var boilerPlate=function(){"use strict";var t={};return t.variantInfo={Amplification:{color:"#FFBDE0",order:0},Homozygous_deletion:{color:"#BDE0FF",order:1},Nonsense_mutation:{color:"#EA3B29",order:2},Splice_site:{color:"#800080",order:3},Translation_start_site:{color:"#AAA8AA",order:4},Missense_mutation:{color:"#3E87C2",order:5},Start_codon_snp:{color:"#3E87C2",order:5},Nonstop_mutation:{color:"#070078",order:6},Frame_shift_indel:{color:"#F68D3B",order:7},Stop_codon_indel:{color:"F68D3B",order:7},In_frame_indel:{color:"#F2EE7E",order:8},Silent:{color:"#5CB755",order:9},Rna:{color:"#FFDF97",order:10},Intron:{color:"#A9A9A9",order:11},"5'utr":{color:"#A9A9A9",order:11},"3'utr":{color:"#A9A9A9",order:11},Igr:{color:"#A9A9A9",order:11}},t.clinicalInfo={alive:{color:"#04CDA4",order:1},dead:{color:"#C50E36",order:2},female:{color:"E0A4E5",order:1},male:{color:"#0F67B6",order:2},"american indian or alaska native":{color:"#38120B",order:1},asian:{color:"#CB771F",order:2},"black or african american":{color:"#302F24",order:3},white:{color:"#9CB1CE",order:4},"hispanic or latino":{color:"#B8642F",order:1},"not hispanic or latino":{color:"#55C53E",order:2},"lung acinar adenocarcinoma":{color:"#716190",order:1},"lung adenocarcinoma mixed subtype":{color:"#5154DE",order:2},"lung adenocarcinoma- not otherwise specified (nos)":{color:"#8E9A7E",order:3},"lung bronchioloalveolar carcinoma mucinous":{color:"#2F91DE",order:4},"lung bronchioloalveolar carcinoma nonmucinous":{color:"#ED6EBD",order:5},"lung clear cell adenocarcinoma":{color:"#1C8D7A",order:6},"lung micropapillary adenocarcinoma":{color:"#B2EE86",order:7},"lung mucinous adenocarcinoma":{color:"#785E54",order:8},"lung papillary adenocarcinoma":{color:"#69B4C4",order:9},"lung signet ring adenocarcinoma":{color:"#C1386E",order:10},"lung solid pattern predominant adenocarcinoma":{color:"#D7A355",order:11},"mucinous (colloid) carcinoma":{color:"#243833",order:12},bronchial:{color:"#F9E3B9",order:1},"l-lower":{color:"#FBA2A3",order:2},"l-upper":{color:"#0CA3C7",order:3},"other (please specify)":{color:"#D3A16C",order:4},"r-lower":{color:"#388A4E",order:5},"r-middle":{color:"#D61E43",order:6},"r-upper":{color:"#B81BCC",order:7},no:{color:"#D73A64",order:1},yes:{color:"#1990AA",order:2},"yes, history of prior malignancy":{color:"#3BDB11",order:3},"yes, history of synchronous/bilateral malignancy":{color:"#803F11",order:4},no:{color:"#D73A64",order:1},yes:{color:"#1990AA",order:2},no:{color:"#D73A64",order:1},yes:{color:"#1990AA",order:2},t1:{color:"#060CDB",order:1},t1a:{color:"#696DE9",order:2},t1b:{color:"#CDCEF7",order:3},t2:{color:"#F6251D",order:4},t2a:{color:"#F96D69",order:5},t2b:{color:"#FDCECD",order:6},t3:{color:"#1AEB42",order:7},t4:{color:"#EBBD34",order:8},tx:{color:"#9943DE",order:9},n0:{color:"#DC5B35",order:1},n1:{color:"#217C1F",order:2},n2:{color:"#18A6F3",order:3},n3:{color:"#EA68C3",order:4},nx:{color:"#F4E831",order:5},m0:{color:"#F0820D",order:1},m1:{color:"#C45A43",order:2},m1a:{color:"#A523C2",order:3},m1b:{color:"#C97BDA",order:4},mx:{color:"#EDD3F2",order:5},"stage i":{color:"#01C606",order:1},"stage ia":{color:"#018404",order:2},"stage ib":{color:"#002C01",order:3},"stage ii":{color:"#0E22C3",order:4},"stage iia":{color:"#08136C",order:5},"stage iib":{color:"#040B41",order:6},"stage iiia":{color:"#BB0C2E",order:7},"stage iiib":{color:"#75081D",order:8},"stage iv":{color:"#F0CA53",order:9},r0:{color:"#DB8EC0",order:1},r1:{color:"#FFD046",order:2},r2:{color:"#495C50",order:3},rx:{color:"#0E5F8A",order:4},"exon 19 deletion":{color:"#4A312A",order:1},l858r:{color:"#74C04C",order:2},l861q:{color:"#FBED09",order:3},other:{color:"#C91DAB",order:4},t790m:{color:"#2C517B",order:5},g12a:{color:"#DED0D1",order:1},g12c:{color:"#AE8A8E",order:2},g12d:{color:"#5D161D",order:3},g12s:{color:"#410F14",order:4},g12v:{color:"#25080B",order:5},other:{color:"#C91DAB",order:6},"complete remission/response":{color:"#BDED73",order:1},"partial remission/response":{color:"#8649F3",order:2},"progressive disease":{color:"#C1746B",order:3},"stable disease":{color:"#CD4C2A",order:4},"complete remission/response":{color:"#BDED73",order:1},"partial remission/response":{color:"#8649F3",order:2},"progressive disease":{color:"#C1746B",order:3},"stable disease":{color:"#CD4C2A",order:4},"Lifelong Non-Smoker":{color:"#C4B5BB",order:1},"Current Smoker":{color:"#896C78",order:2},"Current Reformed Smoker for > 15 yrs":{color:"#3B0A1E",order:3},"Current Reformed Smoker for < or = 15 yrs":{color:"#2F0818",order:4},"Current Reformed Smoker, Duration Not Specified":{color:"#17040C",order:5},NA:{color:"#D6E2E3",order:6}},t.exclusivityInfo={Amplification:"#FFBDE0",Deletion:"#BDE0FF",Mutation:"#5CB755",None:"#D3D3D3"},t},layout=function(){"use strict";function t(t,e,i){if(i)return bio.iteration.loop(i,function(i){var o=!0;bio.iteration.loop(t,function(t){i.indexOf(t)>-1&&(o=!o)}),o&&(n.svg[e][i]=bio.rendering().createSVG(i))}),n.svg[e]}function e(t){var e=(t=Array.prototype.slice.call(t)).map(function(t){return bio.objects.getType(t)});if(e.indexOf("Object")<0)throw new Error("Not found svg set");if(e.indexOf("Function")<0)throw new Error("Not found callback")}var n={svg:{pathway:{},variants:{},landscape:{},expression:{},exclusivity:{}}};return n.landscape=function(e){return t(["option","title"],"landscape",e)},n.variants=function(e){return t(["title"],"variants",e)},n.expression=function(e){return t(["title","function","color_mapping","signature"],"expression",e)},n.exclusivity=function(e){return t(["title","geneset","survival","empty"],"exclusivity",e)},n.pathway=function(e){return t(["title"],"pathway",e)},n.get=function(t,n,i){e(arguments),n="Array"===bio.objects.getType(n)?n:[n],bio.iteration.loop(t,function(t,e){bio.iteration.loop(n,function(n){if(t.indexOf(n)>-1)return i(t,e)})})},n.removeGroupTag=function(t){t?(t="Array"===bio.objects.getType(t)?t:[t],bio.iteration.loop(t,function(t){d3.selectAll(t.indexOf(".")>-1?t:"."+t).remove()})):d3.selectAll("svg g").remove()},function(){return n}},setting=function(){"use strict";function t(t){return o.dom=bio.dom().get(t),o.dom}function e(t){return o.size.width=t.width||parseFloat(o.dom.style.width),o.size.height=t.height||parseFloat(o.dom.style.height),{width:o.size.width,height:o.size.height}}function n(t,e,n,i,a){return o.ids=bio.sizing.chart[t](e,n,i,a),o.ids}function i(t,e){return bio.layout()[t](e)}var o=null;return function(a,r){o=bio.initialize("setting");var l=null;return r.data.data&&r.data.data.name&&(l=r.data.data.group_list),{defaultData:r.data,targetedElement:t(r.element),targetedElementSize:e(r),preprocessData:bio.preprocess(a)(r.data),layoutIds:n(a,o.dom,o.size.width,o.size.height,l),svgs:i(a,o.ids)}}},sizing=function(){"use strict";function t(){document.getElementById("biochart_tooltip")&&document.body.removeChild(document.getElementById("biochart_tooltip"));var t=document.createElement("div");t.id="biochart_tooltip",t.className="biochart-tooltip",document.body.appendChild(t)}function e(e){t(),bio.iteration.loop.call(this,e,function(t,e){var n=document.createElement("div");n.id=t,n.style.width=e.width+"px",n.style.height=e.height+"px",a.ids.push(t),this.appendChild(n)})}function n(t,e,n){return a=bio.initialize("sizing"),t.style.width=e+"px",t.style.height=n+"px",t}function i(t,e,n,i,o){var a=document.createElement("div"),r=document.createElement("div");return a.id=t+"_title",r.id=t+"_contents",a.style.width=n+"px",a.style.height=i*o+"px",r.style.width=n+"px",r.style.height=i*(100-o)+"px",e.appendChild(a),e.appendChild(r),{title:a,contents:r}}function o(t,e,n,i,o){var a=.16*i/t.length,r={patient:{w:.01*n,h:a},axis:{w:.14*n,h:a},group:{w:.65*n,h:a}};return bio.iteration.loop(t,function(t){var n=t.name.removeWhiteSpace(),i="group"===r[o]?"":o;e["landscape_"+i+"_group_"+n]={width:r[o].w.toFixed(1),height:r[o].h.toFixed(1)}}),e}var a={chart:{},ids:[]};return a.setMargin=function(t){if(t.length||"string"!=typeof t){if("Object"===bio.objects.getType(t))return t;var e=t.length;return{top:t[0],left:e>1?t[1]:t[0],bottom:e>2?t[2]:t[0],right:1===e?t[0]:e>3?t[3]:t[1]}}return{top:t,left:t,bottom:t,right:t}},a.chart.landscape=function(t,r,l,s){var c={landscape_temp_sample:{width:.1*r,height:.15*l},landscape_axis_sample:{width:.14*r,height:.15*l},landscape_patient_sample:{width:.01*r,height:.15*l},landscape_sample:{width:.65*r,height:.15*l},landscape_scale_option:{width:.1*r,height:.15*l},landscape_temp_group:{width:.1*r,height:.16*l},landscape_axis_group:{width:.14*r,height:.15*l},landscape_patient_group:{width:.01*r,height:.16*l},landscape_group:{width:.65*r,height:.16*l},landscape_option:{width:.1*r,height:.16*l},landscape_legend:{width:.1*r,height:.64*l},landscape_gene:{width:.14*r,height:.64*l},landscape_patient_heatmap:{width:.01*r,height:.64*l},landscape_heatmap:{width:.65*r,height:.64*l},landscape_pq:{width:.1*r,height:.64*l}},u=i("landscape",t,r,l,.05),d=o(s,{},r,l,"axis"),p=o(s,{},r,l,"group"),f=o(s,{},r,l,"patient");return e.call(n(u.contents,r,.95*l),c),e.call(bio.dom().get("#landscape_group"),p),e.call(bio.dom().get("#landscape_axis_group"),d),e.call(bio.dom().get("#landscape_patient_group"),f),a.ids},a.chart.variants=function(t,o,r){var l={variants_needle:{width:.825*o,height:.825*r},variants_legend:{width:.175*o,height:.5*r},variants_patient_legend:{width:.175*o,height:.425*r},variants_navi:{width:.825*o,height:.1*r}},s=i("variants",t,o,r,.075);return e.call(n(s.contents,o,.925*r),l),a.ids},a.chart.expression=function(t,o,r){var l={expression_survival:{width:.4*o,height:.925*r},expression_bar_plot:{width:.4*o,height:.32*r},expression_function:{width:.2*o,height:.05*r},expression_color_mapping:{width:.2*o,height:.05*r},expression_bar_legend:{width:.2*o,height:.35*r},expression_division:{width:.4*o,height:.04*r},expression_scatter_plot:{width:.4*o,height:.3*r},expression_scatter_empty:{width:.2*o,height:.08*r},expression_scatter_legend:{width:.2*o,height:.2*r},expression_heatmap:{width:.4*o,height:.25*r},expression_signature:{width:.2*o,height:.05*r},expression_color_gradient:{width:.194*o,height:.075*r}},s=i("expression",t,o,r,.075);return e.call(n(s.contents,o,.925*r),l),a.ids},a.chart.exclusivity=function(t,o,r){var l={exclusivity_select_geneset:{width:.59*o,height:.12*r},exclusivity_survival:{width:.4*o,height:.925*r},exclusivity_network:{width:.25*o,height:.65*r},exclusivity_heatmap:{width:.35*o,height:.45*r},exclusivity_legend:{width:.35*o,height:.05*r},exclusivity_sample_legend:{width:.35*o,height:.05*r}},s=i("exclusivity",t,o,r,.075);return e.call(n(s.contents,o,.925*r),l),a.ids},a.chart.pathway=function(t,o,r){var l={},s=i("pathway",t,o,r,.075);return e.call(n(s.contents,o,.925*r),l),a.ids},a.chart.default=function(t,e){return t.id=e.element.attr("id"),t.margin=e.margin?bio.sizing.setMargin(e.margin):null,t.width=parseFloat(e.element.attr("width")),t.height=parseFloat(e.element.attr("height")),t.element="Object"===bio.objects.getType(e.element)||"Array"===bio.objects.getType(e.element)?e.element:/\W/.test(e.element[0])?d3.select(e.element):d3.select("#"+e.element),t},a},commonConfig=function(){"use strict";var t={};return t.typeFormat=function(t){return t.replace(/(_ins|_del)$/gi,"_indel").pronoun()},function(){return t}},exclusivityConfig=function(){"use strict";function t(t){return"B"===t?["A","M"]:"E"===t?["D","M"]:"M"===t?[".","M"]:[t]}function e(t,e){return"var"===t?"Mutation":e.toUpperCase().indexOf("AMP")>-1?"Amplipication":"Deletion"}function n(t){return"Amplification"===t?"A":"Homozygous_deletion"===t?"D":"M"}function i(t){return{Amplification:"A",Deletion:"D",Mutation:"M",None:"."}[t]}function o(t){return{A:"Amplification",D:"Deletion",M:"Mutation",".":"None"}[t]}function a(t){return{Amplification:0,Deletion:1,Mutation:2,None:3}[t]}function r(t,e,n){var i=null;return{legend:{attr:{x:function(t,n,o){var a=i||0,r=t.text.replace(" ","H");return i=i?i+bio.drawing().textSize.width(r,"10px"):bio.drawing().textSize.width(r,"10px")+5,e+a},y:function(t,e,n){return"**"===t.text?18:15}},style:{fill:function(t,e,n){return t.color},fontSize:function(t,e,n){return"**"===t.text?"12px":"10px"}},text:function(t,e,n){return t.text}},division:{attr:{x:function(t,i,o){var a=bio.drawing().textSize.width(t.text,"14px");return"#00AC52"===t.color?n.attr("width")-(10+a):e},y:function(t,e,i){return.05*n.attr("height")}},style:{fill:function(t,e,n){return t.color},fontSize:"14px"},text:function(t,e,n){if("**"===t.text)return t.text}}}[t]}function l(t){var e=".exclusivity_legend_svg.legend-shape-g-tag",n=".exclusivity_legend_svg.legend-text-g-tag";return{margin:[0,t,0,0],attr:{x:function(t,e,n){return"text"===this.tagName?e*(1.3*n.fontWidth.value)+5:e*(1.3*n.fontWidth.value)},y:function(t,e,n){return"text"===this.tagName?.8*n.height/2+.2*n.height:t.indexOf("Mutation")>-1?.2*n.height+.8*n.height/4.5:.2*n.height},width:2.5,height:function(t,e,n){return"Mutation"===t?.8*n.height/2:.8*n.height}},style:{fill:function(t,e,n){return"text"===this.tagName?"#333333":bio.boilerPlate.exclusivityInfo[t]},fontSize:"11px"},on:{mouseover:function(t,i,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(n,a),s=bio.rendering().opacity(bio.boilerPlate.exclusivityInfo[t],.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,i,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(n,a);d3.select(r).transition(10).style("fill",bio.boilerPlate.exclusivityInfo[t]),d3.select(l).style("font-weight","normal")}},text:function(t,e,n){return t}}}function s(){return{}}function c(t,e,n){var i=e.attr("height");return{shape:{margin:[.2*i,n,0,10],attr:{x:function(t,e,n){return n.scaleX(t.x)},y:function(t,e,n){return"Mutation"===t.value?n.scaleY(t.y)+bio.scales().band(n.scaleY)/3:n.scaleY(t.y)},width:function(t,e,n){return bio.scales().band(n.scaleX)},height:function(t,e,n){return"Mutation"===t.value?bio.scales().band(n.scaleY)/3:bio.scales().band(n.scaleY)}},style:{fill:function(t,e,n){return bio.boilerPlate.exclusivityInfo[t.value]}}},axis:{margin:[.2*i,n,0,10],range:[.2*i,i]}}[t]}function u(){return{attr:{x:function(t,e,n){return d3.select(".legend").node().getBoundingClientRect().width},y:function(t,e,n){return d3.select(".legend text").node().getBoundingClientRect().height/3}},style:{fill:function(t,e,n){var i=null;return bio.iteration.loop(n.data.sample.isAltered,function(e){e.text===t.text&&(i=t.color)}),i||"none"},fontSize:"25px"},text:function(t,e,n){return"**"}}}function d(t){return{margin:[20,t,0,9],attr:{x:function(t,e,n){return"text"===this.tagName?t.text.indexOf("Un")>-1?t.end-t.textWidth-n.margin.right:t.start+n.margin.right:"path"===this.tagName?t.path_x:t.start},y:function(t,e,n){return"text"===this.tagName?.05*n.height+n.margin.top:"path"===this.tagName?0===e?n.margin.top:t.path_y:n.margin.top},width:function(t,e,n){return t.end-t.start},height:function(t,e,n){return.1*n.height}},style:{fill:function(t,e,n){return"text"===this.tagName?"#FFFFFF":t.color},stroke:function(t,e,n){return"path"===this.tagName?"#333333":"none"},fontSize:"11px"},text:function(t,e,n){return t.text}}}return function(){return{name:o,symbol:i,byCase:e,legend:l,sample:r,network:s,heatmap:c,survival:u,separate:t,priority:a,division:d,abbreviation:n}}},expressionConfig=function(){"use strict";function t(t){return{width:t?t.attr("width"):0,height:t?t.attr("height"):0}}function e(t){var e=".expression_bar_legend_svg.legend-shape-g-tag",n=".expression_bar_legend_svg.legend-text-g-tag",i=".expression_scatter_legend_svg.legend-shape-g-tag",o=".expression_scatter_legend_svg.legend-text-g-tag";return{color_mapping:{margin:[10,15,0,0],attr:{x:function(t,e,n){return"text"===this.tagName?n.margin.left:0},y:function(t,e,n){return"text"===this.tagName?e*n.fontHeight+n.fontHeight/2-1.5:e*n.fontHeight},width:8,height:8},style:{fill:function(t,e,n){return"text"===this.tagName?"#333333":"NA"===t?"#A4AAA7":c[e]},fontSize:"11px"},on:{mouseover:function(t,i,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(n,a),s=bio.rendering().opacity("NA"===t?"#A4AAA7":c[i],.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,i,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(n,a);d3.select(r).transition(10).style("fill","NA"===t?"#A4AAA7":c[i]),d3.select(l).style("font-weight","normal")}},text:function(t,e,n){return bio.drawing().textOverflow(t,"11px",.75*n.width)}},scatter:{margin:[15,15,20,15],attr:{cx:0,cy:function(t,e,n){return e*(n.fontHeight+3)},r:5,x:function(t,e,n){return n.margin.left},y:function(t,e,n){return e*(n.fontHeight+3)+1}},style:{fill:function(t,e,n){return"Alive"===t?"#5D5DD8":"#D86561"},fontSize:"11px"},on:{mouseover:function(t,e,n){var a=n.legendData.indexOf(t),r=bio.drawing().nthChild(i,a),l=bio.drawing().nthChild(o,a),s=bio.rendering().opacity("Alive"===t?"#5D5DD8":"#D86561",.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,e,n){var a=n.legendData.indexOf(t),r=bio.drawing().nthChild(i,a),l=bio.drawing().nthChild(o,a);d3.select(r).transition(10).style("fill","Alive"===t?"#5D5DD8":"#D86561"),d3.select(l).style("font-weight","normal")}},text:function(t,e,n){return t}}}[t]}function n(t,e){return{shape:{margin:[10,e,30,20],attr:{cx:function(t,e,n){return n.scaleX(t.x)},cy:function(t,e,n){return n.scaleY(t.y)},r:5},style:{fill:function(t,e,n){return void 0===t.value?"#333333":1===t.value?"#D86561":"#5D5DD8"},fillOpacity:.6},on:{mouseover:function(t,e,n){bio.tooltip({element:this,contents:"ID: <b>"+t.x+"</b></br>Months: <b>"+t.y+"</b></br>Status: <b>"+("0"===t.value?"Alive":"Dead")+"</b>"})},mouseout:function(t,e,n){bio.tooltip("hide")}}},axis:{top:0,left:e,margin:[0,0,0,0],exclude:"path, line"}}[t]}function i(t,e){return{shape:{margin:[0,e,0,20],attr:{x:function(t,e,n){return n.scaleX(t.x)},y:function(t,e,n){return n.scaleY(t.y)},width:function(t,e,n){return bio.scales().band(n.scaleX)},height:function(t,e,n){return bio.scales().band(n.scaleY)}},on:{mouseover:function(t,e,n){bio.tooltip({element:this,contents:"ID: <b>"+t.x+"</b></br>Gene: <b>"+t.y+"</b></br>TPM: <b>"+t.value+"</b></br>"})},mouseout:function(t,e,n){bio.tooltip("hide")}}},axis:{top:0,left:e,margin:[0,0,0,0],exclude:"path, line"}}[t]}function o(t){return{margin:[0,t,0,20],attr:{points:function(t,e,n){var i=n.id.indexOf("bar")>-1?t.y-t.value<0?n.scaleY(t.y)+8:n.scaleY(t.y)+3:n.height,o=n.id.indexOf("bar")>-1&&t.y-t.value<0?"top":"bottom";return bio.rendering().triangleStr(n.scaleX(t.x),i,10,o)}},style:{fill:"#333333"},on:{mouseover:function(t,e,n){bio.tooltip({element:this,contents:"<b>"+t.x+"</b></br>Value: <b>"+t.value+"</b></br>"})},mouseout:function(t,e,n){bio.tooltip("hide")}}}}function a(t,e){return{shape:{margin:[20,e+1,15,19],attr:{x:function(t,e,n){return n.scaleX(t.x)},y:function(t,e,n){return t.y-t.value<0?n.scaleY(t.value):n.scaleY(t.y)},width:function(t,e,n){return bio.scales().band(n.scaleX)},height:function(t,e,n){return t.y-t.value<0?n.scaleY(t.y)-n.scaleY(t.value):n.scaleY(t.value)-n.scaleY(t.y)}},style:{fill:function(t,e,n){return t.y-t.value==0?"#000000":"#62C2E0"},stroke:function(t,e,n){return t.y-t.value==0?"#000000":"#62C2E0"}},on:{mouseover:function(t,e,n){bio.tooltip({element:this,contents:"ID: <b>"+t.x+"</b></br>Average: <b>"+t.value+"</b>"})},mouseout:function(t,e,n){bio.tooltip("hide")}}},axis:{top:0,left:e,margin:[10,0,10,0]}}[t]}function r(e,n){return{axis:{top:20,left:0,margin:[0,5,0,10],exclude:"path, line",range:[5,t(n).width-10]},shape:{attr:{x:5,y:5,rx:3,ry:3,width:function(t,e,n){return d3.select(bio.drawing().getParentSVG(this)).attr("width")-10},height:15},style:{fill:function(t,e,n){return"url(#"+n.data.colorGradient.id+")"}}}}[e]}function l(t,e){function n(t,e,n){t.attr("points",function(t,i,o){return bio.rendering().triangleStr(n+e.additional,e.path_y,10,e.direction)})}function i(t,e){var n=t.attr("d"),i=n.substring(n.indexOf("M")+1,n.indexOf(","));t.attr("d",n.replace(new RegExp(i,"gi"),e))}var o=".division-path-0-g-tag path",a="#expression_division_svg_division_shape_rect";return{bar:{margin:[0,e,0,20]},division:{margin:[0,e,0,20],attr:{x:function(t,e,n){return n.position.init.low=n.position.init.low?n.position.init.low:t.path_x,n.position.init.high=n.position.init.high?n.position.init.high:t.path_x,n.position.now.low=n.position.init.low,n.position.now.high=n.position.init.high,"text"===this.tagName?t.text.indexOf("Low")>-1?t.start+5:t.end-t.textWidth-15:"path"===this.tagName?t.path_x:t.start},y:function(t,e,n){return"text"===this.tagName?n.height/2:"path"===this.tagName?t.text.indexOf("Low")>-1?0===e?t.path_y-5:t.path_y:0===e?t.path_y:t.path_y+5:0},points:function(t,e,n){return bio.rendering().triangleStr(t.path_x+t.additional,t.path_y,10,t.direction)},width:function(t,e,n){return t.end-t.start},height:function(t,e,n){return n.height},rx:3,ry:3},style:{fill:function(t,e,n){return"text"===this.tagName?"#FFFFFF":t.text.indexOf("Low")>-1?"#00AC52":"#FF6252"},stroke:function(t,e,n){return"text"===this.tagName?t.text.indexOf("Low")>-1?"#00AC52":"#FF6252":"none"},strokeWidth:"0.5px",fontSize:"12px",fontWeight:"bold",cursor:function(t,e,n){return"polygon"===this.tagName?"pointer":"normal"}},call:{drag:function(t,e,r){if(t.text.indexOf("Low")>-1){r.position.init.low=r.position.init.low?r.position.init.low:t.path_x,r.position.now.low=r.position.now.low?r.position.now.low+=d3.event.dx:t.path_x;l=r.position.now.low=Math.max(t.start,Math.min(r.position.now.high||t.path_x,r.position.now.low));n(d3.select(this),t,r.position.now.low),i(d3.select(o),l),d3.selectAll(a).attr("width",function(e,n,i){return e.text===t.text?l-e.start:e.end-r.position.now.high})}else{r.position.init.high=r.position.init.high?r.position.init.high:t.path_x,r.position.now.high=r.position.now.high?r.position.now.high+=d3.event.dx:t.path_x;var l=r.position.now.high=Math.max(r.position.now.low||t.path_x,Math.min(t.end,r.position.now.high)),s=d3.select(o).attr("d");s.substring(s.indexOf("M")+1,s.indexOf(","));n(d3.select(this),t,r.position.now.high),i(d3.select(".division-path-1-g-tag path"),l),d3.selectAll(a).attr("x",function(e,n,i){return e.text===t.text?l:e.start}).attr("width",function(e,n,i){return e.text===t.text?e.end-l:r.position.now.low-e.start})}}},text:function(t,e,n){return t.text}},scatter:{margin:[0,e,0,20]}}[t]}function s(t){return{legend:{attr:{x:function(t,e,n){var i=d3.select(".legend").node().getBoundingClientRect();return i.right-i.left},y:function(t,e,n){var i=d3.select(".legend text").node().getBoundingClientRect();bio.drawing().textSize.height("11px");return i.height/2.5}},style:{fill:function(t,e,n){return n.data.patient.data===t.text?t.color:"#FFFFFF"}},text:function(t,e,n){return n.data.patient.data===t.text?" **"===n.data.patient.data?"":" **":""}}}[t]}var c=["#B82647","#0A8D5E","#F9D537","#0B6DB7","#E3DDCB","#9F494C","#CBDD61","#ED9149","#89236A","#D8C8B2","#CA5E59","#006494","#2E674E","#9A6B31","#403F95","#616264","#E2A6B4","#5AC6D0","#733E7F","#45436C"];return function(){return{bar:a,legend:e,scatter:n,heatmap:i,patient:o,gradient:r,colorSet:c,division:l,survival:s}}},landscapeConfig=function(){"use strict";function t(t){return bio.boilerPlate.variantInfo[bio.commonConfig().typeFormat(t)].order<2?"cnv":"var"}function e(t,e,n){if("common"===t)return{on:{mouseover:function(t,e){var n=this.parentNode.parentNode.className.baseVal;if(n.indexOf("gene")>-1&&n.indexOf("right")>-1||n.indexOf("group")>-1){var i=n.indexOf("gene")>-1?"Sort by <b>"+this.innerHTML+"</b>":"<b>"+this.innerHTML+"</b></br>Click to sort </br> Alt + Click add to key";bio.tooltip({element:this,contents:i}),d3.select(this).transition().style("font-size",12).style("font-weight","bold")}},mouseout:function(t,e){bio.tooltip("hide"),d3.select(this).transition().style("font-size",10).style("font-weight","normal")}}};var i=parseFloat(n.attr("width")),o=parseFloat(n.attr("height"));return{sampleY:{top:5,left:i-5,direction:"left",range:[5,o-25],margin:[5,0,25,0]},groupY:{top:5,left:30,range:[0,0],direction:"right",margin:[0,0,0,0],exclude:"path, line",on:{click:function(t,e,n){return bio.iteration.loop(n.data.axis.group.y,function(e,i){if(e[0]===t){var o=[].concat(n.data.group.group[i]);n.now.group=bio.landscapeSort().group.call(n,o,!!d3.event.altKey)}}),{sorted:{axis:"x",data:function(t){var e=[];return bio.iteration.loop(t,function(t){e=e.concat(t)}),e}(n.now.group.axis.data)},model:n}}}},geneY:{top:0,left:i-70,direction:"right",range:[10,o-45],exclude:"path, line",margin:[10,0,45,0],on:{click:function(t,e,n){var i=[];return bio.iteration.loop(n.data.heatmap,function(e){e.y===t&&i.push(e)}),{sorted:bio.landscapeSort().gene(n.data.axis.heatmap.x,i),model:n}}}},geneX:{left:15,top:o-45,range:[15,i-85],direction:"bottom",margin:[0,15,0,85]},pqX:{left:5,top:o-45,direction:"bottom",range:[10,i-20],margin:[0,10,20,20]}}[t+e]}function n(t){return{pq:{margin:[5,15,13,5],attr:{rx:3,ry:3,x:function(t,e,n){return"text"===this.tagName?n.margin.left:n.margin.left-n.margin.right},y:function(t,e,n){return"text"===this.tagName?n.height-n.margin.bottom:n.height-1.75*n.margin.bottom},width:function(t,e,n){return n.mostWidth.value+2*n.margin.right},height:function(t,e,n){return n.mostHeight+n.margin.top}}},gene:{margin:[5,5,13,125],attr:{rx:3,ry:3,x:function(t,e,n){return"text"===this.tagName?n.width-n.margin.right:n.width-n.margin.right-n.margin.left},y:function(t,e,n){return"text"===this.tagName?n.height-n.margin.bottom:n.height-1.75*n.margin.bottom},width:function(t,e,n){return n.mostWidth.value-2*n.margin.left},height:function(t,e,n){return n.mostHeight+n.margin.top}}},sample:{margin:[10,6.5,25,45],attr:{rx:3,ry:3,x:function(t,e,n){return"text"===this.tagName?-1*n.height+n.margin.bottom:-1*n.height+.65*n.margin.bottom},y:function(t,e,n){return"text"===this.tagName?n.width-n.margin.right:n.width-n.margin.right-n.margin.top},width:function(t,e,n){return n.mostWidth.value-n.margin.left},height:function(t,e,n){return n.mostHeight+n.margin.top/2}}},common:{titles:["#Mutations","-log10(p-value)"],style:{fontSize:"10px",fontWeight:"bold",filter:"url(#drop_shadow)",fill:function(t,e,n){return"text"===this.tagName?"#FFFFFF":"#595959"}},on:{click:function(t,e,n){return{sorted:bio.landscapeSort()[n.now.sort[n.sortName]](n.sortName,n.data),model:n}},mouseover:function(t,e,n){bio.tooltip({element:"text"===this.tagName?this.nextSibling?this.nextSibling:this.previousSibling:this,contents:"Sort by <b>"+t.text+"</b>"})},mouseout:function(t,e,n){bio.tooltip("hide")}},text:function(t,e,n){return t.text}}}[t]}function i(t){return{pq:{margin:[10,15,45.5,30],attr:{x:function(t,e,n){return bio.math.min(n.rangeX)},y:function(t,e,n){return n.scaleY(t.y)+.25},width:function(t,e,n){return n.scaleX(t.value)},height:function(t,e,n){return bio.scales().band(n.scaleY)-.5}},style:{fill:"#BFBFBF"},on:{mouseover:function(t,e,n){bio.tooltip({element:this,contents:"<b>"+t.y+"</b></br>Value: <b>"+t.value+"</b>"}),d3.select(this).transition(10).style("fill","#7A7A7A").style("filter","url(#drop_shadow)")},mouseout:function(t,e,n){bio.tooltip("hide"),d3.select(this).transition(10).style("fill","#BFBFBF").style("filter","none")}}},gene:{margin:[10,30,45.5,70],attr:{x:function(t,e,n){return n.scaleX(t.x+t.value)+.125},y:function(t,e,n){return n.scaleY(t.y)+.25},width:function(t,e,n){return n.scaleX(t.x)-n.scaleX(t.x+t.value)-.25},height:function(t,e,n){return bio.scales().band(n.scaleY)-.5}},style:{fill:function(t,e,n){return bio.boilerPlate.variantInfo[t.info].color}},on:{mouseover:function(t,e,n){var i=bio.rendering().opacity(bio.boilerPlate.variantInfo[t.info].color,.3);bio.tooltip({element:this,contents:"<b>"+t.y+"</b></br>Type: <b>"+t.info+"</b></br>Count: <b>"+t.value+"</b>"}),d3.select(this).transition(10).style("fill",i).style("filter","url(#drop_shadow)")},mouseout:function(t,e,n){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.variantInfo[t.info].color).style("filter","none")}}},sample:{margin:[10,5,20,0],attr:{x:function(t,e,n){return n.scaleX(t.x)+.25},y:function(t,e,n){return n.scaleY(t.y+t.value)+.25},width:function(t,e,n){return bio.scales().band(n.scaleX)-.5},height:function(t,e,n){return n.scaleY(t.y)-n.scaleY(t.y+t.value)-.5}},style:{fill:function(t,e,n){return bio.boilerPlate.variantInfo[t.info].color}},on:{mouseover:function(t,e,n){var i=bio.rendering().opacity(bio.boilerPlate.variantInfo[t.info].color,.3);bio.tooltip({element:this,contents:"<b>"+t.x+"</b></br>Type: <b>"+t.info+"</b></br>Count: <b>"+t.value+"</b>"}),d3.select(this).transition(10).style("fill",i).style("filter","url(#drop_shadow)")},mouseout:function(t,e,n){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.variantInfo[t.info].color).style("filter","none")}}}}[t]}function o(e){return{heatmap:{margin:[10,5,45.5,0],attr:{x:function(t,e,n){return n.scaleX(t.x)},y:function(e,n,i){return"cnv"!==t(e.value)?bio.scales().band(i.scaleY)/3+i.scaleY(e.y):i.scaleY(e.y)},width:function(t,e,n){return bio.scales().band(n.scaleX)},height:function(e,n,i){return"cnv"!==t(e.value)?bio.scales().band(i.scaleY)/3:bio.scales().band(i.scaleY)}},style:{fill:function(t,e,n){return bio.boilerPlate.variantInfo[t.value].color}},on:{mouseover:function(t,e,n){var i=bio.rendering().opacity(bio.boilerPlate.variantInfo[t.value].color,.3),o="";t.info.length>0&&bio.iteration.loop(t.info,function(t){o+="</br><b>"+t+"</b>"}),bio.tooltip({element:this,contents:"<b>Gene mutations</b></br>X: <b>"+t.x+"</b></br>Y: <b>"+t.y+"</b></br>Type: </br><b>"+t.value+"</b>"+o}),d3.select(this).transition(10).style("fill",i).style("filter","url(#drop_shadow)")},mouseout:function(t,e,n){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.variantInfo[t.value].color).style("filter","none")}}},group:{margin:[0,5,7,0],attr:{x:function(t,e,n){return n.scaleX(t.x)||n.margin.left},y:function(t,e,n){return n.scaleY(t.y)},width:function(t,e,n){return bio.scales().band(n.scaleX)},height:function(t,e,n){return bio.scales().band(n.scaleY)}},style:{fill:function(t,e,n){return bio.boilerPlate.clinicalInfo[t.value].color}},on:{mouseover:function(t,e,n){var i=bio.rendering().opacity(bio.boilerPlate.clinicalInfo[t.value].color,.3);bio.tooltip({element:this,contents:"<b>"+t.y+"</b></br>Sample: <b>"+t.x+"</b></br>Value: <b>"+t.value+"</b></br>"}),d3.select(this).transition(10).style("fill",i).style("filter","url(#drop_shadow)")},mouseout:function(t,e,n){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.clinicalInfo[t.value].color).style("filter","none")}}}}[e]}function a(){var e=".legend-shape-g-tag",n=".legend-text-g-tag";return{margin:[20,15,5,15],attr:{x:function(t,e,n){return"text"===this.tagName?n.margin.left:0},y:function(e,n,i){var o="text"===this.tagName?n*(i.fontHeight+i.padding):n*(i.fontHeight+i.padding)-i.fontHeight/2-1;return"rect"===this.tagName&&"var"===t(e)?o+i.fontHeight/4:o},width:function(t,e,n){return n.fontHeight/2},height:function(e,n,i){return"var"===t(e)?i.fontHeight/2:i.fontHeight}},style:{fill:function(t,e,n){return"text"===this.tagName?"#333333":bio.boilerPlate.variantInfo[t].color},fontSize:"11px"},on:{mouseover:function(t,i,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(n,a),s=bio.rendering().opacity(bio.boilerPlate.variantInfo[t].color,.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,i,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(n,a);d3.select(r).transition(10).style("fill",bio.boilerPlate.variantInfo[t].color),d3.select(l).style("font-weight","normal")}},text:function(t,e,n){return t}}}return function(){return{bar:i,axis:e,legend:a,byCase:t,title:n,heatmap:o}}},pathwayConfig=function(){"use strict";function t(t){if(t){var e=bio.scales().get([0,50],[1,.5]),n=d3.hsl("Y"===t.active?"red":"blue");return n.l=e(t.frequency),n}return"#d0d0d0"}function e(t){var e=d3.select(t).node().parentNode.id;return e.substring(e.lastIndexOf("_")+1,e.length).toUpperCase()}function n(){return{style:{fill:function(e,n,i){return"rect"===this.tagName?t(e):e&&e.frequency>=30?"#F2F2F2":"#333333"}},on:{mouseover:function(t,n,i){var o="rect"===this.tagName?this:d3.select(this.parentNode).select("rect").node(),a=t?t.frequency:"NA",r=t?"Y"===t.active?"RED":"BLUE":"#E8E8E8",l=t?"Y"===t.active?"Activated":"Inactivated":"NA",s=e(this);bio.tooltip({element:o,contents:"<b>"+s+"</b></br>frequency : "+a+'</br><span style="color : '+r+'"><b>'+l+"</b></span>"})},mouseout:function(t,e,n){bio.tooltip("hide")}}}}function i(){function t(t){var e="mouseout"===d3.event.type?0:1,n=e?.02:0,i=e?-5:0;d3.select(this).transition().attr("transform",function(){return"matrix("+(t.scaleX+n)+", 0, 0, "+(t.scaleY+n)+", "+(t.translateX+i)+", "+(t.translateY+i)+")"}).style("cursor","pointer").selectAll("path").style("stroke",e?"#FBFD24":"#FFFFFF").style("stroke-width",e?20:0)}function e(t){return t.nci_id?"http://www.cancer.gov/about-cancer/treatment/drugs/"+t.nci_id:!t.nci_id&&t.dailymed_id?"http://www.dailymed.nlm.nih.gov/dailymed/drugInfo.cfm?setid="+t.dailymed_id:null}function n(t){var e=o.drug_color[t].color,n=document.querySelector("#legend_icon_"+e).cloneNode(!0),i=document.createElement("svg");return n.setAttribute("transform","matrix(0.04, 0, 0, 0.04, 10, 0)"),i.setAttribute("width",40),i.setAttribute("height",20),i.appendChild(n),i.outerHTML}return{on:{click:function(t,i,o){var a=this.id.split("_")[1],r=document.querySelector(".modal-title"),l=document.querySelector(".modal-body");$.ajax({type:"POST",url:"/files",data:{name:"drug"},success:function(t){r.innerHTML='<div id="modal_gene_title">Available drugs</div><div id="modal_gene_name">'+a.toUpperCase()+"</div>",bio.table({height:380,element:l,heads:["Type","Drug","Level of approval","Treated Cancer","Reference"],data:t.data.egfr,columns:function(t,i,o,a,r){if(0===t)return n(a.drug_type);if(1===t){var l=e(a);return l?a.agent+'<a class="drug-link" href='+l+" target='drug'><i class=\"fa fa-external-link\"></i></a>":a.agent}return 2===t?a.drug_class:3===t?a.cancer:4===t?a.source:void 0}})},error:function(t){console.log("Error: ",t)}}),$("#drug_modal").modal({keyboard:!1,backdrop:"static"})},mouseover:t,mouseout:t}}}var o={drug_color:{type1:{class:"agent-red",color:"red"},type2:{class:"agent-blue",color:"blue"},type3:{class:"agent-black",color:"black"}}};return function(){return{node:n,drug:i}}},variantsConfig=function(){"use strict";function t(t){return 3*Math.sqrt(t)/1.25}function e(t,e,n){if("common"===t)return{};var i=parseFloat(n.attr("width")),o=parseFloat(n.attr("height"));return{needleX:{top:o-35,left:0,direction:"bottom",range:[40,i-40],margin:[10,40,35,40]},needleY:{top:0,left:40,direction:"left",range:[20,o-80],margin:[20,40,80,0]}}[t+e]}function n(t){var e=".legend-shape-g-tag",n=".legend-text-g-tag",i=".variants_patient_legend_svg"+e,o=".variants_patient_legend_svg"+n;return{needle:{margin:[15,10,5,15],attr:{cx:function(t,e,n){return n.margin.left},cy:function(t,e,n){return e*(n.fontHeight+5)},r:5,x:function(t,e,n){return"text"===this.tagName?2*n.margin.left:n.margin.left},y:function(t,e,n){return e*(n.fontHeight+5)+1}},style:{fill:function(t,e,n){return"text"===this.tagName?"#333333":bio.boilerPlate.variantInfo[t].color}},on:{mouseover:function(t,i,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(n,a),s=bio.rendering().opacity(bio.boilerPlate.variantInfo[t].color,.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,i,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(n,a);d3.select(r).transition(10).style("fill",bio.boilerPlate.variantInfo[t].color),d3.select(l).style("font-weight","normal")}},text:function(t,e,n){return t}},patient:{margin:[15,10,5,15],attr:{x:function(t,e,n){return"text"===this.tagName?2*n.margin.left:n.margin.left},y:0,points:function(t,e,n){return bio.rendering().triangleStr(n.margin.left,-5,8,"top")}},style:{fill:function(t,e,n){return"text"===this.tagName?"#333":"#FFFFFF"},stroke:function(t,e,n){return"text"===this.tagName?"none":"#333333"},strokeWidth:"1px"},on:{mouseover:function(t,e,n){var a=n.legendData.indexOf(t),r=bio.drawing().nthChild(i,a),l=bio.drawing().nthChild(o,a),s=bio.rendering().opacity("#333333",.3);d3.select(r).transition(10).style("stroke",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,e,n){var a=n.legendData.indexOf(t),r=bio.drawing().nthChild(i,a),l=bio.drawing().nthChild(o,a);d3.select(r).transition(10).style("stroke","#333333"),d3.select(l).style("font-weight","normal")}},text:function(t,e,n){return t}}}[t]}function i(){return{margin:[20,40,80,40],attr:{cx:function(t,e,n){var i=n.scaleX(t.x);return i>n.width-n.margin.right||i<n.margin.left?i*n.width:i},cy:function(t,e,n){return n.scaleY(t.y)},r:function(e,n,i){return t(e.value)},x:function(t,e,n){var i=n.scaleX(t.x);return i>n.width-n.margin.right||i<n.margin.left?i*n.width:i},y:function(t,e,n){return n.scaleY(t.y)}},style:{fill:function(t,e,n){return"path"===this.tagName?"#A8A8A8":n.id.indexOf("needle")>-1?bio.boilerPlate.variantInfo[t.info[0].type].color:bio.rendering().opacity(bio.boilerPlate.variantInfo[t.info[0].type].color,.3)},stroke:function(t,e,n){return"path"===this.tagName?"#A8A8A8":"none"}},on:{mouseover:function(t,e,n){var i=bio.rendering().opacity(bio.boilerPlate.variantInfo[t.info[0].type].color,.5);bio.tooltip({element:this,contents:"Type: <b>"+t.info[0].type+"</b></br>AAChange: <b>"+t.info[0].aachange+"</b></br>Counts: <b>"+t.y+"</b></br>Position: <b>"+t.x+"</b>"}),d3.select(this).transition(10).style("fill",i)},mouseout:function(t,e,n){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.variantInfo[t.info[0].type].color)}}}}function o(){return{margin:[0,40,5,40],end:{init:0,now:0},start:{init:0,now:0},navi:{init:0,now:0,width:0,nowWidth:0},attr:{x:function(t,e,n){return"main"===t?n.start:"end"===t?n.end+n.margin.left-n.controls.width:n.start-n.controls.width},y:function(t,e,n){return"main"===t?0:.25*n.height},width:function(t,e,n){return"main"===t?n.end:2*n.controls.width},height:function(t,e,n){return"main"===t?n.height-n.margin.bottom:n.controls.height},rx:function(t,e,n){return"main"===t?3:5},ry:function(t,e,n){return"main"===t?3:5}},style:{fill:function(t,e,n){return"main"===t?"rgba(255, 255, 50, 0.1)":"#A8A8A8"},stroke:function(t,e,n){return"main"===t?"#FFDF6D":"#EAECED"},strokeWidth:function(t,e,n){return"main"===t?"1px":"2px"},cursor:function(t,e,n){return"main"===t?"move":"ew-resize"}},call:{drag:function(t,e,n){function i(t){return l[t].now+=d3.event.dx,l[t].now=Math.max(l.start["end"===t?"now":"init"],Math.min(l.end["end"===t?"init":"now"],l["end"===t?"end":"start"].now)),l[t].now}var o=d3.select("#variants_navi_svg_navi_main_rect"),a=d3.select("#variants_navi_svg_navi_start_rect"),r=d3.select("#variants_navi_svg_navi_end_rect"),l=n.opts.drag;if("start"===t)d3.select(this).attr("x",i(t)),l.navi.now=l.navi.init+(l.start.now-l.start.init),l.navi.nowWidth=l.navi.width-(l.end.init-l.end.now)-(l.start.now-l.start.init),o.attr("x",l.navi.now).attr("width",l.navi.nowWidth);else if("end"===t)d3.select(this).attr("x",i(t)),l.navi.nowWidth=l.navi.width-(l.start.now-l.start.init)-(l.end.init-l.end.now),o.attr("width",l.navi.nowWidth);else{l.navi.now+=d3.event.dx;var s=l.navi.now=Math.max(l.navi.init,Math.min(l.navi.width+n.margin.left-l.navi.nowWidth,l.navi.now));l.start.now=s-n.controls.width,l.end.now=s+l.navi.nowWidth-n.controls.width,o.attr("x",s),a.attr("x",l.start.now),r.attr("x",l.end.now)}}}}}function a(){return{margin:[20,40,80,40],attr:{x:function(t,e,n){var i=n.scaleX(t.x);return this.id.indexOf("base")>-1?n.margin.left:this.id.indexOf("text")>-1?i+5:i<n.margin.left?n.margin.left:i>n.width-n.margin.right?n.width-n.margin.right:i},y:function(t,e,n){var i=.4*(n.height-10-(n.height-n.margin.bottom));return"text"!==this.tagName?n.height-n.margin.bottom:n.height-n.margin.bottom+i/2},width:function(t,e,n){var i=n.scaleX(t.x),o=n.scaleX(t.x+t.width);if(i<n.margin.left){if((o-=n.margin.left-i)<0)return 0}else if(i+(o-i)>n.width-n.margin.right&&(o-=i+o-i-(n.width-n.margin.right))-i<0)return 0;return this.id.indexOf("base")>-1?n.width-n.margin.left-n.margin.right:o-i},height:function(t,e,n){return.4*(n.height-10-(n.height-n.margin.bottom))},rx:function(t,e,n){return this.id.indexOf("base")>-1?1:3},ry:function(t,e,n){return this.id.indexOf("base")>-1?1:3}},style:{fill:function(t,e,n){return this.id.indexOf("base")>-1?"#DADFE1":this.id.indexOf("text")>-1?"#FFFFFF":t.color}},on:{mouseover:function(t,e,n){var i=this.id.indexOf("base")>-1?null:"text"===this.tagName?this.previousSibling?this.previousSibling:this.nextSibling:this,o=bio.rendering().opacity(t.color,.5);i&&(bio.tooltip({element:i,contents:"<b>"+t.info.identifier+"</b></br>Desc: <b>"+t.info.description+"</b></br>Section: <b>"+t.x+" - "+(t.x+t.width)+"</b>"}),d3.select(i).transition(10).style("fill",o))},mouseout:function(t,e,n){var i=this.id.indexOf("base")>-1?null:"text"===this.tagName?this.previousSibling?this.previousSibling:this.nextSibling:this;i&&(bio.tooltip("hide"),d3.select(i).transition(10).style("fill",t.color))}},text:function(t,e,n){var i=n.scaleX(t.x),o=n.scaleX(t.x+t.width);return bio.drawing().textOverflow(t.info.identifier,"10px",o-i,5)}}}function r(){return{margin:[20,40,7.5,40],attr:{points:function(t,e,n){var i=n.scaleX(t.x);return(i<n.margin.left||i>n.width-n.margin.right)&&(i=n.width+n.margin.right),bio.rendering().triangleStr(i,n.scaleY(t.y)-n.margin.bottom,10,"top")}},style:{fill:function(t,e,n){return"path"===this.tagName?"#A8A8A8":bio.boilerPlate.variantInfo[t.info[0].type].color},stroke:function(t,e,n){return"path"===this.tagName?"#A8A8A8":"none"}}}}return function(){return{axis:e,navi:o,graph:a,legend:n,needle:i,radius:t,patient:r}}},axises=function(){"use strict";function t(t,e){var n=[e.top||0,e.left||0];return{group:bio.rendering().addGroup(e.element,n[0],n[1],t+"-axis"),position:n,margin:bio.sizing.setMargin(e.margin),scale:bio.scales().get(e.domain,e.range)}}function e(t,e){if("string"!=typeof e)throw new Error("2nd Parameter type is not a string");return e?(t.selectAll(e).remove(),t):t}function n(t,n,o){var a=i.byD3v(t.scale,o,n);return n.tickValues,n.exclude?e(t.group.call(a),n.exclude):t.group.call(a)}var i={axises:{}};return i.byD3v=function(t,e,n){var i=(bio.dependencies.version.d3v4()?d3["axis"+e.pronoun()](t):d3.svg.axis.scale(t).orient(e)).ticks(5);return n&&n.tickValues?i.tickValues(n.tickValues):n&&n.ticks&&i.ticks(n.ticks),i},i.top=function(e){return n(t("top",e),e,"top")},i.left=function(e){return n(t("left",e),e,"left")},i.bottom=function(e){return n(t("bottom",e),e,"bottom")},i.right=function(e){return n(t("right",e),e,"right")},function(){return i}},bar=function(){"use strict";function t(t,e,n,i){return"left"===i||"top"===i?[e,t-n]:[t-n,e]}var e={};return function(n,i){e=bio.objects.clone(i||{}),(e=bio.sizing.chart.default(e,n)).copyX=[].concat(n.xaxis),e.copyY=[].concat(n.yaxis),e.startTo=n.startTo||["top","left"],e.rangeX=t(e.width,e.margin.left,e.margin.right,e.startTo[1]),e.rangeY=t(e.height,e.margin.top,e.margin.bottom,e.startTo[0]),e.scaleX=bio.scales().get(e.copyX,e.rangeX),e.scaleY=bio.scales().get(e.copyY,e.rangeY),e.group=bio.rendering().addGroup(n.element,0,0,"bar"),e.opts=bio.objects.clone(n),e.opts.id=e.id+"_bar_rect",e.opts.element=e.group.selectAll("#"+e.id+"_bar_rect"),bio.rectangle(e.opts,e)}},circle=function(){"use strict";return function(t,e){e=e||{},bio.rendering().circle({element:t.element,data:t.data||null,attr:t.attr?{id:function(n,i){return(t.id||e.id||t.element.attr("id"))+"_circle"},cx:function(n,i){return t.attr.cx?"function"!=typeof t.attr.cx?t.attr.cx:t.attr.cx.call(this,n,i,e):0},cy:function(n,i){return t.attr.cy?"function"!=typeof t.attr.cy?t.attr.cy:t.attr.cy.call(this,n,i,e):0},r:function(n,i){return t.attr.r?"function"!=typeof t.attr.r?t.attr.r:t.attr.r.call(this,n,i,e):0}}:null,style:t.style?{fill:function(n,i){return t.style.fill?"function"!=typeof t.style.fill?t.style.fill:t.style.fill.call(this,n,i,e):"#000000"},"fill-opacity":function(n,i){return t.style.fillOpacity?"function"!=typeof t.style.fillOpacity?t.style.fillOpacity:t.style.fillOpacity.call(this,n,i,e):1},stroke:function(n,i){return t.style.stroke?"function"!=typeof t.style.stroke?t.style.stroke:t.style.stroke.call(this,n,i,e):"none"},"stroke-width":function(n,i){return t.style.strokeWidth?"function"!=typeof t.style.strokeWidth?t.style.strokeWidth:t.style.strokeWidth.call(this,n,i,e):"0px"},filter:function(n,i){return!!t.style.filter&&("function"!=typeof t.style.filter?t.style.filter:t.style.filter.call(this,n,i,e))},cursor:function(n,i){return!!t.style.cursor&&("function"!=typeof t.style.cursor?t.style.cursor:t.style.cursor.call(this,n,i,e))}}:null,on:t.on?{click:function(n,i){!!t.on.click&&t.on.click.call(this,n,i,e)},mouseover:function(n,i){!!t.on.mouseover&&t.on.mouseover.call(this,n,i,e)},mouseout:function(n,i){!!t.on.mouseout&&t.on.mouseout.call(this,n,i,e)}}:null})}},divisionLine=function(){"use strict";var t={};return function(e,n){t=bio.objects.clone(n||{}),(t=bio.sizing.chart.default(t,e)).position={now:{},init:{}},t.isMarker=void 0===e.isMarker||e.isMarker,e.pathElement="Array"!==bio.objects.getType(e.pathElement)?[e.pathElement]:e.pathElement,t.division_data=e.data,t.division_info=e.info||[{additional:0,color:"#000000",direction:null,text:"Low",textWidth:10},{additional:0,color:"#FFFFFF",direction:null,text:"High",textWidth:10}],bio.iteration.loop(t.division_info,function(t){t.textWidth=bio.drawing().textSize.width(t.text.replace(" ","a"),e.style.fontSize||"10px")}),t.axis=[].concat(e.axis),t.range=[t.margin.left,t.width-t.margin.right],t.scale=bio.scales().get(t.axis,t.range),t.invert=bio.scales().invert(t.scale),n.data.bar?bio.iteration.loop(n.data.bar,function(n){n.value===e.idxes[0]?t.division_info[0].start=t.scale(n.x):n.value===e.idxes[1]?(t.division_info[0].end=t.scale(n.x),t.division_info[1].start=t.scale(n.x)):n.value===e.idxes[2]&&(t.division_info[1].end=t.scale(n.x))}):t.now.geneset&&(t.division_info[0].start=t.scale(t.axis[0]),t.division_info[0].end=t.scale(e.idxes),t.division_info[1].start=t.scale(e.idxes),t.division_info[1].end=t.scale(t.axis.length-1)),t.shapeGroup=bio.rendering().addGroup(e.element,0,0,"division-shape"),t.textGroup=bio.rendering().addGroup(e.element,0,0,"division-text"),t.opts={text:bio.objects.clone(e),shape:bio.objects.clone(e)},t.opts.text.id=t.id+"_division_text",t.opts.text.data=t.division_info,t.opts.text.element=t.textGroup.selectAll("#"+t.id+"_division_text"),t.opts.shape.id=t.id+"_division_shape",t.opts.shape.data=t.division_info,t.opts.shape.element=t.shapeGroup.selectAll("#"+t.id+"_division_shape"),bio.text(t.opts.text,t),bio.rectangle(t.opts.shape,t),bio.iteration.loop(e.pathElement,function(n,i){var o="shape_"+i,a="path_"+i,r=bio.objects.clone(t.division_info[i]),l=bio.objects.clone(t.division_info[i]),s=[r,l];r.path_x=t.division_info[0].end,l.path_x=t.division_info[0].end,r.path_y=0===i?10:0,l.path_y=0===i?n.attr("height"):n.attr("height")-18,t.opts[a]=bio.objects.clone(e),t.opts[a].id=t.id+"_division_path_"+i,t.opts[a].data=s,t.opts[a].element=bio.rendering().addGroup(n,0,0,"division-path-"+i),t.opts[o]=bio.objects.clone(e),t.opts[o].id=t.id+"_division_shape_"+i,t.opts[o].data=[s[i]],t.opts[o].element=bio.rendering().addGroup(n,0,0,"division-shape-"+i).selectAll("#"+t.id+"_division_shape_"+i),t.isMarker&&bio.triangle({element:t.opts[o].element,data:t.opts[o].data,attr:t.opts[o].attr,style:t.opts[o].style,call:t.opts[o].call},t),bio.path({element:t.opts[a].element,data:t.opts[a].data,attr:t.opts[a].attr,style:{stroke:"#333333",strokeWidth:"0.5px"}},t)})}},drawing=function(){"use strict";function t(t,e,n){var i=document.createElement("span"),o=document.createElement("div"),a=document.createElement("div");"width"===t?n=n.split(" "):e=e.split(" "),a.id="get_text_"+t,i.style.fontSize="width"===t?n[0]:e[0],i.style.fontWeight="width"===t?n[1]:e[1],i.innerHTML="width"===t?e:"Hg",o.style.display="inline-block",o.style.width="1px",o.style.height="0px",a.appendChild(i),a.appendChild(o),document.body.appendChild(a);try{var r=i.getBoundingClientRect()[t].toFixed()}finally{document.body.removeChild(document.getElementById("get_text_"+t))}return parseFloat(r)}var e={textSize:{}};return e.textSize.width=function(e,n){return t("width",e,n)},e.mostWidth=function(t,n){var i=[];return bio.iteration.loop(t,function(t){i.push({text:t,value:e.textSize.width(t,n)})}),i.sort(function(t,e){return t.value<e.value?1:-1})[0]},e.textSize.height=function(e){return t("height",e)},e.fitText=function(t,n,i,o){for(var a=10,r=a+"px "+(o||"normal");e.textSize.height(r)<i&&e.textSize.width(t,r)<n;)r=(a+=1)+"px "+o;return a-1+"px"},e.textOverflow=function(t,n,i,o){var a="";return o=o||5,e.textSize.width(t,n)<i-o?t:(bio.iteration.loop(t.split(""),function(t){e.textSize.width(a+=t,n)>i-o&&(a=a.substring(0,a.length-2))}),a)},e.getParentSVG=function(t){return"svg"===t.parentElement.tagName?t.parentElement:e.getParentSVG(t.parentElement)},e.nthChild=function(t,e){return d3.select(t).node().children[e]},e.findDom=function(t,e){if(t.children<1)throw new Error("There are no any child elements");var n=Array.prototype.slice.call(t.children),i=null;return bio.iteration.loop(n,function(t){t.tagName!==e.toUpperCase()&&"."+t.className!==e&&"#"+t.id!==e||(i=t)}),i},e.slideDown=function(t){var e=t.style.height?parseFloat(t.style.height):t.getBoundingClientRect().height,n=0;t.style.height="0px";var i=setInterval(function(){n+=1,t.style.height=n+"px",n===e&&clearInterval(i)},5)},e.slideUp=function(t){var e=t.style.height?parseFloat(t.style.height):t.getBoundingClientRect().height,n=parseFloat(t.style.height),i=setInterval(function(){n-=1,t.style.height=n+"px",0===n&&(clearInterval(i),t.style.height=e+"px",t.style.display="none")},5)},e.importSVG=function(t,e){var n=null;return d3.xml(t).mimeType("image/svg+xml").get(function(t,i){if(t)throw t;return e?e(i):n=i}),n},function(){return e}},heat=function(){"use strict";function t(t){return bio.iteration.loop(t,function(t,e){bio.iteration.loop(n.mutationType,function(t){e[t][0]&&n.duplicate.push({x:e.x,y:e.y,value:e[t][0],info:e[t].splice(1)})})}),n.duplicate}function e(e){return bio.iteration.loop(e,function(t){var e=t.x+t.y,i=bio.landscapeConfig().byCase(t.value);n.value[e]?bio.boilerPlate.variantInfo[n.value[e][i][0]]>bio.boilerPlate.variantInfo[t.value]?n.value[e][i].unshift(t.value):n.value[e][i].push(t.value):(n.value[e]={cnv:[],var:[],x:t.x,y:t.y},n.value[e][i].push(t.value))}),t(n.value)}var n={};return function(t,i){n=bio.objects.clone(i||{}),(n=bio.sizing.chart.default(n,t)).copyX=[].concat(t.xaxis),n.copyY=[].concat(t.yaxis),n.rangeX=[n.margin.left,n.width-n.margin.right],n.rangeY=[n.margin.top,n.height-n.margin.bottom],n.scaleX=bio.scales().get(n.copyX,n.rangeX),n.scaleY=bio.scales().get(n.copyY,n.rangeY),n.group=bio.rendering().addGroup(t.element,0,0,"heatmap"),n.opts=bio.objects.clone(t),n.opts.data=n.duplicate?e(n.opts.data):n.opts.data,n.opts.id=n.id+"_heatmap_rect",n.opts.element=n.group.selectAll("#"+n.id+"_heatmap_rect"),bio.rectangle(n.opts,n)}},legend=function(){"use strict";var t={};return function(e,n){t=bio.objects.clone(n||{}),(t=bio.sizing.chart.default(t,e)).legendData=e.data,t.padding=e.padding||5,t.fontSize=e.style.font||"10px",t.fontWidth=bio.drawing().mostWidth(t.legendData,t.fontSize),t.fontHeight=bio.drawing().textSize.height(t.fontSize),t.shapeWidth=t.width-(t.margin.left+t.margin.right+t.fontWidth.value),t.shapeGroup=bio.rendering().addGroup(e.element,t.margin.top,t.margin.left,"legend-shape"),t.textGroup=bio.rendering().addGroup(e.element,t.margin.top,t.margin.left,"legend-text"),t.opts={text:bio.objects.clone(e),shape:bio.objects.clone(e)},t.opts.text.id=t.id+"_legend_text",t.opts.text.element=t.textGroup.selectAll("#"+t.id+"_legend_text"),t.opts.shape.id=t.id+"_legend_shape",t.opts.shape.element=t.shapeGroup.selectAll("#"+t.id+"_legend_shape"),e.attr&&e.attr.width?bio.rectangle(t.opts.shape,t):e.attr&&e.attr.r?bio.circle(t.opts.shape,t):e.attr&&e.attr.points&&bio.triangle(t.opts.shape,t),bio.text(t.opts.text,t);var i=e.element.node().parentNode,o=t.textGroup.node().getBoundingClientRect();i.style.height=o.height+t.margin.top+t.padding+"px",i.style.width=t.width-5+"px"}},needle=function(){"use strict";var t={};return function(e,n){t=bio.objects.clone(n||{}),(t=bio.sizing.chart.default(t,e)).copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.height-t.margin.bottom,t.margin.top],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.lineGroup=bio.rendering().addGroup(e.element,0,0,"needle-line"),t.shapeGroup=bio.rendering().addGroup(e.element,0,0,"needle-shape"),t.opts={line:bio.objects.clone(e),shape:bio.objects.clone(e)},t.opts.line.element=t.lineGroup,t.opts.shape.data=e.shapeData,t.opts.shape.element=t.shapeGroup.selectAll("#"+t.id+"_needle_shape"),bio.iteration.loop(e.lineData,function(e){t.opts.line.data=e.value,bio.path(t.opts.line,t)}),bio.circle(t.opts.shape,t)}},network=function(){"use strict";function t(t,e){return d3.layout.force().nodes(t).links(e).charge(d3.forceManyBody()).linkDistance(150)}function e(t,e){return d3.forceSimulation(t).force("charge",d3.forceManyBody().strength(function(t,e){return t.group,-300-t.radius/100*600})).force("link",d3.forceLink(e).id(function(t){return t.text}).distance(function(t){return t.source.group&&t.target.group?90-t.source.radius/100*90:1===t.isOne?10+t.source.radius/100*1050:190-t.source.radius/100*190})).force("x",d3.forceX(function(t){return t.group?o.width/2.1:o.width-o.width*(t.index/10)})).force("y",d3.forceY(function(t){return t.group?o.height/2.5:.95*o.height}))}function n(t,e,n,i,a){var r=bio.rendering().addGroup(o.element,0,0,t);bio.rectangle({id:t,element:r,attr:{rx:2,ry:2,y:e,x:n,width:i,height:a},style:{strokeWidth:2,fill:"#FFFFFF",stroke:"#333333",filter:'url("#drop_shadow")',fillOpacity:function(e){return"compound"===t?1:.3}}},o)}function i(t,e,n){var i=bio.rendering().addGroup(o.element,0,0,"network-info");bio.text({element:i,text:t,id:"network_info",attr:{x:n,y:e},style:{fontSize:"16px",fontWeight:"bold"}})}var o={};return function(a,r){o=bio.objects.clone(r||{}),(o=bio.sizing.chart.default(o,a)).bcr=o.element.node().getBoundingClientRect(),o.network_data=a.data,o.arrow_width=5;var l=null,s=[],c=[];bio.iteration.loop(o.network_data,function(t){"compound"===t.type?l=t:"node"===t.type?s.push(t):c.push(t)}),bio.iteration.loop(s,function(t){l.members.indexOf(t.text)>-1&&(t.group=1),t.radius=(bio.drawing().textSize.width(t.text,"12px")+10)/2});var u={};bio.iteration.loop(c,function(t){u[t.target]=!0}),bio.iteration.loop(c,function(t){t.isOne=Object.keys(u).length}),bio.rendering().dropShadow(o.element.append("svg:defs"),1,-.1,1),bio.rendering().marker({id:"id",data:c,color:"linecolor",width:o.arrow_width,height:o.arrow_width,svg:o.element.append("svg:defs")}),n("infomation",.05*o.height,10,o.width-20,.1*o.height),n("compound",.15*o.height,10,o.width-20,.54*o.height),i(l.text,.105*o.height,o.width/2-bio.drawing().textSize.width(l.text,"16px")/2);for(var d=bio.dependencies.version.d3v4()?e(s,c):t(s,c),p=0,f=Math.ceil(Math.log(d.alphaMin())/Math.log(1-d.alphaDecay()));p<f;++p)d.tick();var g=bio.rendering().addGroup(o.element,0,0,"link-layer"),h=bio.rendering().addGroup(o.element,0,0,"node-layer"),m=g.selectAll(".link").data(c).enter().append("svg:path").attr("class","link").attr("marker-end",function(t){return'url("#marker_'+t.id+'")'}).style("fill","#FFFFFF").style("fill-opacity",.1).style("stroke",function(t){return t.linecolor}).style("stroke-width",1.5).style("stroke-dasharray",function(t){return"Dashed"===t.style?"3, 3":"none"}),v=h.selectAll(".node").data(s).enter().append("g").attr("class"," node");v.append("circle").attr("r",function(t){return(bio.drawing().textSize.width(t.text,"12px")+10)/2}).attr("fill",function(t){return t.bgcolor}).attr("stroke","#333333").attr("stroke-width",1),v.append("text").attr("dx",0).attr("dy",5).attr("text-anchor","middle").style("font-size","12px").style("font-weight","bold").text(function(t){return t.text});d.on("tick",function(){v.attr("transform",function(t,e){t.x=t.group?t.x:o.width/2.5,t.y=t.group?t.y:.78*o.height}),m.attr("d",function(t){var e=t.target.x-t.source.x,n=t.target.y-t.source.y,i=Math.sqrt(e*e+n*n),a=e*(t.target.radius+o.arrow_width)/i,r=n*(t.target.radius+o.arrow_width)/i;return"M"+t.source.x+","+t.source.y+"A"+i+","+i+" 0 0,1 "+(t.target.x-a)+","+(t.target.y-r)}),v.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})})}},path=function(){"use strict";function t(t,e){var n=this;return(bio.dependencies.version.d3v4()?d3.line():d3.svg.line()).x(function(i,o){return t.attr.x?"function"!=typeof t.attr.x?t.attr.x:t.attr.x.call(n,i,o,e):0}).y(function(i,o){return t.attr.y?"function"!=typeof t.attr.y?t.attr.y:t.attr.y.call(n,i,o,e):0})}return function(e,n){n=n||{},bio.rendering().line({element:e.element,attr:e.attr?{id:function(t){return(e.id||n.id||e.element.attr("id"))+"_path"},d:function(i,o){return t.call(this,e,n)(e.data)}}:null,style:e.style?{fill:function(t,i){return e.style.fill?"function"!=typeof e.style.fill?e.style.fill:e.style.fill.call(this,t,i,n):"#A8A8A8"},stroke:function(t,i){return e.style.stroke?"function"!=typeof e.style.stroke?e.style.stroke:e.style.stroke.call(this,t,i,n):"#A8A8A8"},"stroke-width":function(t,i){return e.style.strokeWidth?"function"!=typeof e.style.strokeWidth?e.style.strokeWidth:e.style.strokeWidth.call(this,t,i,n):"1px"}}:null})}},rectangle=function(){"use strict";return function(t,e){return e=e||{},bio.rendering().rect({element:t.element,data:t.data||null,attr:t.attr?{id:function(n){return(t.id||e.id||t.element.attr("id"))+"_rect"},x:function(n,i){return t.attr.x?"function"!=typeof t.attr.x?t.attr.x:t.attr.x.call(this,n,i,e):0},y:function(n,i){return t.attr.y?"function"!=typeof t.attr.y?t.attr.y:t.attr.y.call(this,n,i,e):0},rx:function(n,i){return t.attr.rx?"function"!=typeof t.attr.rx?t.attr.rx:t.attr.rx.call(this,n,i,e):0},ry:function(n,i){return t.attr.ry?"function"!=typeof t.attr.ry?t.attr.ry:t.attr.ry.call(this,n,i,e):0},width:function(n,i){return t.attr.width?"function"!=typeof t.attr.width?t.attr.width:t.attr.width.call(this,n,i,e):1},height:function(n,i){return t.attr.height?"function"!=typeof t.attr.height?t.attr.height:t.attr.height.call(this,n,i,e):1}}:null,style:t.style?{fill:function(n,i){return t.style.fill?"function"!=typeof t.style.fill?t.style.fill:t.style.fill.call(this,n,i,e):"#000000"},"fill-opacity":function(n,i){return t.style.fillOpacity?"function"!=typeof t.style.fillOpacity?t.style.fillOpacity:t.style.fillOpacity.call(this,n,i,e):"none"},stroke:function(n,i){return t.style.stroke?"function"!=typeof t.style.stroke?t.style.stroke:t.style.stroke.call(this,n,i,e):"none"},"stroke-width":function(n,i){return t.style.strokeWidth?"function"!=typeof t.style.strokeWidth?t.style.strokeWidth:t.style.strokeWidth.call(this,n,i,e):"0px"},filter:function(n,i){return!!t.style.filter&&("function"!=typeof t.style.filter?t.style.filter:t.style.filter.call(this,n,i,e))},cursor:function(n,i){return!!t.style.cursor&&("function"!=typeof t.style.cursor?t.style.cursor:t.style.cursor.call(this,n,i,e))}}:null,on:t.on?{click:function(n,i){!!t.on.click&&t.on.click.call(this,n,i,e)},mouseover:function(n,i){!!t.on.mouseover&&t.on.mouseover.call(this,n,i,e)},mouseout:function(n,i){!!t.on.mouseout&&t.on.mouseout.call(this,n,i,e)}}:null,call:t.call?{start:function(n,i){!!t.call.start&&t.call.start.call(this,n,i,e)},drag:function(n,i){!!t.call.drag&&t.call.drag.call(this,n,i,e)},end:function(n,i){!!t.call.end&&t.call.end.call(this,n,i,e)}}:null})}},rendering=function(){"use strict";function t(t,e){if(!e)return!1;bio.iteration.loop(e,function(e,n){t.attr(e,n)})}function e(t,e){if(!e)return!1;bio.iteration.loop(e,function(e,n){t.style(e,n)})}function n(t,e){if(!e)return!1;bio.iteration.loop(e,function(e,n){t.on(e,n)})}function i(t,e){if(!e)return!1;var n=bio.dependencies.version.d3v4()?d3.drag():d3.behavior.drag().origin(Object);bio.iteration.loop(e,function(t,e){t=bio.dependencies.version.d3v4()?t:"drag"!==t?"drag"+t:t,n.on(t,e)}),t.call(n)}function o(t,e){t.text(e)}function a(a){if(!this.element)throw new Error("Not defined SVG Element");var r=this.data?this.element.data(this.data).enter().append(a):this.element.append(a);return!!this.text&&o(r,this.text),t(r,this.attr),e(r,this.style),n(r,this.on),i(r,this.call),r}var r={};return r.createSVG=function(t,e,n){var i=bio.dom().get(t),o=i.id?"#"+i.id:"."+i.className,a=e||parseFloat(i.style.width),r=n||parseFloat(i.style.height);return d3.select(o).append("svg").attr("id",i.id+"_svg").attr("width",a).attr("height",r)},r.addGroup=function(t,e,n,i){t=bio.dependencies.version.d3v4()?t:t[0][0],t="Array"===bio.objects.getType(t)||"Object"===bio.objects.getType(t)?t:d3.select(t),i=i||"";var o=t.attr("id"),a=d3.selectAll("."+o+"."+i+"-g-tag");return(a.node()?a:t).append("g").attr("class",o+" "+i+"-g-tag").attr("transform","translate("+n+", "+e+")")},r.rect=function(t){return a.call(t,"rect")},r.circle=function(t){return a.call(t,"circle")},r.triangle=function(t){return a.call(t,"polygon")},r.triangleStr=function(t,e,n,i){var o,a,r,l,s="left"===i||"bottom"===i?-1:1;return"left"===i||"right"===i?(a=n/2*-1,r=o=n*s,l=n/2):(o=n/2*-1,r=n/2,l=a=n*s),t+","+e+" "+(t+o)+","+(e+a)+" "+(t+r)+","+(e+l)+" "+t+","+e},r.text=function(t){return a.call(t,"text")},r.line=function(n){var i=n.element.append("path");return t(i,n.attr),e(i,n.style),i},r.dropShadow=function(t,e,n,i){var o=t.append("defs").append("filter").attr("id","drop_shadow");o.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",e||3).attr("result","blur"),o.append("feOffset").attr("in","blur").attr("dx",n||2).attr("dy",i||2).attr("result","offsetBlur");var a=o.append("feMerge");a.append("feMergeNode").attr("in","offsetBlur"),a.append("feMergeNode").attr("in","SourceGraphic")},r.marker=function(t){t.svg.selectAll("marker").data(t.data||[""]).enter().append("svg:marker").attr("id",function(e){return t.id?"marker_"+e[t.id]:"marker"}).attr("viewBox","0 -5 10 10").attr("refX",5).attr("refY",0).attr("markerWidth",t.width||5).attr("markerHeight",t.height||5).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5").attr("fill",function(e){return t.color?e[t.color]:"#333333"})},r.opacity=function(t,e){var n=d3.rgb(t);return n.opacity=e||.3,n},r.translation=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttributeNS(null,"transform",t);var n=e.transform.baseVal.consolidate().matrix;return{scale:[n.a,n.d],translate:[n.e,n.f],rotate:n.b,skew:n.c}},function(){return r}},scales=function(){"use strict";function t(t){return"Number"===bio.objects.getType(t[0])?"linear":"ordinal"}var e={};return e.ordinal=function(t,e){return bio.dependencies.version.d3v4()?d3.scaleBand().domain(t).range(e):d3.scale.ordinal().domain(t).rangeBands(e)},e.linear=function(t,e){return bio.dependencies.version.d3v4()?d3.scaleLinear().domain(t).range(e):d3.scale.linear().domain(t).range(e)},e.get=function(n,i){return e[t(n)](n,i)},e.invert=function(e){var n=e.domain(),i=e.range();return("linear"===t(n)?bio.dependencies.version.d3v4()?d3.scaleLinear():d3.scale.linear():bio.dependencies.version.d3v4()?d3.scaleQuantize():d3.scale.quantize()).domain(i).range(n)},e.band=function(t){return bio.dependencies.version.d3v4()?t.bandwidth():t.rangeBand()},function(){return e}},scatter=function(){"use strict";var t={};return function(e,n){t=bio.objects.clone(n||{}),(t=bio.sizing.chart.default(t,e)).scatter_data=e.data,t.copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.margin.top,t.height-t.margin.bottom],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.group=bio.rendering().addGroup(e.element,0,0,"scatter"),t.opts=bio.objects.clone(e),t.opts.data=t.scatter_data,t.opts.id=t.id+"_scatter_shape",t.opts.element=t.group.selectAll("#"+t.id+"_scatter_shape"),bio.circle(t.opts,t)}},survival=function(){"use strict";function t(t){function e(t,e,n,i){var o={};o[t]={case_id:t,months:e,status:n},i.push(o)}var n={os:[],dfs:[]},i={os:[],dfs:[]},o={os:[],dfs:[]};return bio.iteration.loop(t,function(t){if(t){var a=t.os_days/30,r=t.dfs_days/30;n.os.push(a),n.dfs.push(r),null!=a&&null!=t.os_status&&e(t.participant_id,a,t.os_status,i.os),null!=r&&null!=t.dfs_status&&e(t.participant_id,r,t.dfs_status,i.dfs),e(t.participant_id,a,t.os_status,o.os),e(t.participant_id,r,t.dfs_status,o.dfs)}}),{month:n,pure:i,all:o}}function e(t,e){var n=document.createElement("input");return n.id=t+"_survival",n.name="tabs",n.type="radio",n.checked=0===e,n}function n(t,e){var n=document.createElement("label");return n.htmlFor=t+"_survival",n.innerHTML=e,n}function i(t,e){var n=document.createElement("div");return n.id=t,n}function o(t,o){document.querySelector(t).innerHTML="";for(var a=document.querySelector(t),r=0,l=o.length;r<l;r++){var s=o[r],c=o[r].toLowerCase();a.appendChild(e(c,r)),a.appendChild(n(c,s))}for(var r=0,l=o.length;r<l;r++){var u=i(o[r].toLowerCase());u.appendChild(i(o[r].toLowerCase()+"_survival_curve")),u.appendChild(i(o[r].toLowerCase()+"_stat_table")),a.appendChild(u)}}var a={};return function(e){return a.survival_data=t(e.data),o(e.element,["OS","DFS"]),SurvivalTab.init(e.division,a.survival_data.pure),a}},text=function(){"use strict";return function(t,e){e=e||{},bio.rendering().text({element:t.element,data:t.data||null,attr:t.attr?{id:function(n){return(t.id||e.id||t.element.attr("id"))+"_text"},x:function(n,i){return t.attr.x?"function"!=typeof t.attr.x?t.attr.x:t.attr.x.call(this,n,i,e):0},y:function(n,i){return t.attr.y?"function"!=typeof t.attr.y?t.attr.y:t.attr.y.call(this,n,i,e):0}}:null,style:t.style?{fill:function(n,i){return t.style.fill?"function"!=typeof t.style.fill?t.style.fill:t.style.fill.call(this,n,i,e):"#000000"},"font-size":function(n,i){return t.style.fontSize?"function"!=typeof t.style.fontSize?t.style.fontSize:t.style.fontSize.call(this,n,i,e):"10px"},"font-family":function(n,i){return t.style.fontFamily?"function"!=typeof t.style.fontFamily?t.style.fontFamily:t.style.fontFamily.call(this,n,i,e):"Arial"},"font-weight":function(n,i){return t.style.fontWeight?"function"!=typeof t.style.fontWeight?t.style.fontWeight:t.style.fontWeight.call(this,n,i,e):"normal"},"alignment-baseline":function(n,i){return t.style.alignmentBaseline?"function"!=typeof t.style.alignmentBaseline?t.style.alignmentBaseline:t.style.alignmentBaseline.call(this,n,i,e):"middle"},cursor:function(n,i){return!!t.style.cursor&&("function"!=typeof t.style.cursor?t.style.cursor:t.style.cursor.call(this,n,i,e))},stroke:function(n,i){return!!t.style.stroke&&("function"!=typeof t.style.stroke?t.style.stroke:t.style.stroke.call(this,n,i,e))},"stroke-width":function(n,i){return!!t.style.strokeWidth&&("function"!=typeof t.style.strokeWidth?t.style.strokeWidth:t.style.strokeWidth.call(this,n,i,e))}}:null,on:t.on?{click:function(n,i){!!t.on.click&&t.on.click.call(this,n,i,e)},mouseover:function(n,i){!!t.on.mouseover&&t.on.mouseover.call(this,n,i,e)},mouseout:function(n,i){!!t.on.mouseout&&t.on.mouseout.call(this,n,i,e)}}:null,text:function(n,i){return t.text?"function"!=typeof t.text?t.text:t.text.call(this,n,i,e):""}})}},triangle=function(){"use strict";return function(t,e){e=e||{},bio.rendering().triangle({element:t.element,data:t.data||null,attr:t.attr?{id:function(n){return(t.id||e.id||t.element.attr("id"))+"_triangle"},points:function(n,i){return t.attr.points?"function"!=typeof t.attr.points?t.attr.points:t.attr.points.call(this,n,i,e):0}}:null,style:t.style?{fill:function(n,i){return t.style.fill?"function"!=typeof t.style.fill?t.style.fill:t.style.fill.call(this,n,i,e):"#000000"},stroke:function(n,i){return t.style.stroke?"function"!=typeof t.style.stroke?t.style.stroke:t.style.stroke.call(this,n,i,e):"none"},"stroke-width":function(n,i){return t.style.strokeWidth?"function"!=typeof t.style.strokeWidth?t.style.strokeWidth:t.style.strokeWidth.call(this,n,i,e):"0px"},filter:function(n,i){return!!t.style.filter&&("function"!=typeof t.style.filter?t.style.filter:t.style.filter.call(this,n,i,e))},cursor:function(n,i){return!!t.style.cursor&&("function"!=typeof t.style.cursor?t.style.cursor:t.style.cursor.call(this,n,i,e))}}:null,on:t.on?{click:function(n,i){!!t.on.click&&t.on.click.call(this,n,i,e)},mouseover:function(n,i){!!t.on.mouseover&&t.on.mouseover.call(this,n,i,e)},mouseout:function(n,i){!!t.on.mouseout&&t.on.mouseout.call(this,n,i,e)}}:null,call:t.call?{start:function(n,i){!!t.call.start&&t.call.start.call(this,n,i,e)},drag:function(n,i){!!t.call.drag&&t.call.drag.call(this,n,i,e)},end:function(n,i){!!t.call.end&&t.call.end.call(this,n,i,e)}}:null})}},handler=function(){"use strict";function t(t,e){bio.dom().get(t).addEventListener("scroll",e,!1)}function e(t,e){var n=!1;document.body.addEventListener(e,function(t){if(n)return t.preventDefault&&t.preventDefault(),!1}),t.addEventListener("mouseenter",function(t){n=!0}),t.addEventListener("mouseleave",function(t){n=!1})}function n(t,n){if(!t)throw new Error("No given element");e(t,"mousewheel"),t.addEventListener("mousewheel",function(e){t.scrollTop+=t.wheelDelta,n&&n.call(t,e)})}return function(){return{scroll:t,scrollOnHidden:n}}},exclusivity=function(){"use strict";function t(t,e){var n="SMCLUAD1690060028",i=h.now.geneset.split(" "),o=".";return t.length<1?[{text:"**",color:"#00AC52"},{text:n+" Belongs to",color:"#333333"},{text:"Unaltered group",color:"#00AC52"}]:(bio.iteration.loop(t,function(t){var n=e[i.indexOf(t.gene)];n.indexOf(t.value)>-1&&(o="."!==o?o:n[n.indexOf(t.value)])}),"."===o?[{text:"**",color:"#00AC52"},{text:n+" Belongs to",color:"#333333"},{text:"Unaltered group",color:"#00AC52"}]:[{text:"**",color:"#FF6252"},{text:n+" Belongs to",color:"#333333"},{text:"Altered group",color:"#FF6252"}])}function e(e){h.data.sample={data:[],isAltered:!1};var n=bio.exclusivityConfig(),i=bio.landscapeConfig();bio.iteration.loop(e,function(t){h.now.geneset.indexOf(t.gene)>-1&&h.data.sample.data.push({gene:t.gene,value:n.symbol(n.byCase(i.byCase(t.class),t.class))})}),h.data.sample.isAltered=t(h.data.sample.data,h.data.survival.heat[h.now.geneset])}function n(t){bio.layout().get(h.setting.svgs,["ty_legend"],function(e,n){var i=bio.exclusivityConfig(),o=i.legend(t.mostGeneWidth.value);bio.legend({element:n,on:o.on,attr:o.attr,text:o.text,style:o.style,margin:o.margin,data:t.type[h.now.geneset].sort(function(t,e){return i.priority(t)>i.priority(e)?1:-1})}),document.querySelector("#exclusivity_legend").style.height=n.attr("height")+"px"})}function i(t){bio.layout().get(h.setting.svgs,["sample_legend"],function(e,n){var i=bio.rendering().addGroup(n,0,0,"sample-legend"),o=bio.exclusivityConfig().sample("legend",t.mostGeneWidth.value);bio.text({text:o.text,attr:o.attr,style:o.style,id:e+"_sample_legend",data:t.sample.isAltered,element:i.selectAll("#"+e+"_sample_legend")},h)})}function o(t){bio.layout().get(h.setting.svgs,["heatmap"],function(e,n){var i=bio.rendering().addGroup(n,0,0,"sample-division"),o=bio.exclusivityConfig().sample("division",t.mostGeneWidth.value,n);bio.text({text:o.text,attr:o.attr,style:o.style,id:e+"_sample_division",data:t.sample.isAltered,element:i.selectAll("#"+e+"_sample_division")},h)})}function a(t,e){for(var n=0,i=t.length;n<i;n++){var o=t[n],a=e[n];bio.iteration.loop(h.data.sample.isAltered,function(t){t.text===o.innerHTML&&(o.innerHTML+=" **",a.innerHTML+=" **")})}}function r(t){var e=bio.exclusivityConfig().survival();bio.text({element:t,text:e.text,attr:{x:function(t,n){return e.attr.x(t,n,h)},y:function(t,n){return e.attr.y(t,n,h)}},style:{fill:function(t,n){return e.style.fill(t,n,h)}},text:function(t,n){return e.text(t,n,h)}})}function l(t){var e={},n=setInterval(function(){e.os_tb=document.querySelectorAll("#os_stat_table td b"),e.dfs_tb=document.querySelectorAll("#dfs_stat_table td b"),e.legend=d3.selectAll(".legend"),e.os_tb.length>0&&e.dfs_tb.length>0&&e.legend.node()&&(a(e.os_tb,e.dfs_tb),r(e.legend),clearInterval(n))},10)}function s(t){i(t),o(t),l(t)}function c(t){bio.layout().get(h.setting.svgs,["network"],function(e,n){bio.exclusivityConfig().network();bio.network({element:n,data:t.network[h.now.geneset.replaceAll(" ","")]})})}function u(t,e){bio.layout().get(h.setting.svgs,["heatmap"],function(n,i){var o=t.mostGeneWidth.value,a=bio.exclusivityConfig().heatmap("shape",i,o),r=bio.exclusivityConfig().heatmap("axis",i,o);i.attr("height");bio.heat({element:i,attr:a.attr,style:a.style,margin:a.margin,xaxis:e.x[h.now.geneset],yaxis:e.y[h.now.geneset],data:t.heatmap[h.now.geneset]}),bio.axises().left({top:0,left:o,element:i,direction:"left",range:r.range,exclude:"path, line",margin:r.margin,domain:e.y[h.now.geneset]})})}function d(t,e){var n={};return bio.iteration.loop(e.survival.data[t],function(i,o){i&&(n[i.participant_id]=o<=e.divisionIdx[t].idx?"altered":"unaltered")}),n}function p(t){var e=document.querySelector("#exclusivity_survival"),n=parseFloat(e.style.width),i=parseFloat(e.style.height);SurvivalCurveBroilerPlate.settings={canvas_width:.9*n,canvas_height:.59*i,chart_width:.9*n,chart_height:.59*i,chart_left:50,chart_top:15,include_info_table:!1,include_legend:!0,include_pvalue:!0,pval_x:n/1.95,pval_y:40},SurvivalCurveBroilerPlate.style={censored_sign_size:5,axis_stroke_width:1,axisX_title_pos_x:n/2,axisX_title_pos_y:i/1.725,axisY_title_pos_x:-n/2,axisY_title_pos_y:10,axis_color:"black",pval_font_size:10,pval_font_style:"normal"},SurvivalCurveBroilerPlate.subGroupSettings.legend={low:"Unaltered group",high:"Altered group"},bio.survival({element:"#exclusivity_survival",margin:[20,20,20,20],data:t.survival.data[h.now.geneset],division:d(h.now.geneset,t)})}function f(t){bio.layout().get(h.setting.svgs,["heatmap"],function(e,n){var i=bio.exclusivityConfig().division(t.mostGeneWidth.value);bio.divisionLine({element:n,isMarker:!1,pathElement:[n],info:[{text:"Altered group",color:"#FF6252"},{text:"Unaltered group",color:"#00AC52"}],text:i.text,attr:i.attr,style:i.style,margin:i.margin,axis:t.axis.heatmap.x[h.now.geneset],idxes:t.divisionIdx[h.now.geneset].idx+1},h)})}function g(t){e(h.setting.defaultData.sample),n(t),c(t),u(t,t.axis.heatmap),p(t),f(t),s(t)}var h={};return function(t){(h=bio.initialize("exclusivity")).setting=bio.setting("exclusivity",t),h.data=h.setting.preprocessData,bio.title("#exclusivity_title","Mutual Exclusivity"),h.now.geneset=h.data.geneset[0].join(" "),bio.selectBox({viewName:"geneset",margin:[0,0,0,0],fontSize:"14px",defaultText:h.now.geneset,className:"exclusivity-geneset",id:"#exclusivity_select_geneset",items:h.data.geneset.map(function(t){return t.join(" ")}),clickItem:function(t){h.now.geneset=t.toUpperCase(),bio.layout().removeGroupTag(),g(h.data)}}),g(h.data),console.log(">>> Exclusivity reponse data: ",t),console.log(">>> Exclusivity setting data: ",h.setting),console.log(">>> Exclusivity model data: ",h)}},colorGradient=function(){"use strict";function t(t,e){n.offsets.show.push({offset:t,color:e}),n.offsets.data.push({offset:t,color:e})}function e(e,i){var o=[].concat(e).splice(1,e.length-2);t("0%",i[0]),bio.iteration.loop(o,function(t,o){var a=Math.round((bio.math.max(e)-bio.math.min(e))/t*10);n.offsets.show.push({offset:a-n.adjustValue+"%",color:i[o+1]}),n.offsets.data.push({offset:a+"%",color:i[o+1]})}),t("100%",i[e.length-1])}var n={};return function(t,i){return n=bio.objects.clone(i||{}),n=bio.sizing.chart.default(n,t),n.offsets=bio.initialize("colorGradient"),n.adjustValue=t.adjustValue||0,n.id=t.id||"linear_gradient",n.colors=t.colors||["#000000","#FFFFFF"],n.offset=t.offset||[0,100],n.defs=n.element.append("defs"),n.lineGradient=n.defs.append("linearGradient").attr("id",n.id),e(n.offset,n.colors),n.lineGradient.selectAll("stop").data(n.offsets.show).enter().append("stop").attr("offset",function(t,e){return t.offset}).attr("stop-color",function(t,e){return t.color}),n}},expression=function(){"use strict";function t(){bio.selectBox({items:["Average"],viewName:"function",margin:[3,3,0,0],defaultText:"Average",id:"#expression_function",className:"expression-function",clickItem:function(t){_.now.function=t}})}function e(t,e,n){if(!_.now.colorSet)return"#62C2E0";var i=t.info?t.info[_.now.color_mapping]:"NA";return"NA"===i?"#A4AAA7":bio.expressionConfig().colorSet[_.now.colorSet.indexOf(i)]}function n(t){bio.selectBox({margin:[3,3,0,0],viewName:"color_mapping",defaultText:"Color Mapping",id:"#expression_color_mapping",className:"expression-color-mapping",items:t.map(function(t){return t.key}),clickItem:function(n){var i=document.querySelector("#expression_bar_legend");_.now.color_mapping=n,t.some(function(t){return _.now.colorSet=t.value,_.now.color_mapping===t.key}),bio.layout().removeGroupTag(["expression_bar_legend_svg"]),i.className.indexOf("active")<0&&(i.className+="active"),d3.selectAll("#expression_bar_plot_svg_bar_rect_rect").style("fill",e).style("stroke",e),o("color_mapping",_.now.colorSet),i.style.marginBottom=parseFloat(_.init.bar_legend_height)-parseFloat(i.style.height)-5+"px"}})}function i(t){bio.selectBox({margin:[3,3,0,0],viewName:"signature",id:"#expression_signature",className:"expression-signature",defaultText:_.now.signature,items:t.map(function(t){return t.signature}),clickItem:function(t){_.now.signature&&_.now.signature!==t&&(_.now.signature=t,_.requestData.signature=_.now.signature,$.ajax({type:"post",url:"/files",data:{name:"expression"},beforeSend:function(){bio.loading().start(_.setting.targetedElement,_.setting.targetedElementSize.width,_.setting.targetedElementSize.height)},success:function(t){var e="";bio.dom().remove(_.setting.targetedElement,[document.querySelector("#expression_title"),document.querySelector("#expression_contents")]),bio.layout().removeGroupTag(),_.now.signature.indexOf("50")>-1?e=t.data.data_pam50.data:_.now.signature.indexOf("1")>-1?e=t.data.data_sig1.data:_.now.signature.indexOf("2")>-1?e=t.data.data_sig2.data:_.now.signature.indexOf("3")>-1&&(e=t.data.data_sig3.data),bio.expression({element:_.setting.targetedElement.id,width:_.setting.targetedElementSize.width,height:_.setting.targetedElementSize.height,requestData:{source:_.requestData.source,cancer_type:_.requestData.cancer_type,sample_id:_.requestData.sample_id,signature:_.now.signature,filter:_.requestData.filter},data:e}),bio.loading().end()}}))}})}function o(t,e){var n="scatter"===t?"scatter_leg":"bar_leg";bio.layout().get(_.setting.svgs,[n],function(n,i){var o=bio.expressionConfig().legend(t);e&&bio.legend({data:e,element:i,on:o.on,attr:o.attr,text:o.text,style:o.style,margin:o.margin})})}function a(t){bio.layout().get(_.setting.svgs,["gradient"],function(e,n){var i=bio.expressionConfig().gradient("shape"),o=bio.expressionConfig().gradient("axis",n);_.data.colorGradient=bio.colorGradient({element:n,offset:t,adjustValue:6,colors:["#FF0000","#000000","#00FF00"]}),bio.rectangle({element:bio.rendering().addGroup(n,0,0,"gradient-shape"),attr:i.attr,style:i.style},_),bio.axises().bottom({element:n,top:o.top,left:o.left,range:o.range,margin:o.margin,exclude:o.exclude,tickValues:t,domain:[t[0],t[2]]}).selectAll("text").style("fill","#999999")})}function r(t,e,n){bio.layout().get(_.setting.svgs,["heatmap"],function(i,o){var a=bio.scales().get(n,["#FF0000","#000000","#00FF00"]),r=bio.expressionConfig(),l=r.heatmap("shape",t.axisMargin),s=r.heatmap("axis",t.axisMargin);o.attr("height",10*e.y.length),bio.heat({element:o,xaxis:e.x,yaxis:e.y,on:l.on,data:t.heatmap,attr:l.attr,margin:l.margin,style:{fill:function(t,e,n){return a(t.value)}}}),bio.axises().left({element:o,domain:e.y,top:s.top,left:s.left,margin:s.margin,exclude:s.exclude,range:[0,10*e.y.length]})})}function l(t,e){bio.layout().get(_.setting.svgs,["bar_plot"],function(n,i){var o=bio.expressionConfig(),a=o.bar("shape",t.axisMargin),r=o.bar("axis",t.axisMargin);bio.bar({element:i,xaxis:e.x,data:t.bar,on:a.on,attr:a.attr,style:a.style,margin:a.margin,yaxis:[e.y[2],e.y[0]]}),bio.axises().left({element:i,top:r.top,left:r.left,tickValues:e.y,margin:r.margin,domain:[e.y[2],e.y[0]],range:[20,i.attr("height")-15]}).selectAll("path, line").style("stroke","#999999")})}function s(t,e){_.data.survival.divide={},bio.iteration.loop(t,function(t){t.value<=e?_.data.survival.divide[t.x]="unaltered":_.data.survival.divide[t.x]="altered"})}function c(t,e){_.now.osdfs!==t&&(bio.layout().removeGroupTag(["scatter-g-tag","left-axis-g-tag"]),_.now.osdfs=t,f(e,e.axis.scatter,_.now.osdfs),(_.divide.low_arr||_.divide.high_arr)&&x(d3.selectAll("#expression_scatter_plot_svg_scatter_shape_circle"),_.divide.low_arr,_.divide.high_arr))}function u(t){var e=document.querySelector("#expression_survival").querySelectorAll("input");e[0].onclick=function(e){c("os",t)},e[1].onclick=function(e){c("dfs",t)}}function d(t){var e=document.querySelector("#expression_survival"),n=parseFloat(e.style.width),i=parseFloat(e.style.height)/1.4;SurvivalCurveBroilerPlate.settings={canvas_width:.92*n,canvas_height:.9*i,chart_width:.9*n,chart_height:.9*i,chart_left:50,chart_top:15,include_info_table:!1,include_legend:!0,include_pvalue:!0,pval_x:n/1.95,pval_y:40},SurvivalCurveBroilerPlate.style={censored_sign_size:5,axis_stroke_width:1,axisX_title_pos_x:n/2,axisX_title_pos_y:i/1.125,axisY_title_pos_x:-n/2,axisY_title_pos_y:10,axis_color:"black",pval_font_size:10,pval_font_style:"normal"},SurvivalCurveBroilerPlate.subGroupSettings.legend={low:"Low score group",high:"High score group"};s(t.bar,t.axis.bar.y[1]);var o=bio.survival({element:"#expression_survival",margin:[20,20,20,20],data:_.divide.patient_list||_.setting.defaultData.patient_list,division:_.divide.divide||t.survival.divide});_.data.survival.data=o.survival_data,_.data.scatter=Object.keys(_.data.scatter).length<1?_.data.survival.data.all:_.data.scatter,u(t)}function p(t,e){var n=[];return bio.iteration.loop(t,function(t){bio.iteration.loop(t,function(t,i){e.indexOf(t)>-1&&n.push({x:t,y:i.months,value:i.status})})}),n}function f(t,e,n){bio.layout().get(_.setting.svgs,["scatter_p"],function(i,o){var a=bio.expressionConfig(),r=a.scatter("shape",t.axisMargin),l=a.scatter("axis",t.axisMargin),s=[].concat(e.y[n]).reverse();bio.scatter({element:o,yaxis:s,xaxis:e.x,on:r.on,attr:r.attr,style:r.style,margin:r.margin,data:p(t.scatter[n],e.x)}),bio.axises().left({ticks:15,element:o,domain:s,top:l.top,left:l.left,margin:l.margin,range:[10,o.attr("height")-30]}).selectAll("path, line").style("stroke","#999999")})}function g(t,e){for(var n=0,i=t.length;n<i;n++){var o=t[n],a=e[n];_.data.patient.data===o.innerHTML&&(o.innerHTML+=" **",a.innerHTML+=" **")}}function h(t){var e=bio.expressionConfig().survival("legend");bio.text({element:t,attr:{x:function(t,n){return e.attr.x(t,n,_)},y:function(t,n){return e.attr.y(t,n,_)}},style:{fill:function(t,n){return e.style.fill(t,n,_)}},text:function(t,n){return e.text(t,n,_)}})}function m(){var t={},e=setInterval(function(){t.os_tb=document.querySelectorAll("#os_stat_table td b"),t.dfs_tb=document.querySelectorAll("#dfs_stat_table td b"),t.legend=d3.selectAll(".legend"),t.os_tb.length>0&&t.dfs_tb.length>0&&t.legend.node()&&(g(t.os_tb,t.dfs_tb),h(t.legend),clearInterval(e))},10)}function v(t){bio.layout().get(_.setting.svgs,["bar_p","scatter_p"],function(e,n){var i={},o=e.indexOf("bar")>-1?"bar":"scatter",a=bio.expressionConfig().patient(t.axisMargin);i.group=bio.rendering().addGroup(n,0,0,o+"-patient"),i.id=e+"_"+o+"_patient",i.margin=bio.sizing.setMargin(a.margin),i.width=parseFloat(n.attr("width")),i.height=parseFloat(n.attr("height")),i.scaleX=bio.scales().get(t.axis.heatmap.x,[i.margin.left,i.width-i.margin.right]),i.scaleY=bio.scales().get([t.axis.bar.y[2],t.axis.bar.y[0]],[i.margin.top,i.height-i.margin.bottom]),bio.triangle({element:i.group.selectAll("#"+i.id+"_"+o+"_patient"),data:t.bar.filter(function(e){if(e.x===t.patient.name)return e}),attr:{id:function(t,e,n){return i.id+"_"+o+"_patient"},points:a.attr.points},style:a.style,on:a.on},i)}),m()}function x(t,e,n){t.style("fill-opacity",function(i,o,a){return e.indexOf(i.x)<0&&n.indexOf(i.x)<0?.08:t.attr("id").indexOf("shape")>-1?.6:1}).style("stroke-opacity",function(t,i,o){return e.indexOf(t.x)<0&&n.indexOf(t.x)<0?.08:1})}function y(t){function e(t){bio.iteration.loop(t,function(t){t!==_.data.patient.name&&(bio.iteration.loop(_.setting.defaultData.patient_list,function(e){e.participant_id===t&&_.divide.patient_list.push(e)}),_.divide.divide[t]=_.data.survival.divide[t])})}function n(n,i){_.divide.divide={},_.divide.patient_list=[],_.divide.scatter={os:[],dfs:[]},e(n),e(i),d(t),v(t),x(d3.selectAll("#expression_bar_plot_svg_bar_rect_rect"),n,i),x(d3.selectAll("#expression_scatter_plot_svg_scatter_shape_circle"),n,i)}var i=bio.expressionConfig().division;bio.layout().get(_.setting.svgs,["division"],function(e,o){var a=i("division",t.axisMargin);bio.divisionLine({element:o,pathElement:[d3.select("#expression_bar_plot_svg"),d3.select("#expression_scatter_plot_svg")],info:[{additional:-10,color:"#00AC52",direction:"right",text:"Low score group"},{additional:10,color:"#FF6252",direction:"left",text:"High score group"}],data:t.bar,text:a.text,attr:a.attr,call:{drag:a.call.drag,end:function(t,e,i){var o=[].concat(i.axis);_.divide.low_sample=i.invert(i.position.now.low),_.divide.high_sample=i.invert(i.position.now.high),_.divide.high_arr=o.splice(i.axis.indexOf(_.divide.high_sample),o.length-1),_.divide.low_arr=o.splice(0,i.axis.indexOf(_.divide.low_sample)),n(_.divide.low_arr,_.divide.high_arr)}},style:a.style,margin:a.margin,axis:t.axis.bar.x,idxes:t.axis.bar.y},_)})}function b(e,s){t(),n(e.subtype),i(s.signature_list),o("color_mapping",_.now.colorSet||null),o("scatter",["Alive","Dead"]),a(e.axis.gradient.x),r(e,e.axis.heatmap,e.axis.gradient.x),l(e,e.axis.bar),d(e),f(e,e.axis.scatter,_.now.osdfs),v(e),y(e)}var _={};return function(t){_={},(_=bio.initialize("expression")).setting=bio.setting("expression",t),_.data=_.setting.preprocessData,_.requestData=t.requestData||{},_.requestURL=t.requestURL||"/rest/expressions",_.init.signature=t.data.signature_list[0].signature,_.now.signature=_.requestData.signature,_.init.bar_legend_height=document.querySelector("#expression_bar_legend").style.height,bio.title("#expression_title","Expressions"),b(_.data,_.setting.defaultData),console.log(">>> Expression reponse data: ",t),console.log(">>> Expression setting data: ",_.setting),console.log(">>> Expression model data: ",_)}},landscape=function(){"use strict";function t(t){var e=bio.dom().get("#landscape_heatmap");t.width=2*parseFloat(e.style.width),t.height=parseFloat(e.style.height)}function e(t){bio.scaleSet({element:"#landscape_option",defaultValue:m.init.width,change:function(t,e){return bio.layout().removeGroupTag(),"refresh"===e.type?(a({axis:"x",data:m.init.axis.x}),a({axis:"y",data:m.init.axis.y}),h(m.data,(m.now.width=m.init.width,m.now.width))):h(m.data,(m.now.width=e.value,m.now.width))}})}function n(){d3.selectAll("#landscape_group_svg, #landscape_axis_group_svg, #landscape_patient_group_svg").remove()}function i(t){t=t.sort(function(t,e){return bio.boilerPlate.variantInfo[t].order>bio.boilerPlate.variantInfo[e].order?1:-1})}function o(t){t.patient.heatmap={x:t.patient.x,y:t.gene.y},t.patient.group={x:["NA"],y:t.group.y},t.patient.sample={x:t.patient.x,y:t.sample.y}}function a(t){var e="x"===t.axis?"group":"pq",n="x"===t.axis?"sample":"gene";m.data.axis[e][t.axis]=t.data,m.data.axis[n][t.axis]=t.data,m.data.axis.heatmap[t.axis]=t.data}function r(t){bio.layout().get(m.setting.svgs,["e_gr","e_s","e_h"],function(e,n){n.attr("width",t||m.now.width||m.init.width)})}function l(t){if(!t)return!1;m=t.model,bio.layout().removeGroupTag(),a(t.sorted),h(m.data,m.now.width)}function s(t,e){var n={sample:"s_s",gene:"gene",pq:"pq",group:"s_g"}[t];bio.layout().get(m.setting.svgs,[n],function(n,i){var o=bio.landscapeConfig().axis(t,e,i),a=bio.landscapeConfig().axis("common"),r=m.data.axis[t][e.toLowerCase()];"group"===t&&bio.iteration.loop(r,function(t){n.indexOf(t[0].removeWhiteSpace())>-1&&(r=t)}),bio.axises()[o.direction]({element:i,domain:r,top:o.top,left:o.left,range:o.range,margin:o.margin,exclude:o.exclude}).selectAll("text").on("mouseout",!!a.on&&a.on.mouseout).on("mouseover",!!a.on&&a.on.mouseover).on("click",function(t,e){var n=!!o.on&&o.on.click.call(this,t,e,m);console.log(n.model),l(n)})})}function c(t,e){return t.indexOf("pq")<0?t.indexOf("gene")>-1?[{name:"gene",text:e.titles[0]}]:[{name:"sample",text:e.titles[0]}]:[{name:"pq",text:e.titles[1]}]}function u(t){bio.layout().get(m.setting.svgs,[t],function(t,e){var n=bio.landscapeConfig().title("common"),i=c(e.attr("id"),n),o=bio.landscapeConfig().title(i[0].name);bio.sortTitle({data:i,element:e,attr:o.attr,text:n.text,style:n.style,margin:o.margin,titles:n.titles,on:{mouseover:n.on.mouseover,mouseout:n.on.mouseout,click:function(t,e,o){m.sortName=i[0].name,m.now.sort[t.name]&&"asc"===m.now.sort[t.name]?m.now.sort[t.name]="desc":m.now.sort[t.name]="asc",l(n.on.click.call(this,t,e,m))}}},m)})}function d(t,e,n,i){var o={sample:{id:"e_s",config:"sample"},samplePatient:{id:"t_s",config:"sample"},gene:{id:t,config:t},pq:{id:t,config:t}}[t];bio.layout().get(m.setting.svgs,[o.id],function(a,r){var l=bio.landscapeConfig().bar(o.config);t.indexOf("Patient")>-1&&(l.margin[3]=5),bio.bar({data:e,element:r,on:l.on,xaxis:n.x,yaxis:n.y,startTo:i,attr:l.attr,style:l.style,margin:l.margin})})}function p(t,e){return t.indexOf("group")>-1||t.indexOf("patientGroup")>-1?e.y[0].removeWhiteSpace():""}function f(t,e,n){var i=p(t,n),o={group:{id:"p_group_",config:"group"},patientGroup:{id:"t_group_",config:"group"},heatmap:{id:"e_h",config:"heatmap"},patientHeatmap:{id:"t_h",config:"heatmap"}};bio.layout().get(m.setting.svgs,[o[t].id+i],function(i,a){var r=bio.landscapeConfig().heatmap(o[t].config),l=t.indexOf("map")>-1?bio.initialize("landscapeHeatmap"):null;(t.indexOf("patientHeatmap")>-1||t.indexOf("patientGroup")>-1)&&(r.margin[3]=5),bio.heat({data:e,element:a,xaxis:n.x,yaxis:n.y,on:r.on,attr:r.attr,style:r.style,margin:r.margin},l)})}function g(t){bio.layout().get(m.setting.svgs,["legend"],function(e,n){var i=bio.landscapeConfig().legend();bio.legend({data:t,element:n,on:i.on,attr:i.attr,text:i.text,style:i.style,margin:i.margin})})}function h(t,e){var n=m.data;r(e),s("pq","X"),s("gene","X"),s("gene","Y"),s("group","Y"),s("sample","Y"),u("pq"),u("s_s"),u("gene"),d("pq",n.pq,n.axis.pq,["top","left"]),d("gene",n.stack.gene,n.axis.gene,["top","left"]),d("sample",n.stack.sample,n.axis.sample,["top","left"]),d("samplePatient",n.stack.patient,n.axis.patient.sample,["top","left"]),f("heatmap",n.heatmap,n.axis.heatmap),f("patientHeatmap",n.patient,n.axis.patient.heatmap),bio.iteration.loop(n.axis.group.y,function(t,e){var i=n.axis.group.y[e],o={x:n.axis.group.x,y:i},a={x:n.axis.patient.group.x,y:i};f("group",n.group.group[e],o),f("patientGroup",[n.group.patient[e]],a)}),g(n.type)}var m={};return function(r){(m=bio.initialize("landscape")).setting=bio.setting("landscape",r),m.data=m.setting.preprocessData,n(),bio.title("#landscape_title",m.setting.defaultData.title),t(m.init),e(m.setting),m.exclusive.init=bio.landscapeSort().exclusive(m.data.heatmap,m.data.gene),m.init.axis.x=[].concat(m.exclusive.init.data),m.init.axis.y=[].concat(m.data.axis.gene.y),i(m.data.type),o(m.data.axis),a(m.exclusive.init),h(m.data,m.init.width),bio.handler().scroll("#landscape_heatmap",function(t){var e=bio.dom().get("#landscape_sample"),n=bio.dom().get("#landscape_group");e.scrollLeft=this.scrollLeft,n.scrollLeft=this.scrollLeft}),console.log(">>> Landscape reponse data: ",r),console.log(">>> Landscape setting data: ",m.setting),console.log(">>> Landscape model data: ",m)}},landscapeSort=function(){"use strict";function t(t,e){var n={};return bio.iteration.loop(t,function(t,i){n[t[e]]=n[t[e]]?n[t[e]]+=t.value:n[t[e]]=t.value}),n}function e(t){var e=[];return bio.iteration.loop(t,function(t,n){e.push({key:t,value:n})}),e}function n(t,e){var n="asc"===t?1:-1;return e.sort(function(t,e){return t.value>e.value?1*n:-1*n})}function i(i,o){return{axis:"y",data:n(i,e(t(o,"y"))).map(function(t){return t.key})}}function o(i,o){return{axis:"x",data:n(i,e(t(o,"x"))).map(function(t){return t.key})}}function a(t,e){return{axis:"y",data:n(t,e).map(function(t){return t.y})}}function r(t,e,n){switch(t){case"gene":return i(e,n);case"sample":return o(e,n);case"pq":return a(e,n);default:throw new Error("Not matching function")}}function l(t,e){switch(t){case"gene":return e.stack.gene;case"sample":return e.stack.sample;case"pq":return e.pq;case"init":return e.init;default:throw new Error("No matching any data")}}function s(t,e){return r(t,"asc",l(t,e))}function c(t,e){return r(t,"desc",l(t,e))}function u(t,e){var n=bio.landscapeSort().exclusive(e,e[0].y);return bio.iteration.loop(t,function(t){n.data.indexOf(t)<0&&n.data.push(t)}),n}function d(t){var e=[];return bio.iteration.loop(Object.keys(t).sort(function(t,e){return bio.boilerPlate.clinicalInfo[t].order>bio.boilerPlate.clinicalInfo[e].order?1:-1}),function(n,i){e.push(t[n])}),e}function p(t){var e=[];return bio.iteration.loop.call(this,t,function(t){var n=[];bio.iteration.loop(t,function(t){n=n.concat(t.info)}),e.push(bio.landscapeSort().exclusive(n,this.data.gene))}),e}function f(t){var e=d(y(t)),n=p.call(this,e),i={};return bio.iteration.loop(n,function(t){i.axis=t.axis,i.data?i.data.push(t.data):i.data=[t.data]}),{group:e,axis:i}}function g(t,e){var n=[];return bio.iteration.loop(t,function(t){bio.iteration.loop(e,function(e){t.x===e.x&&n.push(t)})}),n}function h(t,e){if(e){if(this.now.group.length<1)throw new Error("There are empty group data");var n=[],i={group:[],axis:{axis:"x",data:[]}};return bio.iteration.loop.call(this,this.now.group.group,function(e){n.push(f.call(this,g(t,e)))}),bio.iteration.loop(n,function(t){i.group=i.group.concat(t.group),i.axis.data=i.axis.data.concat(t.axis.data)}),i}return f.call(this,t)}function m(t,e,n){var i=2*e.indexOf(n.y),o="cnv"===bio.landscapeConfig().byCase(n.value)?0:1;t.value=t.value.replaceAt(i,"00".replaceAt(o,"1"))}function v(t){return{axis:"x",data:t.sort(function(t,e){return t.value<e.value?1:-1}).map(function(t){return t.key})}}function x(t,e){var n={},i=[],o=0;return bio.iteration.loop(t,function(t){n[t.x]?n[t.x]=n[t.x]:(n[t.x]=!0,i.push({key:t.x,value:[].fill(e.length,"00").join("")}),o+=1),m(i[o-1],e,t)}),b.exclusive=i,v(i)}function y(t){var e={};return bio.iteration.loop(t,function(t){e[t.value]?e[t.value].push(t):e[t.value]=[t]}),e}var b={};return function(){return b=bio.initialize("landscapeSort"),{asc:s,desc:c,gene:u,group:h,exclusive:x}}},scaleSet=function(){"use strict";function t(){var t=document.createElement("div");return t.id="scale_set_div",t}function e(t){var e=document.createElement("input");return e.id="scale_set_input",e.value=t||"100%",e}function n(t){return t.indexOf("caret")>-1?t.indexOf("up")>-1?"up":"down":"refresh"}function i(t){if(a.change){var e=n(this.className),i=parseInt(.1*a.defaultValue),o={up:1,down:-1}[e];a.scaleValue="refresh"!==e?a.scaleValue+o*i:a.defaultValue,a.scaleRate="refresh"!==e?"up"===e?(a.scaleRate+=a.termRate,a.scaleRate):(a.scaleRate-=a.termRate,a.scaleRate):a.defaultRate,a.scaleRate=a.defaultValue/2>a.scaleValue?(a.scaleRate+=a.termRate,a.scaleRate):2*a.defaultValue<a.scaleValue?2*a.defaultRate:a.scaleRate,a.scaleValue=a.defaultValue/2>a.scaleValue?a.defaultValue/2:2*a.defaultValue<a.scaleValue?2*a.defaultValue:a.scaleValue,a.input.value=a.scaleRate+"%",a.change.call(this,t,{type:e,value:a.scaleValue})}}function o(){var t=document.createElement("div"),e=["caret-up","caret-down","refresh"];return t.id="scale_options",bio.iteration.loop(e,function(e){var n=document.createElement("i"),o=document.createElement("div"),a=document.createElement("button");a.className="scale-"+e,n.className="fa fa-"+e+" fa-lg",a.addEventListener("click",i),a.appendChild(n),o.appendChild(a),t.appendChild(o)}),t}var a={};return function(n){if(!n.element)throw new Error("Please, pass the element");var i=bio.dom().get(n.element);(a={unit:n.unit||"%",change:n.change||null,termRate:n.termRate||10,scaleRate:n.defaultRate||100,defaultRate:n.defaultRate||100,scaleValue:n.defaultValue||100,defaultValue:n.defaultValue||100}).div=t(),a.input=e(),a.buttons=o(),a.div.appendChild(a.input),a.div.appendChild(a.buttons),i.appendChild(a.div)}},sortTitle=function(){"use strict";var t={};return function(e,n){t=bio.objects.clone(n||{}),t=bio.sizing.chart.default(t,e),bio.rendering().dropShadow(e.element,1,-.1,1),t.font=e.style.fontSize+" "+e.style.fontWeight,t.mostWidth=bio.drawing().mostWidth(e.titles,t.font),t.mostHeight=bio.drawing().textSize.height(t.font),t.group=bio.rendering().addGroup(e.element,0,0,"sort-title"),t.id.indexOf("sample")>-1&&t.group.attr("transform","translate(0, 0) rotate(270)"),t.opts={text:bio.objects.clone(e),shape:bio.objects.clone(e)},t.opts.text.id=t.id+"_sorttitle_text",t.opts.text.element=t.group.selectAll("#"+t.id+"_text"),t.opts.shape.id=t.id+"_sorttitle_shape",t.opts.shape.element=t.group.selectAll("#"+t.id+"_shape"),bio.rectangle(t.opts.shape,t),bio.text(t.opts.text,t)}},initialize=function(){"use strict";var t={layout:{svg:{variants:{},landscape:{},expression:{},exclusivity:{}}},sizing:{ids:[],chart:{}},setting:{idx:[],dom:null,size:{width:0,height:0}},preprocess:{pathway:null,variants:{needle:{line:[],shape:[]},patient:{line:[],shape:[]},type:[],graph:[],axis:{needle:{x:[],y:[]},now:{x:[],y:[]}}},landscape:{type:{},group:{group:[],patient:[]},heatmap:[],patient:[],stack:{gene:{},sample:{},patient:{}},axis:{pq:{x:[],y:[]},gene:{x:[],y:[]},group:{x:[],y:[]},sample:{x:[],y:[]},heatmap:{x:[],y:[]},patient:{x:[],y:[]}}},expression:{func:{default:"average",now:null,avg:[]},tpms:[],heatmap:[],scatter:{},subtype:[],survival:{},bar:[],axis:{gradient:{x:{},y:{}},heatmap:{x:{},y:{}},scatter:{x:{},y:{}},bar:{x:{},y:{}}}},exclusivity:{heatmap:{},network:{},type:{},survival:{merge:{},heat:{},data:{}},geneset:[],geneset_all:[],axis:{heatmap:{x:{},y:{}},division:{x:{},y:[]}},divisionIdx:{}}},loading:{},expression:{init:{function:"Average",signature:null,color_mapping:null},now:{function:null,signature:null,color_mapping:null,osdfs:"os"},divide:{}},exclusivity:{now:{geneset:null}},colorGradient:{show:[],data:[]},variants:{div:{}},variantsNavi:{start:0,end:0},landscape:{div:{},init:{axis:{x:[],y:[]},width:0,height:0},now:{sort:{gene:null,sample:null,pq:null},group:[],axis:{x:[],y:[]},width:0,height:0},exclusive:{init:null}},landscapeSort:{exclusive:[]},landscapeHeatmap:{mutationType:["cnv","var"],value:{},duplicate:[]}};return function(e){return bio.objects.clone(t[e]?t[e]:{})}},pathway=function(){"use strict";function t(t,e){bio.drawing().importSVG("/datas/"+t+".svg",e)}function e(t,e){var n=null;return bio.iteration.loop(e,function(e){e.gene_id===t&&(n={is:!0,data:e})}),n||{is:!1,data:null}}function n(t,e){if(e>-1){var n=!1;setInterval(function(){n=!n,t.style("stroke",n?"#ff0000":"#333").style("stroke-width",n?3:1)},500)}}function i(t,e,i,o){var a=bio.pathwayConfig().node();o&&n(t,o),t.attr("cursor","pointer").style("fill",function(t){return a.style.fill.call(this,e)}).on("mouseover",function(t,n){a.on.mouseover.call(this,e,n,i)}).on("mouseout",function(t,n){a.on.mouseout.call(this,e,n,i)})}function o(t){bio.iteration.loop(t.childNodes,function(t,e){/gene_/i.test(e.id)&&d3.select(e).data({index:t})})}function a(t,n){var a=d3.selectAll("text").nodes();bio.iteration.loop(a,function(o){var a=e(o.textContent,t);if(a.is||/gene_/i.test(o.parentNode.id)){var r=d3.select(o.parentNode).select("rect"),l=n.indexOf(o.textContent),s={x:parseInt(r.attr("x")),y:parseInt(r.attr("y")),width:parseInt(r.attr("width")),height:parseInt(r.attr("height"))};i(r,a.data,s,l),i(d3.select(o),a.data,s)}}),o(a[0].parentNode.parentNode),d3.selectAll("text, rect").attr("class","")}function r(t){var e=bio.pathwayConfig().drug();d3.selectAll('g[id*="drug_"]').datum(function(e){var n=d3.select(this).attr("transform"),i=bio.dependencies.version.d3v4()?bio.rendering().translation(n):d3.transform(n);return{cancer:t,scaleX:i.scale[0],scaleY:i.scale[1],translateX:i.translate[0],translateY:i.translate[1]}}).on("click",e.on.click).on("mouseover",e.on.mouseover).on("mouseout",e.on.mouseout)}var l={};return function(e){t(e.cancer_type,function(t){bio.modal({id:"drug_modal",element:document.querySelector(e.element)}),(l=bio.initialize("pathway")).setting=bio.setting("pathway",e),l.data=l.setting.preprocessData,l.modalID="drug_modal",bio.title("#pathway_title",e.cancer_type.toUpperCase()+" - Pathway");var n=document.getElementById("pathway_contents"),i=document.querySelector(".modal-body");d3.select(t.documentElement).attr("width",parseFloat(n.style.width)).attr("height",parseFloat(n.style.height)),n.appendChild(t.documentElement),i.style.height=.8*parseFloat(n.style.height)+"px",a(l.setting.defaultData.pathway,l.setting.defaultData.patient),r(e.cancer_type)}),console.log(">>> Pathway reponse data: ",e),console.log(">>> Pathway setting data: ",l.setting),console.log(">>> Pathway model data: ",l)}},preprocExclusivity=function(){"use strict";function t(t){var e={};return bio.iteration.loop(t,function(t){e[t.gene]=["."]}),e}function e(t,e){var n={};return bio.iteration.loop(t,function(t){var i=bio.boilerPlate.variantInfo[t.type],o=bio.exclusivityConfig().abbreviation(i),a=bio.objects.clone(e);n[t.participant_id]?"."===n[t.participant_id][t.gene][0]?n[t.participant_id][t.gene]=[o]:n[t.participant_id][t.gene].push(o):(a[t.gene]=[o],n[t.participant_id]=a)}),n}function n(n,i){var o=t(i),a=e(i,o);bio.iteration.loop(n,function(t){t.gene=a[t.participant_id]?a[t.participant_id]:o}),d.survival.merge=n}function i(t){return"rgb("+t.split(" ").join(",")+")"}function o(t){return d.type[t.join(" ")]=[]}function a(t){var e=t.matchAll(d.regex.geneset),n=t.matchAll(d.regex.heatmap),i=bio.exclusivityConfig(),a=0;bio.iteration.loop(e,function(t){var e=t.replace(/\[|\]/g,"").split(" "),r=e.length+a,l=e.join(" "),s=o(e),c=[];d.heatmap[l]=[],d.axis.heatmap.x[l]=[],d.axis.heatmap.y[l]=e,d.axis.division.x[l]=[],d.divisionIdx[l]={idx:0};for(var u=0,p=n[0].length;u<p;u++)d.axis.heatmap.x[l].push(""+u),d.axis.division.x[l].push(""+u);for(;a<r;a++)bio.iteration.loop(n[a].split(""),function(t,n){bio.iteration.loop(i.separate(t),function(t){t=i.name(t),d.heatmap[l].push({x:n,y:e[a>=e.length?a-(r-e.length):a],value:t}),s.indexOf(t)<0?s.push(t):s=s}),d.divisionIdx[l].idx="."!==t?d.divisionIdx[l].idx>n?d.divisionIdx[l].idx:n:d.divisionIdx[l].idx}),c.push(n[a]);d.geneset.push(e),d.geneset_all=d.geneset_all.concat(e),d.survival.heat[l]=c});var r=d.geneset[4];d.geneset[4]=d.geneset[0],d.geneset[0]=r}function r(t){var e=[];return bio.iteration.loop(t,function(t){var n={};t=t.replace(new RegExp(/\t|\s{2,}|\s(?=\D)/,"ig"),"\t"),bio.iteration.loop(t.split("\t"),function(t){var e=t.split(":");n[e[0]]=e[0].indexOf("color")<0?e[1]:i(e[1])}),e.push(n)}),e}function l(t){var e=null;bio.iteration.loop(t,function(t,n){d.network[t]=r(n),bio.iteration.loop(d.network[t],function(t){"compound"===t.type?(e=t.id,t.bgcolor=t.bgcolor.replace('"',""),t.textcolor=t.textcolor.replace('"',"")):"edge"===t.type?(t.source=t.source.replace(e,""),t.target=t.target.replace(e,""),t.linecolor=t.linecolor.replace('"',"")):"node"===t.type&&(t.bgcolor=t.bgcolor.replace('"',""))})})}function s(t){var e={};t=(t=t.replace(/\\n{1}/g,"\n")).replace(/\\t{1}/g,"\t"),bio.iteration.loop(t.split("\n"),function(t){bio.iteration.loop(d.geneset,function(n){var i=n.join("");t.indexOf(i)>-1&&(e[i]?e[i].push(t):e[i]=[t])})}),l(e)}function c(t){return t.indexOf("A")>-1&&t.indexOf("M")>-1?"B":t.indexOf("D")>-1&&t.indexOf("M")>-1?"E":t[0]}function u(t){var e={};bio.iteration.loop(d.survival.heat,function(t,n){for(var i=d.axis.heatmap.x[t].length,o=t.split(" "),a=d.survival.data[t]?d.survival.data[t]:d.survival.data[t]=[],r=e[t]={},l=0;l<i;l++)d.survival.merge.some(function(t){for(var e=!0,i=0,s=o.length;i<s;i++)c(t.gene[o[i]])!==n[i][l]&&(e=!1);if(e&&void 0===r[t.participant_id])return r[t.participant_id]="",a[l]=t,void 0!==a[l]})})}var d={};return function(t){return d={},d=bio.initialize("preprocess").exclusivity,d.regex={geneset:new RegExp(/\[\w+(\s\w+)+\w+\]/,"g"),heatmap:new RegExp(/(A|B|D|E|M|\.){10,}/,"g")},n(t.survival.patient,t.survival.types),a(t.heatmap),s(t.network),u(t.survival),d.mostGeneWidth=bio.drawing().mostWidth(d.geneset_all,"12px"),console.log(">>> Preprocess exclusivity data: ",t),console.log(">>> Preprocess data: ",d),d}},preprocExpression=function(){"use strict";function t(t){f.axis.scatter.y={os:[],dfs:[]},f.patient_subtype={},bio.iteration.loop(t,function(t){f.axis.scatter.y.os.push(t.os_days/30),f.axis.scatter.y.dfs.push(t.dfs_days/30),f.patient_subtype[t.participant_id]=t});var e=bio.math.min(f.axis.scatter.y.os),n=bio.math.max(f.axis.scatter.y.os),i=bio.math.min(f.axis.scatter.y.dfs),o=bio.math.max(f.axis.scatter.y.dfs);f.axis.scatter.y.os=[e,n],f.axis.scatter.y.dfs=[i,o]}function e(t){var e={};return bio.iteration.loop(t,function(t){e[t.subtype]?e[t.subtype].push(t.value):e[t.subtype]=[t.value]}),e}function n(t){var n=e(t);bio.iteration.loop(n,function(t,e){f.subtype.push({key:t,value:e})})}function i(t){return Math.log(t+1)/Math.LN2}function o(t){f.axis.heatmap.x[t.participant_id]?f.axis.heatmap.x[t.participant_id].push({key:t.hugo_symbol,value:t.tpm}):f.axis.heatmap.x[t.participant_id]=[{key:t.hugo_symbol,value:t.tpm}]}function a(t){f.axis.gradient.x=[bio.math.min(t),bio.math.median(t),bio.math.max(t)],f.axis.gradient.y=[""]}function r(t){bio.iteration.loop(t,function(t,e){var n=0,i=0;bio.iteration.loop(e,function(t){f.axis.heatmap.y[t.key]="",n+=t.value}),i=n/e.length,f.bar.push({x:t,value:i,info:f.patient_subtype[t]}),f.func.avg.push(i)}),f.func.avg.sorted=f.func.avg.sort(function(t,e){return t>e?1:-1}),f.axis.bar.y=[bio.math.min(f.func.avg),bio.math.median(f.func.avg),bio.math.max(f.func.avg)]}function l(t,e){return{average:r(e)}[t]}function s(t){var e=[].concat(f.func.avg),n=[];bio.iteration.loop(t,function(t){n[e.indexOf(t.value)]=t.x}),f.axis.heatmap.x=n}function c(t,e){return{average:s(e)}[t]}function u(t){var e=f.func.now||f.func.default;bio.iteration.loop(t,function(t){t.tpm=i(t.tpm+1),o(t),f.tpms.push(t.tpm),f.heatmap.push({x:t.participant_id,y:t.hugo_symbol,value:t.tpm})}),a(f.tpms),l(e,f.axis.heatmap.x),c(e,f.bar),f.axis.heatmap.y=Object.keys(f.axis.heatmap.y),f.axis.scatter.x=f.axis.heatmap.x,f.axis.bar.x=f.axis.heatmap.x}function d(t){return f.axis.bar.y[1]>=f.func.avg[f.axis.bar.x.indexOf(t)]?"Low score group":"High score group"}function p(t){var e=0;return bio.iteration.loop(t,function(t){var n=bio.drawing().textSize.width(t,"10px");e=e>n?e:n}),e}var f={};return function(e){return f={},f=bio.initialize("preprocess").expression,f.all_rna_list=[].concat(e.cohort_rna_list.concat(e.sample_rna_list)),f.genes=e.gene_list.map(function(t){return t.hugo_symbol}),t(e.patient_list),n(e.subtype_list),u(f.all_rna_list),f.patient={name:e.sample_rna_list[0].participant_id,data:d(e.sample_rna_list[0].participant_id)},bio.iteration.loop(f.bar,function(t){t.y=f.axis.bar.y[1]}),f.axisMargin=p(f.axis.heatmap.y),console.log(">>> Preprocess variants data: ",e),console.log(">>> Preprocess data: ",f),f}},preprocLandscape=function(){"use strict";function t(t,e){t.indexOf(e)<0&&t.push(e)}function e(t,e){t.push({x:e.participant_id,y:e.gene,value:e.type})}function n(t,e,n){t[e]=t[e]?t[e]:{},t[e][n]=t[e][n]?t[e][n]+1:1}function i(t,e){bio.iteration.loop(t,function(t,n){t.type=bio.commonConfig().typeFormat(t.type),p.type[t.type]=null,e(t,n)}),p.isIterateCommonOk=!0}function o(o){i(o,function(i){n(p.stack.gene,i.gene,i.type),n(p.stack.sample,i.participant_id,i.type),e(p.heatmap,i),t(p.axis.sample.x,i.participant_id)})}function a(o){i(o,function(i){n(p.stack.patient,i.participant_id,i.type),e(p.patient,i),t(p.axis.patient.x,i.participant_id)})}function r(t){bio.iteration.loop(t,function(t){var e=[];bio.iteration.loop(t.data,function(n){var i=[];bio.iteration.loop(p.heatmap,function(t){n.participant_id===t.x&&i.push(t)}),e.push({x:n.participant_id,y:t.name,value:n.value,info:i})}),p.group.group.push(e),p.axis.group.y.push([t.name]),p.group.patient.push({x:p.axis.patient.x[0],y:t.name,value:"NA"})})}function l(t,e){return t.map(function(t){var n=Math.log(t[e])/Math.log(12)*-1;return{x:0,y:t.gene,value:n}})}function s(t,e,n,i,o){return"gene"===t?{x:e,y:n,value:i,info:o}:{x:n,y:e,value:i,info:o}}function c(t,e){var n=[],i="gene"===t?"x":"y";return bio.iteration.loop(e,function(e,o){var a=0,r=0;bio.iteration.loop(o,function(i,o){n.push(s(t,a,e,o,i)),a+=o,r+=o}),p.axis[t][i].push(r)}),n}function u(){p.axis.gene.x=[bio.math.max(p.axis.gene.x),0],p.axis.sample.y=[bio.math.max(p.axis.sample.y),0],p.axis.pq.x=[0,bio.math.max(p.pq.map(function(t){return Math.ceil(t.value)}))]}function d(){p.axis.pq.y=p.axis.gene.y=p.axis.heatmap.y=p.gene,p.axis.heatmap.x=p.axis.group.x=p.axis.sample.x}var p={};return function(t){return p=bio.initialize("preprocess").landscape,t=t.gene_list?t:t.data,p.gene=t.gene_list.map(function(t){return t.gene}),o(t.mutation_list),a(t.patient_list),r(t.group_list),p.type=Object.keys(p.type),p.pq=l(t.gene_list,t.pq||"p"),p.stack.gene=c("gene",p.stack.gene),p.stack.sample=c("sample",p.stack.sample),p.stack.patient=c("patient",p.stack.patient),u(),d(),console.log(">>> Preprocess landscape data: ",t),console.log(">>> Preprocess data: ",p),p}},preprocPathway=function(){"use strict";var t={};return function(e){return console.log(">>> Preprocess pathway data: ",e),console.log(">>> Preprocess data: ",t),t}},preprocVariants=function(){"use strict";function t(t,e){bio.iteration.loop(t,function(t,n){var i=0,o={key:t,value:[{x:parseFloat(t),y:i,value:0}]};a.axis.needle.y.push(i),bio.iteration.loop(n,function(e,n){o.value.push({x:parseFloat(t),y:i+=n.length,value:n.length,info:n})}),a.axis.needle.y.push(i),e.push(o)})}function e(e,n){var i={};bio.iteration.loop(e,function(t){t.type=bio.commonConfig().typeFormat(t.type);var e=t.position+" "+t.type+" "+t.aachange;i[t.position]?i[t.position][e]?i[t.position][e].push(t):i[t.position][e]=[t]:(i[t.position]={},i[t.position][e]=[t]),a.type.indexOf(t.type)<0&&a.type.push(t.type)}),t(i,n)}function n(t){bio.iteration.loop(t,function(t,e){a.graph.push({x:t.start,y:0,width:t.end-t.start,height:15,color:t.colour,info:t})})}function i(t){a.axis.needle.x=[0,t[0].length],a.axis.needle.y=a.axis.needle.y.length<1?[0,1]:[bio.math.min(a.axis.needle.y),bio.math.max(a.axis.needle.y)]}function o(t,e){bio.iteration.loop(t,function(t){bio.iteration.loop(t.value,function(n,i){n.info&&(n.value=n.y-t.value[i-1].y,e.push(n))})})}var a={};return function(t){return a=bio.initialize("preprocess").variants,e(t.variants.public_list,a.needle.line),e(t.variants.patient_list,a.patient.line),n(t.variants.graph),i(t.variants.graph),o(a.needle.line,a.needle.shape),o(a.patient.line,a.patient.shape),console.log(">>> Preprocess variants data: ",t),console.log(">>> Preprocess data: ",a),a}},preprocess=function(){"use strict";return function(t){return{pathway:bio.preprocPathway,variants:bio.preprocVariants,landscape:bio.preprocLandscape,expression:bio.preprocExpression,exclusivity:bio.preprocExclusivity}[t]}},SurvivalCurveBroilerPlate={elem:{svg:"",xScale:"",yScale:"",xAxis:"",yAxis:"",line:"",curve:"",dots:[],censoredDots:""},settings:{canvas_width:400,canvas_height:400,chart_width:370,chart_height:370,chart_left:50,chart_top:25,include_info_table:!1,include_legend:!0,include_pvalue:!0,pval_x:220,pval_y:57},divs:{curveDivId:"",headerDivId:"",infoTableDivId:""},subGroupSettings:{line_color:"red",mouseover_color:"#F5BCA9",legend:"",curveId:""},text:{xTitle:"",yTitle:"",qTips:{estimation:"",censoredEvent:"",failureEvent:""},infoTableTitles:{total_cases:"#total cases",num_of_events_cases:"",median:""},pValTitle:"Logrank Test P-Value: "},style:{censored_sign_size:5,axis_stroke_width:1,axisX_title_pos_x:260,axisX_title_pos_y:30,axisY_title_pos_x:10,axisY_title_pos_y:10,axis_color:"black",pval_font_size:10,pval_font_style:"normal"},vals:{pVal:0}};if(void 0===cbio)var cbio={};cbio.util=function(){function t(t,e){e=e||512;for(var n=atob(t),i=[],o=0;o<n.length;o+=e){for(var a=n.slice(o,o+e),r=new Array(a.length),l=0;l<a.length;l++)r[l]=a.charCodeAt(l);var s=new Uint8Array(r);i.push(s)}return i}function e(t,e){$(t).mouseenter(function(t){e.fadeIn({complete:function(){$(this).css({visibility:"visible"}),$(this).css({display:"inline"})}})}),$(t).mouseleave(function(t){e.fadeOut({complete:function(){$(this).css({visibility:"hidden"}),$(this).css({display:"inline"})}})})}function n(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function i(t){var e=document.getElementById(t),n=e;return e.contentWindow&&(n=e.contentWindow),n}function o(t){var e=document.getElementById(t),n=e.contentDocument;return!n&&e.contentWindow&&(n=e.contentWindow.document),n}function a(t,e){return"case.do?cancer_study_id="+t+"&case_id="+e}function r(t,e){return"case.do?cancer_study_id="+t+"&sample_id="+e}function l(t,e){t?(t[0]&&t[0].ownerSVGElement?t=t[0]:t[0]&&t[0][0]&&t[0][0].ownerSVGElement&&(t=t[0][0]),$(t).off("mouseenter",s),$(t).one("mouseenter",{qTipOpts:e},s)):console.error("qTip target is not defined.")}function s(t){var e={show:{ready:!0},hide:{fixed:!0,delay:100},style:{classes:"qtip-light qtip-rounded qtip-shadow",tip:!0},position:{my:"top left",at:"bottom right",viewport:$(window)}},n=t.data.qTipOpts;jQuery.extend(!0,e,n),$(this).qtip(e)}function c(){return{proxy:{pdbProxy:{options:{servletName:"get3dPdb.json",listJoiner:" ",subService:!1}},variantAnnotationProxy:{options:{initMode:"full",data:{}}}}}}function u(t){var e;if(null==t)return t;e=(e=d(e=t.replace(/\s+$/,""),"_"," ")).toLowerCase();var n=new Array;n.push(e.charAt(0).toUpperCase());for(var i=1;i<e.length;i++)" "==e.charAt(i-1)?n.push(e.charAt(i).toUpperCase()):n.push(e.charAt(i));return n.join("")}function d(t,e,n){for(var i=t,o=i.indexOf(e);-1!=o;)o=(i=i.replace(e,n)).indexOf(e);return i}function p(){return'<b>Recurrent Hotspot</b><br/>This mutated amino acid was identified as a recurrent hotspot (statistically significant) in a population-scale cohort of tumor samples of various cancer types using methodology based in part on <a href="http://www.ncbi.nlm.nih.gov/pubmed/26619011" target="_blank">Chang et al., Nat Biotechnol, 2016</a>.<br/><br/>Explore all mutations at <a href="http://cancerhotspots.org/" target="_blank">http://cancerhotspots.org/</a>.'}function f(t,e){var n=[],i=!1;_.each(t,function(t){$.isNumeric(t)&&n.push(Number(t))}),n.sort(function(t,e){return t-e});var o=n[Math.floor(n.length/4)],a=n[Math.ceil(.75*n.length)>n.length-1?n.length-1:Math.ceil(.75*n.length)],r=a-o;n[Math.ceil(.5*n.length)]<.001&&(i=!0);var l,s;if(a<1?(l=Number((a+1.5*r).toFixed(2)),s=Number((o-1.5*r).toFixed(2))):(l=Math.ceil(a+1.5*r),s=Math.floor(o-1.5*r)),s<n[0]&&(s=n[0]),l>n[n.length-1]&&(l=n[n.length-1]),e){var c=0;if(-1===n.indexOf(s)){for(;s>n[c]&&s>n[c+1];)c++;s=n[c+1]}if(c=n.length-1,-1===n.indexOf(l)){for(;l<n[c]&&l<n[c-1];)c--;l=n[c-1]}}return[s,l,i]}var g=function(t){return null===t||void 0===t},h=function(){var t=window.location.origin;return t||(t=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),t},m=function(t,e){function n(t,n){return t[e]<n[e]?-1:t[e]>n[e]?1:0}return t.sort(n),t},v=function(t){return t.replace(/[^a-zA-Z0-9-]/g,"_")};return{toPrecision:function(t,e,n){return 1e-6<=t&&t<n?t.toExponential(e):t.toPrecision(e)},getObjectLength:function(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e},checkNullOrUndefined:g,uniqueElementsOfArray:function(t){for(var e=[],n={},i=0,o=t.length;i<o;i++)t[i]in n||(e.push(t[i]),n[t[i]]=1);return e},arrayToAssociatedArrayIndices:function(t,e){g(e)&&(e=0);for(var n={},i=0,o=t.length;i<o;i++)n[t[i]]=i+e;return n},alterAxesAttrForPDFConverter:function(t,e,n,i,o){o&&(e*=-1,i*=-1);var a=t.selectAll(".tick").selectAll("text"),r=n.selectAll(".tick").selectAll("text"),l=parseInt(a.attr("y")),s=parseInt(r.attr("y"));a.attr("y",l+e),r.attr("y",s+i)},lcss:function(t,e){for(var n=0;n<t.length&&n<e.length&&t[n]===e[n];)n++;return t.substring(0,n)},b64ToByteArrays:t,browser:function(){var t={},e=navigator.userAgent.toLowerCase();if(t.firefox=/mozilla/.test(e)&&/firefox/.test(e),t.mozilla=t.firefox,t.chrome=/webkit/.test(e)&&/chrome/.test(e),t.safari=/applewebkit/.test(e)&&/safari/.test(e)&&!/chrome/.test(e),t.opera=/opera/.test(e),t.msie=/msie/.test(e),t.version="",t.msie||t.firefox||t.chrome||t.safari||t.opera||/trident/.test(e)&&(t.msie=!0,t.version=11),""===t.version)for(var n in t)if(t[n]){t.version=e.match(new RegExp("("+n+")( |/)([0-9]+)"))[3];break}return t}(),getWindowOrigin:h,sortByAttribute:m,safeProperty:v,autoHideOnMouseLeave:e,swapElement:n,getTargetWindow:i,getTargetDocument:o,getLinkToPatientView:a,getLinkToSampleView:r,addTargetedQTip:l,baseMutationMapperOpts:c,toTitleCase:u,getHotSpotDesc:p,replaceAll:d,findExtremes:f}}(),Array.prototype.forEach||(Array.prototype.forEach=function(t){var e=this.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=arguments[1],i=0;i<e;i++)i in this&&t.call(n,this[i],i,this)});var KmEstimator=function(){return{calc:function(t){var e=1;for(var n in t){var i=t[n];"1"==i.status?(i.survival_rate=e*((i.num_at_risk-1)/i.num_at_risk),e=i.survival_rate):"0"==i.status&&(i.survival_rate=e)}}}},LogRankTest=function(){function t(t,n,i){for(var r=0,l=0;r<t.length&&l<n.length;){if(t[r].time<n[l].time){if((s=jQuery.extend(!0,{},o)).time=t[r].time,"1"!=t[r].status){r+=1;continue}s.num_of_failure_1=1,s.num_at_risk_1=t[r].num_at_risk,s.num_at_risk_2=n[l].num_at_risk,r+=1}else if(t[r].time>n[l].time){if((s=jQuery.extend(!0,{},o)).time=n[l].time,"1"!=n[l].status){l+=1;continue}s.num_of_failure_2=1,s.num_at_risk_1=t[r].num_at_risk,s.num_at_risk_2=n[l].num_at_risk,l+=1}else{var s=jQuery.extend(!0,{},o);if(s.time=t[r].time,"1"!=t[r].status&&"1"!=n[l].status){r+=1,l+=1;continue}"1"==t[r].status&&(s.num_of_failure_1=1),"1"==n[l].status&&(s.num_of_failure_2=1),s.num_at_risk_1=t[r].num_at_risk,s.num_at_risk_2=n[l].num_at_risk,r+=1,l+=1}a.push(s)}e(i)}function e(t){$.each(a,function(t,e){e.expectation=e.num_at_risk_1/(e.num_at_risk_1+e.num_at_risk_2)*(e.num_of_failure_1+e.num_of_failure_2)}),n(t)}function n(t){$.each(a,function(t,e){var n=e.num_of_failure_1+e.num_of_failure_2,i=e.num_at_risk_1+e.num_at_risk_2;e.variance=n*(i-n)*e.num_at_risk_1*e.num_at_risk_2/(i*i*(i-1))}),i(t)}function i(t){var e=0,n=0,i=0;$.each(a,function(t,o){e+=o.num_of_failure_1,n+=o.expectation,i+=o.variance});var o=(e-n)*(e-n)/i;$.post("http://www.cbioportal.org/calcPval.do",{chi_square_score:o}).done(function(e){(r=t)(e)})}var o={time:"",num_of_failure_1:0,num_of_failure_2:0,num_at_risk_1:0,num_at_risk_2:0,expectation:0,variance:0},a=[],r="";return{calc:function(e,n,i){a.length=0,t(e,n,i)}}},SurvivalCurve=function(){function t(){$("#"+A.curveDivId).empty(),b.svg=d3.select("#"+A.curveDivId).append("svg").attr("width",w.canvas_width).attr("height",w.canvas_height),b.curve=b.svg.append("g"),b.censoredDots=b.svg.append("g").attr("id","crossDots")}function e(t){var e=[],n=d3.format(".0%");$.each(t,function(t,n){var i=n.data;$.each(i.getData(),function(t,n){e.push(n.time)})}),b.xScale=d3.scaleLinear().domain([0,d3.max(e)+.1*d3.max(e)]).range([w.chart_left,w.chart_width]),b.yScale=d3.scaleLinear().domain([-.03,1.05]).range([w.chart_height-40,w.chart_left]),b.xAxis=d3.axisBottom(b.xScale).tickSize(6,0,0),b.yAxis=d3.axisLeft(b.yScale).tickFormat(n).tickSize(6,0,0)}function n(){b.line=d3.line().x(function(t){return b.xScale(t.time)}).y(function(t){return b.yScale(t.survival_rate)})}function i(t){var e={case_id:"",time:"",status:"",num_at_risk:-1,survival_rate:0},n=jQuery.extend(!0,{},e);return n.case_id="NA",n.time=0,n.status="NA",n.num_at_risk=t,n.survival_rate=1,n}function o(t,e,n){null!==t&&t.length>0&&(0!==t[0].time&&t.unshift(i(t[0].num_at_risk)),b.curve=b.svg.append("path").attr("id",n+"-line").attr("d",b.line(t)).style("fill","none").style("stroke",e.line_color))}function a(t,e,n){b.dots[t].selectAll("path").data(e).enter().append("svg:path").attr("d",d3.symbol().size(400).type(d3.symbolCircle)).attr("transform",function(t){return"translate("+b.xScale(t.time)+", "+b.yScale(t.survival_rate)+")"}).attr("fill",n).style("opacity",0)}function r(t){var e=function(t){if(d3.select(this).transition().duration(400).style("opacity",.9),!$(this).data("qtip")){var e=window.QuerySession?window.QuerySession.getCancerStudyIds()[0]:window.cancerStudyId||window.cancer_study_id||window.cancer_study_id_selected,n="<font size='2'>";n+=k.qTips.id+": <strong><a href='"+E(e,t.case_id)+"' target='_blank'>"+t.case_id+"</a></strong><br>",n+=k.qTips.estimation+": <strong>"+(100*t.survival_rate).toFixed(2)+"%</strong><br>","0"===t.status?n+=k.qTips.censoredEvent+": <strong>"+t.time.toFixed(2)+" </strong>months (censored)<br>":n+=k.qTips.failureEvent+": <strong>"+t.time.toFixed(2)+" </strong>months<br>",n+="</font>",$(this).qtip({content:{text:n},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow qtip-wide"},show:{event:"mouseover",ready:!0},hide:{fixed:!0,delay:100,event:"mouseout"},position:{my:"left bottom",at:"top right"}})}},n=function(){d3.select(this).transition().duration(400).style("opacity",0)};b.dots[t].selectAll("path").on("mouseover",e),b.dots[t].selectAll("path").on("mouseout",n)}function l(t,e){b.svg.append("g").style("stroke-width",C.axis_stroke_width).style("fill","none").style("stroke",C.axis_color).attr("class","survival-curve-x-axis-class").style("shape-rendering","crispEdges").attr("transform","translate(0, "+(w.chart_height-40)+")").call(t),b.svg.append("g").style("stroke-width",C.axis_stroke_width).style("fill","none").style("stroke",C.axis_color).style("shape-rendering","crispEdges").attr("transform","translate(0, "+w.chart_left+")").call(t.ticks(0)),b.svg.append("g").style("stroke-width",C.axis_stroke_width).style("fill","none").style("stroke",C.axis_color).attr("class","survival-curve-y-axis-class").style("shape-rendering","crispEdges").attr("transform","translate("+w.chart_left+", 0)").call(e),b.svg.append("g").style("stroke-width",C.axis_stroke_width).style("fill","none").style("stroke",C.axis_color).style("shape-rendering","crispEdges").attr("transform","translate("+(w.chart_width-1)+", 0)").call(e.ticks(0)),b.svg.selectAll("text").style("font-family","sans-serif").style("font-size","11px").style("stroke-width",.5).style("stroke","black").style("fill","black")}function s(t,e,n){b.censoredDots.append("g").attr("id",n+"-crossdots").selectAll("path").data(t).enter().append("path").filter(function(t){return"0"==t.status}).attr("transform",function(t){return"translate("+b.xScale(t.time)+","+b.yScale(t.survival_rate)+")"}).attr("d",d3.symbol().type(d3.symbolCross).size(function(t){return 25})).attr("fill",e.line_color)}function c(t){var e=[];$.each(t,function(t,n){var i={};i.text=n.settings.legend,i.color=n.settings.line_color,e.push(i)});var n=b.svg.selectAll(".legend").data(e).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate("+w.chart_left+", "+(20+15*e)+")"});n.append("path").attr("width",18).attr("height",18).attr("d",d3.symbol().size(60).type(function(t){return d3.symbolSquare})).attr("fill",function(t){return t.color}).attr("stroke","black").attr("stroke-width",.9),n.append("text").attr("x",10).attr("y",5).style("text-anchor","front").style("font-size","11px").text(function(t){return t.text})}function u(t,e){b.svg.append("text").attr("class","label").attr("x",C.axisX_title_pos_x).attr("y",C.axisX_title_pos_y).style("text-anchor","middle").style("font-size","11px").style("font-weight","bold").text(t),b.svg.append("text").attr("class","label").attr("transform","rotate(-90)").attr("x",C.axisY_title_pos_x).attr("y",C.axisY_title_pos_y).style("text-anchor","middle").style("font-size","11px").style("font-weight","bold").text(e)}function d(t){b.svg.append("text").attr("class","pval").attr("x",w.pval_x).attr("y",w.pval_y).attr("font-size",C.pval_font_size).attr("font-style",C.pval_font_style).style("text-anchor","front").text(k.pValTitle+cbio.util.toPrecision(Number(t),3,.001))}function p(t){b.svg.select(".pval").text(k.pValTitle+cbio.util.toPrecision(Number(t),3,1e-4))}function f(t){$("#"+A.infoTableDivId).empty(),$.each(t,function(t,e){var n="High score group"===e.groupName||"Altered group"===e.groupName?"#FF6252":"#00AC52",i=$("#exclusivity_survival div").width();$("#"+A.infoTableDivId).append('<tr><td style="width: '+i+'px; text-align:right;"></td><td style="width: '+i+'px; text-align:center;"><b style="color : '+n+';">'+e.groupName+'</b></td></tr><tr><td style="width: '+i+'px; text-align:right;">'+k.infoTableTitles.total_cases+'</td><td style="width: '+i+'px; text-align:center;"><b>'+e.num_cases+'</b></td></tr><tr><td style="width: '+i+'px; text-align:right;">'+k.infoTableTitles.num_of_events_cases+'</td><td style="width: '+i+'px; text-align:center;"><b>'+e.num_of_events_cases+'</b></td></tr><tr><td style="width: '+i+'px; text-align:right;">'+k.infoTableTitles.median+'</td><td style="width: '+i+'px; text-align:center;"><b>'+e.median+"</b></td></tr>")})}function g(t){$("#"+A.headerDivId).append("<button id='"+A.curveDivId+"_svg_download' style='font-size:12px;'>SVG</button>"),$("#"+A.headerDivId).append("<button id='"+A.curveDivId+"_pdf_download' style='font-size:12px;'>PDF</button>"),$("#"+A.headerDivId).append("<button id='"+A.curveDivId+"_data_download' style='font-size:12px;'>Data</button>"),$("#"+A.curveDivId+"_svg_download").click(function(){var t=new XMLSerializer,e=cbio.download.addSvgHeader(t.serializeToString($("#"+A.curveDivId+" svg")[0]));cbio.download.clientSideDownload([e],"survival_study.svg","application/svg+xml")}),$("#"+A.curveDivId+"_pdf_download").click(function(){var t={filename:"survival_study.pdf",contentType:"application/pdf",servletName:"svgtopdf.do"};cbio.download.initDownload($("#"+A.curveDivId+" svg")[0],t)}),$("#"+A.curveDivId+"_data_download").click(function(){var e="",n="",i=this.id;-1!==i.indexOf("os")?(e+="Overall Survival Kaplan-Meier Estimate\n",n="os_survival_data.txt"):-1!==i.indexOf("dfs")&&(e+="Disease Free Survival Kaplan-Meier Estimate\n",n="dfs_survival_data.txt"),_.each(t,function(t){var n="\n"+t.settings.legend+"\n";n+="Case ID\tNumber at Risk\tStatus\tSurvival Rate\tTime (months)\n",_.each(t.data.getData(),function(t){var e="";-1!==i.indexOf("os")?"0"==t.status?e="censored":"1"===t.status&&(e="deceased"):-1!==i.indexOf("dfs")&&("0"==t.status?e="censored":"1"==t.status&&(e="relapsed")),n+=t.case_id+"\t"+t.num_at_risk+"\t"+e+"\t"+t.survival_rate+"\t"+t.time+"\n"}),e+=n}),cbio.download.clientSideDownload([e],n)})}function h(t,e){var i=e.data,l=e.settings,u={};u.id=l.curveId,u.color=l.line_color,D[u.id]=u,b.dots[u.id]=b.svg.append("g").attr("id",u.id+"-dots"),n(),o(i.getData(),l,u.id),i.getData().shift(),s(i.getData(),l,u.id),a(u.id,i.getData(),l.mouseover_color),r(u.id),w.include_legend&&c(t)}function m(t){d3.selectAll("#"+t+"-dots").remove(),d3.selectAll("#"+t+"-line").remove(),d3.selectAll("#"+t+"-crossdots").remove(),delete D[t]}function v(t){if(t)for(var e in t)w[e]=t[e]}function x(t){w.include_pvalue&&!isNaN(t)?b.svg.select(".pval").empty()?d(t):p(t):b.svg.select(".pval").empty()||b.svg.select(".pval").remove()}function y(t){t.settings.curveId in D?console.log("%c Error: Curve ID exists","color:red"):h([t],t)}var b="",w="",k="",C="",A="",S="",D={},E={};return{init:function(n,i){b=i.elem,w=i.settings,k=i.text,C=i.style,A=i.divs,S=i.vals,E=i.qtipFunc;var o=!1;if($.each(n,function(t,e){if(0===e.data.getData().length)return o=!0,!1}),o)$("#"+A.infoTableDivId).empty(),$("#"+A.infoTableDivId).append("<span style='margin: 20px; color: grey;'>Survival data not available</span>");else{if(t(),e(n),l(b.xAxis,b.yAxis),u(k.xTitle,k.yTitle),$.each(n,function(t,e){h(n,e)}),g(n),i.settings.include_info_table){var a=[];$.each(n,function(t,e){var n=jQuery.extend(!0,{},e.data.getStats());n.groupName=e.settings.legend,a.push(n)}),f(a)}i.settings.include_pvalue&&d(S.pVal)}},updateView:function(t,e){e&&v(e.settings),t&&x(t.pval)},addCurve:y,removeCurve:m}},SurvivalCurveProxy=function(){function t(t){var e={};t.forEach(function(t){var n=Object.keys(t)[0];e[n]=t[n]}),t=e;var n=0;for(var i in t)if(t.hasOwnProperty(i)&&""!==t[i]&&-1!==u.indexOf(i)){var r=jQuery.extend(!0,{},o);r.case_id=t[i].case_id,r.time=t[i].months,r.status=t[i].status,"NA"!==r.time&&"NA"!==r.status&&void 0!==r.status&&void 0!==r.status&&(a.push(r),n+=1)}cbio.util.sortByAttribute(a,"time");for(var l in a)a[l].num_at_risk=n,n+=-1}function e(){s.calc(a);var t=jQuery.extend(!0,{},r);0!==a.length?t.num_cases=a.length:t.num_cases="NA",t.num_of_events_cases=n(a),t.median=i(a),l=t}function n(t){if(0!==t.length){var e=0;for(var n in t)"1"==t[n].status&&(e+=1);return e}return"NA"}function i(t){var e=0;if(0!==t.length){var n=0;for(var i in t)if(t[i].survival_rate<=.5){n=i,e=parseFloat(t[n].time);break}return 0==e?"NA":e}return"NA"}var o={case_id:"",time:"",status:"",num_at_risk:-1,survival_rate:0},a=[],r={pVal:0,num_cases:0,num_of_events_cases:0,median:0},l={},s="",c="",u=[];return{init:function(n,i,o,r){u=i,s=o,c=r,t(n),0===a.length||0!==a.length&&e()},getData:function(){return a},getStats:function(){return l}}},SurvivalCurveView=function(t){var e=t,n="",i="",o="",a=[],r=[],l=[],s=function(t){e.vals.pVal=t,(n=new SurvivalCurve).init(l,e)};return{getResultInit:function(t,e){i=new KmEstimator,o=new LogRankTest;for(var n in t)"altered"===t[n]?a.push(n):"unaltered"===t[n]&&r.push(n);var c=new SurvivalCurveProxy,u=new SurvivalCurveProxy;c.init(e,a,i,o),u.init(e,r,i,o);var d=jQuery.extend(!0,{},SurvivalCurveBroilerPlate.subGroupSettings);d.line_color="#00AC52",d.mouseover_color="#00AC52",d.legend=SurvivalCurveBroilerPlate.subGroupSettings.legend.low;var p=jQuery.extend(!0,{},SurvivalCurveBroilerPlate.subGroupSettings);p.line_color="#FF6252",p.mouseover_color="#FF6252",p.legend=SurvivalCurveBroilerPlate.subGroupSettings.legend.high;var f={},g={};f.data=c,f.settings=p,g.data=u,g.settings=d,l=[f,g],o.calc(l[0].data.getData(),l[1].data.getData(),s)},pValCallBackFunc:s}},SurvivalTab=function(){return{init:function(t,e){var n=jQuery.extend(!0,{},SurvivalCurveBroilerPlate),i=jQuery.extend(!0,{},SurvivalCurveBroilerPlate);n.text.xTitle="Months Survival",n.text.yTitle="Surviving",n.text.qTips.estimation="Survival estimate",n.text.qTips.censoredEvent="Time of last observation",n.text.qTips.failureEvent="Time of death",n.text.qTips.id="Patient ID",n.settings.include_info_table=!0,n.divs.curveDivId="os_survival_curve",n.divs.headerDivId="os_header",n.divs.infoTableDivId="os_stat_table",n.text.infoTableTitles.total_cases="#total cases",n.text.infoTableTitles.num_of_events_cases="#cases deceased",n.text.infoTableTitles.median="median months survival",n.qtipFunc=cbio.util.getLinkToPatientView,i.text.xTitle="Months Disease Free",i.text.yTitle="Disease Free",i.text.qTips.estimation="Disease free estimate",i.text.qTips.censoredEvent="Time of last observation",i.text.qTips.failureEvent="Time of relapse",i.text.qTips.id="Patient ID",i.settings.include_info_table=!0,i.divs.curveDivId="dfs_survival_curve",i.divs.headerDivId="dfs_header",i.divs.infoTableDivId="dfs_stat_table",i.text.infoTableTitles.total_cases="#total cases",i.text.infoTableTitles.num_of_events_cases="#cases relapsed",i.text.infoTableTitles.median="median months disease free",i.qtipFunc=cbio.util.getLinkToPatientView,new SurvivalCurveView(n).getResultInit(t,e.os),new SurvivalCurveView(i).getResultInit(t,e.dfs)}}}(),loading=function(){"use strict";function t(t){var e=[];return bio.iteration.loop(t,function(t){var n=document.createElement("div");n.className="loading-circle-"+t,e.push(n)}),e}function e(e,n,i){var o=document.createElement("div"),a=document.createElement("div"),r=t([1,2,3,4]),l=document.createElement("span");o.className="loading",o.style.width=n+"px",o.style.height=i+"px",l.className="loading-text",l.innerHTML="Loading";for(var s=0,c=r.length;s<c;s++)a.appendChild(r[s]);return o.appendChild(a),o.appendChild(l),e.appendChild(o),o}function n(t,n,i){if(!n||!i)throw new Error("Please define the width and height");o.loadingElement=document.querySelector(".loading")?document.querySelector(".loading"):e(t,n,i),"none"===o.loadingElement.style.display&&(o.loadingElement.style.display="block")}function i(t,e){$(o.loadingElement).fadeOut("slow")}var o={};return function(t,e,o){return{start:n,end:i}}},modal=function(){"use strict";function t(){var t=document.createElement("button");return t.id="modal_close",t.className="btn btn-default",t.innerHTML="Close",t.setAttribute("type","button"),t.setAttribute("data-dismiss","modal"),t}function e(e){n.modal=document.createElement("div"),n.modal.setAttribute("tabindex","-1"),n.modal.setAttribute("role","dialog"),n.modal.setAttribute("aria-labelledby",e),n.dialog=document.createElement("div"),n.dialog.setAttribute("role","document"),n.content=document.createElement("div"),n.header=document.createElement("div"),n.footer=document.createElement("div"),n.title=document.createElement("div"),n.body=document.createElement("div"),n.modal.id=e,n.body.className="modal-body",n.modal.className="modal fade",n.title.className="modal-title",n.dialog.className="modal-dialog",n.footer.className="modal-footer",n.header.className="modal-header",n.content.className="modal-content",n.modal.style.display="none",n.header.appendChild(n.title),n.content.appendChild(n.header),n.content.appendChild(n.body),n.footer.appendChild(t()),n.content.appendChild(n.footer),n.dialog.appendChild(n.content),n.modal.appendChild(n.dialog)}var n={};return function(t){e(t.id||"modal"),n.element=t.element,n.element.appendChild(n.modal)}},selectBox=function(){"use strict";function t(t){var e=document.createElement("div"),n=a.width-2*a.margin.left,i=a.height-2*a.margin.top<40?a.height-2*a.margin.top:40;return e.className=t+" drop-menu",e.style.width=n+"px",e.style.height=i+"px",e.style.marginLeft=a.margin.left+"px",e.style.marginTop=a.margin.top+"px",e.style.fontSize=a.fontSize,e}function e(t,e){var n=document.createElement("div"),i=document.createElement("span"),o=document.createElement("i");return n.className=t+" select",n.style.paddingTop=10-a.margin.top+1+"px",n.style.paddingBottom=10-a.margin.top+1+"px",n.style.paddingLeft=10-a.margin.left+1+"px",n.style.paddingRight=10-a.margin.left+1+"px",i.title=e,i.innerHTML=e,o.className="fa fa-chevron-down",n.appendChild(i),n.appendChild(o),n}function n(t){var e=document.createElement("input");return e.type="hidden",e.name=t,e}function i(t){var e=document.createElement("ul");return e.className="dropeddown",bio.iteration.loop(t,function(t){var n=document.createElement("li");n.id=t,n.title=t,n.innerHTML=bio.drawing().textOverflow(t,a.fontSize,.4*a.width),e.appendChild(n)}),e}function o(t,e){t="."+t,$(t).click(function(t){$(this).attr("tabindex",1).focus(),$(this).toggleClass("active"),$(this).find(".dropeddown").slideToggle(300)}),$(t).focusout(function(){$(this).removeClass("active"),$(this).find(".dropeddown").slideUp(300)}),$(t+" .dropeddown li").click(function(t){return $(this).parents(".drop-menu").find("span").text($(this).text()),$(this).parents(".drop-menu").find("span").attr("title",$(this).attr("id")),$(this).parents(".drop-menu").find("input").attr("value",$(this).attr("id")),!!e&&e($(this).attr("id").toLowerCase())})}var a={};return function(r){(a={}).element=document.querySelector(r.id),a.className=r.className||"",a.margin=bio.sizing.setMargin(r.margin||[0,0,0,0]),a.width=r.width||parseFloat(a.element.style.width),a.height=r.height||parseFloat(a.element.style.height),a.defaultText=r.defaultText||"Select",a.viewName=r.viewName||"viewName",a.fontSize=r.fontSize||"10px",a.items=r.items||[""],a.clickItem=r.clickItem||null,a.frame=t(a.className),a.defaultText=e(a.className,a.defaultText),a.viewer=n(a.viewName),a.addItems=i(a.items),a.element.children.length<1&&(a.frame.appendChild(a.defaultText),a.frame.appendChild(a.viewer),a.frame.appendChild(a.addItems),a.element.appendChild(a.frame),o(a.className,a.clickItem),document.querySelector(".drop-menu .select").style.lineHeight=a.fontSize)}},table=function(){"use strict";function t(t,e){var n=document.createElement("div");return n.className="table-frame",n.style.width=t+"px",n.style.height=e+"px",n}function e(t){var e=document.createElement("div");return e.innerHTML=t||"",e.className="table-caption",e.style.display="table-caption",e}function n(t){var e=document.createElement("div");return e.id=t||"",e.className="table-row",e.style.display="table-row",e}function i(t,e,n){var i=document.createElement("div");return i.className="table-cell "+t.removeWhiteSpace(),i.style.padding="5px",i.style.width=e+"px",i.style.height=(n||35)+"px",i.style.lineHeight=(n||25)+"px",i.style.display="table-cell",i.innerHTML=t,i}function o(t){var e=document.createElement("div"),n=t.indexOf("<")>-1?t.substring(0,t.indexOf("<")):t,i=0;return e.id="temp_width",e.style.fontSize="16px",e.style.fontWeight="bold",e.style.overflow="hidden",e.style.border="1px solid",e.style.whiteSpace="nowrap",e.style.display="table-cell",e.style.textOverflow="ellipse",e.innerHTML=n,document.body.appendChild(e),i=e.getBoundingClientRect().width,document.body.removeChild(document.querySelector("#temp_width")),i+12}function a(t,e,n){s.cellWidth.fill(t.length,0),bio.iteration.loop(t,function(t,e){s.cellWidth[e]=o(t)}),bio.iteration.loop(e,function(e,i){var a=[];bio.iteration.loop(t,function(t,r){var l=n(r,i,t,e);s.cellWidth[r]=s.cellWidth[r]>o(l)?s.cellWidth[r]:o(l),a.push(l)}),s.cellData.push(a)});var i=0;bio.iteration.loop(s.cellWidth,function(t){i+=t}),s.frame.style.width=i+20+"px"}function r(t,e){var o=document.createElement("div"),a=n();return o.className="table-header",bio.iteration.loop(e,function(t,e){a.appendChild(i(t,s.cellWidth[e]))}),o.appendChild(a),t.appendChild(o),a}function l(t,e,o){var a=document.createElement("div");a.className="table-contents",a.style.height=o.height+"px",bio.iteration.loop(e,function(t){var e=n();bio.iteration.loop(t,function(t,n){e.appendChild(i(t,s.cellWidth[n]))}),a.appendChild(e)}),t.appendChild(a)}var s={cellData:[],cellWidth:[]};return function(n){if(document.querySelector(".table-frame")&&n.element.removeChild(document.querySelector(".table-frame")),!n.columns)throw new Error("Not found Columns");s.element=n.element,s.width=n.width||0,s.height=n.height||0,s.frame=t(s.width,s.height),a(n.heads,n.data,n.columns),s.frame.appendChild(e(n.title)),r(s.frame,n.heads),l(s.frame,s.cellData,n),s.element.appendChild(s.frame)}},title=function(){"use strict";return function(t,e){var n=bio.dom().get(t),i=parseFloat(n.style.width),o=parseFloat(n.style.height);n.innerHTML=e,n.style.fontSize=bio.drawing().fitText(e,i,o,"bold"),n.style.lineHeight=n.style.height}},tooltip=function(){"use strict";function t(t,e,n){return t.left-n.width/2<e.left?"right":t.top-n.height<e.top?"bottom":t.right+n.width>e.right?"left":(t.bottom,n.height,e.bottom,"top")}function e(e,n,i){if(!e)throw new Error("Do not find a Tooltip element");var o=e.getBoundingClientRect(),a=n.getBoundingClientRect(),r=t(a,i.getBoundingClientRect(),o);e.className=r,e.style.visibility="visible",e.style.top=function(t,e,n){if("left"!==t&&"top"!==t&&"bottom"!==t&&"right"!==t)throw new Error("Wrong direction");return{top:e.top-n-10+window.scrollY+"px",left:e.top-n/2+window.scrollY+"px",bottom:e.bottom+10+window.scrollY+"px",right:e.top-n/2+window.scrollY+"px"}[t]}(r,a,o.height),e.style.left=function(t,e,n){if("left"!==t&&"top"!==t&&"bottom"!==t&&"right"!==t)throw new Error("Wrong direction");return{top:e.left-n/2+window.scrollX+"px",left:e.left-n-10+"px",bottom:e.left-n/2+window.scrollX+"px",right:e.right+10+"px"}[t]}(r,a,o.width)}function n(t){if(!t)throw new Error("Do not find a Tooltip element");t.innerHTML="",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden"}return function(t){if("String"===bio.objects.getType(t)){if(!document.getElementById("biochart_tooltip"))throw new Error('Not found "#biochart_tooltip"');return n(document.getElementById("biochart_tooltip"))}var i=t.element||null,o=t.contents||"",a=bio.drawing().getParentSVG(i),r=document.getElementById("biochart_tooltip");return r.innerHTML=o,e(r,i,a)}},dependencies=function(){"use strict";var t={version:{}};return t.version.d3v4=function(){if(!d3)throw new Error("D3JS is not found");return 0!==d3.version.indexOf("3")},t},dom=function(){"use strict";var t={};return t.get=function(t){if("object"==typeof t)return t;var e=["#","."],n=t.removeSymbol(),i=null;return bio.iteration.loop(e,function(t){var e=t+n,o=document.querySelector(e);o&&(i=o)}),i},t.remove=function(t,e){if(bio.objects.getType(t).indexOf("HTML")<0)throw new Error("Not a dom element");bio.iteration.loop(e,function(e){t.removeChild(e)})},t.removeAll=function(t){if(bio.objects.getType(t).indexOf("HTML")<0)throw new Error("Not a dom element");for(;t.firstChild;)t.removeChild(t.firstChild)},function(){return t}},iteration=function(){"use strict";var t={};return t.loop=function(t,e){if("object"!=typeof t)throw new Error("This is not Object or Array");if("Array"===bio.objects.getType(t))for(var n=0,i=t.length;n<i;n++)e.call(this,t[n],n);else for(var o in t)e.call(this,o,t[o])},Array.prototype.fill=function(t,e){for(var n=0;n<t;n++)this.push(e);return this},t},math=function(){"use strict";var t={};return t.medianIndex=function(t){var e=t.length;return e%2==1?(e+1)/2:e/2},t.median=function(e){var n=bio.objects.clone(e);return n.sort(function(t,e){return t>e?1:-1})[t.medianIndex(n)]},t.min=function(t,e){return arguments.length<2?Math.min.apply(null,t):Math.min.call(null,t,e)},t.max=function(t,e){return arguments.length<2?Math.max.apply(null,t):Math.max.call(null,t,e)},t.random=function(t,e){return t=t||0,e=e||1,Math.floor(Math.random()*e)+t},t},objects=function(){"use strict";var t={};return t.getType=function(t){var e=Object.prototype.toString.call(t);return e.substring(e.indexOf(" ")+1,e.indexOf("]"))},t.clone=function(e){if("object"!=typeof e)return e;if("Array"===t.getType(e))return(new Array).concat(e);var n={};return bio.iteration.loop(e,function(i,o){e.hasOwnProperty(i)&&(n[i]=t.clone(e[i]))}),n},t.getKey=function(t,e){return Object.keys(t)[Object.values(t).indexOf(e)]},t},strings=function(){"use strict";String.prototype.matchAll=function(t){for(var e,n=[];e=t.exec(this);)n.push(e[0]);return n},String.prototype.pronoun=function(){return this[0].toUpperCase()+this.substring(1).toLowerCase()},String.prototype.removeWhiteSpace=function(){return this.replace(/\s/gi,"")},String.prototype.removeSymbol=function(){return this.replace(/\W/gi,"")},String.prototype.replaceAt=function(t,e){return this.substring(0,t)+e+this.substring(t+1)},String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"ig"),e)}},variants=function(){"use strict";function t(t,e){var n=[].concat(l.data.axis.needle.y);bio.layout().get(l.setting.svgs,["needle"],function(i,o){var a=bio.variantsConfig().axis(t,e,o),r=(bio.variantsConfig().axis("common"),l.data.axis.needle[e.toLowerCase()]);bio.axises()[a.direction]({element:o,top:a.top,left:a.left,range:a.range,margin:a.margin,exclude:a.exclude,domain:"Y"===e?n.reverse():r})})}function e(t,e){var n={needle:"s_legend",patient:"t_legend"}[t];e=e.sort(function(t,e){return bio.boilerPlate.variantInfo[t].order>bio.boilerPlate.variantInfo[e].order?1:-1}),bio.layout().get(l.setting.svgs,[n],function(n,i){var o=bio.variantsConfig().legend(t);bio.legend({data:e,element:i,on:o.on,attr:o.attr,text:o.text,style:o.style,margin:o.margin})})}function n(t,e,n,i){bio.layout().get(l.setting.svgs,["needle"],function(o,a){var r=bio.variantsConfig().needle();bio.needle({element:a,yaxis:n.y,on:r.on,lineData:t,shapeData:e,attr:r.attr,style:r.style,margin:r.margin,xaxis:i||n.x})})}function i(t,e){bio.layout().get(l.setting.svgs,["navi"],function(i,r){var s=bio.variantsConfig().navi();bio.variantsNavi({data:t,element:r,xaxis:e.x,yaxis:e.y,on:s.on,attr:s.attr,style:s.style,margin:s.margin,call:{drag:s.call.drag,end:function(t,e,i){var r=i.opts.drag,s=bio.scales().invert(i.scaleX),c=[s(r.start.now+i.controls.width),s(r.end.now+i.controls.width)],u=[i.margin.left,i.width-i.margin.right];d3.selectAll(".bottom-axis-g-tag").call(bio.axises().byD3v(bio.scales().get(c,u),"bottom")),bio.layout().removeGroupTag([".variants_needle_svg.needle-line-g-tag",".variants_needle_svg.needle-shape-g-tag",".variants_needle_svg.needle-graph-g-tag",".variants_needle_svg.needle-patient-shape-g-tag"]),n(l.data.needle.line,l.data.needle.shape,l.data.axis.needle,c),o(l.data.graph,l.data.axis.needle,c),a(l.data.patient.shape,l.data.axis.needle,c)}}})})}function o(t,e,n){bio.layout().get(l.setting.svgs,["needle"],function(i,o){var a=bio.variantsConfig().graph();bio.variantsGraph({data:t,element:o,on:a.on,yaxis:e.y,text:a.text,attr:a.attr,style:a.style,margin:a.margin,xaxis:n||e.x})})}function a(t,e,n){bio.layout().get(l.setting.svgs,["needle"],function(i,o){var a=bio.variantsConfig().patient(),r=bio.variantsConfig().needle();bio.variantsPatient({data:t,element:o,yaxis:e.y,attr:a.attr,style:a.style,on:r.on,margin:a.margin,xaxis:n||e.x})})}function r(r){bio.layout().removeGroupTag(),t("needle","X"),t("needle","Y"),e("needle",r.type),e("patient",[r.patient.shape[0].info[0].id]),n(r.needle.line,r.needle.shape,r.axis.needle),i(r,r.axis.needle),o(r.graph,r.axis.needle),a(r.patient.shape,r.axis.needle)}var l={};return function(t){(l=bio.initialize("variants")).setting=bio.setting("variants",t),l.data=l.setting.preprocessData,bio.title("#variants_title",l.setting.defaultData.variants.title),r(l.data),console.log(">>> Variants reponse data: ",t),console.log(">>> Variants setting data: ",l.setting),console.log(">>> Variants model data: ",l)}},variantsGraph=function(){"use strict";var t={};return function(e,n){t=bio.objects.clone(n||{}),(t=bio.sizing.chart.default(t,e)).graphData=e.data,t.copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.margin.top,t.height-t.margin.bottom],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.group=bio.rendering().addGroup(e.element,0,0,"needle-graph"),t.opts={base:bio.objects.clone(e),graph:bio.objects.clone(e)},t.opts.base.data=[""],t.opts.base.id=t.id+"_graph_base",t.opts.base.element=t.group.selectAll("#"+t.id+"_graph_base"),bio.rectangle(t.opts.base,t),t.opts.graph.id=t.id+"_graph_group",t.opts.graph.data=null,t.opts.graph.element=t.group.selectAll("#"+t.id+"_graph_group").data(t.graphData).enter().append("g").attr("id",t.id+"_graph_group").attr("transform","translate(0, 0)"),bio.rectangle(t.opts.graph,t),bio.text(t.opts.graph,t)}},variantsNavi=function(){"use strict";var t={};return function(e,n){var i=bio.variantsConfig().navi();t=bio.initialize("variantsNavi"),t=bio.objects.clone(n||{}),(t=bio.sizing.chart.default(t,e)).naviData=e.data,t.copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.height-t.margin.bottom,t.margin.top],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.controls={width:5,height:.4*t.height},t.start=t.scaleX(bio.math.min(t.copyX)),t.end=t.width-t.margin.left-t.margin.right,i.start.init=t.start-t.controls.width,i.end.init=t.end-t.controls.width+t.margin.left,i.start.now=i.start.init,i.end.now=i.end.init,i.navi.init=t.start,i.navi.now=t.start,i.navi.width=t.end,i.navi.nowWidth=t.end-t.start,t.group=bio.rendering().addGroup(e.element,0,0,"heatmap");var o=bio.variantsConfig().needle();bio.variantsConfig().navi();bio.needle({xaxis:t.copyX,yaxis:t.copyY,element:e.element,attr:o.attr,style:o.style,margin:[10,40,10,40],lineData:t.naviData.needle.line,shapeData:t.naviData.needle.shape}),t.opts={end:bio.objects.clone(e),main:bio.objects.clone(e),start:bio.objects.clone(e),drag:i},t.opts.main.data=["main"],t.opts.main.id=t.id+"_navi_main",t.opts.main.element=t.group.selectAll("#"+t.id+"_navi_main"),t.opts.start.data=["start"],t.opts.start.id=t.id+"_navi_start",t.opts.start.element=t.group.selectAll("#"+t.id+"_navi_start"),t.opts.end.data=["end"],t.opts.end.id=t.id+"_navi_end",t.opts.end.element=t.group.selectAll("#"+t.id+"_navi_end"),bio.rectangle(t.opts.main,t),bio.rectangle(t.opts.start,t),bio.rectangle(t.opts.end,t),d3.selectAll("#"+t.id+" path").remove()}},variantsPatient=function(){"use strict";var t={};return function(e,n){t=bio.objects.clone(n||{}),(t=bio.sizing.chart.default(t,e)).patientData=e.data,t.copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.height-t.margin.bottom,t.margin.top],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.shapeGroup=bio.rendering().addGroup(e.element,0,0,"needle-patient-shape"),t.opts=bio.objects.clone(e),t.opts.data=t.patientData,t.opts.element=t.shapeGroup.selectAll("#"+t.id+"_needle_patient_shape"),bio.triangle(t.opts,t)}};