function needleRadius(t){return 3*Math.sqrt(t)/1.25}var axis=function(t){"use strict";function e(t,e){return d3.axisTop?i(t,e):n(t,e)}function n(t,e){return d3.svg.axis().scale(t).orient(e)}function i(t,e){return d3["axis"+util.camelCase(e)](t)}function a(e,n,i){return util.loop(n,function(n,a){e[n]&&e[n](t.option[n](i,a))}),e}function r(t,e){return e?t.selectAll(e).remove():t}var o={axies:{}};return t.element=function(e){return e="Object"===util.varType(e)?e:/\W/.test(e[0])?d3.select(e):d3.select("#"+e),o.current=e,t},t.option={tickValues:function(t,e){if("Array"===util.varType(e))return e;for(var n=util.minmax(t).max/(e-1),i=[],a=0;a<e-1;a++)i.push(a*n);return i.push(util.minmax(t).max),i}},t.top=function(t){var n=size.setMargin(t.margin),i=draw.size(o.current),s=t.position||[n.top,n.left],l=scale.get(t.data,[n.left,i.w-n.right]),u=render.addGroup(o.current,s[0],s[1]),c=t.opt?t.opt:{};return u.call(a(e(l,"top"),t.opt,t.data)),r(u,c.remove),u},t.left=function(t){var n=size.setMargin(t.margin),i=draw.size(o.current),s=t.position||[n.top,i.w-n.right],l=scale.get(t.data,[n.top,i.h-n.bottom]),u=render.addGroup(o.current,s[0],s[1]),c=t.opt?t.opt:{};return u.call(a(e(l,"left"),t.opt,t.data)),r(u,c.remove),u},t.bottom=function(t){var n=size.setMargin(t.margin),i=draw.size(o.current),s=t.position||[i.h-n.bottom,n.left],l=scale.get(t.data,[n.left,i.w-n.right]),u=render.addGroup(o.current,s[0],s[1]),c=t.opt?t.opt:{};return u.call(a(e(l,"bottom"),t.opt,t.data)),r(u,c.remove),u},t.right=function(t){var n=size.setMargin(t.margin),i=draw.size(o.current),s=t.position||[n.top,n.left],l=scale.get(t.data,[n.top,i.h-n.bottom]),u=render.addGroup(o.current,s[0],s[1]),c=t.opt?t.opt:{};return u.call(a(e(l,"right"),t.opt,t.data)),r(u,c.remove),u},t}(axis||{}),bar=function(t){"use strict";function e(t){var e=[i.m.left,i.w-i.m.right],n=[i.m.top,i.h-i.m.bottom];return{x:"top"===t||"bottom"===t||"right"===t?e:e.reverse(),y:"left"===t||"right"===t||"bottom"===t?n:n.reverse()}}function n(t,n,i){return scale.get(n,e(t)[i])}var i={};return function(t){(i={}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),i.w=t.width||i.e.attr("width")||0,i.h=t.height||i.e.attr("height")||0,i.m=size.setMargin(t.margin),i.dr=t.direction||"top",i.g=render.addGroup(i.e,i.m.top,i.m.left),i.dx=(new Array).concat(t.xaxis),i.dy=(new Array).concat(t.yaxis),i.sx=n(i.dr,i.dx,"x"),i.sy=n(i.dr,i.dy,"y");var e=i.e.attr("id");return render.rect({element:i.g.selectAll("#"+e+"_rect"),data:t.data,attr:{id:function(t){return e+"_rect"},x:function(e,n){return t.attr.x?t.attr.x.call(i,e,n):t.attr.x(e)},y:function(e,n){return t.attr.y?t.attr.y.call(i,e,n):t.attr.y(e)},width:function(e,n){return t.attr.width?t.attr.width.call(i,e,n):10},height:function(e,n){return t.attr.height?t.attr.height.call(i,e,n):10}},style:{fill:function(e,n){return t.style.fill?t.style.fill.call(i,e,n):"#000000"},stroke:function(e,n){return t.style.stroke?t.style.stroke.call(i,e,n):"#FFFFFF"}},on:{mouseover:function(e,n){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(i,e,n))}}}),i}}(),colorGradient=function(t){"use strict";function e(t,e){i.offsets.show.push({offset:t,color:e}),i.offsets.data.push({offset:t,color:e})}function n(t,n){var a=util.minmax(t),r=(new Array).concat(t).splice(1,t.length-2);e("0%",n[0]),util.loop(r,function(t,e){var r=Math.round((a.max-a.min)/t*10);i.offsets.show.push({offset:r-i.adj+"%",color:n[e+1]}),i.offsets.data.push({offset:r+"%",color:n[e+1]})}),e("100%",n[t.length-1])}var i={};return function(t){return i={offsets:{show:[],data:[]}},i.e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),i.adj=t.adjustValue||0,i.id=t.id||"linear_gradient",i.colors=t.colors||["#000000","#FFFFFF"],i.offset=t.offset||[0,100],i.defs=i.e.append("defs"),i.lineGradient=i.defs.append("linearGradient").attr("id",i.id),n(i.offset,i.colors),i.lineGradient.selectAll("stop").data(i.offsets.show).enter().append("stop").attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color}),i}}(),config={exclusivity:{},expression:{},landscape:{},variants:{}};config.landscape.name=function(t){return t=t.replace(/(_ins|_del)$/gi,"_indel"),t=t.substring(0,1).toUpperCase()+t.substring(1).toLowerCase()},config.landscape.case=function(t){switch(config.landscape.priority(config.landscape.name(t))){case 0:case 1:return"cnv";default:return"var"}},config.landscape.priority=function(t){return{Amplification:0,Homozygous_deletion:1,Nonsense_mutation:2,Splice_site:3,Translation_start_site:4,Missense_mutation:5,Start_codon_snp:5,Nonstop_mutation:6,Frame_shift_indel:7,Stop_codon_indel:7,In_frame_indel:8,Silent:9,Rna:10,Intron:11,"5'utr":11,"3'utr":11,Igr:11}[t]},config.landscape.color=function(t){return{Amplification:"#FFBDE0",Homozygous_deletion:"#BDE0FF",Nonsense_mutation:"#EA3B29",Splice_site:"#800080",Translation_start_site:"#AAA8AA",Missense_mutation:"#3E87C2",Start_codon_snp:"#3E87C2",Nonstop_mutation:"#070078",Frame_shift_indel:"#F68D3B",Stop_codon_indel:"F68D3B",In_frame_indel:"#F2EE7E",Silent:"#5CB755",Rna:"#FFDF97",Intron:"#A9A9A9","5'utr":"#A9A9A9","3'utr":"#A9A9A9",Igr:"#A9A9A9",dead:"#C50E36",alive:"#04CDA4",male:"#0F67B6",female:"E0A4E5",white:"#9CB1CE","black or african american":"#302F24",asian:"#CB771F","american indian or alaska native":"#38120B","hispanic or latino":"#B8642F","not hispanic or latino":"#55C53E","lung acinar adenocarcinoma":"#716190","lung adenocarcinoma mixed subtype":"#5154DE","lung adenocarcinoma- not otherwise specified (nos)":"#8E9A7E","lung bronchioloalveolar carcinoma mucinous":"#2F91DE","lung bronchioloalveolar carcinoma nonmucinous":"#ED6EBD","lung clear cell adenocarcinoma":"#1C8D7A","lung micropapillary adenocarcinoma":"#B2EE86","lung mucinous adenocarcinoma":"#785E54","lung papillary adenocarcinoma":"#69B4C4","lung signet ring adenocarcinoma":"#C1386E","lung solid pattern predominant adenocarcinoma":"#D7A355","mucinous (colloid) carcinoma":"#243833",bronchial:"#F9E3B9","l-lower":"#FBA2A3","l-upper":"#0CA3C7","other (please specify)":"#D3A16C","r-lower":"#388A4E","r-middle":"#D61E43","r-upper":"#B81BCC",no:"#D73A64",yes:"#1990AA","yes, history of prior malignancy":"#3BDB11","yes, history of synchronous/bilateral malignancy":"#803F11",no:"#D73A64",yes:"#1990AA",no:"#D73A64",yes:"#1990AA",t1:"#060CDB",t1a:"#696DE9",t1b:"#CDCEF7",t2:"#F6251D",t2a:"#F96D69",t2b:"#FDCECD",t3:"#1AEB42",t4:"#EBBD34",tx:"#9943DE",n0:"#DC5B35",n1:"#217C1F",n2:"#18A6F3",n3:"#EA68C3",nx:"#F4E831",m0:"#F0820D",m1:"#C45A43",m1a:"#A523C2",m1b:"#C97BDA",mx:"#EDD3F2","stage i":"#01C606","stage ia":"#018404","stage ib":"#002C01","stage ii":"#0E22C3","stage iia":"#08136C","stage iib":"#040B41","stage iiia":"#BB0C2E","stage iiib":"#75081D","stage iv":"#F0CA53",r0:"#DB8EC0",r1:"#FFD046",r2:"#495C50",rx:"#0E5F8A","exon 19 deletion":"#4A312A",l858r:"#74C04C",l861q:"#FBED09",other:"#C91DAB",t790m:"#2C517B",g12a:"#DED0D1",g12c:"#AE8A8E",g12d:"#5D161D",g12s:"#410F14",g12v:"#25080B",other:"#C91DAB","complete remission/response":"#BDED73","partial remission/response":"#8649F3","progressive disease":"#C1746B","stable disease":"#CD4C2A","complete remission/response":"#BDED73","partial remission/response":"#8649F3","progressive disease":"#C1746B","stable disease":"#CD4C2A","Lifelong Non-Smoker":"#C4B5BB","Current Smoker":"#896C78","Current Reformed Smoker for > 15 yrs":"#3B0A1E","Current Reformed Smoker for < or = 15 yrs":"#2F0818","Current Reformed Smoker, Duration Not Specified":"#17040C",NA:"#D6E2E3"}[t]},config.landscape.sample={attr:{x:function(t){return t.x.indexOf("-")>-1?this.sx(t.x):this.sx(t.x)+3},y:function(t){return this.sy(util.minmax(this.dy).max)-this.sy(t.y+t.value)+this.sy(util.minmax(this.dy).min)},width:function(t){return t.x.indexOf("-")>-1?scale.compatibleBand(this.sx):scale.compatibleBand(this.sx)-7.5},height:function(t){return this.sy(t.value)-this.sy(util.minmax(this.dy).min)}},style:{fill:function(t){return config.landscape.color(t.info)},stroke:function(t){return"#FFFFFF"}}},config.landscape.gene={attr:{x:function(t){return this.sx(util.minmax(this.dx).max-t.x)-this.sx(t.value)+this.m.left},y:function(t){return this.sy(t.y)},width:function(t){return this.sx(t.value)-this.m.left},height:function(t){return scale.compatibleBand(this.sy)}},style:{fill:function(t){return config.landscape.color(t.info)},stroke:function(t){return"#FFFFFF"}}},config.landscape.pq={attr:{x:function(t){return this.sx(util.minmax(this.dx).min)},y:function(t){return this.sy(t.y)},width:function(t){return this.sx(t.value)},height:function(t){return scale.compatibleBand(this.sy)}},style:{fill:function(t){return"#BFBFBF"},stroke:function(t){return"#FFFFFF"}}},config.landscape.heatmap={attr:{x:function(t){return this.sx(t.x)},y:function(t){return"cnv"!==config.landscape.case(t.value)?scale.compatibleBand(this.sy)/3+this.sy(t.y):this.sy(t.y)},width:function(t){return scale.compatibleBand(this.sx)},height:function(t){return"cnv"!==config.landscape.case(t.value)?scale.compatibleBand(this.sy)/3:scale.compatibleBand(this.sy)}},style:{fill:function(t){return config.landscape.color(t.value)},stroke:function(t){return"#FFFFFF"}}},config.landscape.group={attr:{x:function(t){return this.sx(t.x)},y:function(t){return this.sy(t.y)},width:function(t){return scale.compatibleBand(this.sx)},height:function(t){return scale.compatibleBand(this.sy)}},style:{fill:function(t){return config.landscape.color(t.value)},stroke:function(t){return"#FFFFFF"}}},config.landscape.legend={attr:{x:function(t,e){var n="h"===this.dr?(2*this.p+this.mw)*e:0;return this.isText?n+2*this.p:n},y:function(t,e){var n=this.height||15,i="h"===this.dr?0:(this.p+this.mh)*e;return this.isText?i+this.mh-this.mh/2+this.p/2:config.landscape.case(t)&&"var"===config.landscape.case(t)?i+n/3:i},width:function(t,e){return this.width||5},height:function(t,e){var n=this.height||15;return config.landscape.case(t)&&"var"===config.landscape.case(t)?n/3:n}},style:{fill:function(t){return config.landscape.color(t)},stroke:function(t){return"#FFFFFF"},fontFamily:function(t){return"Times Roman"},fontSize:function(t){return"12px"}},text:function(t){return t}},config.landscape.axis={sample:{direction:"left",margin:[5,0,10,5],opt:{tickValues:3}},group:{direction:"right",margin:[0,0,0,0],opt:{remove:"line, path"}},gene:[{direction:"right",margin:[5,150,40,0],opt:{remove:"line, path"}},{direction:"bottom",margin:[0,10,35,71],opt:{tickValues:3}}],pq:{direction:"bottom",margin:[0,10,35,20],opt:{tickValues:3}}},config.landscape.bar={pq:{direction:"right",margin:[5,10,41,30],xaxis:function(){return this.pq.x},yaxis:function(){return this.pq.y},attr:config.landscape.pq.attr,style:config.landscape.pq.style}},config.landscape.stack={patient:{direction:"top",margin:[5,0,10,0],xaxis:function(){return this.patient.x},yaxis:function(){return this.sample.y},attr:config.landscape.sample.attr,style:config.landscape.sample.style},sample:{direction:"top",margin:[5,1,10,1],xaxis:function(){return this.sample.x},yaxis:function(){return this.sample.y},attr:config.landscape.sample.attr,style:config.landscape.sample.style},gene:{direction:"left",margin:[5,10,41,70],xaxis:function(){return this.gene.x},yaxis:function(){return this.gene.y},attr:config.landscape.gene.attr,style:config.landscape.gene.style}},config.landscape.heatmap={heatmap:{direction:"left",margin:[5,1,41,1],opt:{},xaxis:function(){return this.sample.x},yaxis:function(){return this.gene.y},attr:config.landscape.heatmap.attr,style:config.landscape.heatmap.style},patient:{direction:"left",margin:[5,1,41,3.5],opt:{},xaxis:function(){return this.patient.x},yaxis:function(){return this.gene.y},attr:config.landscape.heatmap.attr,style:config.landscape.heatmap.style}},config.landscape.group={group:{direction:"left",margin:[2,1,4,1],opt:{},xaxis:function(){return this.sample.x},attr:config.landscape.group.attr,style:config.landscape.group.style},patient:{direction:"left",margin:[2,1,4,4],opt:{},xaxis:function(){return this.patient.x},attr:config.landscape.group.attr,style:config.landscape.group.style}},config.exclusivity.separate=function(t){return"B"===t?["A","M"]:"E"===t?["D","M"]:"M"===t?[".","M"]:[t]},config.exclusivity.case=function(t,e){return"var"===t?"Mutation":e.toUpperCase().indexOf("AMP")>-1?"Amplification":"Deletion"},config.exclusivity.symbol=function(t){return{Amplification:"A",Deletion:"D",Mutation:"M",None:"."}[t]},config.exclusivity.name=function(t){return{A:"Amplification",D:"Deletion",M:"Mutation",".":"None"}[t]},config.exclusivity.priority=function(t){return{Amplification:0,Deletion:1,Mutation:2,None:3}[t]},config.exclusivity.color=function(t){return{Amplification:"#FFBDE0",Deletion:"#BDE0FF",Mutation:"#5CB755",None:"#D3D3D3"}[t]},config.exclusivity.legend={margin:[20,80,0,0],attr:{x:function(t,e){var n="h"===this.dr?(10*this.p+this.mw)*e:0;return this.isText?n+2*this.p:n},y:function(t,e){var n=this.height||15,i="h"===this.dr?0:(this.p+this.mh)*e;return this.isText?i+this.mh-this.mh/2:"Mutation"===t?i+n/3:i},width:function(t,e){return this.width||5},height:function(t,e){var n=this.height||15;return"Mutation"===t?n/3:n}},style:{fill:function(t){if(!this.isText)return config.exclusivity.color(t)}},text:function(t){return t}},config.exclusivity.heatmap={margin:[35,40,35,50],attr:{x:function(t){return this.sx(t.x)},y:function(t){return"Mutation"===t.value?this.sy(t.y)+scale.compatibleBand(this.sy)/3:this.sy(t.y)},width:function(t){return scale.compatibleBand(this.sx)},height:function(t){return"Mutation"===t.value?scale.compatibleBand(this.sy)/3:scale.compatibleBand(this.sy)}},style:{fill:function(t){return config.exclusivity.color(t.value)},stroke:function(t){return!1}}},config.exclusivity.division={margin:[10,40,0,50],attr:{x:function(t,e){return e>0?this.isText?this.scale(this.axis[this.axis.length-1])-draw.getTextWidth(t.text,this.font)-this.padding:this.scale(t.point):this.isText?this.m.left+this.padding:this.m.left},y:function(t){return this.isText?this.m.top+(this.textHeight+this.padding):this.m.top},width:function(t,e){return e>0?this.w-this.scale(t.point)-this.m.right:this.scale(t.point)-this.m.left},height:function(t){return this.textHeight+4*this.padding},rx:function(t){return 3},ry:function(t){return 3}},style:{fill:function(t,e){return this.isText?"#FFFFFF":t.color},stroke:function(t,e){return this.isLine?"#000000":"#FFFFFF"},dashed:function(t,e){return"4,2"}},line:{x:function(){return this.scale(this.point)},y:function(){return this.m.left+1.2*this.m.top}},text:function(t,e){return t.text}},config.exclusivity.sample={survival:{attr:{x:function(t,e){return this.data.sample.isAltered.indexOf(t.text)>-1?draw.getTextWidth(t.text,"15px")+draw.getTextWidth(t.text,"15px")/4:-5},y:function(t,e){return this.data.sample.isAltered.indexOf(t.text)>-1?draw.getTextHeight("15px").height/1.3:0}},style:{fill:function(t,e){return this.data.sample.isAltered.indexOf(t.text)>-1?t.color:"#FFFFFF"},fontSize:function(t){return"25px"}},text:function(t,e){return this.data.sample.isAltered.indexOf(t.text)>-1?" **":""}},division:{margin:[15,80,0,50],attr:{x:function(t,e){return t.type.indexOf("Altered group")>-1?0:this.e.attr("width")-this.m.left-(this.m.left-this.m.right)},y:function(t,e){return 0}},style:{fill:function(t,e){return t.type.indexOf("Altered group")>-1?"#FF6252":"#00AC52"}},text:function(t,e){return t.value}},legend:{margin:[35,80,0,0],attr:{x:function(t,e){if(this.isText)return 0===e?0:1===e?draw.getTextWidth(this.d[0],"25px")+5:draw.getTextWidth(this.d[0].toUpperCase(),this.font)+draw.getTextWidth(this.d[1].toUpperCase(),this.font)-draw.getTextWidth("a",this.font)},y:function(t,e){return e>0?-draw.getTextHeight("25px").height/5:0}},style:{fill:function(t,e){if(this.isText)return 1===e?"#333":this.d[2].toUpperCase().indexOf("UN")>-1?"#00AC52":"#FF6252"},fontSize:function(t,e){return 0===e?"25px":this.font}},text:function(t,e){return t}}},config.variants.legend={margin:[20,20,0,0],attr:{x:function(t,e){var n="h"===this.dr?(10*this.p+this.mw)*e:this.isText?this.p:0;return this.isText?n+2*this.p:n},y:function(t,e){var n=this.height||5;return this.isText?this.mh*e+.7*n:this.mh*e},r:function(t){return 5}},style:{fontSize:function(t){return"12px"},fill:function(t){return config.landscape.color(t)}},text:function(t){return t}},config.variants.needle={margin:[20,30,100,60],attr:{x:function(t,e){return this.sx(t.x)},y:function(t,e){return this.sy(t.y)},r:function(t,e){return t.value?needleRadius(t.value):this.radius}},style:{fill:function(t){return!!t.info&&config.landscape.color(t.info[0].type)},stroke:function(t){return"#FFFFFF"}}},config.variants.needleGraph={margin:[0,30,80,60],attr:{x:function(t,e){return this.isText?this.sx(t.x)+5:this.sx(t.x)},y:function(t,e){return this.isText?this.sh/2:0},width:function(t,e){return this.sx(t.width)},height:function(t,e){return this.sh}},style:{fill:function(t){return t.color},stroke:function(t){return"#FFFFFF"}},text:function(t){return t.info.identifier}},config.variants.axis={left:{margin:[20,60,100,0]},top:{margin:[2,30,0,60]}},config.variants.navi={margin:[0,30,5,60],style:{fill:function(t){var e=!!t.info&&d3.rgb(config.landscape.color(t.info[0].type));return this.g.selectAll("path").style("stroke","rgba(0, 0, 0, 0.1)"),!!e&&(e.opacity=.3,e)}}},config.variants.patient={needle:{margin:[0,30,48,60],attr:{points:function(t,e){var n=this.s(t.position);return n+","+this.len/2.5+" "+(n-this.len)+","+2*this.len+" "+(n+this.len)+","+2*this.len+" "+n+","+this.len/2.5}},style:{fill:function(t,e){return config.landscape.color(t.type)},stroke:function(t,e){var n=d3.rgb(config.landscape.color(t.type));return n.opacity=.3,n}}},legend:{margin:[0,0,0,0],attr:{points:function(t,e){var n=document.querySelector("#variants_legend_chart").firstChild.getBoundingClientRect(),i=n.right-n.left+n.width;return i+","+(n.bottom-n.width)+" "+(i-n.width/2)+","+n.bottom+" "+(i+n.width/2)+","+n.bottom+" "+i+","+(n.bottom-n.width)},x:function(t,e){var n=document.querySelector("#variants_legend_chart").firstChild.getBoundingClientRect();return n.right-n.left+2*n.width+this.p},y:function(t,e){return document.querySelector("#variants_legend_chart").firstChild.getBoundingClientRect().bottom}},style:{fill:function(t,e){return config.landscape.color(t.type)},stroke:function(t,e){var n=d3.rgb(config.landscape.color(t.type));return n.opacity=.3,n},fontSize:function(t){return"12px"},strokeWidth:function(t){return"3px"}},text:function(t){return"Patients"}}},config.expression.legend={bar:{margin:[5,5,5,5],text:function(t){return draw.textOverflow(t,"10px",.7*this.w)},attr:{x:function(t,e){return this.isText?this.m.left+2*this.p:this.p},y:function(t,e){return this.isText?this.mh*e+this.mh/2.5:this.mh*e},width:function(t,e){return this.mh/3},height:function(t,e){return this.mh/2.5}},style:{fill:function(t,e){return"#000000"},stroke:function(t,e){return"#FFFFFF"},fontSize:function(t){return"10px"}}},scatter:{margin:[30,10,10,10],text:function(t){return t},attr:{x:function(t,e){return this.isText?this.m.left+this.m.right:this.p},y:function(t,e){return this.isText?this.mh*e+this.p/1.2:this.mh*e},r:function(t,e){return this.p}},style:{fill:function(t,e){return"Alive"===t?"#5D5DD8":"#D86561"},fontSize:function(t){return"12px"}}}},config.expression.scatter={margin:[10,30,35,20],attr:{x:function(t,e){return this.sx(t.x)-this.m.left},y:function(t,e){return this.sy(t.y)},r:function(t,e){return this.ss}},style:{fill:function(t,e){return void 0===t.value?"#333333":1===t.value?"#D86561":"#5D5DD8"},fillOpacity:function(t,e){return"0.6"}},on:{mouseover:function(t,e){console.log("Scatter: ",t)}}},config.expression.bar={margin:[10,30,50,20],attr:{x:function(t,e){return this.sx(t.x)-this.m.left},y:function(t,e){return t.y-t.value<0?this.sy(t.value):this.sy(t.y)},width:function(t,e){return scale.compatibleBand(this.sx)},height:function(t,e){return t.y-t.value<0?this.sy(t.y)-this.sy(t.value):this.sy(t.value)-this.sy(t.y)}},style:{fill:function(t,e){return t.y-t.value==0?"#000":"#62C2E0"},stroke:function(t,e){return t.y-t.value==0?"#000":"#62C2E0"}},on:{mouseover:function(t,e){}}},config.expression.heatmap={margin:[2,30,0,20],attr:{x:function(t,e){return this.sx(t.x)-this.m.left},y:function(t,e){return this.sy(t.y)},width:function(t,e){return scale.compatibleBand(this.sx)},height:function(t,e){return scale.compatibleBand(this.sy)}},on:{mouseover:function(t,e){console.log("Heatmap: ",t)}}},config.expression.division={margin:[0,30,25,20],marginScatter:[0,30,15,20],attr:{x:function(t,e){return e>0?this.isText?this.scale(this.axis[this.axis.length-1])-draw.getTextWidth(t.text.toUpperCase(),this.font)+5*this.padding-this.m.left:this.scale(t.point)-this.m.left:this.isText?this.scale(this.axis[0])-this.m.left+2*this.padding:this.scale(this.axis[0])-this.m.left},y:function(t){return this.isText?this.h-this.m.bottom+this.textHeight-this.padding:this.h-this.m.bottom},width:function(t,e){return e>0?this.scale(this.axis[this.axis.length-1])-this.scale(t.point):this.scale(t.point)-this.m.left},height:function(t){return this.textHeight+2*this.padding},rx:function(t,e){return 3},ry:function(t,e){return 3}},style:{fill:function(t,e){return this.isText?"#F1F1F1":t.color},stroke:function(t,e){return this.isLine?"#000000":"#FFFFFF"},dashed:function(t,e){return"4, 2"}},line:{x:function(){return this.scale(this.point)-this.m.left},y:function(){return this.id.indexOf("bar")>0?this.m.bottom/2:0}},text:function(t,e){return t.text},figure:{data:function(t){return this.id.indexOf("bar")>0?[t[0]]:[t[1]]},attr:{id:function(t,e){return this.id+"_marker"},cx:function(t,e){return this.scale(this.point)-this.m.left},cy:function(t,e){return this.id.indexOf("scatter")>0?this.h-this.m.bottom+4:this.m.bottom/2-4},r:function(t,e){return 3}},style:{fill:function(t,e){return t.color}}}},config.expression.patient={margin:[10,30,50,20],attr:{points:function(t,e){var n=this.sx(t.x),i=this.id.indexOf("bar")>0?(t.y-t.value<0?this.sy(t.value):this.sy(t.y))+5:this.h;return n+", "+i+" "+(n-4)+","+(i-7)+" "+(n+4)+","+(i-7)+" "+n+","+i}},style:{fill:function(t,e){return"#000000"},stroke:function(t,e){return"#B7B7B7"},"stroke-width":"1px"}};var divisionLine=function(t){"use strict";var e={};return function(t){if(e={},e.e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),e.m=size.setMargin(t.margin),e.id=e.e.attr("id"),e.w=t.width||e.e.attr("width"),e.h=t.height||e.e.attr("height"),e.g=render.addGroup(e.e,e.m.top,e.m.left),e.axis=t.xaxis||t.yaxis||[""],e.scale=scale.get(e.axis,t.xaxis?[e.m.left,e.w-e.m.right]:[e.m.top,e.h-e.m.bottom]),e.point="Array"===util.varType(t.point)?util.median(t.point):t.point,e.font=t.font||"10px",e.padding=t.padding||5,e.textHeight=draw.getTextHeight(e.font).height,e.data=t.data.map(function(t){return t.point=e.point,t}),e.line=(util.d3v4()?d3.line():d3.svg.line()).x(function(t){return t.x}).y(function(t){return t.y}),e.showRect=void 0===t.showRect&&!1!==t.showRect||t.showRect,e.showText=void 0===t.showText&&!1!==t.showText||t.showText,e.showLine=void 0===t.showLine&&!1!==t.showLine||t.showLine,e.marker=(void 0!==t.marker||!1===t.marker)&&(t.marker||"circle"),e.showRect&&render.rect({element:e.g.selectAll("#"+e.id+"_rect"),data:e.data,attr:{id:function(t){return e.id+"_rect"},x:function(n,i){return t.attr.x?t.attr.x.call(e,n,i):0},y:function(n,i){return t.attr.y?t.attr.y.call(e,n,i):0},width:function(n,i){return t.attr.width?t.attr.width.call(e,n,i):0},height:function(n,i){return t.attr.height?t.attr.height.call(e,n,i):0},rx:function(n,i){return t.attr.rx?t.attr.rx.call(e,n,i):0},ry:function(n,i){return t.attr.ry?t.attr.ry.call(e,n,i):0}},style:{fill:function(n,i){return t.style.fill?t.style.fill.call(e,n,i):"#000"},stroke:function(n,i){return t.style.stroke?t.style.stroke.call(e,n,i):"#000"}},on:{mouseover:function(n,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(e,n,i))}}}),e.showText&&render.text({element:e.g.selectAll("#"+e.id+"_text"),data:e.data,attr:{id:function(t){return e.isText=!0,e.id+"_text"},x:function(n,i){return t.attr.x?t.attr.x.call(e,n,i):0},y:function(n,i){return t.attr.y?t.attr.y.call(e,n,i):0}},style:{fill:function(n,i){return t.style.fill?t.style.fill.call(e,n,i):"#000"},"alignment-baseline":"middle","font-size":e.font},text:function(n,i){return t.text?t.text.call(e,n,i):""}}),e.showLine){var n=t.lineX?t.lineX.call(e):0,i=t.lineY?t.lineY.call(e):0;render.line({element:e.g,attr:{id:function(t){return e.isLine=!0,e.id+"_line"},d:e.line([{x:n,y:i},{x:n,y:e.h-e.m.bottom}])},style:{stroke:function(n,i){return t.style.stroke?t.style.stroke.call(e,n,i):"#000"},"stroke-dasharray":function(n,i){return t.style.dashed?t.style.dashed.call(e,n,i):"5, 10"}}})}e.marker&&"circle"===e.marker&&render.circle({element:e.g.selectAll("#"+e.id+"_marker"),data:t.figure.data?t.figure.data.call(e,e.data):e.data,attr:{id:function(n,i){return t.figure.attr.id?t.figure.attr.id.call(e,n,i):""},cx:function(n,i){return t.figure.attr.cx?t.figure.attr.cx.call(e,n,i):0},cy:function(n,i){return t.figure.attr.cy?t.figure.attr.cy.call(e,n,i):0},r:function(n,i){return t.figure.attr.r?t.figure.attr.r.call(e,n,i):0}},style:{fill:function(n,i){return t.figure.style.fill?t.figure.style.fill.call(e,n,i):0},stroke:function(n,i){return t.figure.style.stroke?t.figure.style.stroke.call(e,n,i):0}},on:{mouseover:function(n,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(e,n,i))}}})}}(),draw=function(t){"use strict";return t.ctx=null,t.clearCanvas=function(t){t.children.length>0&&t.removeChild(t.firstChild)},t.width=function(t){return"string"==typeof t?parseFloat(document.querySelector(t)):parseFloat(t.style.width)},t.height=function(t){return"string"==typeof t?parseFloat(document.querySelector(t)):parseFloat(t.style.height)},t.getTextWidth=function(t,e){var n=document.createElement("canvas"),i=n.getContext("2d"),a=0;return n.id="get-text-width",i.font=e?e+" arial":"10px arial",document.body.appendChild(n),a=i.measureText(t).width,document.body.removeChild(document.getElementById("get-text-width")),a},t.getMostTextWidth=function(e,n){var i=0;return util.loop(e,function(e){var a=t.getTextWidth(e,n);i=i>a?i:a}),i},t.getTextHeight=function(t,e){var n=document.createElement("span"),i=document.createElement("div"),a=document.createElement("div");a.id="get_text_height",n.style.fontSize=t||"10px",n.style.fontStyle=e||"Arial",n.innerHTML="Hg",i.style.display="inline-block",i.style.width="1px",i.style.height="0px",a.appendChild(n),a.appendChild(i),document.querySelector("body").appendChild(a);try{var r={};i.style.verticalAlign="baseline",r.ascent=i.offsetTop-n.offsetTop,i.style.verticalAlign="bottom",r.height=i.offsetTop-n.offsetTop,r.descent=r.height-r.ascent}finally{a.parentNode.removeChild(document.getElementById("get_text_height"))}return r},t.randomDraw=function(t,e){return Math.floor(Math.random()*t)+(e||0)},t.getDegree=function(t,e,n,i){var a=n-t,r=i-e,o=Math.atan2(a,r);return{radian:o,degree:Math.floor(180*o/Math.PI)}},t.noOverlap=function(e,n,i){for(var a=n.filter(function(t){return"node"===t.type}),r=n.filter(function(t){return"edge"===t.type}),o=0,s=a.length;o<s;o++){var l=a[o];l.textWidth=t.getTextWidth(e,"14px Calibri",l.text),l.width=l.width||1.2*l.textWidth,l.height=l.height||24,l.radius=5,i&&(l.top=i.members.indexOf(l.text)>-1?t.randomDraw(i.top+l.height/2,.7*i.height-l.height/2):(i.top-0)/2-l.height/2,l.left=t.randomDraw(i.left+i.width-i.left-l.width,i.left)),r.forEach(function(t){t.source=t.source.substring(0,l.text.length)===l.text?l.text:t.source,t.target=t.target.substring(0,l.text.length)===l.text?l.text:t.target,t.id=t.id.substring(0,t.source.length+t.target.length)})}return n},t.size=function(t){return t=util.d3v4()?t:t[0][0],t="Array"===util.varType(t)||"Object"===util.varType(t)?t:d3.select(t),{w:parseFloat(t.attr("width")),h:parseFloat(t.attr("height"))}},t.textOverflow=function(e,n,i){var a="";return e.split("").some(function(e){return t.getTextWidth(a+=e,n)>i}),a===e?e:a+"..."},t}(draw||{}),eventHandler=function(t){"use strict";function e(t){function e(e){t({x:e.pageX-i.ctx.canvas.offsetLeft,y:e.pageY-i.ctx.canvas.offsetTop})}if(!i.ctx)throw new Error("Not found context of canvas.");i.ctx.canvas.removeEventListener("mousemove",e),i.ctx.canvas.addEventListener("mousemove",e)}function n(t,e){var n=!1;document.body.addEventListener(e,function(t){if(n)return t.preventDefault&&t.preventDefault(),!1}),t.addEventListener("mouseenter",function(t){n=!0}),t.addEventListener("mouseleave",function(t){n=!1})}var i={};return t.context=function(e){return i.ctx=e,arguments.length?t:i.ctx},t.data=function(e){return i.data=e,arguments.length?t:i.data},t.hover=function(t){e(function(t){})},t.onScroll=function(t,e){(t="object"==typeof t?t:document.querySelector(t)).addEventListener("scroll",e)},t.verticalScroll=function(t,e){if(!t)throw new Error("There are not given dom element");n(t,"mousewheel"),t.addEventListener("mousewheel",function(n){t.scrollTop+=n.wheelDelta,e&&e.call(t,n)})},t.hoverSVG=function(t,e){console.log(t)},t}(eventHandler||{}),exclusive=function(){"use strict";function t(){var t={};return util.loop(m.data.survival.data[m.now.geneset],function(e,n){e&&(n<=m.data.divisionIdx[m.now.geneset].idx?t[e.participant_id]="altered":t[e.participant_id]="unaltered")}),t}function e(){var e=document.querySelector("#exclusivity_survival"),n=parseFloat(e.style.width),i=parseFloat(e.style.height)/1.5;SurvivalCurveBroilerPlate.settings={canvas_width:n,canvas_height:i,chart_width:n-30,chart_height:i-30,chart_left:50,chart_top:15,include_info_table:!1,include_legend:!0,include_pvalue:!0,pval_x:n-200,pval_y:42},SurvivalCurveBroilerPlate.style={censored_sign_size:5,axis_stroke_width:1,axisX_title_pos_x:n/2,axisX_title_pos_y:i-25,axisY_title_pos_x:-n/2+25,axisY_title_pos_y:10,axis_color:"black",pval_font_size:14,pval_font_style:"normal"},SurvivalCurveBroilerPlate.subGroupSettings.legend={low:"Unaltered group",high:"Altered group"},survival({element:"#exclusivity_survival",margin:[20,20,20,20],data:m.data.survival.data[m.now.geneset],divisionData:t()})}function n(){network({data:m.data.network[m.now.geneset],element:"#exclusivity_network"})}function i(){layout.getSVG(m.svg,["heatmap"],function(t,e){axis.element(e).left({margin:[35,0,35,e.attr("width")-80],data:m.now.geneset.split(" "),opt:{remove:"line, path"}}).attr("id","exclusivity_heatmap_axis")})}function a(){layout.getSVG(m.svg,["heatmap"],function(t,e){heatmap({element:e,data:m.data.heatmap[m.now.geneset],opt:config.exclusivity.heatmap.opt,attr:config.exclusivity.heatmap.attr,style:config.exclusivity.heatmap.style,margin:config.exclusivity.heatmap.margin,xaxis:m.data.axis.heatmap.x[m.now.geneset],yaxis:m.data.axis.heatmap.y[m.now.geneset]})})}function r(){layout.getSVG(m.svg,["heatmap"],function(t,e){divisionLine({element:e,data:[{text:"Altered group",color:"#FF6252"},{text:"Unaltered group",color:"#00AC52"}],xaxis:m.data.axis.heatmap.x[m.now.geneset],margin:config.exclusivity.division.margin,padding:6,text:config.exclusivity.division.text,attr:config.exclusivity.division.attr,style:config.exclusivity.division.style,font:"14px",lineX:config.exclusivity.division.line.x,lineY:config.exclusivity.division.line.y,point:m.data.divisionIdx[m.now.geneset].idx+1})})}function o(){layout.getSVG(m.svg,["ty_legend"],function(t,e){legend({element:e,data:m.data.type[m.now.geneset],priority:config.exclusivity.priority,text:config.exclusivity.legend.text,font:"14px",attr:config.exclusivity.legend.attr,style:config.exclusivity.legend.style,margin:config.exclusivity.legend.margin})})}function s(){u(m.origin.sample),e(),n(),i(),a(),r(),o(),g()}function l(t,e){var n="SMCLUAD1690060028",i=m.now.geneset.split(" "),a=".";return t.length<1?["**",n+" Belongs to","Unaltered group"]:(util.loop(t,function(t){var n=e[i.indexOf(t.gene)];n.indexOf(t.value)>-1&&(a="."!==a?a:n[n.indexOf(t.value)])}),"."===a?["**",n+" Belongs to","Unaltered group"]:["**",n+" Belongs to","Altered group"])}function u(t){m.data.sample={data:[],isAltered:!1},util.loop(t,function(t){m.now.geneset.indexOf(t.gene)>-1&&m.data.sample.data.push({gene:t.gene,value:config.exclusivity.symbol(config.exclusivity.case(config.landscape.case(t.class),t.class))})}),m.data.sample.isAltered=l(m.data.sample.data,m.data.survival.heat[m.now.geneset])}function c(){layout.getSVG(m.svg,["sample_legend"],function(t,e){legend({element:e,data:m.data.sample.isAltered,font:"14px",attr:config.exclusivity.sample.legend.attr,style:config.exclusivity.sample.legend.style,text:config.exclusivity.sample.legend.text,margin:config.exclusivity.sample.legend.margin})})}function d(){layout.getSVG(m.svg,["heatmap"],function(t,e){var n=config.exclusivity.sample.division,i={};i.e=e,i.m=size.setMargin(n.margin),i.g=render.addGroup(e,i.m.top,i.m.left),render.text({element:i.g.selectAll("#"+e.attr("id")+"_sample"),data:[{value:"**",type:m.data.sample.isAltered}],attr:{id:function(t){return e.attr("id")+"_sample"},x:function(t,e){return n.attr.x.call(i,t,e)},y:function(t,e){return n.attr.y.call(i,t,e)}},style:{fill:function(t,e){return n.style.fill.call(i,t,e)},"font-size":"25px","alignment-baseline":"middle"},text:function(t,e){return n.text.call(i,t,e)}})})}function f(t,e){for(var n=0,i=t.length;n<i;n++){var a=t[n],r=e[n];m.data.sample.isAltered.indexOf(a.innerHTML)>-1&&(a.innerHTML+=" **",r.innerHTML+=" **")}}function p(t){var e=config.exclusivity.sample.survival;render.text({element:t,attr:{x:function(t){return e.attr.x.call(m,t)},y:function(t){return e.attr.y.call(m,t)}},style:{fill:function(t){return e.style.fill.call(m,t)},"font-size":function(t){return e.style.fontSize.call(m,t)}},text:function(t){return e.text.call(m,t)}})}function h(){var t={},e=setInterval(function(){t.ostb=document.querySelectorAll("#dfs_stat_table td b"),t.dfstb=document.querySelectorAll("#os_stat_table td b"),t.legends=d3.selectAll(".legend"),t.ostb.length>0&&t.dfstb.length>0&&t.legends.node()&&(f(t.ostb,t.dfstb),p(t.legends),clearInterval(e))},1e3)}function g(){c(),d(),h()}var m={now:{geneset:null}};return function(t){console.log("Given Exclusivity data: ",t);var e=document.querySelector(t.element||null),n=parseFloat(t.width||e.style.width||1400),i=parseFloat(t.height||e.style.height||700);e.style.background="#F7F7F7",m.origin=t.data,m.data=preprocessing.exclusivity(t.data),m.ids=size.chart.exclusivity(e,n,i),m.svg=layout.exclusivity(m.ids,m),m.now.geneset=m.data.geneset[0].join(" "),selectBox({element:"#exclusivity_select_geneset",initText:m.now.geneset,className:"exclusivity-geneset",viewName:"geneset",items:m.data.geneset.map(function(t){return t.join(" ")}),click:function(t){m.now.geneset=t.toUpperCase(),layout.removeG(),s()}}),s(),console.log("Exclusivity Model data: ",m)}}(),expression=function(t){"use strict";function e(t,e){y.data.survival.divide={},util.loop(t,function(t,n){t.value<=e?y.data.survival.divide[t.x]="unaltered":y.data.survival.divide[t.x]="altered"})}function n(t){y.now.osdfs!==t&&(layout.removeG(["expression_scatter_plot"]),d(y.now.osdfs=t,y.now.osdfs))}function i(){var t=document.getElementById("expression_survival").querySelectorAll("input");t[0].onclick=function(t){n("os")},t[1].onclick=function(t){n("dfs")}}function a(){var t=document.querySelector("#expression_survival"),n=parseFloat(t.style.width),a=parseFloat(t.style.height)/1.4;SurvivalCurveBroilerPlate.settings={canvas_width:n,canvas_height:a,chart_width:n-30,chart_height:a-30,chart_left:50,chart_top:15,include_info_table:!1,include_legend:!0,include_pvalue:!0,pval_x:n-190,pval_y:42},SurvivalCurveBroilerPlate.style={censored_sign_size:5,axis_stroke_width:1,axisX_title_pos_x:n/2,axisX_title_pos_y:a-25,axisY_title_pos_x:-n/2+25,axisY_title_pos_y:10,axis_color:"black",pval_font_size:12,pval_font_style:"normal"},SurvivalCurveBroilerPlate.subGroupSettings.legend={low:"Low score group",high:"High score group"};e(y.data.bar,y.data.axis.bar.y[1]);var r=survival({element:"#expression_survival",margin:[20,20,20,20],data:y.origin.patient_list,divisionData:y.data.survival.divide});y.data.survival.data=r.survivalData,y.data.scatter=y.data.survival.data.all,i()}function r(){layout.getSVG(y.svg,["bar_plot"],function(t,e){var n=y.data.axis.bar.y;config.expression.bar.margin.splice(1,1,y.data.axisLeft),bar({element:e,data:y.data.bar,direction:"bottom",margin:config.expression.bar.margin,attr:config.expression.bar.attr,style:config.expression.bar.style,xaxis:y.data.axis.bar.x,yaxis:[n[2],n[0]],on:config.expression.bar.on}),axis.element(e).left({margin:[10,0,50,e.attr("width")-y.data.axisLeft],data:[n[2],n[0]],opt:{tickValues:n}}).style("stroke-width","0.3")})}function o(){selectBox({element:"#expression_function",className:"expression-function",margin:[3,3,0,0],initText:"Average",viewName:"function",items:["Average"],click:function(t){y.now.func=t,console.log("Function is: ",y.now.func)}})}function s(){selectBox({element:"#expression_color_mapping",margin:[3,3,0,0],className:"expression-color-mapping",initText:"Color Mapping",viewName:"color_mapping",items:y.data.subtype.map(function(t){return t.key}),click:function(t){y.now.col=t,console.log("Color mapping set is: ",y.now.col),y.data.subtype.some(function(t){return y.now.colorSet=t.value,y.now.col===t.key}),layout.removeG(["expression_bar_legend","expression_bar_plot","expression_scatter_plot"]),l(),r(),d(y.now.osdfs),u()}})}function l(){y.now.colorSet&&layout.getSVG(y.svg,["bar_legend"],function(t,e){legend({element:e,data:y.now.colorSet,text:config.expression.legend.bar.text,attr:config.expression.legend.bar.attr,style:config.expression.legend.bar.style,margin:config.expression.legend.bar.margin})})}function u(){config.expression.division.margin.splice(1,1,y.data.axisLeft),config.expression.division.marginScatter.splice(1,1,y.data.axisLeft);var t={padding:3,font:"12px",xaxis:y.data.axis.bar.x,margin:config.expression.division.margin,point:y.data.axis.bar.x[util.medIndex(y.data.axis.bar.x)],data:[{text:"Low score group",color:"#00AC52"},{text:"High score group",color:"#FF6252"}],text:config.expression.division.text,attr:config.expression.division.attr,style:config.expression.division.style,figure:config.expression.division.figure,lineX:config.expression.division.line.x,lineY:config.expression.division.line.y,marker:"circle"};layout.getSVG(y.svg,["bar_plot"],function(e,n){t.element=n,divisionLine(t)}),layout.getSVG(y.svg,["scatter_plot"],function(e,n){t.element=n,t.yAdjust=0,t.showRect=!1,t.showText=!1,t.margin=config.expression.division.marginScatter,divisionLine(t)})}function c(t){var e=[];return util.loop(y.data.scatter[t],function(t){util.loop(t,function(t,n){y.data.axis.scatter.x.indexOf(t)>-1&&e.push({x:t,y:n.months,value:n.status})})}),e}function d(t){layout.getSVG(y.svg,["scatter_plot"],function(e,n){var i=(new Array).concat(y.data.axis.scatter.y[t]).reverse();util.minmax(i);config.expression.scatter.margin.splice(1,1,y.data.axisLeft),scatter({element:n,data:c(t),margin:config.expression.scatter.margin,attr:config.expression.scatter.attr,style:config.expression.scatter.style,xaxis:y.data.axis.scatter.x,yaxis:i,on:config.expression.scatter.on}),axis.element(n).left({margin:[10,0,35,n.attr("width")-y.data.axisLeft],data:i,opt:{}}).style("stroke-width","0.3")})}function f(){layout.getSVG(y.svg,"scatter_legend",function(t,e){legend({element:e,data:["Alive","Dead"],text:config.expression.legend.scatter.text,attr:config.expression.legend.scatter.attr,style:config.expression.legend.scatter.style,margin:config.expression.legend.scatter.margin})})}function p(){layout.getSVG(y.svg,["heatmap"],function(t,e){var n=draw.getTextHeight("12px").height,i=scale.get(y.data.axis.gradient.x,["#FF0000","#000000","#00FF00"]);e.attr("height",y.data.axis.heatmap.y.length*n),config.expression.heatmap.margin.splice(1,1,y.data.axisLeft),heatmap({element:e,data:y.data.heatmap,xaxis:y.data.axis.heatmap.x,yaxis:y.data.axis.heatmap.y,margin:config.expression.heatmap.margin,attr:config.expression.heatmap.attr,style:{fill:function(t,e){return i(t.value)}},on:config.expression.heatmap.on}),axis.element(e).left({margin:[2,0,0,e.attr("width")-y.data.axisLeft],data:y.data.axis.heatmap.y,opt:{remove:"path, line"}}),eventHandler.verticalScroll(e.node().parentNode)})}function h(){selectBox({element:"#expression_signature",className:"expression-signature",margin:[3,3,0,0],initText:y.init.sig,viewName:"signature",items:y.origin.signature_list.map(function(t){return t.signature}),click:function(t){y.now.sig=t,console.log("Signature set is: ",y.now.sig)}})}function g(){layout.getSVG(y.svg,["gradient"],function(t,e){y.data.colorGradient=colorGradient({element:e,offset:y.data.axis.gradient.x,adjustValue:6,colors:["#FF0000","#000000","#00FF00"]}),render.rect({element:render.addGroup(e,5,3),attr:{id:t+"_rect",x:0,y:0,rx:3,rx:3,width:e.attr("width")-6,height:.1*e.attr("height")},style:{fill:"url(#"+y.data.colorGradient.id+")"}}),axis.element(e).bottom({margin:[0,3,.9*e.attr("height"),10],data:[y.data.axis.gradient.x[0],y.data.axis.gradient.x[2]],opt:{tickValues:y.data.axis.gradient.x,remove:"path, line"}}).selectAll("text").style("fill","#999999")})}function m(){layout.getSVG(y.svg,["bar_plot","scatter_plot"],function(t,e){var n={},i=y.data.axis.bar.y;n.g=render.addGroup(e,0,0),n.id=e.attr("id"),n.m=size.setMargin(config.expression.patient.margin),n.w=e.attr("width"),n.h=e.attr("height"),n.sx=scale.get(y.data.axis.heatmap.x,[n.m.left,n.w-n.m.right]),n.sy=scale.get([i[2],i[0]],[n.m.top,n.h-n.m.bottom]),render.triangle({element:n.g.selectAll("#"+n.id+"_tri"),data:y.data.bar.filter(function(t){if(t.x===y.data.patient)return t}),attr:{id:function(t){return n.id+"_tri"},points:function(t,e){return config.expression.patient.attr.points.call(n,t,e)}},style:config.expression.patient.style})})}function x(){var t={},e=setInterval(function(){t.ostb=document.querySelectorAll("#dfs_stat_table td b"),t.dfstb=document.querySelectorAll("#os_stat_table td b"),t.legends=d3.selectAll(".legend"),t.ostb.length>0&&t.dfstb.length>0&&t.legends.node()&&clearInterval(e)},1e3)}var y={init:{func:"Average",sig:null,col:null},now:{func:null,sig:null,col:null,osdfs:"os"}};return function(t){var e=document.querySelector(t.element||null),n=parseFloat(t.width||e.style.width||1400),i=parseFloat(t.height||e.style.height||700);e.style.background="#F7F7F7",y.origin=t.data,y.data=preprocessing.expression(t.data),y.ids=size.chart.expression(e,n,i),y.svg=layout.expression(y.ids,y),y.init.sig=y.origin.signature_list[0].signature,y.now.sig=y.init.sig;var c=draw.getMostTextWidth(y.data.axis.heatmap.y,"12px");y.data.axisLeft=10*Math.ceil(c/10),o(),s(),l(),a(),r(),u(),d(y.now.osdfs),f(),p(),h(),g(),m(),x(),console.log("Expression Model data: ",y)}}(),heatmap=function(t){"use strict";function e(t){util.loop(t,function(t,e){util.loop(i.mt,function(t,n){e[t][0]&&i.d.push({x:e.x,y:e.y,value:e[t][0]})})})}function n(t){return util.loop(t,function(t,e){var n=t.x+t.y,a=config.landscape.case(t.value);i.v[n]?config.landscape.priority(i.v[n][a][0])>config.landscape.priority(t.value)?i.v[n][a].unshift(t.value):i.v[n][a].push(t.value):(i.v[n]={cnv:[],var:[],x:t.x,y:t.y},i.v[n][a].push(t.value))}),e(i.v)}var i={mt:["cnv","var"],v:{},d:[]};return function(t){(i={mt:["cnv","var"],v:{},d:[]}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),i.s=draw.size(i.e),i.m=size.setMargin(t.margin),i.g=render.addGroup(i.e,i.m.top,i.m.left),i.sx=scale.get(t.xaxis,[i.m.left,(t.width||i.s.w)-i.m.right]),i.sy=scale.get(t.yaxis,[i.m.top,(t.height||i.s.h)-i.m.bottom]);var e=i.e.attr("id");return render.rect({element:i.g.selectAll("#"+e+"_rect"),data:t.dup?(n(t.data),i.d):t.data,attr:{id:function(t,n){return e+"_rect"},x:function(e,n){return t.attr.x?t.attr.x.call(i,e,n):0},y:function(e,n){return t.attr.y?t.attr.y.call(i,e,n):0},width:function(e,n){return t.attr.width?t.attr.width.call(i,e,n):0},height:function(e,n){return t.attr.height?t.attr.height.call(i,e,n):0}},style:{fill:function(e,n){return t.style.fill?t.style.fill.call(i,e,n):"#000000"},stroke:function(e,n){return!!t.style.stroke&&t.style.stroke.call(i,e,n)}},on:{mouseover:function(e,n){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(i,e,n))}}}),i}}(),landscape=function(t){"use strict";function e(){A.div.title=document.querySelector("#landscape_title"),A.div.title.innerHTML=A.origin.title}function n(t,e,n){var i=document.createElement("div");A.ids.push((i.id=t.id+"_"+e,i.id)),util.loop(n,function(t,e){i.style[t]=e}),t.appendChild(i)}function i(t){var e={_patient:document.getElementById("landscape_patient_group"),_axis:document.getElementById("landscape_axis_group"),_chart:document.getElementById("landscape_group")};util.loop(e,function(e,i){util.loop(t,function(a,r){n(i,util.removeWhiteSpace(a[0])+e,{width:draw.width(i)+"px",height:draw.height(i)/t.length+"px",overflowX:"hidden",overflowY:"hidden"})})})}function a(t,e,n,i){var a=!1;util.loop(t.split("_"),function(t,r){config.landscape[e][t]&&(a||(a=!0,i(config.landscape[e][t],n[t])))})}function r(t,e){return a(t,"axis",A.data.axis,e)}function o(t,e){return a(t,"bar",A.data,e)}function s(t,e){return a(t,"stack",A.data.stack,e)}function l(t,e){return a(t,"heatmap",A.data,e)}function u(t,e){return a(t,"group",A.data.group,e)}function c(t,e){var n;return t.indexOf("group")<0?e:(t.split("_").forEach(function(t){util.loop(e,function(e,i){t===e[0].replace(/\s/gi,"")&&(n=e)})}),n)}function d(t,e){var n;return util.loop(e,function(e,i){var a=(e.y||e[0].y).replace(/\s/gi,"");t.indexOf(a)>-1&&(n="Array"===util.varType(e)?e:[e])}),n}function f(){layout.getSVG(A.svg,["axis_sample","gene","pq","axis_group_"],function(t,e){r(t,function(t,n){t="Array"!==util.varType(t)?[t]:t,util.loop(t,function(t,i){axis.element(e)[t.direction]({margin:t.margin,data:c(e.attr("id"),"top"===t.direction||"bottom"===t.direction?n.x:n.y),opt:t.opt})})})})}function p(t,e,n,i){bar({data:e,opt:t.opt,element:n,attr:t.attr,style:t.style,margin:t.margin,direction:t.direction,width:i.indexOf("patient")<0&&i.indexOf("sample")>-1?A.now.width||A.init.width:null,xaxis:t.xaxis.call(A.data.axis),yaxis:t.yaxis.call(A.data.axis)})}function h(){layout.getSVG(A.svg,["pq"],function(t,e){o(t,function(n,i){p(n,i,e,t)})})}function g(){layout.getSVG(A.svg,["e_sample","patient_sample","gene"],function(t,e){s(t,function(n,i){p(n,i,e,t)})})}function m(){layout.getSVG(A.svg,["_heatmap"],function(t,e){l(t,function(n,i){heatmap({data:i,dup:!0,opt:n.opt,element:e,attr:n.attr,style:n.style,margin:n.margin,xaxis:n.xaxis.call(A.data.axis),yaxis:n.yaxis.call(A.data.axis),width:t.indexOf("patient")<0?A.now.width||A.init.width:null})})})}function x(){layout.getSVG(A.svg,["t_group_","e_group_"],function(t,e){u(t,function(n,i){heatmap({element:e,opt:n.opt,attr:n.attr,style:n.style,margin:n.margin,data:d(t,i),width:t.indexOf("patient")<0?A.now.width||A.init.width:null,xaxis:n.xaxis.call(A.data.axis),yaxis:A.data.axis.group.y.filter(function(e,n){if(t.indexOf(e[0].replace(/\s/gi,""))>-1)return e})[0]})})})}function y(){layout.getSVG(A.svg,["legend"],function(t,e){legend({element:e,data:A.data.type,priority:config.landscape.priority,text:config.landscape.legend.text,attr:config.landscape.legend.attr,style:config.landscape.legend.style,margin:[e.attr("height")/3,20,0,0]})})}function v(){A.init.width=2*draw.width(d3.select("#landscape_heatmap").node()),A.init.height=draw.height(d3.select("#landscape_heatmap").node())}function w(){landscapeScaleOption.set({element:"#landscape_option",default:100,defaultValue:A.init.width,interval:10,unit:"%",btn:[{id:"upscale",className:"upscale"},{id:"downscale",className:"downscale"},{id:"initialize",className:"initialize"}],input:{id:"viewscale",className:"viewscale"},change:function(t,e){return layout.removeG(),"initialize"===t?(_({axis:"x",data:A.init.axis.x}),_({axis:"y",data:A.init.axis.y}),k(A.data,(A.now.width=A.init.width,A.now.width))):k(A.data,(A.now.width=e,A.now.width))}})}function _(t){"x"===t.axis?(A.data.axis.group[t.axis]=t.data,A.data.axis.sample[t.axis]=t.data,A.data.axis.heatmap[t.axis]=t.data):(A.data.axis.pq[t.axis]=t.data,A.data.axis.gene[t.axis]=t.data,A.data.axis.heatmap[t.axis]=t.data)}function b(){selectBox({element:"#landscape_option",margin:[0,8,0,0],height:"30px",className:"landscape-sort",initText:"Select by sort..",viewName:"sort",items:["Mutation","Value","Sample"],click:function(t){A.now.sort[t]&&"asc"===A.now.sort[t]?A.now.sort[t]="desc":A.now.sort[t]="asc",layout.removeG(),_(landscapeSort[A.now.sort[t]](t,A.data)),k(A.data,A.now.width)}})}function F(t){layout.getSVG(A.svg,["e_group_","e_sample","e_heatmap"],function(e,n){n.attr("width",t||A.now.width||A.init.width)})}function k(t,e){F(e),f(),g(),h(),m(),x(),y()}var A={div:{},init:{axis:{x:[],y:[]},width:0,height:0},now:{sort:{mutation:null,sample:null,value:null},axis:{x:[],y:[]},width:0,height:0},exclusive:{init:null}};return function(t){console.log("Given Landscape data: ",t);var n=document.querySelector(t.element||null),a=parseFloat(t.width||n.style.width||1400),r=parseFloat(t.height||n.style.height||700);A.origin=t.data,A.data=preprocessing.landscape(t.data),A.init.axis.x=(new Array).concat(A.data.axis.heatmap.x),A.init.axis.y=(new Array).concat(A.data.axis.gene.y),A.ids=size.chart.landscape(n,a,r),v(),e(),w(),b(),i(A.data.axis.group.y),A.svg=layout.landscape(A.ids,A),A.exclusive.init=landscapeSort.exclusive(A.data.heatmap,A.data.gene),_(A.exclusive.init),k(A.data,A.init.width),console.log("Landscape Model data: ",A),eventHandler.onScroll("#landscape_heatmap",function(t){var e=document.querySelector("#landscape_sample"),n=document.querySelector("#landscape_group").children,i=Array.prototype.slice.call(n);e.scrollLeft=this.scrollLeft,util.loop.call(this,i,function(t,e){t.scrollLeft=this.scrollLeft})})}}(),landscapeScaleOption=function(t){"use strict";function e(t){return{upscale:"fa fa-caret-up",downscale:"fa fa-caret-down",initialize:"fa fa-refresh"}[t]}function n(t){var e=document.querySelector("#viewscale");switch(this.id){case"upscale":r.status+=r.interval;break;case"downscale":r.status-=r.interval;break;case"initialize":r.status=r.default;break;default:return}var n="upscale"===this.id?1:-1,i=parseInt(.1*r.defaultValue);r.status=r.status<r.default?r.default:r.status>200?200:r.status,e.value=r.status+" %",r.nowValue="initialize"===this.id?r.defaultValue:(this.id,r.nowValue+n*i),r.nowValue=r.defaultValue>r.nowValue?r.defaultValue:2*r.defaultValue<r.nowValue?2*r.defaultValue:r.nowValue,!!r.change&&r.change(this.id,r.nowValue)}function i(t,i){for(var a=0,r=i.btn.length;a<r;a++){var o=i.btn[a],s=document.createElement("button"),l=document.createElement("i");l.className=e(o.id),s.id=o.id,s.addEventListener("click",n),s.appendChild(l),t.appendChild(s)}}function a(t,e){util.loop(e.input,function(e,n){var i=document.createElement("input");i.id=e.id,i.readOnly=!0,i.tabIndex=-1,i.value=(r.value||r.default)+" "+r.unit,t.appendChild(i)})}var r={};return t.set=function(e){if(d3.select(".scale-option-frame").empty()){var n=document.createElement("div");n.className="scale-option-frame",(r=e).status=e.default,r.e=document.querySelector(e.element),r.width=parseFloat(e.width||r.e.style.width||140),r.height=parseFloat(e.height||r.e.style.height||105),r.change=e.change||null,r.defaultValue=e.defaultValue,r.nowValue=r.defaultValue,r.e.appendChild(n),e.btn=e.btn.length?e.btn:[e.btn],e.input=e.input.length?e.input:[e.input],a(n,e),i(n,e)}return t},t.change=function(e){return e(r),t},t}(landscapeScaleOption||{}),landscapeSort=function(t){"use strict";function e(t,e){switch(t){case"mutation":return e.stack.gene;case"sample":return e.stack.sample;case"value":return e.pq;case"init":return e.init;default:throw new Error("No matching any data")}}function n(t,e){var n={};return util.loop(t,function(t,i){n[t[e]]=n[t[e]]?n[t[e]]+=t.value:n[t[e]]=t.value}),n}function i(t){var e=[];return util.loop(t,function(t,n){e.push({key:t,value:n})}),e}function a(t,e){var n="asc"===t?1:-1;return e.sort(function(t,e){return t.value>e.value?1*n:-1*n})}function r(t,e){return{axis:"y",data:a(t,i(n(e,"y"))).map(function(t){return t.key})}}function o(t,e){return{axis:"x",data:a(t,i(n(e,"x"))).map(function(t){return t.key})}}function s(t,e){return{axis:"y",data:a(t,e).map(function(t){return t.y})}}function l(t,e,n){switch(t){case"mutation":return r(e,n);case"sample":return o(e,n);case"value":return s(e,n);default:throw new Error("Not matching any function")}}function u(t,e,n){var i=2*e.indexOf(n.y),a="cnv"===config.landscape.case(n.value)?0:1;t.value=t.value.replaceAt(i,"00".replaceAt(a,"1"))}function c(t){for(var e="",n=0;n<t;n++)e+="00";return e}function d(t){return{axis:"x",data:t.sort(function(t,e){return t.value<e.value?1:-1}).map(function(t,e){return t.key})}}var f={exclusive:[]};return t.exclusive=function(t,e){var n={},i=[],a=0;return util.loop(t,function(t){n[t.x]?n[t.x]=n[t.x]:(n[t.x]=!0,i.push({key:t.x,value:c(e.length)}),a+=1),u(i[a-1],e,t)}),f.exclusive=i,d(i)},t.asc=function(t,n){return l(t,"asc",e(t,n))},t.desc=function(t,n){return l(t,"desc",e(t,n))},t.byGene=function(){},t.byGroup=function(){},t}(landscapeSort||{}),layout=function(t){"use strict";function e(t,e,n){return util.loop(n,function(n,a){var r=!0;util.loop(t,function(t,e){n.indexOf(t)>-1&&(r=!r)}),r&&(i[e][n]=render.createSVG(n))}),i[e]}function n(t){var e=Array.prototype.slice.call(t).map(function(t){return util.varType(t)});if(e.indexOf("Object")<0)throw new Error("Not found svg set");if(e.indexOf("Function")<0)throw new Error("Not found CallBack function")}var i={exclusivity:{},expression:{},landscape:{},variants:{}};return t.getSVG=function(t,e,i){n(arguments),e="Array"===util.varType(e)?e:[e],util.loop(t,function(t,n){util.loop(e||[""],function(e,a){if(t.indexOf(e)>-1)return i(t,n)})})},t.removeG=function(t){t?(t="Array"===util.varType(t)?t:[t],util.loop(t,function(t){var e=t.indexOf("#")>-1?t:"#"+t;d3.selectAll(e+" svg .g-tag").remove()})):d3.selectAll("svg .g-tag").remove()},t.exclusivity=function(t){return e(["geneset","survival","network"],"exclusivity",t)},t.landscape=function(t){return e(["option","title"],"landscape",t)},t.variants=function(t){return e(["title"],"variants",t)},t.expression=function(t){return e(["title","function","color_mapping","signature"],"expression",t)},t}(layout||{}),legend=function(t){"use strict";function e(t,e){var n=0;return util.loop(t,function(t,i){n=n>draw.getTextWidth(t,e)?n:draw.getTextWidth(t,e)}),n}var n={};return function(t){(n={}).d=t.priority?t.data.sort(function(e,n){return t.priority(e)>t.priority(n)?1:-1}):t.data,n.e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),n.id=n.e.attr("id"),n.m=size.setMargin(t.margin),n.w=n.e.attr("width"),n.h=n.e.attr("height"),n.t=n.m.top||0,n.l=n.m.left||0,n.p=t.padding||5,n.font=t.font||"10px",n.sw=n.sg=render.addGroup(n.e,n.t,n.l),n.tg=render.addGroup(n.e,n.t,n.l),n.mw=e(n.d,n.font),n.mh=draw.getTextHeight(n.font).height,n.dr=n.w-n.m.left-n.m.right>n.h-n.m.top-n.m.bottom?"h":"v",t.attr&&t.attr.r?render.circle({element:n.sg.selectAll("#"+n.id+"_circle"),data:n.d,attr:{id:function(t){return n.id+"_circle"},cx:function(e,i){return t.attr.x?t.attr.x.call(n,e,i):0},cy:function(e,i){return t.attr.y?t.attr.y.call(n,e,i):0},r:function(e,i){return t.attr.r?t.attr.r.call(n,e,i):0}},style:{fill:function(e){return t.style.fill?t.style.fill(e):"#000000"},stroke:function(e){return!!t.style.stroke&&t.style.stroke(e)}},on:{mouseover:function(e,i){return!!t.on.mouseover&&t.on.mouseover.call(n,e,i)}}}):t.attr&&t.attr.points?render.triangle({element:n.sg.selectAll("#"+n.id+"_triangle"),data:n.d,attr:{id:function(t){return n.id+"_triangle"},points:function(e,i){return t.attr.points?t.attr.points.call(n,e,i):[0,0]}},style:{fill:function(e){return t.style.fill?t.style.fill(e):"#000000"},stroke:function(e){return!!t.style.stroke&&t.style.stroke(e)},"stroke-width":function(e){return t.style.strokeWidth?t.style.strokeWidth(e):"1px"}},on:{mouseover:function(e,i){return!!t.on.mouseover&&t.on.mouseover.call(n,e,i)}}}):t.attr&&t.attr.width&&t.attr.height&&render.rect({element:n.sg.selectAll("#"+n.id+"_rect"),data:n.d,attr:{id:function(t){return n.id+"_rect"},x:function(e,i){return t.attr.x?t.attr.x.call(n,e,i):0},y:function(e,i){return t.attr.y?t.attr.y.call(n,e,i):0},width:function(e,i){return t.attr.width?t.attr.width.call(n,e,i):5},height:function(e,i){return t.attr.height?t.attr.height.call(n,e,i):5}},style:{fill:function(e){return t.style.fill?t.style.fill(e):"#000000"},stroke:function(e){return!!t.style.stroke&&t.style.stroke(e)}},on:{mouseover:function(e,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(n,e,i))}}}),render.text({element:n.tg.selectAll("#"+n.id+"_text"),data:n.d,attr:{id:function(t){return n.isText=!0,n.id+"_text"},x:function(e,i){return t.attr.x?t.attr.x.call(n,e,i):0},y:function(e,i){return t.attr.y?t.attr.y.call(n,e,i):0}},style:{"font-size":function(e,i){return t.style.fontSize?t.style.fontSize.call(n,e,i):n.font},"font-family":function(e){return t.style.fontFamily?t.style.fontFamily.call(n,e):"Arial"},"font-weight":function(e){return t.style.fontWeight?t.style.fontWeight.call(n,e):"1"},"alignment-baseline":function(e){return t.style.alignmentBaseline?t.style.alignmentBaseline:"middle"},fill:function(e,i){return t.style.fill?t.style.fill.call(n,e,i):"#333333"}},on:{mouseover:function(e,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(n,e,i))}},text:function(e,i){return t.text?t.text.call(n,e,i):"legend "+i}})}}();!function(t){"use strict";t.bio={draw:draw,config:config,render:render,variants:variants,pathways:"",expression:expression,landscape:landscape,exclusive:exclusive,chart:{bar:bar,legend:legend,needle:needle,network:network,heatmap:heatmap,scatter:scatter,survival:survival},tools:{selectBox:selectBox,needleNavi:needleNavi,needleGraph:needleGraph,divisionLine:divisionLine,colorGradient:colorGradient,landscapeSort:landscapeSort,landscapeScaleOption:landscapeScaleOption},util:util,size:size,scale:scale,layout:layout,eventHandler:eventHandler,preprocessing:preprocessing}}(window||{});var needle=function(t){"use strict";var e={};return function(t){(e={}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),e.s=draw.size(e.e),e.id=e.e.attr("id"),e.m=size.setMargin(t.margin),e.t=e.m.top||0,e.l=e.m.left||0,e.g=render.addGroup(e.e,e.m.top,e.m.left),e.xag=render.addGroup(e.e,e.m.top,e.m.left),e.xxg=render.addGroup(e.e,e.m.top,e.m.left),e.radius=t.radius||5,e.sx=scale.get(t.xaxis,[e.m.left,e.s.w-e.m.right]),e.sy=scale.get(t.yaxis,[e.s.h-e.m.bottom,e.m.top]),e.line=(util.d3v4()?d3.line():d3.svg.line()).x(function(t){return e.sx(t.x)}).y(function(t){return e.sy(t.y)}),util.loop(t.lineData,function(t,n){render.line({element:e.g,attr:{id:function(t){return e.id+"_line"},d:e.line(t.value)},style:{stroke:"#333333"}})}),render.circle({element:e.g.selectAll("#"+e.id+"_circle"),data:t.circleData,attr:{id:function(t){return e.id+"_circle"},cx:function(n,i){return t.attr.x?t.attr.x.call(e,n,i):0},cy:function(n,i){return t.attr.y?t.attr.y.call(e,n,i):0},r:function(n,i){return t.attr.r?t.attr.r.call(e,n,i):e.radius}},style:{fill:function(n,i){return t.style.fill?t.style.fill.call(e,n,i):"#000000"},stroke:function(n,i){return t.style.stroke?t.style.stroke.call(e,n,i):"#FFFFFF"}},on:{mouseover:function(n,i){return!!t.on.mouseover&&t.on.mouseover.call(e,n,i)}}})}}(),needleGraph=function(t){"use strict";function e(){for(var t=1;draw.getTextHeight(t+"px").height<n.sh/2;)t+=1;return t+"px"}var n={};return function(t){(n={}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),n.s=draw.size(n.e),n.m=size.setMargin(t.margin),n.t=n.s.h-n.m.bottom,n.l=n.m.left||0,n.g=render.addGroup(n.e,n.t,n.l),n.sx=scale.get(t.xaxis,[n.m.left,n.s.w-n.m.right]),n.sy=scale.get(t.yaxis,[n.s.h-n.m.bottom,n.m.top]),n.sh=Math.abs(n.sy(1)-n.sy(0))/2,n.mfh=e(),render.rect({element:n.g.selectAll("#"+n.e.attr("id")+"_base"),data:[""],attr:{id:n.e.attr("id")+"_base",x:n.sx(util.minmax(t.xaxis).min)+5,y:.1*n.sh,width:n.s.w-n.m.right-n.m.left-5,height:.8*n.sh,rx:1,ry:1},style:{fill:"#DADFE1",stroke:"#CCCDCE","stroke-width":"5px"}}),render.rect({element:n.g.selectAll("#"+n.e.attr("id")+"_rect"),data:t.data,attr:{id:function(t){return n.e.attr("id")+"_rect"},x:function(e,i){return t.attr.x?t.attr.x.call(n,e,i):0},y:function(e,i){return t.attr.y?t.attr.y.call(n,e,i):0},width:function(e,i){return t.attr.width?t.attr.width.call(n,e,i):0},height:function(e,i){return t.attr.height?t.attr.height.call(n,e,i):0},rx:3,ry:3},style:{fill:function(e,i){return t.style.fill?t.style.fill.call(n,e,i):"#000000"},stroke:function(e,i){return t.style.stroke?t.style.stroke.call(n,e,i):"#FFFFFF"}}}),render.text({element:n.g.selectAll("#"+n.e.attr("id")+"_text"),data:t.data,attr:{id:function(t){return n.isText=!0,n.e.attr("id")+"_text"},x:function(e,i){return t.attr.x?t.attr.x.call(n,e,i):0},y:function(e,i){return t.attr.y?t.attr.y.call(n,e,i):0}},style:{fill:"#FFFFFF","font-size":n.mfh,"alignment-baseline":"middle"},text:function(e,i){return t.text?t.text.call(n,e,i):0}})}}(),needleNavi=function(t){"use strict";function e(t){util.loop(t,function(t,e){render.rect({element:n.g.selectAll("#"+n.e.attr("id")+"_"+t),data:[t],attr:{id:function(t){return n.e.attr("id")+"_"+t},x:"end"===t?n.end+n.m.left-5:n.start-5,y:.25*n.s.h,width:10,height:.4*n.s.h,rx:5,rx:5},style:{fill:"#A8A8A8",stroke:"#EAECED","stroke-width":"2px",cursor:"move"}})})}var n={start:0,end:0};return function(t){(n={}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),n.s=draw.size(n.e),n.m=size.setMargin(t.margin),n.t=n.m.top||0,n.l=n.m.left||0,n.g=render.addGroup(n.e,n.m.top,n.m.left),n.sx=scale.get(t.xaxis,[n.m.left,n.s.w-n.m.right]),n.sy=scale.get(t.yaxis,[n.s.h-n.m.bottom,n.m.top]),n.start=n.sx(util.minmax(t.xaxis).min),n.end=n.s.w-n.m.right-n.m.left,needle({element:n.e,lineData:t.data.needle,circleData:t.data.fullNeedle,attr:config.variants.needle.attr,style:t.style,margin:[5,30,10,60],xaxis:t.xaxis,yaxis:t.yaxis}),render.rect({element:n.g.selectAll("#"+n.e.attr("id")+"_navi"),data:[""],attr:{id:function(t){return n.e.attr("id")+"navi"},x:n.start,y:0,width:n.end,height:n.s.h-n.m.bottom,rx:3,ry:3},style:{fill:"rgba(255, 225, 50, 0.1)",stroke:"#FFDF6D"}}),e(["start","end"])}}(),network=function(){"use strict";return function(t){var e=[],n={},i="";t.data.map(function(t){if("compound"===t.type)i=t.members,e.push({group:"nodes",data:{id:"n0",bgcolor:t.bgcolor,bdcolor:t.bordercolor||"rgb(0, 0, 0)",width:100,height:150,isComp:!0,per:t.text},position:{}});else if("node"===t.type){var a={data:{id:i.indexOf(t.text)>-1?"n0:"+t.text:t.text,name:t.text,bgcolor:t.bgcolor,bdcolor:t.bordercolor||"rgb(0, 0, 0)",width:draw.getTextWidth(t.text,"14px Calibri"),height:20,fontSize:10,isComp:!1},group:"nodes"};n[t.text]={parent:i.indexOf(t.text)>-1?"n0:":""},i.indexOf(t.text)>-1&&(a.data.parent="n0"),e.push(a)}else if("edge"===t.type){var r="",o="",s="";for(var l in n)t.source.substring(0,l.length)===l&&(r=n[l].parent+l,s=t.source.substring(l.length,t.source.length),o=n[t.target.substring(0,t.target.indexOf(s))].parent+t.target.substring(0,t.target.indexOf(s)));e.push({data:{id:r+o,source:r,target:o,color:t.linecolor},group:"edges"})}}),cytoscape({container:document.querySelector(t.element),boxSelectionEnabled:!1,autoungrabify:!0,autounselectify:!0,pixelRatio:"auto",elements:e,style:cytoscape.stylesheet().selector("node").css({shape:"rectangle",width:"data(width)",height:"data(height)","font-size":"10",content:"data(name)","text-valign":"center","background-color":"data(bgcolor)","border-color":"data(bdcolor)","border-width":"1"}).selector(":parent").css({"background-color":"rgba(255, 255, 255, 0.5)","border-color":"rgb(150, 0, 0)","border-width":"1",content:"data(per)","font-size":"10","text-valign":"top"}).selector("edge").css({"curve-style":"bezier","target-arrow-shape":"triangle","target-arrow-color":"data(color)","arrow-scale":"1","line-color":"data(color)"}),layout:{name:"cose-bilkent",animate:!1}}).resize(550,10,10,10)}}(),preprocessing=function(t){"use strict";function e(t){util.loop(t,function(t,e){var n=0,i={key:t,value:[{x:parseFloat(t),y:n,value:0}]};J.axis.needle.y.push(n),util.loop(e,function(e,a){i.value.push({x:parseFloat(t),y:n+=a.length,value:a.length,info:a})}),J.axis.needle.y.push(n),J.needle.push(i)})}function n(t){var n={};util.loop(t,function(t,e){t.type=config.landscape.name(t.type);var i=t.position+" "+t.type+" "+t.aachange;n[t.position]?n[t.position][i]?n[t.position][i].push(t):n[t.position][i]=[t]:(n[t.position]={},n[t.position][i]=[t]),J.type.indexOf(t.type)<0&&J.type.push(t.type)}),e(n)}function i(){util.loop(J.needle,function(t,e){util.loop(t.value,function(e,n){e.info&&(e.value=e.y-t.value[n-1].y,J.fullNeedle.push(e))})})}function a(t){util.loop(t,function(t,e){J.graph.push({x:t.start,y:0,width:t.end-t.start,height:15,color:t.colour,info:t})})}function r(t){J.axis.needle.x=[0,t[0].length],J.axis.needle.y=J.axis.needle.y.length<1?[0,1]:[util.minmax(J.axis.needle.y).min,util.minmax(J.axis.needle.y).max]}function o(t){return/[\[][\w(\s|,)]+[\]]/.exec(t)[0].replace(/\[|\]/g,"").split(" ")}function s(t){return"rgb("+t.split(" ").join(",")+")"}function l(t){var e=[];return util.loop(t,function(t,n){var i={};util.loop(t.split("\t"),function(t,e){i[t.split(":")[0]]=t.split(":")[0].indexOf("color")<0?t.split(":")[1]:s(t.split(":")[1])}),e.push(i)}),e}function u(t){util.loop(t,function(t,e){X.network[t]=l(e)})}function c(t){var e={};util.loop(t.split("\n"),function(t,n){util.loop(X.geneset,function(n,i){t.indexOf(n.join(""))>-1&&(e[n.join(" ")]?e[n.join(" ")].push(t):e[n.join(" ")]=[t])})}),u(e)}function d(t){return X.type[t.join(" ")]=[]}function f(t,e,n,i,a,r,o){util.loop(e.split(""),function(e,s){a.push(""+s),r.push(""+s),util.loop(config.exclusivity.separate(e),function(e,a){e=config.exclusivity.name(e),n.push({x:s,y:t,value:e}),i.indexOf(e)<0?i.push(e):i=i}),o.idx="."!==e?o.idx>s?o.idx:s:o.idx})}function p(t,e,n){var i=d(e);util.loop(t,function(t,a){util.loop(e,function(a,r){if(t.indexOf(a)>-1){var o=e.join(" ");X.axis.heatmap.x[o]=[],X.axis.heatmap.y[o]=e,X.axis.division.x[o]=[],X.divisionIdx[o]={idx:0},f(a,t.substring(0,t.indexOf(" ")),n,i,X.axis.heatmap.x[o],X.axis.division.x[o],X.divisionIdx[o])}})})}function h(t){util.loop(t.split("\n\n"),function(t,e){if(""!==t){var n=o(t),i=t.split("\n"),a=i.splice(1,i.length);p(a,n,X.heatmap[n.join(" ")]=[]);X.survival.heat[n.join(" ")]=a,X.fullGeneset.concat(n),X.geneset.push(n)}})}function g(t){var e={};return util.loop(t,function(t,n){e[t.gene]=["."]}),e}function m(t,e){var n={};return util.loop(t,function(t,i){var a=config.landscape.name(t.type),r="Amplification"===a||"Homozygous_deletion"===a?"Amplification"===a?"A":"D":"M",o=util.cloneObject(e);n[t.participant_id]?"."===n[t.participant_id][t.gene][0]?n[t.participant_id][t.gene]=[r]:n[t.participant_id][t.gene].push(r):(o[t.gene]=[r],n[t.participant_id]=o)}),n}function x(t,e){var n=g(e),i=m(e,n);util.loop(t,function(t,e){t.gene=i[t.participant_id]?i[t.participant_id]:n}),X.survival.merge=t}function y(t){return t.indexOf("A")>-1&&t.indexOf("M")>-1?"B":t.indexOf("D")>-1&&t.indexOf("M")>-1?"E":t[0]}function v(t){var e={};util.loop(X.survival.heat,function(t,n){for(var i=X.axis.heatmap.x[t].length,a=t.split(" "),r=X.survival.data[t]?X.survival.data[t]:X.survival.data[t]=[],o=e[t]={},s=0;s<i;s++)X.survival.merge.some(function(t){for(var e=!0,i=0;i<a.length;i++)y(t.gene[a[i]])!==n[i][s]&&(e=!1);if(e&&void 0===o[t.participant_id])return o[t.participant_id]="",r[s]=t,void 0!==r[s]})})}function w(t){P.type[t]||(P.type[t]=null)}function _(t){t[P.keys.t]=K.name(t[P.keys.t])}function b(t,e,n,i,a){return"gene"===t?{x:e,y:n,value:i,info:a}:{x:n,y:e,value:i,info:a}}function F(t,e){var n=[];return util.loop(e,function(e,i){var a=0,r=0;util.loop(i,function(i,o){n.push(b(t,a,e,o,i)),a+=o,r+=o}),P.axis[t]["gene"===t?"x":"y"].push(r)}),n}function k(t,e,n){t[e]=t[e]?t[e]:{},t[e][n]=t[e][n]?t[e][n]+1:1}function A(t,e){t.push({x:e[P.keys.p],y:e[P.keys.g],value:e[P.keys.t]})}function S(t,e){util.loop(t,function(t,n){_(t),w(t[P.keys.t]),e(t,n)})}function C(t){S(t,function(t,e){k(P.stack.gene,t[P.keys.g],t[P.keys.t]),k(P.stack.sample,t[P.keys.p],t[P.keys.t]),A(P.heatmap,t),P.axis.sample.x.indexOf(t[P.keys.p])<0&&P.axis.sample.x.push(t[P.keys.p])})}function T(t){S(t,function(t,e){k(P.stack.patient,t[P.keys.p],t[P.keys.t]),A(P.patient,t),P.axis.patient.x.indexOf(t[P.keys.p])<0&&P.axis.patient.x.push(t[P.keys.p])})}function B(t){return Math.log(t)/Math.log(12)*-1}function E(t,e){var n=[];return util.loop(t,function(t,i){n.push({x:0,y:t[P.keys.g],value:B(t[e])})}),n}function D(t){util.loop(t,function(t,e){var n=[];util.loop(t.data,function(e,i){n.push({x:e[P.keys.p],y:t.name,value:e.value})}),P.group.group.push(n),P.axis.group.y.push([t.name]),P.group.patient.push({x:P.axis.patient.x[0],y:t.name,value:"NA"})})}function O(){P.axis.gene.x=[util.minmax(P.axis.gene.x).max,0],P.axis.sample.y=[util.minmax(P.axis.sample.y).max,0],P.axis.pq.x=[0,util.minmax(P.pq.map(function(t){return Math.ceil(t.value)})).max]}function G(){P.axis.pq.y=P.gene,P.axis.gene.y=P.gene,P.axis.heatmap.y=P.gene,P.axis.heatmap.x=P.axis.sample.x,P.axis.group.x=P.axis.sample.x}function z(t,e){var n={};return util.loop(e,function(e,i){t.indexOf(i)>-1?n.g=e:K.color(K.name(i))?n.t=e:n.p=e}),n}function M(t){return Math.log(t+1)/Math.LN2}function L(t){Y.axis.scatter.y={os:[],dfs:[]},util.loop(t,function(t){Y.axis.scatter.y.os.push(t.os_days/30),Y.axis.scatter.y.dfs.push(t.dfs_days/30)});var e=util.minmax(Y.axis.scatter.y.os),n=util.minmax(Y.axis.scatter.y.dfs);Y.axis.scatter.y.os=[e.min,e.max],Y.axis.scatter.y.dfs=[n.min,n.max]}function V(t){Y.axis.heatmap.x[t.participant_id]?Y.axis.heatmap.x[t.participant_id].push({key:t.hugo_symbol,value:t.tpm}):Y.axis.heatmap.x[t.participant_id]=[{key:t.hugo_symbol,value:t.tpm}]}function N(t){var e=util.minmax(t),n=util.median(t);Y.axis.gradient.x=[e.min,n,e.max],Y.axis.gradient.y=[""]}function q(t){util.loop(t,function(t,e){var n=0,i=0;util.loop(e,function(t){Y.axis.heatmap.y[t.key]="",n+=t.value}),i=n/e.length,Y.bar.push({x:t,value:i}),Y.func.avg.push(i)}),Y.func.avg.sort=Y.func.avg.sort(function(t,e){return t>e?1:-1});var e=util.minmax(Y.func.avg),n=util.median(Y.func.avg);Y.axis.bar.y=[e.min,n,e.max]}function j(t,e){return{average:q(e)}[t]}function W(t){var e=(new Array).concat(Y.func.avg),n=[];util.loop(t,function(t){n[e.indexOf(t.value)]=t.x}),Y.axis.heatmap.x=n}function H(t,e){return{average:W(e)}[t]}function I(t){var e=Y.func.now||Y.func.default;util.loop(t,function(t,e){t.tpm=M(t.tpm+1),V(t),Y.tpms.push(t.tpm),Y.heatmap.push({x:t.participant_id,y:t.hugo_symbol,value:t.tpm})}),N(Y.tpms),j(e,Y.axis.heatmap.x),H(e,Y.bar),Y.axis.heatmap.y=util.keyToArr(Y.axis.heatmap.y),Y.axis.scatter.x=Y.axis.heatmap.x,Y.axis.bar.x=Y.axis.heatmap.x}function R(t){var e={};return util.loop(t,function(t,n){e[t.subtype]?e[t.subtype].push(t.value):e[t.subtype]=[t.value]}),e}function $(t){var e=R(t);util.loop(e,function(t,e){Y.subtype.push({key:t,value:e})})}var U={expression:{func:{default:"average",now:null,avg:[]},tpms:[],heatmap:[],scatter:{},subtype:[],survival:{},bar:[],axis:{gradient:{x:{},y:{}},heatmap:{x:{},y:{}},scatter:{x:{},y:{}},bar:{x:{},y:{}}}},exclusivity:{heatmap:{},network:{},type:{},survival:{merge:{},heat:{},data:{}},geneset:[],fullGeneset:[],axis:{heatmap:{x:{},y:{}},division:{x:{},y:[]}},divisionIdx:{}},landscape:{keys:{},type:{},group:{group:[],patient:[]},heatmap:[],patient:[],stack:{gene:{},sample:{},patient:{}},axis:{pq:{x:[],y:[]},gene:{x:[],y:[]},group:{x:[],y:[]},sample:{x:[],y:[]},heatmap:{x:[],y:[]},patient:{x:[],y:[]}}},variants:{needle:[],fullNeedle:[],type:[],graph:[],axis:{needle:{x:[],y:[]}}}},P=U.landscape,X=U.exclusivity,Y=U.expression,J=U.variants,K=config.landscape;return t.variants=function(t){return n(t.variants.public_list),a(t.variants.graph),r(t.variants.graph),i(),J.patient=t.variants.patient_list.map(function(t,e){return t.type=config.landscape.name(t.type),t}),console.log("Preprocess of Variants: ",J),J},t.exclusivity=function(t){return x(t.survival.patient,t.survival.types),h(t.heatmap),c(t.network),v(t.heatmap),console.log("Preprocess of Exclusivity: ",X),X},t.landscape=function(t){return P.gene=t.gene,P.keys=z(P.gene,t.mutation.concat(t.patient)[0]),C(t.mutation),T(t.patient),D(t.group),P.type=util.keyToArr(P.type),P.pq=E(t.pq,t.pqValue||"p"),P.stack.gene=F("gene",P.stack.gene),P.stack.sample=F("sample",P.stack.sample),P.stack.patient=F("patient",P.stack.patient),O(),G(),console.log("Preprocess of Landscape: ",P),P},t.expression=function(t){return Y.allRna=(new Array).concat(t.cohort_rna_list.concat(t.sample_rna_list)),Y.genes=t.gene_list.map(function(t){return t.hugo_symbol}),Y.patient=t.sample_rna_list[0].participant_id,$(t.subtype_list),I(Y.allRna),L(t.patient_list),util.loop(Y.bar,function(t){t.y=Y.axis.bar.y[1]}),console.log("Preprocessing of Expression: ",Y),Y},t}(preprocessing||{}),render=function(t){"use strict";function e(t,e){for(var n in e)t.attr(n,e[n])}function n(t,e){for(var n in e)t.style(n,e[n])}function i(t,e){for(var n in e)t.on(n,e[n])}function a(t,e){t.text(e)}function r(t){if(!this.element)throw new Error("Not defined SVG Element");var r=this.data?this.element.data(this.data).enter().append(t):this.element.append(t);!!this.text&&a(r,this.text),e(r,this.attr),n(r,this.style),i(r,this.on)}return t.createSVG=function(t,e,n){var t=t.indexOf("#")<0?"#"+t:t,i=document.querySelector(t);return d3.select(t).append("svg").attr("id",t.replace("#","")+"_chart").attr("width",(e||parseFloat(i.style.width))+1).attr("height",n||parseFloat(i.style.height))},t.addGroup=function(t,e,n){return t=util.d3v4()?t:t[0][0],(t="Array"===util.varType(t)||"Object"===util.varType(t)?t:d3.select(t)).append("g").attr("class",t.attr("id")+" g-tag").attr("transform","translate("+n+", "+e+")")},t.rect=function(t){r.call(t,"rect")},t.circle=function(t){r.call(t,"circle")},t.text=function(t){r.call(t,"text")},t.line=function(t){var i=t.element.append("path");e(i,t.attr),n(i,t.style)},t.triangle=function(t){r.call(t,"polygon")},t.star=function(t){var e=(util.d3v4()?d3.symbol():d3.svg.symbol()).type(util.d3v4()?d3.symbolStar:"star"),a=t.element.append("path").attr("d",e.size(t.size));n(a,t.style),i(a,t.on)},t}(render||{}),scale=function(t){"use strict";function e(t,e){var n=[];if("number"==typeof e[0]&&"number"==typeof e[1]&&e.length<3){for(var a=Math.max(e[0],e[1]),r=Math.min(e[0],e[1]),o=a+r-r,s=r;s<=o;s++)n.push(s);return i.data.push(n),i.len.push(o),"ordinal"===t?n:[e[0],e[1]]}return i.data.push(e),i.len.push(e.length),e}function n(t){return"String"===util.varType(t[0])?"ordinal":"linear"}var i={data:[],len:[]};return t.ordinal=function(t,n){var i=e("ordinal",t);return d3.scaleBand?d3.scaleBand().domain(i).range(n):d3.scale.ordinal().domain(i).rangeBands(n)},t.linear=function(t,n){var i=e("linear",t);return d3.scaleLinear?d3.scaleLinear().domain(i).range(n):d3.scale.linear().domain(i).range(n)},t.getType=function(t){return"number"==typeof t[0]?"linear":"ordinal"},t.compatibleBand=function(t){return t.bandwidth?t.bandwidth():t.rangeBand()},t.getDomain=function(){return i.data.shift()},t.getDomainLength=function(){return i.len.shift()},t.getDistance=function(e){return"ordinal"===e?t.compatibleBand():t(1)-t(0)},t.get=function(e,i){return t[n(e)](e,i)},t}(scale||{}),scatter=function(t){"use strict";var e={};return function(t){(e={}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),e.m=size.setMargin(t.margin),e.d=t.data,e.w=e.e.attr("width"),e.h=e.e.attr("height"),e.t=t.top||e.m.top||0,e.l=t.left||e.m.left||0,e.f=t.fontSize||"10px",e.ss=t.shapeSize||5,e.sx=scale.get(t.xaxis,[e.m.left,e.w-e.m.right]),e.sy=scale.get(t.yaxis,[e.m.top,e.h-e.m.bottom]),e.g=render.addGroup(e.e,e.t,e.l);var n=e.e.attr("id");t.attr.r?render.circle({element:e.g.selectAll("#"+n+"_circle"),data:e.d,attr:{id:function(t){return n+"_circle"},cx:function(n,i){return t.attr.x?t.attr.x.call(e,n,i):0},cy:function(n,i){return t.attr.y?t.attr.y.call(e,n,i):0},r:function(n,i){return t.attr.r?t.attr.r.call(e,n,i):0}},style:{fill:function(e){return t.style.fill?t.style.fill(e):"#000000"},"fill-opacity":function(e){return t.style.fillOpacity?t.style.fillOpacity(e):"1"},stroke:function(e){return!!t.style.stroke&&t.style.stroke(e)}},on:{mouseover:function(n,i){return!!t.on.mouseover&&t.on.mouseover.call(e,n,i)}}}):t.attr.points?render.triangle({element:e.g.selectAll("#"+n+"_triangle"),data:e.d,attr:{id:function(t){return n+"_triangle"},points:function(n,i){return t.attr.points?t.attr.points.call(e,n,i):[0,0]}},style:{fill:function(e){return t.style.fill?t.style.fill(e):"#000000"},"fill-opacity":function(e){return t.style.fillOpacity?t.style.fillOpacity(e):"1"},stroke:function(e){return!!t.style.stroke&&t.style.stroke(e)},"stroke-width":function(e){return t.style.strokeWidth?t.style.strokeWidth(e):"1px"}},on:{mouseover:function(n,i){return!!t.on.mouseover&&t.on.mouseover.call(e,n,i)}}}):render.rect({element:e.g.selectAll("#"+n+"_rect"),data:e.d,attr:{id:function(t){return n+"_rect"},x:function(n,i){return t.attr.x?t.attr.x.call(e,n,i):0},y:function(n,i){return t.attr.y?t.attr.y.call(e,n,i):0},width:function(n,i){return t.attr.width?t.attr.width.call(e,n,i):5},height:function(n,i){return t.attr.height?t.attr.height.call(e,n,i):5}},style:{fill:function(e){return t.style.fill?t.style.fill(e):"#000000"},"fill-opacity":function(e){return t.style.fillOpacity?t.style.fillOpacity(e):"1"},stroke:function(e){return!!t.style.stroke&&t.style.stroke(e)}},on:{mouseover:function(n,i){return!!t.on.mouseover&&t.on.mouseover.call(e,n,i)}}}),t.text&&render.text({element:e.g.selectAll("#"+e.e.attr("id")+"_text"),data:e.d,attr:{id:function(t){return e.isText=!0,e.e.attr("id")+"_text"},x:function(n,i){return t.attr.x?t.attr.x.call(e,n,i):0},y:function(n,i){return t.attr.y?t.attr.y.call(e,n,i):0}},style:{"font-size":function(e){return t.style.fontSize?t.style.fontSize(e):"10px"},"font-family":function(e){return t.style.fontFamily?t.style.fontFamily(e):"Arial"},"alignment-baseline":function(e){return t.style.alignmentBaseline?t.style.alignmentBaseline:"middel"}},on:{mouseover:function(n,i){return!!t.on.mouseover&&t.on.mouseover.call(e,n,i)}},text:function(n,i){return t.text?t.text.call(e,n,i):"legend "+i}})}}(),selectBox=function(t){"use strict";function e(t){var e=document.createElement("div"),n=o.h-2*o.m.top<40?o.h-2*o.m.top:40;return e.className=t+" drop-menu",e.style.width=o.w-2*o.m.left+"px",e.style.height=n+"px",e.style.marginLeft=o.m.left+"px",e.style.marginTop=o.m.top+"px",e.style.fontSize=o.fontSize,e}function n(t,e){var n=document.createElement("div"),i=document.createElement("span"),a=document.createElement("i");return n.className=t+" select",n.style.paddingTop=10-o.m.top+1+"px",n.style.paddingBottom=10-o.m.top+1+"px",n.style.paddingLeft=10-o.m.left+1+"px",n.style.paddingRight=10-o.m.left+1+"px",i.innerHTML=e,a.className="fa fa-chevron-down",n.appendChild(i),n.appendChild(a),n}function i(t){var e=document.createElement("input");return e.type="hidden",e.name=t,e}function a(t){var e=document.createElement("ul");return e.className="dropeddown",util.loop(t,function(t){var n=document.createElement("li");n.id=t.toLowerCase(),n.title=t,n.innerHTML=draw.textOverflow(t,o.fontSize,.4*o.w),e.appendChild(n)}),e}function r(t,e){var n="."+t;$(n).click(function(t){$(this).attr("tabindex",1).focus(),$(this).toggleClass("active"),$(this).find(".dropeddown").slideToggle(300)}),$(n).focusout(function(){$(this).removeClass("active"),$(this).find(".dropeddown").slideUp(300)}),$(n+" .dropeddown li").click(function(t){return $(this).parents(".drop-menu").find("span").text($(this).text()),$(this).parents(".drop-menu").find("span").attr("title",$(this).attr("id")),$(this).parents(".drop-menu").find("input").attr("value",$(this).attr("id")),!!e&&e($(this).attr("id").toLowerCase())})}var o={};return function(t){(o={}).e=document.querySelector(t.element),o.m=size.setMargin(t.margin||[0,0,0,0]),o.w=t.width||parseFloat(o.e.style.width),o.h=t.height||parseFloat(o.e.style.height),o.className=t.className||"",o.initText=t.initText||"Select item",o.viewName=t.viewName||"select",o.fontSize=t.fontSize||"14px",o.items=t.items||[""],o.click=t.click||null,o.frame=e(o.className),o.initText=n(o.className,o.initText),o.viewer=i(o.viewName),o.setItemts=a(o.items),o.e.children.length<1&&(o.frame.appendChild(o.initText),o.frame.appendChild(o.viewer),o.frame.appendChild(o.setItemts),o.e.appendChild(o.frame),r(o.className,o.click))}}(),size=function(t){"use strict";function e(t){util.loop.call(this,t,function(t,e){var i=document.createElement("div");i.id=t,i.style.width=e.w+"px",i.style.height=e.h+"px",n.ids.push(t),this.appendChild(i)})}var n={ids:[]};return t.chart={},t.setMargin=function(t){if(!t.length)return{top:t,left:t,bottom:t,right:t};if("[object Object]"===Object.prototype.toString.call(t))return t;switch(t.length){case 1:return{top:t[0],left:t[0],bottom:t[0],right:t[0]};case 2:return{top:t[0],left:t[1],bottom:t[0],right:t[1]};case 3:return{top:t[0],left:t[1],bottom:t[2],right:t[1]};case 4:default:return{top:t[0],left:t[1],bottom:t[2],right:t[3]}}},t.setSize=function(t,e,n){return t.style.width=e+"px",t.style.height=n+"px",t},t.chart.exclusivity=function(i,a,r){var o={exclusivity_select_geneset:{w:.25*a,h:.1*r},exclusivity_upper_empty:{w:.34*a,h:.2*r},exclusivity_survival:{w:.4*a,h:r},exclusivity_network:{w:.25*a,h:.55*r},exclusivity_heatmap:{w:.35*a,h:.3*r},exclusivity_legend:{w:.35*a,h:.05*r},exclusivity_sample_legend:{w:.35*a,h:.05*r}};return e.call(t.setSize(i,a,r),o),n.ids},t.chart.landscape=function(i,a,r){var o={landscape_title:{w:a,h:.05*r},landscape_legend:{w:.15*a,h:r},landscape_axis_sample:{w:.15*a,h:.15*r},landscape_patient_sample:{w:.01*a,h:.15*r},landscape_sample:{w:.59*a,h:.15*r},landscape_scale_option:{w:.1*a,h:.15*r},landscape_axis_group:{w:.15*a,h:.2*r},landscape_patient_group:{w:.01*a,h:.2*r},landscape_group:{w:.59*a,h:.2*r},landscape_option:{w:.1*a,h:.2*r},landscape_gene:{w:.15*a,h:.65*r},landscape_patient_heatmap:{w:.01*a,h:.65*r},landscape_heatmap:{w:.59*a,h:.65*r},landscape_pq:{w:.1*a,h:.65*r}};return e.call(t.setSize(i,a,r),o),n.ids},t.chart.variants=function(i,a,r){var o={variants_title:{w:.95*a,h:.05*r},variants_needle:{w:.85*a,h:.85*r},variants_legend:{w:.15*a,h:.85*r},variants_navi:{w:.85*a,h:.1*r}};return e.call(t.setSize(i,a,r),o),n.ids},t.chart.expression=function(i,a,r){var o={expression_title:{w:a,h:.05*r},expression_survival:{w:.4*a,h:.95*r},expression_bar_plot:{w:.4*a,h:.4*r},expression_function:{w:.2*a,h:.05*r},expression_color_mapping:{w:.2*a,h:.05*r},expression_bar_legend:{w:.2*a,h:.3*r},expression_scatter_plot:{w:.4*a,h:.3*r},expression_scatter_empty:{w:.2*a,h:.2*r},expression_scatter_legend:{w:.2*a,h:.1*r},expression_heatmap:{w:.4*a,h:.24*r},expression_signature:{w:.2*a,h:.05*r},expression_color_gradient:{w:.2*a,h:.25*r}};return e.call(t.setSize(i,a,r),o),n.ids},t}(size||{}),survival=function(t){"use strict";function e(t){function e(t,e,n,i){var a={};a[t]={case_id:t,months:e,status:n},i.push(a)}var n={os:[],dfs:[]},i={os:[],dfs:[]},a={os:[],dfs:[]};return util.loop(t,function(t,r){if(t){var o=t.os_days/30,s=t.dfs_days/30;n.os.push(o),n.dfs.push(s),null!=o&&null!=t.os_status&&e(t.participant_id,o,t.os_status,i.os),null!=s&&null!=t.dfs_status&&e(t.participant_id,s,t.dfs_status,i.dfs),e(t.participant_id,o,t.os_status,a.os),e(t.participant_id,s,t.dfs_status,a.dfs)}}),{month:n,pure:i,all:a}}function n(t,e){var n=document.createElement("input");return n.id=t+"_survival",n.name="tabs",n.type="radio",n.checked=0===e,n}function i(t,e){var n=document.createElement("label");return n.htmlFor=t+"_survival",n.innerHTML=e,n}function a(t,e){var n=document.createElement("div");return n.id=t,n}function r(t,e){document.querySelector(t).innerHTML="";for(var r=document.querySelector(t),o=0,s=e.length;o<s;o++){var l=e[o],u=e[o].toLowerCase();r.appendChild(n(u,o)),r.appendChild(i(u,l))}for(var o=0,s=e.length;o<s;o++){var c=a(e[o].toLowerCase());c.appendChild(a(e[o].toLowerCase()+"_survival_curve")),c.appendChild(a(e[o].toLowerCase()+"_stat_table")),r.appendChild(c)}}var o={};return function(t){return o.survivalData=e(t.data),r(t.element,["OS","DFS"]),SurvivalTab.init(t.divisionData,o.survivalData.pure),o}}(),util=function(t){"use strict";return t.d3v4=function(){return 0!==d3.version.indexOf("3")},t.camelCase=function(t){return t.substring(0,1).toUpperCase()+t.substring(1).toLowerCase()},t.loop=function(e,n){if("Array"===t.varType(e))for(var i=0,a=e.length;i<a;i++)n.call(this,e[i],i);else if("Object"===t.varType(e))for(var r in e)n.call(this,r,e[r])},t.cloneObject=function(e){if(null===e||"object"!=typeof e)return e;var n=e.constructor();return t.loop(e,function(t,i){e.hasOwnProperty(t)&&(n[t]=e[t])}),n},t.varType=function(t){var e=Object.prototype.toString.call(t);return e.substring(e.indexOf(" ")+1,e.indexOf("]"))},t.keyToArr=function(e){var n=[];return t.loop(e,function(t,e){n.push(t)}),n},t.minmax=function(t,e){return arguments.length<2?{min:Math.min.apply(null,t),max:Math.max.apply(null,t)}:{min:Math.min.call(null,t,e),max:Math.max.call(null,t,e)}},t.median=function(e){return(new Array).concat(e).sort()[t.medIndex(e)]},t.medIndex=function(t){return t.length%2==1?(t.length+1)/2:t.length/2},t.removeWhiteSpace=function(t){return t.replace(/\s/gi,"")},String.prototype.replaceAt=function(t,e){return this.substr(0,t)+e+this.substr(t+e.length)},Array.prototype.fill=function(t,e){for(var n=0;n<t;n++)this.push(e);return this},t}(util||{}),variants=function(t){"use strict";function e(){p.div.title=document.querySelector("#variants_title"),p.div.title.innerHTML=p.origin.variants.title}function n(t,e,n){return["top"===t?e.attr("height")-n[0]:n[0],n[1]]}function i(){var t=["left","top"],e=(new Array).concat(p.data.axis.needle.y);layout.getSVG(p.svg,["needle"],function(i,a){util.loop(t,function(t,i){axis.element(a)[t]({margin:config.variants.axis[t].margin,position:n(t,a,config.variants.axis[t].margin),data:"left"===t?e.reverse():p.data.axis.needle.x,opt:{}})})})}function a(){layout.getSVG(p.svg,["needle"],function(t,e){needle({element:e,lineData:p.data.needle,circleData:p.data.fullNeedle,attr:config.variants.needle.attr,style:config.variants.needle.style,margin:config.variants.needle.margin,xaxis:p.data.axis.needle.x,yaxis:p.data.axis.needle.y})})}function r(){layout.getSVG(p.svg,["needle"],function(t,e){needleGraph({element:e,data:p.data.graph,attr:config.variants.needleGraph.attr,style:config.variants.needleGraph.style,margin:config.variants.needleGraph.margin,text:config.variants.needleGraph.text,xaxis:p.data.axis.needle.x,yaxis:p.data.axis.needle.y})})}function o(){layout.getSVG(p.svg,["navi"],function(t,e){needleNavi({element:e,data:p.data,margin:config.variants.navi.margin,style:config.variants.navi.style,xaxis:p.data.axis.needle.x,yaxis:p.data.axis.needle.y})})}function s(t){layout.getSVG(p.svg,["needle"],function(e,n){var i={},a=config.variants.patient.needle;i.m=size.setMargin(a.margin),i.s=draw.size(n),i.g=render.addGroup(n,i.s.h-i.m.bottom,i.m.left),i.s=scale.get(p.data.axis.needle.x,[i.m.left,i.s.w-i.m.right]),i.len=5,render.triangle({element:i.g.selectAll("#"+n.attr("id")+"_tri"),data:t,attr:{id:function(t,e){return n.attr("id")+"_tri"},points:function(t,e){return a.attr.points?a.attr.points.call(i,t,e):[0,0]}},style:{fill:function(t,e){return a.style.fill?a.style.fill.call(i,t,e):"#000000"},stroke:function(t,e){return a.style.stroke?a.style.stroke.call(i,t,e):"#FFFFFF"},"stroke-width":"3px"}})})}function l(t){layout.getSVG(p.svg,["legend"],function(e,n){var i=config.variants.patient.legend,a=size.setMargin(i.margin);render.addGroup(n,a.top,a.left);legend({element:n,data:t,attr:config.variants.patient.legend.attr,style:config.variants.patient.legend.style,text:config.variants.patient.legend.text,margin:config.variants.patient.legend.margin})})}function u(){s(p.data.patient),l(p.data.patient)}function c(){layout.getSVG(p.svg,["legend"],function(t,e){legend({element:e,data:p.data.type,priority:config.landscape.priority,text:config.variants.legend.text,attr:config.variants.legend.attr,style:config.variants.legend.style,margin:config.variants.legend.margin})})}function d(){i(),c(),a(),o(),r(),u()}function f(t){t.style.background="#F7F7F7"}var p={div:{}};return function(t){console.log("Given Variants data: ",t);var n=document.querySelector(t.element||null),i=parseFloat(t.width||n.style.width||1400),a=parseFloat(t.height||n.style.height||700);p.origin=t.data,p.data=preprocessing.variants(t.data),p.ids=size.chart.variants(n,i,a),p.svg=layout.variants(p.ids,p),f(n),e(),d()}}();