function needleRadius(t){return 3*Math.sqrt(t)/1.25}var axis=function(t){"use strict";function e(t,e){return d3.axisTop?i(t,e):n(t,e)}function n(t,e){return d3.svg.axis().scale(t).orient(e)}function i(t,e){return d3["axis"+util.camelCase(e)](t)}function a(e,n,i){return util.loop(n,function(n,a){e[n]&&e[n](t.option[n](i,a))}),e}function r(t,e){return e?t.selectAll(e).remove():t}var l={axies:{}};return t.element=function(e){return e="Object"===util.varType(e)?e:/\W/.test(e[0])?d3.select(e):d3.select("#"+e),l.current=e,t},t.option={tickValues:function(t,e){for(var n=util.minmax(t).max/(e-1),i=[],a=0;a<e-1;a++)i.push(a*n);return i.push(util.minmax(t).max),i}},t.top=function(t){var n=size.setMargin(t.margin),i=draw.size(l.current),o=t.position||[n.top,n.left],s=scale.get(t.data,[n.left,i.w-n.right]),c=render.addGroup(l.current,o[0],o[1]);return c.call(a(e(s,"top"),t.opt,t.data)),r(c,t.opt.remove),c},t.left=function(t){var n=size.setMargin(t.margin),i=draw.size(l.current),o=t.position||[n.top,i.w-n.right],s=scale.get(t.data,[n.top,i.h-n.bottom]),c=render.addGroup(l.current,o[0],o[1]);return c.call(a(e(s,"left"),t.opt,t.data)),r(c,t.opt.remove),c},t.bottom=function(t){var n=size.setMargin(t.margin),i=draw.size(l.current),o=t.position||[i.h-n.bottom,n.left],s=scale.get(t.data,[n.left,i.w-n.right]),c=render.addGroup(l.current,o[0],o[1]);return c.call(a(e(s,"bottom"),t.opt,t.data)),r(c,t.opt.remove),c},t.right=function(t){var n=size.setMargin(t.margin),i=draw.size(l.current),o=t.position||[n.top,n.left],s=scale.get(t.data,[n.top,i.h-n.bottom]),c=render.addGroup(l.current,o[0],o[1]);return c.call(a(e(s,"right"),t.opt,t.data)),r(c,t.opt.remove),c},t}(axis||{}),bar=function(t){"use strict";function e(t){var e=draw.size(a.e),n=[a.m.left,(a.w||e.w)-a.m.right],i=[a.m.top,(a.h||e.h)-a.m.bottom];return{x:"top"===t||"bottom"===t||"right"===t?n:n.reverse(),y:"left"===t||"right"===t||"bottom"===t?i:i.reverse()}}function n(t,n,i){return scale.get(n,e(t)[i])}function i(t){t.m=a.m,t.sx=a.sx,t.sy=a.sy,t.dx=this.xaxis,t.dy=this.yaxis}var a={};return function(t){return a={},a.e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),a.w=t.width||null,a.h=t.height||null,a.m=size.setMargin(t.margin),a.t=a.m.top||0,a.l=a.m.left||0,a.g=render.addGroup(a.e,a.t,a.l),a.sx=n(t.direction,t.xaxis,"x"),a.sy=n(t.direction,t.yaxis,"y"),render.rect({element:a.g.selectAll("#"+a.e.attr("id")+"_rect"),data:t.data,attr:{id:function(e){return i.call(t,e),a.e.attr("id")+"_rect"},x:function(e){return t.attr.x(e)},y:function(e){return t.attr.y(e)},width:function(e){return t.attr.width(e)},height:function(e){return t.attr.height(e)}},style:{fill:function(e){return t.style.fill(e)},stroke:function(e){return t.style.stroke(e)}}}),a}}(),config={exclusivity:{},landscape:{},variants:{}};config.landscape.name=function(t){return t=t.replace(/(_ins|_del)$/gi,"_indel"),t=t.substring(0,1).toUpperCase()+t.substring(1).toLowerCase()},config.landscape.case=function(t){switch(config.landscape.priority(config.landscape.name(t))){case 0:case 1:return"cnv";default:return"var"}},config.landscape.priority=function(t){return{Amplification:0,Homozygous_deletion:1,Nonsense_mutation:2,Splice_site:3,Translation_start_site:4,Missense_mutation:5,Start_codon_snp:5,Nonstop_mutation:6,Frame_shift_indel:7,Stop_codon_indel:7,In_frame_indel:8,Silent:9,Rna:10,Intron:11,"5'utr":11,"3'utr":11,Igr:11}[t]},config.landscape.color=function(t){return{Amplification:"#FFBDE0",Homozygous_deletion:"#BDE0FF",Nonsense_mutation:"#EA3B29",Splice_site:"#800080",Translation_start_site:"#AAA8AA",Missense_mutation:"#3E87C2",Start_codon_snp:"#3E87C2",Nonstop_mutation:"#070078",Frame_shift_indel:"#F68D3B",Stop_codon_indel:"F68D3B",In_frame_indel:"#F2EE7E",Silent:"#5CB755",Rna:"#FFDF97",Intron:"#A9A9A9","5'utr":"#A9A9A9","3'utr":"#A9A9A9",Igr:"#A9A9A9",dead:"#C50E36",alive:"#04CDA4",male:"#0F67B6",female:"E0A4E5",white:"#9CB1CE","black or african american":"#302F24",asian:"#CB771F","american indian or alaska native":"#38120B","hispanic or latino":"#B8642F","not hispanic or latino":"#55C53E","lung acinar adenocarcinoma":"#716190","lung adenocarcinoma mixed subtype":"#5154DE","lung adenocarcinoma- not otherwise specified (nos)":"#8E9A7E","lung bronchioloalveolar carcinoma mucinous":"#2F91DE","lung bronchioloalveolar carcinoma nonmucinous":"#ED6EBD","lung clear cell adenocarcinoma":"#1C8D7A","lung micropapillary adenocarcinoma":"#B2EE86","lung mucinous adenocarcinoma":"#785E54","lung papillary adenocarcinoma":"#69B4C4","lung signet ring adenocarcinoma":"#C1386E","lung solid pattern predominant adenocarcinoma":"#D7A355","mucinous (colloid) carcinoma":"#243833",bronchial:"#F9E3B9","l-lower":"#FBA2A3","l-upper":"#0CA3C7","other (please specify)":"#D3A16C","r-lower":"#388A4E","r-middle":"#D61E43","r-upper":"#B81BCC",no:"#D73A64",yes:"#1990AA","yes, history of prior malignancy":"#3BDB11","yes, history of synchronous/bilateral malignancy":"#803F11",no:"#D73A64",yes:"#1990AA",no:"#D73A64",yes:"#1990AA",t1:"#060CDB",t1a:"#696DE9",t1b:"#CDCEF7",t2:"#F6251D",t2a:"#F96D69",t2b:"#FDCECD",t3:"#1AEB42",t4:"#EBBD34",tx:"#9943DE",n0:"#DC5B35",n1:"#217C1F",n2:"#18A6F3",n3:"#EA68C3",nx:"#F4E831",m0:"#F0820D",m1:"#C45A43",m1a:"#A523C2",m1b:"#C97BDA",mx:"#EDD3F2","stage i":"#01C606","stage ia":"#018404","stage ib":"#002C01","stage ii":"#0E22C3","stage iia":"#08136C","stage iib":"#040B41","stage iiia":"#BB0C2E","stage iiib":"#75081D","stage iv":"#F0CA53",r0:"#DB8EC0",r1:"#FFD046",r2:"#495C50",rx:"#0E5F8A","exon 19 deletion":"#4A312A",l858r:"#74C04C",l861q:"#FBED09",other:"#C91DAB",t790m:"#2C517B",g12a:"#DED0D1",g12c:"#AE8A8E",g12d:"#5D161D",g12s:"#410F14",g12v:"#25080B",other:"#C91DAB","complete remission/response":"#BDED73","partial remission/response":"#8649F3","progressive disease":"#C1746B","stable disease":"#CD4C2A","complete remission/response":"#BDED73","partial remission/response":"#8649F3","progressive disease":"#C1746B","stable disease":"#CD4C2A","Lifelong Non-Smoker":"#C4B5BB","Current Smoker":"#896C78","Current Reformed Smoker for > 15 yrs":"#3B0A1E","Current Reformed Smoker for < or = 15 yrs":"#2F0818","Current Reformed Smoker, Duration Not Specified":"#17040C",NA:"#D6E2E3"}[t]},config.landscape.sample={attr:{x:function(t){return t.x.indexOf("-")>-1?t.sx(t.x):t.sx(t.x)+3},y:function(t){return t.sy(util.minmax(t.dy).max)-t.sy(t.y+t.value)+t.sy(util.minmax(t.dy).min)},width:function(t){return t.x.indexOf("-")>-1?scale.compatibleBand(t.sx):scale.compatibleBand(t.sx)-7.5},height:function(t){return t.sy(t.value)-t.sy(util.minmax(t.dy).min)}},style:{fill:function(t){return config.landscape.color(t.info)},stroke:function(t){return"#FFFFFF"}}},config.landscape.gene={attr:{x:function(t){return t.sx(util.minmax(t.dx).max)-t.sx(t.x+t.value)},y:function(t){return t.sy(t.y)},width:function(t){return t.sx(t.value)},height:function(t){return scale.compatibleBand(t.sy)}},style:{fill:function(t){return config.landscape.color(t.info)},stroke:function(t){return"#FFFFFF"}}},config.landscape.pq={attr:{x:function(t){return t.sx(util.minmax(t.dx).min)},y:function(t){return t.sy(t.y)},width:function(t){return t.sx(t.value)},height:function(t){return scale.compatibleBand(t.sy)}},style:{fill:function(t){return"#BFBFBF"},stroke:function(t){return"#FFFFFF"}}},config.landscape.heatmap={attr:{x:function(t){return this.sx(t.x)},y:function(t){return"cnv"!==config.landscape.case(t.value)?scale.compatibleBand(this.sy)/3+this.sy(t.y):this.sy(t.y)},width:function(t){return scale.compatibleBand(this.sx)},height:function(t){return"cnv"!==config.landscape.case(t.value)?scale.compatibleBand(this.sy)/3:scale.compatibleBand(this.sy)}},style:{fill:function(t){return config.landscape.color(t.value)},stroke:function(t){return"#FFFFFF"}}},config.landscape.group={attr:{x:function(t){return this.sx(t.x)},y:function(t){return this.sy(t.y)},width:function(t){return scale.compatibleBand(this.sx)},height:function(t){return scale.compatibleBand(this.sy)}},style:{fill:function(t){return config.landscape.color(t.value)},stroke:function(t){return"#FFFFFF"}}},config.landscape.legend={attr:{x:function(t,e){var n="h"===this.dr?(2*this.p+this.mw)*e:0;return this.isText?n+2*this.p:n},y:function(t,e){var n=this.height||15,i="h"===this.dr?0:(this.p+this.mh)*e;return this.isText?i+this.mh-this.mh/2+this.p/2:config.landscape.case(t)&&"var"===config.landscape.case(t)?i+n/3:i},width:function(t,e){return this.width||5},height:function(t,e){var n=this.height||15;return config.landscape.case(t)&&"var"===config.landscape.case(t)?n/3:n}},style:{fill:function(t){return config.landscape.color(t)},stroke:function(t){return"#FFFFFF"},fontFamily:function(t){return"Times Roman"},fontSize:function(t){return"12px"}},text:function(t){return t}},config.landscape.axis={sample:{direction:"left",margin:[5,0,10,5],opt:{tickValues:3}},group:{direction:"right",margin:[0,0,0,0],opt:{remove:"line, path"}},gene:[{direction:"right",margin:[5,150,40,0],opt:{remove:"line, path"}},{direction:"bottom",margin:[0,10,35,71],opt:{tickValues:3}}],pq:{direction:"bottom",margin:[0,10,35,20],opt:{tickValues:3}}},config.landscape.bar={pq:{direction:"right",margin:[5,10,41,30],xaxis:function(){return this.pq.x},yaxis:function(){return this.pq.y},attr:config.landscape.pq.attr,style:config.landscape.pq.style}},config.landscape.stack={patient:{direction:"top",margin:[5,0,10,0],xaxis:function(){return this.patient.x},yaxis:function(){return this.sample.y},attr:config.landscape.sample.attr,style:config.landscape.sample.style},sample:{direction:"top",margin:[5,1,10,1],xaxis:function(){return this.sample.x},yaxis:function(){return this.sample.y},attr:config.landscape.sample.attr,style:config.landscape.sample.style},gene:{direction:"left",margin:[5,10,41,70],xaxis:function(){return this.gene.x},yaxis:function(){return this.gene.y},attr:config.landscape.gene.attr,style:config.landscape.gene.style}},config.landscape.heatmap={heatmap:{direction:"left",margin:[5,1,41,1],opt:{},xaxis:function(){return this.sample.x},yaxis:function(){return this.gene.y},attr:config.landscape.heatmap.attr,style:config.landscape.heatmap.style},patient:{direction:"left",margin:[5,1,41,3.5],opt:{},xaxis:function(){return this.patient.x},yaxis:function(){return this.gene.y},attr:config.landscape.heatmap.attr,style:config.landscape.heatmap.style}},config.landscape.group={group:{direction:"left",margin:[2,1,4,1],opt:{},xaxis:function(){return this.sample.x},attr:config.landscape.group.attr,style:config.landscape.group.style},patient:{direction:"left",margin:[2,1,4,4],opt:{},xaxis:function(){return this.patient.x},attr:config.landscape.group.attr,style:config.landscape.group.style}},config.exclusivity.separate=function(t){return"B"===t?["A","M"]:"E"===t?["D","M"]:"M"===t?[".","M"]:[t]},config.exclusivity.name=function(t){return{A:"Amplification",D:"Deletion",M:"Mutation",".":"None"}[t]},config.exclusivity.priority=function(t){return{Amplification:0,Deletion:1,Mutation:2,None:3}[t]},config.exclusivity.color=function(t){return{Amplification:"#FFBDE0",Deletion:"#BDE0FF",Mutation:"#5CB755",None:"#D3D3D3"}[t]},config.exclusivity.legend={margin:[30,80,0,0],attr:{x:function(t,e){var n="h"===this.dr?(10*this.p+this.mw)*e:0;return this.isText?n+2*this.p:n},y:function(t,e){var n=this.height||15,i="h"===this.dr?0:(this.p+this.mh)*e;return this.isText?i+this.mh-this.mh/2+this.p/2:"Mutation"===t?i+n/3:i},width:function(t,e){return this.width||5},height:function(t,e){var n=this.height||15;return"Mutation"===t?n/3:n}},style:{fill:function(t){return config.exclusivity.color(t)},fontSize:function(t){return"12px"},fontFamily:function(t){return"Times Roman"}},text:function(t){return t}},config.exclusivity.heatmap={margin:[35,40,35,50],attr:{x:function(t){return this.sx(t.x)},y:function(t){return"Mutation"===t.value?this.sy(t.y)+scale.compatibleBand(this.sy)/3:this.sy(t.y)},width:function(t){return scale.compatibleBand(this.sx)},height:function(t){return"Mutation"===t.value?scale.compatibleBand(this.sy)/3:scale.compatibleBand(this.sy)}},style:{fill:function(t){return config.exclusivity.color(t.value)},stroke:function(t){return"#FFFFFF"}}},config.exclusivity.division={margin:[11,40,0,48],dashed:"4, 5",attr:{x:function(t){return this.sx?this.sx(t.value):0},y:function(t){return this.sy?this.sy(t.value):0},width:function(t){return"h"===this.direction?t.size:this.w},height:function(t){return"h"!==this.direction?t.size:this.h}},style:{fill:function(t,e){return t.color},stroke:function(t,e){return"#FFFFFF"}}},config.variants.legend={margin:[20,20,0,0],attr:{x:function(t,e){var n="h"===this.dr?(10*this.p+this.mw)*e:this.isText?this.p:0;return this.isText?n+2*this.p:n},y:function(t,e){var n=this.height||5;return this.isText?this.mh*e+.7*n:this.mh*e},r:function(t){return 5}},style:{fontSize:function(t){return"12px"},fill:function(t){return config.landscape.color(t)}},text:function(t){return t}},config.variants.needle={margin:[20,30,100,60],attr:{x:function(t,e){return this.sx(t.x)},y:function(t,e){return this.sy(t.y)},r:function(t,e){return t.value?needleRadius(t.value):this.radius}},style:{fill:function(t){return!!t.info&&config.landscape.color(t.info[0].type)},stroke:function(t){return"#FFFFFF"}}},config.variants.needleGraph={margin:[0,30,80,60],attr:{x:function(t,e){return this.isText?this.sx(t.x)+5:this.sx(t.x)},y:function(t,e){return this.isText?this.sh/2:0},width:function(t,e){return this.sx(t.width)},height:function(t,e){return this.sh}},style:{fill:function(t){return t.color},stroke:function(t){return"#FFFFFF"}},text:function(t){return t.info.identifier}},config.variants.axis={left:{margin:[20,60,100,0]},top:{margin:[2,30,0,60]}},config.variants.navi={margin:[0,30,5,60],style:{fill:function(t){var e=!!t.info&&d3.rgb(config.landscape.color(t.info[0].type));return this.g.selectAll("path").style("stroke","rgba(0, 0, 0, 0.1)"),!!e&&(e.opacity=.3,e)}}};var divisionLine=function(t){"use strict";function e(){return{first:i[i.sw](i.point)-i[i.sw](i.a[0]),last:i[i.sw](i.a[i.a.length-1])-i[i.sw](i.point)}}function n(t,e){for(var n=1,t=t/3;draw.getTextHeight(n+"px").height<t;)n+=1;return n+"px"}var i={};return function(t){(i={}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),i.m=size.setMargin(t.margin),i.s=draw.size(i.e),i.t=i.m.top||0,i.l=i.m.left||0,i.direction=t.direction||"h",i.point=t.point||0,i.a=t.axis,i.sw="s"+("h"===i.direction?"x":"y"),i[i.sw]=scale.get(t.axis,"h"===i.direction?[i.m.left,i.s.w-i.m.right]:[i.m.top,i.s.h-i.m.bottom]),i.g=render.addGroup(i.e,i.t,i.l),i.lg=render.addGroup(i.e,i.t,i.l),i.h=t.height||30,i.w=t.width||30,i.th=n(i.h),i.line=(util.d3v4()?d3.line():d3.svg.line()).x(function(t){return t.x}).y(function(t){return t.y});var a=e();render.rect({element:i.g.selectAll("#"+i.e.attr("id")+"_div"),data:[{value:t.axis[0],color:t.color[0],size:a.first},{value:t.point,color:t.color[1],size:a.last}],attr:{id:function(t){return i.e.attr("id")+"_div"},x:function(e){return t.attr.x?t.attr.x.call(i,e):0},y:function(e){return t.attr.y?t.attr.y.call(i,e):0},width:function(e){return t.attr.width?t.attr.width.call(i,e):i.w},height:function(e){return t.attr.height?t.attr.height.call(i,e):i.h},rx:5,ry:5},style:{fill:function(e,n){return t.style.fill?t.style.fill.call(i,e,n):"#000000"},stroke:function(e,n){return t.style.stroke?t.style.stroke.call(i,e,n):"#FFFFFF"}}}),render.text({element:i.g.selectAll("#"+i.e.attr("id")+"_text"),data:[{text:t.text[0]},{text:t.text[1]}],attr:{id:i.e.attr("id")+"_text",x:function(t,e){return 0===e?i[i.sw](i.a[0])+5:i[i.sw](i.a[i.a.length-1])-5},y:function(t,e){return i.h-.25*i.h}},style:{fill:"#F1F1F1","text-anchor":function(t,e){return 0===e?"start":"end"},"alignment-baseline":"middle","font-size":i.th,"font-weight":"bold","text-shadow":"1px 1px rgba(0, 0, 0, 0.5)"},text:function(t){return t.text}}),render.line({element:i.lg,attr:{id:function(t){return i.e.attr("id")+"_line"},d:i.line([{x:i[i.sw](i.point),y:i.h},{x:i[i.sw](i.point),y:i.s.h}]),"stroke-dasharray":t.dashed||"0","stroke-width":.8},style:{stroke:"#000000"}})}}(),draw=function(t){"use strict";return t.ctx=null,t.clearCanvas=function(t){t.children.length>0&&t.removeChild(t.firstChild)},t.width=function(t){return"string"==typeof t?parseFloat(document.querySelector(t)):parseFloat(t.style.width)},t.height=function(t){return"string"==typeof t?parseFloat(document.querySelector(t)):parseFloat(t.style.height)},t.getTextWidth=function(t,e){var n=document.createElement("canvas"),i=n.getContext("2d"),a=0;return n.id="get-text-width",i.font=(e||"10px")+"arial",document.body.appendChild(n),a=i.measureText(t).width,document.body.removeChild(document.getElementById("get-text-width")),a},t.getTextHeight=function(t,e){var n=document.createElement("span"),i=document.createElement("div"),a=document.createElement("div");a.id="get_text_height",n.style.fontSize=t||"10px",n.style.fontStyle=e||"Arial",n.innerHTML="Hg",i.style.display="inline-block",i.style.width="1px",i.style.height="0px",a.appendChild(n),a.appendChild(i),document.querySelector("body").appendChild(a);try{var r={};i.style.verticalAlign="baseline",r.ascent=i.offsetTop-n.offsetTop,i.style.verticalAlign="bottom",r.height=i.offsetTop-n.offsetTop,r.descent=r.height-r.ascent}finally{a.parentNode.removeChild(document.getElementById("get_text_height"))}return r},t.randomDraw=function(t,e){return Math.floor(Math.random()*t)+(e||0)},t.getDegree=function(t,e,n,i){var a=n-t,r=i-e,l=Math.atan2(a,r);return{radian:l,degree:Math.floor(180*l/Math.PI)}},t.noOverlap=function(e,n,i){for(var a=n.filter(function(t){return"node"===t.type}),r=n.filter(function(t){return"edge"===t.type}),l=0,o=a.length;l<o;l++){var s=a[l];s.textWidth=t.getTextWidth(e,"14px Calibri",s.text),s.width=s.width||1.2*s.textWidth,s.height=s.height||24,s.radius=5,i&&(s.top=i.members.indexOf(s.text)>-1?t.randomDraw(i.top+s.height/2,.7*i.height-s.height/2):(i.top-0)/2-s.height/2,s.left=t.randomDraw(i.left+i.width-i.left-s.width,i.left)),r.forEach(function(t){t.source=t.source.substring(0,s.text.length)===s.text?s.text:t.source,t.target=t.target.substring(0,s.text.length)===s.text?s.text:t.target,t.id=t.id.substring(0,t.source.length+t.target.length)})}return n},t.size=function(t){return t=util.d3v4()?t:t[0][0],t="Array"===util.varType(t)||"Object"===util.varType(t)?t:d3.select(t),{w:parseFloat(t.attr("width")),h:parseFloat(t.attr("height"))}},t}(draw||{}),eventHandler=function(t){"use strict";function e(t){function e(e){t({x:e.pageX-n.ctx.canvas.offsetLeft,y:e.pageY-n.ctx.canvas.offsetTop})}if(!n.ctx)throw new Error("Not found context of canvas.");n.ctx.canvas.removeEventListener("mousemove",e),n.ctx.canvas.addEventListener("mousemove",e)}var n={};return t.context=function(e){return n.ctx=e,arguments.length?t:n.ctx},t.data=function(e){return n.data=e,arguments.length?t:n.data},t.hover=function(t){e(function(t){})},t.onScroll=function(t,e){(t="object"==typeof t?t:document.querySelector(t)).addEventListener("scroll",e)},t}(eventHandler||{}),exclusive=function(){"use strict";function t(){var t={};return util.loop(s.data.survival.data[s.nowSet],function(e,n){e&&(n<=s.data.divisionIdx[s.nowSet].idx?t[e.participant_id]="altered":t[e.participant_id]="unaltered")}),t}function e(){var e=document.querySelector("#exclusivity_survival"),n=parseFloat(e.style.width),i=parseFloat(e.style.height)/1.5;SurvivalCurveBroilerPlate.settings={canvas_width:n,canvas_height:i,chart_width:n-30,chart_height:i-30,chart_left:50,chart_top:15,include_info_table:!1,include_legend:!0,include_pvalue:!0,pval_x:n-200,pval_y:42},SurvivalCurveBroilerPlate.style={censored_sign_size:5,axis_stroke_width:1,axisX_title_pos_x:n/2,axisX_title_pos_y:i-25,axisY_title_pos_x:-n/2+25,axisY_title_pos_y:10,axis_color:"black",pval_font_size:14,pval_font_style:"normal"},survival({element:"#exclusivity_survival",margin:[20,20,20,20],data:s.data.survival.data[s.nowSet],divisionData:t()})}function n(){network({data:s.data.network[s.nowSet],element:"#exclusivity_network"})}function i(){layout.getSVG(s.svg,["heatmap"],function(t,e){axis.element(e).left({margin:[35,0,35,e.attr("width")-80],data:s.nowSet.split(" "),opt:{remove:"line, path"}}).attr("id","exclusivity_heatmap_axis")})}function a(){layout.getSVG(s.svg,["heatmap"],function(t,e){heatmap({element:e,data:s.data.heatmap[s.nowSet],opt:config.exclusivity.heatmap.opt,attr:config.exclusivity.heatmap.attr,style:config.exclusivity.heatmap.style,margin:config.exclusivity.heatmap.margin,xaxis:s.data.axis.heatmap.x[s.nowSet],yaxis:s.data.axis.heatmap.y[s.nowSet]})})}function r(){layout.getSVG(s.svg,["heatmap"],function(t,e){divisionLine({element:e,height:45,direction:"h",color:["#FF6252","#00AC52"],attr:config.exclusivity.division.attr,style:config.exclusivity.division.style,text:["Altered group","Unaltered group"],margin:config.exclusivity.division.margin,axis:s.data.axis.heatmap.x[s.nowSet],point:""+s.data.divisionIdx[s.nowSet].idx,dashed:config.exclusivity.division.dashed})})}function l(){layout.getSVG(s.svg,["legend"],function(t,e){legend({element:e,data:s.data.type[s.nowSet],priority:config.exclusivity.priority,text:config.exclusivity.legend.text,attr:config.exclusivity.legend.attr,style:config.exclusivity.legend.style,margin:config.exclusivity.legend.margin})})}function o(){e(),n(),i(),a(),r(),l()}var s={};return function(t){console.log("Given Exclusivity data: ",t);var e=document.querySelector(t.element||null),n=parseFloat(t.width||e.style.width||1400),i=parseFloat(t.height||e.style.height||700);e.style.background="#F7F7F7",s.origin=t.data,s.data=preprocessing.exclusivity(t.data),s.ids=size.chart.exclusivity(e,n,i),s.svg=layout.exclusivity(s.ids,s),s.nowSet=selectGeneSet.set({element:"#exclusivity_select_geneset",data:s.data.geneset,change:function(t){s.nowSet=this.value,layout.removeG(),o()}}),o(),console.log("Exclusivity Model data: ",s)}}(),force=function(t){return t.setConstant=function(e){return t.constant=e||50,model},t.getConstant=function(){return t.constant||50},t.getKvalue=function(e,n){var i=t.getConstant();return Math.sqrt(e*n)/i},t.aForce=function(t,e){return e*e/t},t.rForce=function(t,e){return t*t/e},t}(force||{}),heatmap=function(t){"use strict";function e(t){util.loop(t,function(t,e){util.loop(i.mt,function(t,n){e[t][0]&&i.d.push({x:e.x,y:e.y,value:e[t][0]})})})}function n(t){return util.loopArr(t,function(t,e){var n=t.x+t.y,a=config.landscape.case(t.value);i.v[n]?config.landscape.priority(i.v[n][a][0])>config.landscape.priority(t.value)?i.v[n][a].unshift(t.value):i.v[n][a].push(t.value):(i.v[n]={cnv:[],var:[],x:t.x,y:t.y},i.v[n][a].push(t.value))}),e(i.v)}var i={mt:["cnv","var"],v:{},d:[]};return function(t){return i.e={},i.e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),i.s=draw.size(i.e),i.m=size.setMargin(t.margin),i.t=i.m.top||0,i.l=i.m.left||0,i.g=render.addGroup(i.e,i.t,i.l),i.sx=scale.get(t.xaxis,[i.m.left,(t.width||i.s.w)-i.m.right]),i.sy=scale.get(t.yaxis,[i.m.top,(t.height||i.s.h)-i.m.bottom]),render.rect({element:i.g.selectAll("#"+i.e.attr("id")+"_rect"),data:t.dup?(n(t.data),i.d):t.data,attr:{id:function(t){return i.e.attr("id")+"_rect"},x:function(e){return t.attr.x.call(i,e)},y:function(e){return t.attr.y.call(i,e)},width:function(e){return t.attr.width.call(i,e)},height:function(e){return t.attr.height.call(i,e)}},style:{fill:function(e){return t.style.fill(e)},stroke:function(e){return t.style.stroke(e)}}}),i}}(),landscape=function(t){"use strict";function e(){b.div.title=document.querySelector("#landscape_title"),b.div.title.innerHTML=b.origin.title}function n(t,e,n){var i=document.createElement("div");b.ids.push((i.id=t.id+"_"+e,i.id)),util.loop(n,function(t,e){i.style[t]=e}),t.appendChild(i)}function i(t){var e={_patient:document.getElementById("landscape_patient_group"),_axis:document.getElementById("landscape_axis_group"),_chart:document.getElementById("landscape_group")};util.loop(e,function(e,i){util.loop(t,function(a,r){n(i,util.removeWhiteSpace(a[0])+e,{width:draw.width(i)+"px",height:draw.height(i)/t.length+"px",overflowX:"hidden",overflowY:"hidden"})})})}function a(t,e,n,i){var a=!1;util.loop(t.split("_"),function(t,r){config.landscape[e][t]&&(a||(a=!0,i(config.landscape[e][t],n[t])))})}function r(t,e){return a(t,"axis",b.data.axis,e)}function l(t,e){return a(t,"bar",b.data,e)}function o(t,e){return a(t,"stack",b.data.stack,e)}function s(t,e){return a(t,"group",b.data.group,e)}function c(t,e){var n;return t.indexOf("group")<0?e:(t.split("_").forEach(function(t){util.loop(e,function(e,i){t===e[0].replace(/\s/gi,"")&&(n=e)})}),n)}function u(t,e){var n;return util.loop(e,function(e,i){var a=(e.y||e[0].y).replace(/\s/gi,"");t.indexOf(a)>-1&&(n="Array"===util.varType(e)?e:[e])}),n}function d(){layout.getSVG(b.svg,["axis_sample","gene","pq","axis_group_"],function(t,e){r(t,function(t,n){t="Array"!==util.varType(t)?[t]:t,util.loop(t,function(t,i){axis.element(e)[t.direction]({margin:t.margin,data:c(e.attr("id"),"top"===t.direction||"bottom"===t.direction?n.x:n.y),opt:t.opt})})})})}function p(t,e,n,i){bar({data:e,opt:t.opt,element:n,attr:t.attr,style:t.style,margin:t.margin,direction:t.direction,width:i.indexOf("patient")<0&&i.indexOf("sample")>-1?b.nowWidth||b.initWidth:null,xaxis:t.xaxis.call(b.data.axis),yaxis:t.yaxis.call(b.data.axis)})}function f(){layout.getSVG(b.svg,["pq"],function(t,e){l(t,function(n,i){p(n,i,e,t)})})}function h(){layout.getSVG(b.svg,["e_sample","patient_sample","gene"],function(t,e){o(t,function(n,i){p(n,i,e,t)})})}function g(){layout.getSVG(b.svg,["t_group_","e_group_"],function(t,e){s(t,function(n,i){heatmap({element:e,opt:n.opt,attr:n.attr,style:n.style,margin:n.margin,data:u(t,i),width:t.indexOf("patient")<0?b.nowWidth||b.initWidth:null,xaxis:n.xaxis.call(b.data.axis),yaxis:b.data.axis.group.y.filter(function(e,n){if(t.indexOf(e[0].replace(/\s/gi,""))>-1)return e})[0]})})})}function m(){layout.getSVG(b.svg,["legend"],function(t,e){legend({element:e,data:b.data.type,priority:config.landscape.priority,text:config.landscape.legend.text,attr:config.landscape.legend.attr,style:config.landscape.legend.style,margin:[e.attr("height")/3,20,0,0]})})}function y(){b.initWidth=2*draw.width(d3.select("#landscape_heatmap").node()),b.initHeight=draw.height(d3.select("#landscape_heatmap").node())}function x(){scaleOption.set({element:"#landscape_option",default:100,defaultValue:b.initWidth,interval:10,unit:"%",btn:[{id:"upscale",className:"upscale"},{id:"downscale",className:"downscale"},{id:"initialize",className:"initialize"}],input:{id:"viewscale",className:"viewscale"},change:function(t,e){layout.removeG(),_(b.data,(b.nowWidth=e,b.nowWidth))}})}function v(){sortOption.set({element:"#landscape_option",subject:["Mutation","Value","Sample"],itemClick:function(t){console.log("dd")}})}function w(t){layout.getSVG(b.svg,["e_group_","e_sample","e_heatmap"],function(e,n){n.attr("width",t||b.nowWidth||b.initWidth)})}function _(t,e){w(e),d(),h(),f(),g(),m()}var b={div:{}};return function(t){console.log("Given Landscape data: ",t);var n=document.querySelector(t.element||null),a=parseFloat(t.width||n.style.width||1400),r=parseFloat(t.height||n.style.height||700);b.origin=t.data,b.data=preprocessing.landscape(t.data),b.ids=size.chart.landscape(n,a,r),y(),e(),x(),v(),i(b.data.axis.group.y),b.svg=layout.landscape(b.ids,b),_(b.data,b.initWidth),console.log("Landscape Model data: ",b),eventHandler.onScroll("#landscape_heatmap",function(t){var e=document.querySelector("#landscape_sample"),n=document.querySelector("#landscape_group").children,i=this;e.scrollLeft=i.scrollLeft,util.loop(n,function(t,e){t.scrollLeft=i.scrollLeft})})}}(),layout=function(t){"use strict";function e(t,e,i){return util.loop(i,function(i,a){var r=!0;util.loop(t,function(t,e){i.indexOf(t)>-1&&(r=!r)}),r&&(n[e][i]=render.createSVG(i))}),n[e]}var n={exclusivity:{},landscape:{},variants:{}};return t.getSVG=function(t,e,n){util.loop(t,function(t,i){util.loop(e,function(e,a){if(t.indexOf(e)>-1)return n(t,i)})})},t.removeG=function(){d3.selectAll("svg .g-tag").remove()},t.exclusivity=function(t){return e(["geneset","survival","network"],"exclusivity",t)},t.landscape=function(t){return e(["option","title"],"landscape",t)},t.variants=function(t){return e(["title"],"variants",t)},t}(layout||{}),legend=function(t){"use strict";function e(t,e){var n=0;return util.loop(t,function(t,i){n=n>draw.getTextWidth(t,e)?n:draw.getTextWidth(t,e)}),n}var n={};return function(t){(n={}).d=t.data.sort(function(e,n){return t.priority(e)>t.priority(n)?1:-1}),n.e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),n.m=size.setMargin(t.margin),n.w=n.e.attr("width"),n.h=n.e.attr("height"),n.t=n.m.top||0,n.l=n.m.left||0,n.p=t.padding||5,n.sw=n.sg=render.addGroup(n.e,n.t,n.l),n.tg=render.addGroup(n.e,n.t,n.l),n.mw=e(n.d,"10px Arial"),n.mh=draw.getTextHeight("10px Arial").height,n.dr=n.w-n.m.left-n.m.right>n.h-n.m.top-n.m.bottom?"h":"v",t.attr.r?render.circle({element:n.sg.selectAll("#"+n.e.attr("id")+"_circle"),data:n.d,attr:{id:function(t){return n.e.attr("id")+"_circle"},cx:function(e,i){return t.attr.x?t.attr.x.call(n,e,i):0},cy:function(e,i){return t.attr.y?t.attr.y.call(n,e,i):0},r:function(e,i){return t.attr.r?t.attr.r.call(n,e,i):0}},style:{fill:function(e){return t.style.fill?t.style.fill(e):"#000000"},stroke:function(e){return!!t.style.stroke&&t.style.stroke(e)}}}):render.rect({element:n.sg.selectAll("#"+n.e.attr("id")+"_rect"),data:n.d,attr:{id:function(t){return n.e.attr("id")+"_rect"},x:function(e,i){return t.attr.x?t.attr.x.call(n,e,i):0},y:function(e,i){return t.attr.y?t.attr.y.call(n,e,i):0},width:function(e,i){return t.attr.width?t.attr.width.call(n,e,i):5},height:function(e,i){return t.attr.height?t.attr.height.call(n,e,i):5}},style:{fill:function(e){return t.style.fill?t.style.fill(e):"#000000"},stroke:function(e){return!!t.style.stroke&&t.style.stroke(e)}}}),render.text({element:n.tg.selectAll("#"+n.e.attr("id")+"_text"),data:n.d,attr:{id:function(t){return n.isText=!0,n.e.attr("id")+"_text"},x:function(e,i){return t.attr.x?t.attr.x.call(n,e,i):0},y:function(e,i){return t.attr.y?t.attr.y.call(n,e,i):0}},style:{"font-size":function(e){return t.style.fontSize?t.style.fontSize(e):"10px"},"font-family":function(e){return t.style.fontFamily?t.style.fontFamily(e):"Arial"},"alignment-baseline":function(e){return t.style.alignmentBaseline?t.style.alignmentBaseline:"middel"}},text:function(e,i){return t.text(e,i,n)||"legend"+i}})}}();!function(t){"use strict";t.bio={draw:draw,config:config,render:render,variants:variants,pathways:"",expression:"",landscape:landscape,exclusive:exclusive,chart:{bar:bar,legend:legend,needle:needle,needleGraph:needleGraph,needleNavi:needleNavi,network:network,heatmap:heatmap,survival:survival},tools:{sortOption:sortOption,scaleOption:scaleOption,divisionLine:divisionLine,selectGeneSet:selectGeneSet},util:util,size:size,scale:scale,layout:layout,eventHandler:eventHandler,preprocessing:preprocessing}}(window||{});var needle=function(t){"use strict";var e={};return function(t){(e={}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),e.s=draw.size(e.e),e.m=size.setMargin(t.margin),e.t=e.m.top||0,e.l=e.m.left||0,e.g=render.addGroup(e.e,e.m.top,e.m.left),e.xag=render.addGroup(e.e,e.m.top,e.m.left),e.xxg=render.addGroup(e.e,e.m.top,e.m.left),e.radius=t.radius||5,e.sx=scale.get(t.xaxis,[e.m.left,e.s.w-e.m.right]),e.sy=scale.get(t.yaxis,[e.s.h-e.m.bottom,e.m.top]),e.line=(util.d3v4()?d3.line():d3.svg.line()).x(function(t){return e.sx(t.x)}).y(function(t){return e.sy(t.y)}),util.loop(t.lineData,function(t,n){render.line({element:e.g,attr:{id:function(t){return e.e.attr("id")+"_line"},d:e.line(t.value)},style:{stroke:"#333333"}})}),render.circle({element:e.g.selectAll("#"+e.e.attr("id")+"_circle"),data:t.circleData,attr:{id:function(t){return e.e.attr("id")+"_circle"},cx:function(n,i){return t.attr.x?t.attr.x.call(e,n,i):0},cy:function(n,i){return t.attr.y?t.attr.y.call(e,n,i):0},r:function(n,i){return t.attr.r?t.attr.r.call(e,n,i):e.radius}},style:{fill:function(n,i){return t.style.fill?t.style.fill.call(e,n,i):"#000000"},stroke:function(n,i){return t.style.stroke?t.style.stroke.call(e,n,i):"#FFFFFF"}}})}}(),needleGraph=function(t){"use strict";function e(){for(var t=1;draw.getTextHeight(t+"px").height<n.sh/2;)t+=1;return t+"px"}var n={};return function(t){(n={}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),n.s=draw.size(n.e),n.m=size.setMargin(t.margin),n.t=n.s.h-n.m.bottom,n.l=n.m.left||0,n.g=render.addGroup(n.e,n.t,n.l),n.sx=scale.get(t.xaxis,[n.m.left,n.s.w-n.m.right]),n.sy=scale.get(t.yaxis,[n.s.h-n.m.bottom,n.m.top]),n.sh=Math.abs(n.sy(1)-n.sy(0))/2,n.mfh=e(),render.rect({element:n.g.selectAll("#"+n.e.attr("id")+"_base"),data:[""],attr:{id:n.e.attr("id")+"_base",x:n.sx(util.minmax(t.xaxis).min)+5,y:.1*n.sh,width:n.s.w-n.m.right-n.m.left-5,height:.8*n.sh,rx:1,ry:1},style:{fill:"#DADFE1",stroke:"#CCCDCE","stroke-width":"5px"}}),render.rect({element:n.g.selectAll("#"+n.e.attr("id")+"_rect"),data:t.data,attr:{id:function(t){return n.e.attr("id")+"_rect"},x:function(e,i){return t.attr.x?t.attr.x.call(n,e,i):0},y:function(e,i){return t.attr.y?t.attr.y.call(n,e,i):0},width:function(e,i){return t.attr.width?t.attr.width.call(n,e,i):0},height:function(e,i){return t.attr.height?t.attr.height.call(n,e,i):0},rx:3,ry:3},style:{fill:function(e,i){return t.style.fill?t.style.fill.call(n,e,i):"#000000"},stroke:function(e,i){return t.style.stroke?t.style.stroke.call(n,e,i):"#FFFFFF"}}}),render.text({element:n.g.selectAll("#"+n.e.attr("id")+"_text"),data:t.data,attr:{id:function(t){return n.isText=!0,n.e.attr("id")+"_text"},x:function(e,i){return t.attr.x?t.attr.x.call(n,e,i):0},y:function(e,i){return t.attr.y?t.attr.y.call(n,e,i):0}},style:{fill:"#FFFFFF","font-size":n.mfh,"alignment-baseline":"middle"},text:function(e,i){return t.text?t.text.call(n,e,i):0}})}}(),needleNavi=function(t){"use strict";function e(t){util.loop(t,function(t,e){render.rect({element:n.g.selectAll("#"+n.e.attr("id")+"_"+t),data:[t],attr:{id:function(t){return n.e.attr("id")+"_"+t},x:"end"===t?n.end+n.m.left-5:n.start-5,y:.25*n.s.h,width:10,height:.4*n.s.h,rx:5,rx:5},style:{fill:"#A8A8A8",stroke:"#EAECED","stroke-width":"2px",cursor:"move"}})})}var n={start:0,end:0};return function(t){(n={}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),n.s=draw.size(n.e),n.m=size.setMargin(t.margin),n.t=n.m.top||0,n.l=n.m.left||0,n.g=render.addGroup(n.e,n.m.top,n.m.left),n.sx=scale.get(t.xaxis,[n.m.left,n.s.w-n.m.right]),n.sy=scale.get(t.yaxis,[n.s.h-n.m.bottom,n.m.top]),n.start=n.sx(util.minmax(t.xaxis).min),n.end=n.s.w-n.m.right-n.m.left,needle({element:n.e,lineData:t.data.needle,circleData:t.data.fullNeedle,attr:config.variants.needle.attr,style:t.style,margin:[5,30,10,60],xaxis:t.xaxis,yaxis:t.yaxis}),render.rect({element:n.g.selectAll("#"+n.e.attr("id")+"_navi"),data:[""],attr:{id:function(t){return n.e.attr("id")+"navi"},x:n.start,y:0,width:n.end,height:n.s.h-n.m.bottom,rx:3,ry:3},style:{fill:"rgba(255, 225, 50, 0.1)",stroke:"#FFDF6D"}}),e(["start","end"])}}(),network=function(){"use strict";return function(t){var e=[],n={},i="";t.data.map(function(t){if("compound"===t.type)i=t.members,e.push({group:"nodes",data:{id:"n0",bgcolor:t.bgcolor,bdcolor:t.bordercolor||"rgb(0, 0, 0)",width:100,height:200,isComp:!0,per:t.text},position:{}});else if("node"===t.type){var a={data:{id:i.indexOf(t.text)>-1?"n0:"+t.text:t.text,name:t.text,bgcolor:t.bgcolor,bdcolor:t.bordercolor||"rgb(0, 0, 0)",width:draw.getTextWidth(t.text,"14px Calibri"),height:20,fontSize:10,isComp:!1},group:"nodes"};n[t.text]={parent:i.indexOf(t.text)>-1?"n0:":""},i.indexOf(t.text)>-1&&(a.data.parent="n0"),e.push(a)}else if("edge"===t.type){var r="",l="",o="";for(var s in n)t.source.substring(0,s.length)===s&&(r=n[s].parent+s,o=t.source.substring(s.length,t.source.length),l=n[t.target.substring(0,t.target.indexOf(o))].parent+t.target.substring(0,t.target.indexOf(o)));e.push({data:{id:r+l,source:r,target:l,color:t.linecolor},group:"edges"})}});cytoscape({container:document.querySelector(t.element),boxSelectionEnabled:!1,autoungrabify:!0,autounselectify:!0,pixelRatio:"auto",elements:e,style:cytoscape.stylesheet().selector("node").css({shape:"rectangle",width:"data(width)",height:"data(height)","font-size":"10",content:"data(name)","text-valign":"center","background-color":"data(bgcolor)","border-color":"data(bdcolor)","border-width":"1"}).selector(":parent").css({"background-color":"rgba(255, 255, 255, 0.5)","border-color":"rgb(150, 0, 0)","border-width":"1",content:"data(per)","font-size":"10","text-valign":"top"}).selector("edge").css({"curve-style":"bezier","target-arrow-shape":"triangle","target-arrow-color":"data(color)","arrow-scale":"1","line-color":"data(color)"}),layout:{name:"cose-bilkent",animate:!1}})}}(),preprocessing=function(t){"use strict";function e(t){util.loop(t,function(t,e){var n=0,i={key:t,value:[{x:parseFloat(t),y:n,value:0}]};L.axis.needle.y.push(n),util.loop(e,function(e,a){i.value.push({x:parseFloat(t),y:n+=a.length,value:a.length,info:a})}),L.axis.needle.y.push(n),L.needle.push(i)})}function n(t){var n={};util.loop(t,function(t,e){t.type=config.landscape.name(t.type);var i=t.position+" "+t.type+" "+t.aachange;n[t.position]?n[t.position][i]?n[t.position][i].push(t):n[t.position][i]=[t]:(n[t.position]={},n[t.position][i]=[t]),L.type.indexOf(t.type)<0&&L.type.push(t.type)}),e(n)}function i(){util.loop(L.needle,function(t,e){util.loop(t.value,function(e,n){e.info&&(e.value=e.y-t.value[n-1].y,L.fullNeedle.push(e))})})}function a(t){util.loop(t,function(t,e){L.graph.push({x:t.start,y:0,width:t.end-t.start,height:15,color:t.colour,info:t})})}function r(t){L.axis.needle.x=[0,t[0].length],L.axis.needle.y=L.axis.needle.y.length<1?[0,1]:[util.minmax(L.axis.needle.y).min,util.minmax(L.axis.needle.y).max]}function l(t){return/[\[][\w(\s|,)]+[\]]/.exec(t)[0].replace(/\[|\]/g,"").split(" ")}function o(t){return"rgb("+t.split(" ").join(",")+")"}function s(t){var e=[];return util.loop(t,function(t,n){var i={};util.loop(t.split("\t"),function(t,e){i[t.split(":")[0]]=t.split(":")[0].indexOf("color")<0?t.split(":")[1]:o(t.split(":")[1])}),e.push(i)}),e}function c(t){util.loop(t,function(t,e){q.network[t]=s(e)})}function u(t){var e={};util.loop(t.split("\n"),function(t,n){util.loop(q.geneset,function(n,i){t.indexOf(n.join(""))>-1&&(e[n.join(" ")]?e[n.join(" ")].push(t):e[n.join(" ")]=[t])})}),c(e)}function d(t){return q.type[t.join(" ")]=[]}function p(t,e,n,i,a,r,l){util.loop(e.split(""),function(e,o){a.push(""+o),r.push(""+o),util.loop(config.exclusivity.separate(e),function(e,a){e=config.exclusivity.name(e),n.push({x:o,y:t,value:e}),i.indexOf(e)<0?i.push(e):i=i}),l.idx="."!==e?l.idx>o?l.idx:o:l.idx})}function f(t,e,n){var i=d(e);util.loop(t,function(t,a){util.loop(e,function(a,r){if(t.indexOf(a)>-1){var l=e.join(" ");q.axis.heatmap.x[l]=[],q.axis.heatmap.y[l]=e,q.axis.division.x[l]=[],q.divisionIdx[l]={idx:0},p(a,t.substring(0,t.indexOf(" ")),n,i,q.axis.heatmap.x[l],q.axis.division.x[l],q.divisionIdx[l])}})})}function h(t){util.loop(t.split("\n\n"),function(t,e){if(""!==t){var n=l(t),i=t.split("\n"),a=i.splice(1,i.length);f(a,n,q.heatmap[n.join(" ")]=[]);q.survival.heat[n.join(" ")]=a,q.fullGeneset.concat(n),q.geneset.push(n)}})}function g(t){var e={};return util.loop(t,function(t,n){e[t.gene]=["."]}),e}function m(t,e){var n={};return util.loop(t,function(t,i){var a=config.landscape.name(t.type),r="Amplification"===a||"Homozygous_deletion"===a?"Amplification"===a?"A":"D":"M",l=util.cloneObject(e);n[t.participant_id]?"."===n[t.participant_id][t.gene][0]?n[t.participant_id][t.gene]=[r]:n[t.participant_id][t.gene].push(r):(l[t.gene]=[r],n[t.participant_id]=l)}),n}function y(t,e){var n=g(e),i=m(e,n);util.loop(t,function(t,e){t.gene=i[t.participant_id]?i[t.participant_id]:n}),q.survival.merge=t}function x(t){return t.indexOf("A")>-1&&t.indexOf("M")>-1?"B":t.indexOf("D")>-1&&t.indexOf("M")>-1?"E":t[0]}function v(t){var e={};util.loop(q.survival.heat,function(t,n){for(var i=q.axis.heatmap.x[t].length,a=t.split(" "),r=q.survival.data[t]?q.survival.data[t]:q.survival.data[t]=[],l=e[t]={},o=0;o<i;o++)q.survival.merge.some(function(t){for(var e=!0,i=0;i<a.length;i++)x(t.gene[a[i]])!==n[i][o]&&(e=!1);if(e&&void 0===l[t.participant_id])return l[t.participant_id]="",r[o]=t,void 0!==r[o]})})}function w(t){V.type[t]||(V.type[t]=null)}function _(t){t[V.keys.t]=j.name(t[V.keys.t])}function b(t,e,n,i,a){return"gene"===t?{x:e,y:n,value:i,info:a}:{x:n,y:e,value:i,info:a}}function F(t,e){var n=[];return util.loop(e,function(e,i){var a=0,r=0;util.loop(i,function(i,l){n.push(b(t,a,e,l,i)),a+=l,r+=l}),V.axis[t]["gene"===t?"x":"y"].push(r)}),n}function k(t,e,n){t[e]=t[e]?t[e]:{},t[e][n]=t[e][n]?t[e][n]+1:1}function C(t,e){t.push({x:e[V.keys.p],y:e[V.keys.g],value:e[V.keys.t]})}function A(t,e){util.loop(t,function(t,n){_(t),w(t[V.keys.t]),e(t,n)})}function S(t){A(t,function(t,e){k(V.stack.gene,t[V.keys.g],t[V.keys.t]),k(V.stack.sample,t[V.keys.p],t[V.keys.t]),C(V.heatmap,t),V.axis.sample.x.indexOf(t[V.keys.p])<0&&V.axis.sample.x.push(t[V.keys.p])})}function E(t){A(t,function(t,e){k(V.stack.patient,t[V.keys.p],t[V.keys.t]),C(V.patient,t),V.axis.patient.x.indexOf(t[V.keys.p])<0&&V.axis.patient.x.push(t[V.keys.p])})}function D(t){return Math.log(t)/Math.log(12)*-1}function B(t,e){var n=[];return util.loop(t,function(t,i){n.push({x:0,y:t[V.keys.g],value:D(t[e])})}),n}function T(t){util.loop(t,function(t,e){var n=[];util.loop(t.data,function(e,i){n.push({x:e[V.keys.p],y:t.name,value:e.value})}),V.group.group.push(n),V.axis.group.y.push([t.name]),V.group.patient.push({x:V.axis.patient.x[0],y:t.name,value:"NA"})})}function O(){V.axis.gene.x=[util.minmax(V.axis.gene.x).max,0],V.axis.sample.y=[util.minmax(V.axis.sample.y).max,0],V.axis.pq.x=[0,util.minmax(V.pq.map(function(t){return Math.ceil(t.value)})).max]}function z(){V.axis.pq.y=V.gene,V.axis.gene.y=V.gene,V.axis.heatmap.y=V.gene,V.axis.heatmap.x=V.axis.sample.x,V.axis.group.x=V.axis.sample.x}function G(t,e){var n={};return util.loop(e,function(e,i){t.indexOf(i)>-1?n.g=e:j.color(j.name(i))?n.t=e:n.p=e}),n}var M={exclusivity:{heatmap:{},network:{},type:{},survival:{merge:{},heat:{},data:{}},geneset:[],fullGeneset:[],axis:{heatmap:{x:{},y:{}},division:{x:{},y:[]}},divisionIdx:{}},landscape:{keys:{},type:{},group:{group:[],patient:[]},heatmap:[],patient:[],stack:{gene:{},sample:{},patient:{}},axis:{pq:{x:[],y:[]},gene:{x:[],y:[]},group:{x:[],y:[]},sample:{x:[],y:[]},heatmap:{x:[],y:[]},patient:{x:[],y:[]}}},variants:{needle:[],fullNeedle:[],type:[],graph:[],axis:{needle:{x:[],y:[]}}}},V=M.landscape,q=M.exclusivity,L=M.variants,j=config.landscape;return t.variants=function(t){return n(t.variants.public_list),a(t.variants.graph),r(t.variants.graph),i(),L.patient=t.variants.patient_list.map(function(t,e){return t.type=config.landscape.name(t.type),t}),console.log("Preprocess of Variants: ",L),L},t.exclusivity=function(t){return y(t.survival.patient,t.survival.types),h(t.heatmap),u(t.network),v(t.heatmap),console.log("Preprocess of Exclusivity: ",q),q},t.landscape=function(t){return V.gene=t.gene,V.keys=G(V.gene,t.mutation.concat(t.patient)[0]),S(t.mutation),E(t.patient),T(t.group),V.type=util.keyToArr(V.type),V.pq=B(t.pq,t.pqValue||"p"),V.stack.gene=F("gene",V.stack.gene),V.stack.sample=F("sample",V.stack.sample),V.stack.patient=F("patient",V.stack.patient),O(),z(),console.log("Preprocess of Landscape: ",V),V},t}(preprocessing||{}),render=function(t){"use strict";function e(t,e){for(var n in e)t.attr(n,e[n])}function n(t,e){for(var n in e)t.style(n,e[n])}function i(t,e){t.text(e)}function a(t){var a=this.element.data(this.data).enter().append(t);!!this.text&&i(a,this.text),e(a,this.attr),n(a,this.style)}return t.createSVG=function(t,e,n){var t=t.indexOf("#")<0?"#"+t:t,i=document.querySelector(t);return d3.select(t).append("svg").attr("id",t.replace("#","")+"_chart").attr("width",(e||parseFloat(i.style.width))+1).attr("height",n||parseFloat(i.style.height))},t.addGroup=function(t,e,n){return t=util.d3v4()?t:t[0][0],(t="Array"===util.varType(t)||"Object"===util.varType(t)?t:d3.select(t)).append("g").attr("class",t.attr("id")+" g-tag").attr("transform","translate("+n+", "+e+")")},t.rect=function(t){a.call(t,"rect")},t.circle=function(t){a.call(t,"circle")},t.text=function(t){a.call(t,"text")},t.line=function(t){var i=t.element.append("path");e(i,t.attr),n(i,t.style)},t.triangle=function(t){t.element.append("path")},t}(render||{}),scale=function(t){"use strict";function e(t,e){var n=[];if("number"==typeof e[0]&&"number"==typeof e[1]){for(var a=Math.max(e[0],e[1]),r=Math.min(e[0],e[1]),l=a+r-r,o=r;o<=l;o++)n.push(o);return i.data.push(n),i.len.push(l),"ordinal"===t?n:[e[0],e[1]]}return i.data.push(e),i.len.push(e.length),e}function n(t){return"String"===util.varType(t[0])?"ordinal":"linear"}var i={data:[],len:[]};return t.ordinal=function(t,n){var i=e("ordinal",t);return d3.scaleBand?d3.scaleBand().domain(i).range(n):d3.scale.ordinal().domain(i).rangeBands(n)},t.linear=function(t,n){var i=e("linear",t);return d3.scaleLinear?d3.scaleLinear().domain(i).range(n):d3.scale.linear().domain(i).range(n)},t.getType=function(t){return"number"==typeof t[0]?"linear":"ordinal"},t.compatibleBand=function(t){return t.bandwidth?t.bandwidth():t.rangeBand()},t.getDomain=function(){return i.data.shift()},t.getDomainLength=function(){return i.len.shift()},t.getDistance=function(e){return"ordinal"===e?t.compatibleBand():t(1)-t(0)},t.get=function(e,i){return t[n(e)](e,i)},t}(scale||{}),scaleOption=function(t){"use strict";function e(t){return{upscale:"fa fa-caret-up",downscale:"fa fa-caret-down",initialize:"fa fa-refresh"}[t]}function n(t){var e=document.querySelector("#viewscale");switch(this.id){case"upscale":r.status+=r.interval;break;case"downscale":r.status-=r.interval;break;case"initialize":r.status=r.default;break;default:return}var n="upscale"===this.id?1:-1,i=parseInt(.1*r.defaultValue);r.status=r.status<r.default?r.default:r.status>200?200:r.status,e.value=r.status+" %",r.nowValue="initialize"===this.id?r.defaultValue:(this.id,r.nowValue+n*i),r.nowValue=r.defaultValue>r.nowValue?r.defaultValue:2*r.defaultValue<r.nowValue?2*r.defaultValue:r.nowValue,!!r.change&&r.change(this.id,r.nowValue)}function i(t,i){for(var a=0,r=i.btn.length;a<r;a++){var l=i.btn[a],o=document.createElement("button"),s=document.createElement("i");s.className=e(l.id),o.id=l.id,o.addEventListener("click",n),o.appendChild(s),t.appendChild(o)}}function a(t,e){util.loop(e.input,function(e,n){var i=document.createElement("input");i.id=e.id,i.readOnly=!0,i.tabIndex=-1,i.value=(r.value||r.default)+" "+r.unit,t.appendChild(i)})}var r={};return t.set=function(e){if(d3.select(".scale-option-frame").empty()){var n=document.createElement("div");n.className="scale-option-frame",(r=e).status=e.default,r.e=document.querySelector(e.element),r.width=parseFloat(e.width||r.e.style.width||140),r.height=parseFloat(e.height||r.e.style.height||105),r.change=e.change||null,r.defaultValue=e.defaultValue,r.nowValue=r.defaultValue,r.e.appendChild(n),e.btn=e.btn.length?e.btn:[e.btn],e.input=e.input.length?e.input:[e.input],a(n,e),i(n,e)}return t},t.change=function(e){return e(r),t},t}(scaleOption||{}),selectGeneSet=function(t){"use strict";function e(){o.l=document.createElement("label")}function n(t){o.s=document.createElement("select"),o.s.id=t.replace("#","")+"_view",o.l.appendChild(o.s)}function i(t){util.loop(t,function(t,e){var n=document.createElement("option"),i=t.join(" ");n.text=i,n.value=i,o.s.options.add(n)})}function a(t){var e="";return util.loop(t,function(t,n){var i=t.join(" ");e=i.length>e.length?i:e}),e}function r(t,e,n){var i=1;for(a(t);draw.getTextHeight(i+"px").height<n/4.8;)i+=1;o.view.style.fontSize=i+"px"}function l(t){o.area=document.querySelector("#exclusivity_select_geneset"),o.view=document.querySelector("#exclusivity_select_geneset_view"),o.label=document.querySelector("#exclusivity_select_geneset label");var e=parseFloat(o.area.style.width),n=parseFloat(o.area.style.height);o.label.style.width=e+"px",o.view.style.width=e+"px",o.label.style.padding=.05*e+"px",o.label.style.marginTop=.03*e+"px",o.label.style.marginLeft=.03*e+"px",r(t,e,n)}var o={};return t.set=function(t){var a=document.querySelector(t.element);return e(),n(t.element),i(t.data),o.s.onchange=t.change||null,a.appendChild(o.l),l(t.data),o.s.value},t}(selectGeneSet||{}),size=function(t){"use strict";function e(t){util.loop.call(this,t,function(t,e){var i=document.createElement("div");i.id=t,i.style.width=e.w+"px",i.style.height=e.h+"px",n.ids.push(t),this.appendChild(i)})}var n={ids:[]};return t.chart={},t.setMargin=function(t){if(!t.length)return{top:t,left:t,bottom:t,right:t};if("[object Object]"===Object.prototype.toString.call(t))return t;switch(t.length){case 1:return{top:t[0],left:t[0],bottom:t[0],right:t[0]};case 2:return{top:t[0],left:t[1],bottom:t[0],right:t[1]};case 3:return{top:t[0],left:t[1],bottom:t[2],right:t[1]};case 4:default:return{top:t[0],left:t[1],bottom:t[2],right:t[3]}}},t.setSize=function(t,e,n){return t.style.width=e+"px",t.style.height=n+"px",t},t.chart.exclusivity=function(i,a,r){var l={exclusivity_select_geneset:{w:.2*a,h:.1*r},exclusivity_upper_empty:{w:.35*a,h:.25*r},exclusivity_survival:{w:.4*a,h:r},exclusivity_network:{w:.25*a,h:.5*r},exclusivity_heatmap:{w:.35*a,h:.3*r},exclusivity_legend:{w:.35*a,h:.1*r}};return e.call(t.setSize(i,a,r),l),n.ids},t.chart.landscape=function(i,a,r){var l={landscape_title:{w:a,h:.05*r},landscape_legend:{w:.15*a,h:r},landscape_axis_sample:{w:.15*a,h:.15*r},landscape_patient_sample:{w:.01*a,h:.15*r},landscape_sample:{w:.59*a,h:.15*r},landscape_scale_option:{w:.1*a,h:.15*r},landscape_axis_group:{w:.15*a,h:.2*r},landscape_patient_group:{w:.01*a,h:.2*r},landscape_group:{w:.59*a,h:.2*r},landscape_option:{w:.1*a,h:.2*r},landscape_gene:{w:.15*a,h:.65*r},landscape_patient_heatmap:{w:.01*a,h:.65*r},landscape_heatmap:{w:.59*a,h:.65*r},landscape_pq:{w:.1*a,h:.65*r}};return e.call(t.setSize(i,a,r),l),n.ids},t.chart.variants=function(i,a,r){var l={variants_title:{w:.95*a,h:.05*r},variants_needle:{w:.85*a,h:.85*r},variants_legend:{w:.15*a,h:.85*r},variants_navi:{w:.85*a,h:.1*r}};return e.call(t.setSize(i,a,r),l),n.ids},t}(size||{}),sortOption=function(t){"use strict";function e(t){o.ul.style.visibility="hidden"===o.ul.style.visibility||""===o.ul.style.visibility?"visible":"hidden"}function n(){o.b=document.createElement("button"),o.s=document.createElement("span"),o.i=document.createElement("i"),o.b.id="landscape_sort_select",o.b.addEventListener("click",e),o.i.className="fa fa-sort-amount-desc",o.s.appendChild(o.i),o.b.appendChild(o.s)}function i(){o.ip=document.createElement("input"),o.ip.id="landscape_sort_case_view",o.ip.readOnly=!0,o.ip.tabIndex=-1}function a(t){return o.ul.style.visibility="hidden",o.ip.value=this.innerHTML,o.itemClick(t)}function r(t){o.ul=document.createElement("ul"),o.ul.id="landscape_sort_list",util.loop(t,function(t,e){var n=document.createElement("li");n.appendChild(document.createTextNode(t)),n.addEventListener("click",a),o.ul.appendChild(n)})}function l(){var t=document.createElement("div");return t.id="landscape_sort_area",t}var o={};return t.set=function(t){var e=l();o.itemClick=t.itemClick,e.appendChild((i(),o.ip)),e.appendChild((n(),o.b)),e.appendChild((r(t.subject),o.ul)),o.e=document.getElementById(t.element.replace("#","")),o.e.appendChild(e)},t}(sortOption||{}),survival=function(t){"use strict";function e(t){function e(t,e,n,i){var a={};a[t]={case_id:t,months:e,status:n},i.push(a)}var n={os:[],dfs:[]},i={os:[],dfs:[]},a={os:[],dfs:[]};return util.loop(t,function(t,r){if(t){var l=t.os_days/30,o=t.dfs_days/30;n.os.push(l),n.dfs.push(o),null!=l&&null!=t.os_status&&e(t.participant_id,l,t.os_status,i.os),null!=o&&null!=t.dfs_status&&e(t.participant_id,o,t.dfs_status,i.dfs),e(t.participant_id,l,t.os_status,a.os),e(t.participant_id,l,t.dfs_status,a.dfs)}}),{month:n,pure:i,all:a}}function n(t,e){var n=document.createElement("input");return n.id=t+"_survival",n.name="tabs",n.type="radio",n.checked=0===e,n}function i(t,e){var n=document.createElement("label");return n.htmlFor=t+"_survival",n.innerHTML=e,n}function a(t,e){var n=document.createElement("div");return n.id=t,n}function r(t,e){document.querySelector(t).innerHTML="";for(var r=document.querySelector(t),l=0,o=e.length;l<o;l++){var s=e[l],c=e[l].toLowerCase();r.appendChild(n(c,l)),r.appendChild(i(c,s))}for(var l=0,o=e.length;l<o;l++){var u=a(e[l].toLowerCase());u.appendChild(a(e[l].toLowerCase()+"_survival_curve")),u.appendChild(a(e[l].toLowerCase()+"_stat_table")),r.appendChild(u)}}return function(t){var n=e(t.data).pure;r(t.element,["OS","DFS"]),SurvivalTab.init(t.divisionData,n)}}(),util=function(t){"use strict";return t.d3v4=function(){return 0!==d3.version.indexOf("3")},t.camelCase=function(t){return t.substring(0,1).toUpperCase()+t.substring(1).toLowerCase()},t.loop=function(e,n){if("Array"===t.varType(e))for(var i=0,a=e.length;i<a;i++)n.call(this,e[i],i);else if("Object"===t.varType(e))for(var r in e)n.call(this,r,e[r])},t.cloneObject=function(e){if(null===e||"object"!=typeof e)return e;var n=e.constructor();return t.loop(e,function(t,i){e.hasOwnProperty(t)&&(n[t]=e[t])}),n},t.varType=function(t){var e=Object.prototype.toString.call(t);return e.substring(e.indexOf(" ")+1,e.indexOf("]"))},t.keyToArr=function(e){var n=[];return t.loop(e,function(t,e){n.push(t)}),n},t.minmax=function(t,e){return arguments.length<2?{min:Math.min.apply(null,t),max:Math.max.apply(null,t)}:{min:Math.min.call(null,t,e),max:Math.max.call(null,t,e)}},t.removeWhiteSpace=function(t){return t.replace(/\s/gi,"")},t}(util||{}),variants=function(t){"use strict";function e(){d.div.title=document.querySelector("#variants_title"),d.div.title.innerHTML=d.origin.variants.title}function n(t,e,n){return["top"===t?e.attr("height")-n[0]:n[0],n[1]]}function i(){var t=["left","top"],e=(new Array).concat(d.data.axis.needle.y);layout.getSVG(d.svg,["needle"],function(i,a){util.loop(t,function(t,i){axis.element(a)[t]({margin:config.variants.axis[t].margin,position:n(t,a,config.variants.axis[t].margin),data:"left"===t?e.reverse():d.data.axis.needle.x,opt:{}})})})}function a(){layout.getSVG(d.svg,["needle"],function(t,e){needle({element:e,lineData:d.data.needle,circleData:d.data.fullNeedle,attr:config.variants.needle.attr,style:config.variants.needle.style,margin:config.variants.needle.margin,xaxis:d.data.axis.needle.x,yaxis:d.data.axis.needle.y})})}function r(){layout.getSVG(d.svg,["needle"],function(t,e){needleGraph({element:e,data:d.data.graph,attr:config.variants.needleGraph.attr,style:config.variants.needleGraph.style,margin:config.variants.needleGraph.margin,text:config.variants.needleGraph.text,xaxis:d.data.axis.needle.x,yaxis:d.data.axis.needle.y})})}function l(){layout.getSVG(d.svg,["navi"],function(t,e){needleNavi({element:e,data:d.data,margin:config.variants.navi.margin,style:config.variants.navi.style,xaxis:d.data.axis.needle.x,yaxis:d.data.axis.needle.y})})}function o(){console.log(d.data.patient),layout.getSVG(d.svg,["needle"],function(t,e){})}function s(){layout.getSVG(d.svg,["legend"],function(t,e){legend({element:e,data:d.data.type,priority:config.landscape.priority,text:config.variants.legend.text,attr:config.variants.legend.attr,style:config.variants.legend.style,margin:config.variants.legend.margin})})}function c(){i(),s(),a(),l(),r(),o()}function u(t){t.style.background="#F7F7F7"}var d={div:{}};return function(t){console.log("Given Variants data: ",t);var n=document.querySelector(t.element||null),i=parseFloat(t.width||n.style.width||1400),a=parseFloat(t.height||n.style.height||700);d.origin=t.data,d.data=preprocessing.variants(t.data),d.ids=size.chart.variants(n,i,a),d.svg=layout.variants(d.ids,d),u(n),e(),c()}}();