var axis=function(t){"use strict";function e(t,e){return d3.svg.axis().scale(t).orient(e)}function n(t,e){return d3["axis"+util.camelCase(e)](t)}function i(e,n,i){return util.loop(n,function(n,a){e[n]&&e[n](t.option[n](i,a))}),e}function a(t,e){return e?t.selectAll(e).remove():t}var r={axies:{}};return t.element=function(e){return e="Object"===util.varType(e)?e:/\W/.test(e[0])?d3.select(e):d3.select("#"+e),r.current=e,t},t.byVersion=function(t,i){return util.d3v4()?n(t,i):e(t,i)},t.option={tickValues:function(t,e){if("Array"===util.varType(e))return e;for(var n=util.minmax(t).max/(e-1),i=[],a=0;a<e-1;a++)i.push(a*n);return i.push(util.minmax(t).max),i}},t.top=function(e){var n=size.setMargin(e.margin),o=draw.size(r.current),l=e.position||[n.top,n.left],s=scale.get(e.data,[n.left,o.w-n.right]),u=render.addGroup(r.current,l[0],l[1],"top-axis"),c=e.opt?e.opt:{};return u.call(i(t.byVersion(s,"top"),e.opt,e.data)),a(u,c.remove),u},t.left=function(e){var n=size.setMargin(e.margin),o=draw.size(r.current),l=e.position||[n.top,o.w-n.right],s=scale.get(e.data,[n.top,o.h-n.bottom]),u=render.addGroup(r.current,l[0],l[1],"left-axis"),c=e.opt?e.opt:{};return u.call(i(t.byVersion(s,"left"),e.opt,e.data)),a(u,c.remove),u},t.bottom=function(e){var n=size.setMargin(e.margin),o=draw.size(r.current),l=e.position||[o.h-n.bottom,n.left],s=scale.get(e.data,[n.left,o.w-n.right]),u=render.addGroup(r.current,l[0],l[1],"bottom-axis"),c=e.opt?e.opt:{};return u.call(i(t.byVersion(s,"bottom"),e.opt,e.data)),a(u,c.remove),u},t.right=function(e){var n=size.setMargin(e.margin),o=draw.size(r.current),l=e.position||[n.top,n.left],s=scale.get(e.data,[n.top,o.h-n.bottom]),u=render.addGroup(r.current,l[0],l[1],"right-axis"),c=e.opt?e.opt:{};return u.call(i(t.byVersion(s,"right"),e.opt,e.data)),a(u,c.remove),u},t}(axis||{}),bar=function(t){"use strict";function e(t){var e=[i.m.left,i.w-i.m.right],n=[i.m.top,i.h-i.m.bottom];return{x:"top"===t||"bottom"===t||"right"===t?e:e.reverse(),y:"left"===t||"right"===t||"bottom"===t?n:n.reverse()}}function n(t,n,i){return scale.get(n,e(t)[i])}var i={};return function(t){return i={},i.e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),i.id=i.e.attr("id"),i.w=t.width||i.e.attr("width")||0,i.h=t.height||i.e.attr("height")||0,i.m=size.setMargin(t.margin),i.data=t.data,i.direction=t.direction||"top",i.g=render.addGroup(i.e,i.m.top,i.m.left,"bar"),i.dx=(new Array).concat(t.xaxis),i.dy=(new Array).concat(t.yaxis),i.sx=n(i.direction,i.dx,"x"),i.sy=n(i.direction,i.dy,"y"),render.rect({element:i.g.selectAll("#"+i.id+"_rect"),data:i.data,attr:{id:function(t){return i.id+"_rect"},x:function(e,n){return t.attr.x?t.attr.x(e,n,i):t.attr.x(e)},y:function(e,n){return t.attr.y?t.attr.y(e,n,i):t.attr.y(e)},width:function(e,n){return t.attr.width?t.attr.width(e,n,i):10},height:function(e,n){return t.attr.height?t.attr.height(e,n,i):10}},style:{fill:function(e,n){return t.style.fill?t.style.fill(e,n,i):"#000000"},stroke:function(e,n){return t.style.stroke?t.style.stroke(e,n,i):"#FFFFFF"}},on:{mouseover:function(e,n){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(this,e,n,i))},mouseout:function(e,n){return!!t.on&&(!!t.on.mouseout&&t.on.mouseout.call(this,e,n,i))}}}),i}}(),colorGradient=function(t){"use strict";function e(t,e){i.offsets.show.push({offset:t,color:e}),i.offsets.data.push({offset:t,color:e})}function n(t,n){var a=util.minmax(t),r=(new Array).concat(t).splice(1,t.length-2);e("0%",n[0]),util.loop(r,function(t,e){var r=Math.round((a.max-a.min)/t*10);i.offsets.show.push({offset:r-i.adj+"%",color:n[e+1]}),i.offsets.data.push({offset:r+"%",color:n[e+1]})}),e("100%",n[t.length-1])}var i={};return function(t){return i={offsets:{show:[],data:[]}},i.e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),i.adj=t.adjustValue||0,i.id=t.id||"linear_gradient",i.colors=t.colors||["#000000","#FFFFFF"],i.offset=t.offset||[0,100],i.defs=i.e.append("defs"),i.lineGradient=i.defs.append("linearGradient").attr("id",i.id),n(i.offset,i.colors),i.lineGradient.selectAll("stop").data(i.offsets.show).enter().append("stop").attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color}),i}}(),config={exclusivity:{},expression:{},landscape:{},variants:{}};config.landscape.name=function(t){return t=t.replace(/(_ins|_del)$/gi,"_indel"),t=t.substring(0,1).toUpperCase()+t.substring(1).toLowerCase()},config.landscape.case=function(t){switch(config.landscape.priority(config.landscape.name(t))){case 0:case 1:return"cnv";default:return"var"}},config.landscape.priority=function(t){return{Amplification:0,Homozygous_deletion:1,Nonsense_mutation:2,Splice_site:3,Translation_start_site:4,Missense_mutation:5,Start_codon_snp:5,Nonstop_mutation:6,Frame_shift_indel:7,Stop_codon_indel:7,In_frame_indel:8,Silent:9,Rna:10,Intron:11,"5'utr":11,"3'utr":11,Igr:11}[t]},config.landscape.orderedName=["Amplification","Homozygous_deletion","Nonsense_mutation","Splice_site","Translation_start_site","Missense_mutation","Start_codon_snp","Nonstop_mutation","Frame_shift_indel","Stop_codon_indel","In_frame_indel","Silent","Rna","Intron","5'utr","3'utr","Igr","alive","dead","female","male","american indian or alaska native","asian","black or african american","white","hispanic or latino","not hispanic or latino","lung acinar adenocarcinoma","lung adenocarcinoma mixed subtype","lung adenocarcinoma- not otherwise specified (nos)","lung bronchioloalveolar carcinoma mucinous","lung bronchioloalveolar carcinoma nonmucinous","lung clear cell adenocarcinoma","lung micropapillary adenocarcinoma","lung mucinous adenocarcinoma","lung papillary adenocarcinoma","lung signet ring adenocarcinoma","lung solid pattern predominant adenocarcinoma","mucinous (colloid) carcinoma","bronchial","l-lower","l-upper","other (please specify)","r-lower","r-middle","r-upper","no","yes","yes, history of prior malignancy","yes, history of synchronous/bilateral malignancy","no","yes","no","yes","t1","t1a","t1b","t2","t2a","t2b","t3","t4","tx","n0","n1","n2","n3","nx","m0","m1","m1a","m1b","mx","stage i","stage ia","stage ib","stage ii","stage iia","stage iib","stage iiia","stage iiib","stage iv","r0","r1","r2","rx","exon 19 deletion","l858r","l861q","other","t790m","g12a","g12c","g12d","g12s","g12v","other","complete remission/response","partial remission/response","progressive disease","stable disease","complete remission/response","partial remission/response","progressive disease","stable disease","Lifelong Non-Smoker","Current Smoker","Current Reformed Smoker for > 15 yrs","Current Reformed Smoker for < or = 15 yrs","Current Reformed Smoker, Duration Not Specified","NA"],config.landscape.color=function(t){return{Amplification:"#FFBDE0",Homozygous_deletion:"#BDE0FF",Nonsense_mutation:"#EA3B29",Splice_site:"#800080",Translation_start_site:"#AAA8AA",Missense_mutation:"#3E87C2",Start_codon_snp:"#3E87C2",Nonstop_mutation:"#070078",Frame_shift_indel:"#F68D3B",Stop_codon_indel:"F68D3B",In_frame_indel:"#F2EE7E",Silent:"#5CB755",Rna:"#FFDF97",Intron:"#A9A9A9","5'utr":"#A9A9A9","3'utr":"#A9A9A9",Igr:"#A9A9A9",alive:"#04CDA4",dead:"#C50E36",female:"E0A4E5",male:"#0F67B6","american indian or alaska native":"#38120B",asian:"#CB771F","black or african american":"#302F24",white:"#9CB1CE","hispanic or latino":"#B8642F","not hispanic or latino":"#55C53E","lung acinar adenocarcinoma":"#716190","lung adenocarcinoma mixed subtype":"#5154DE","lung adenocarcinoma- not otherwise specified (nos)":"#8E9A7E","lung bronchioloalveolar carcinoma mucinous":"#2F91DE","lung bronchioloalveolar carcinoma nonmucinous":"#ED6EBD","lung clear cell adenocarcinoma":"#1C8D7A","lung micropapillary adenocarcinoma":"#B2EE86","lung mucinous adenocarcinoma":"#785E54","lung papillary adenocarcinoma":"#69B4C4","lung signet ring adenocarcinoma":"#C1386E","lung solid pattern predominant adenocarcinoma":"#D7A355","mucinous (colloid) carcinoma":"#243833",bronchial:"#F9E3B9","l-lower":"#FBA2A3","l-upper":"#0CA3C7","other (please specify)":"#D3A16C","r-lower":"#388A4E","r-middle":"#D61E43","r-upper":"#B81BCC",no:"#D73A64",yes:"#1990AA","yes, history of prior malignancy":"#3BDB11","yes, history of synchronous/bilateral malignancy":"#803F11",no:"#D73A64",yes:"#1990AA",no:"#D73A64",yes:"#1990AA",t1:"#060CDB",t1a:"#696DE9",t1b:"#CDCEF7",t2:"#F6251D",t2a:"#F96D69",t2b:"#FDCECD",t3:"#1AEB42",t4:"#EBBD34",tx:"#9943DE",n0:"#DC5B35",n1:"#217C1F",n2:"#18A6F3",n3:"#EA68C3",nx:"#F4E831",m0:"#F0820D",m1:"#C45A43",m1a:"#A523C2",m1b:"#C97BDA",mx:"#EDD3F2","stage i":"#01C606","stage ia":"#018404","stage ib":"#002C01","stage ii":"#0E22C3","stage iia":"#08136C","stage iib":"#040B41","stage iiia":"#BB0C2E","stage iiib":"#75081D","stage iv":"#F0CA53",r0:"#DB8EC0",r1:"#FFD046",r2:"#495C50",rx:"#0E5F8A","exon 19 deletion":"#4A312A",l858r:"#74C04C",l861q:"#FBED09",other:"#C91DAB",t790m:"#2C517B",g12a:"#DED0D1",g12c:"#AE8A8E",g12d:"#5D161D",g12s:"#410F14",g12v:"#25080B",other:"#C91DAB","complete remission/response":"#BDED73","partial remission/response":"#8649F3","progressive disease":"#C1746B","stable disease":"#CD4C2A","complete remission/response":"#BDED73","partial remission/response":"#8649F3","progressive disease":"#C1746B","stable disease":"#CD4C2A","Lifelong Non-Smoker":"#C4B5BB","Current Smoker":"#896C78","Current Reformed Smoker for > 15 yrs":"#3B0A1E","Current Reformed Smoker for < or = 15 yrs":"#2F0818","Current Reformed Smoker, Duration Not Specified":"#17040C",NA:"#D6E2E3"}[t]},config.landscape.sample={attr:{x:function(t,e,n){return t.x.indexOf("-")>-1?n.sx(t.x):n.sx(t.x)+3},y:function(t,e,n){return n.sy(util.minmax(n.dy).max)-n.sy(t.y+t.value)+n.sy(util.minmax(n.dy).min)},width:function(t,e,n){return t.x.indexOf("-")>-1?scale.compatibleBand(n.sx):scale.compatibleBand(n.sx)-7.5},height:function(t,e,n){return n.sy(t.value)-n.sy(util.minmax(n.dy).min)}},style:{fill:function(t,e,n){return config.landscape.color(t.info)},stroke:function(t,e,n){return"#FFFFFF"}},on:{mouseover:function(t,e,n){tooltip({element:this,contents:"<b>"+t.x+"</b></br>Type: <b>"+t.info+"</b></br>Count: <b>"+t.value+"</b>"}),d3.select(this).transition().duration(50).style("stroke","#333333")},mouseout:function(t,e,n){tooltip("hide"),d3.select(this).transition().duration(50).style("stroke","#FFFFFF")}}},config.landscape.gene={attr:{x:function(t,e,n){return n.sx(util.minmax(n.dx).max-t.x)-n.sx(t.value)+n.m.left},y:function(t,e,n){return n.sy(t.y)},width:function(t,e,n){return n.sx(t.value)-n.m.left},height:function(t,e,n){return scale.compatibleBand(n.sy)}},style:{fill:function(t,e,n){return config.landscape.color(t.info)},stroke:function(t,e,n){return"#FFFFFF"}},on:{mouseover:function(t,e,n){tooltip({element:this,contents:"<b>"+t.y+"</b></br>Type: <b>"+t.info+"</b></br>Count: <b>"+t.value+"</b>"}),d3.select(this).transition().duration(50).style("stroke","#333333")},mouseout:function(t,e,n){tooltip("hide"),d3.select(this).transition().duration(50).style("stroke","#FFFFFF")}}},config.landscape.pq={attr:{x:function(t,e,n){return n.sx(util.minmax(n.dx).min)},y:function(t,e,n){return n.sy(t.y)},width:function(t,e,n){return n.sx(t.value)},height:function(t,e,n){return scale.compatibleBand(n.sy)}},style:{fill:function(t,e,n){return"#BFBFBF"},stroke:function(t,e,n){return"#FFFFFF"}},on:{mouseover:function(t,e,n){tooltip({element:this,contents:"<b>"+t.y+"</b></br>Value: <b>"+t.value+"</b>"}),d3.select(this).transition().duration(50).style("stroke","#333333")},mouseout:function(t,e,n){tooltip("hide"),d3.select(this).transition().duration(50).style("stroke","#FFFFFF")}}},config.landscape.heatmap={attr:{x:function(t,e,n){return n.sx(t.x)},y:function(t,e,n){return"cnv"!==config.landscape.case(t.value)?scale.compatibleBand(n.sy)/3+n.sy(t.y):n.sy(t.y)},width:function(t,e,n){return scale.compatibleBand(n.sx)},height:function(t,e,n){return"cnv"!==config.landscape.case(t.value)?scale.compatibleBand(n.sy)/3:scale.compatibleBand(n.sy)}},style:{fill:function(t,e,n){return config.landscape.color(t.value)},stroke:function(t,e,n){return"#FFFFFF"}},on:{mouseover:function(t,e,n){var i="";t.info.length>0&&util.loop(t.info,function(t){i+="</br><b>"+t+"</b>"}),tooltip({element:this,contents:"<b>Gene mutations</b></br>X: <b>"+t.x+"</b></br>Y: <b>"+t.y+"</b></br>Type: </br><b>"+t.value+"</b>"+i}),d3.select(this).transition().duration(50).style("stroke","#333333")},mouseout:function(t,e,n){tooltip("hide"),d3.select(this).transition().duration(50).style("stroke","#FFFFFF")}}},config.landscape.group={attr:{x:function(t,e,n){return n.sx(t.x)},y:function(t,e,n){return n.sy(t.y)},width:function(t,e,n){return scale.compatibleBand(n.sx)},height:function(t,e,n){return scale.compatibleBand(n.sy)}},style:{fill:function(t,e,n){return config.landscape.color(t.value)},stroke:function(t,e,n){return"#FFFFFF"}},on:{mouseover:function(t,e,n){tooltip({element:this,contents:"<b>"+t.y+"</b></br>Sample: <b>"+t.x+"</b></br>Value: <b>"+t.value+"</b></br>"}),d3.select(this).transition().duration(50).style("stroke","#333333")},mouseout:function(t,e,n){tooltip("hide"),d3.select(this).transition().duration(50).style("stroke","#FFFFFF")}}},config.landscape.legend={attr:{x:function(t,e,n){if(n.isText)return n.x[e]+2*n.padding;var i=n.shape+3*n.padding+n.mw,a=0,r=0;return n.x[e-1]?n.x[e-1]+i>n.w?(r=n.padding,a=r):(r=n.x[e-1]+i,a=r-i):(r=n.padding,a=r),n.x.push(a),a},y:function(t,e,n){if(n.isText){a="var"===config.landscape.case(t)?2*n.shape/3:0;return n.y[e]+n.shape-a}var i=2*n.shape,a="var"===config.landscape.case(t)?i/3:0;return n.x[e-1]?parseInt(n.x[e-1])!==parseInt(n.x[e])?(n.y.push(0),0):(n.y.push(e*i+n.padding+a),e*i+n.padding+a):(n.y.push(0),0)},width:function(t,e,n){return n.shape/1.5},height:function(t,e,n){var i=2*n.shape;return config.landscape.case(t)&&"var"===config.landscape.case(t)?i/3:i}},style:{fill:function(t,e,n){return n.isText?"#333333":config.landscape.color(t)},stroke:function(t,e,n){return"#FFFFFF"},fontSize:function(t,e,n){return"11px"}},text:function(t,e,n){return t}},config.landscape.axis={sample:{direction:"left",margin:[5,0,10,5],opt:{tickValues:3}},group:{direction:"right",margin:[0,15,0,0],opt:{remove:"line, path"}},gene:[{direction:"right",margin:[5,150,40,0],opt:{remove:"line, path"}},{direction:"bottom",margin:[0,10,35,90],opt:{tickValues:3}}],pq:{direction:"bottom",margin:[0,10,35,20],opt:{tickValues:3}}},config.landscape.bar={pq:{direction:"right",margin:[5,10,41,30],xaxis:function(){return this.pq.x},yaxis:function(){return this.pq.y},attr:config.landscape.pq.attr,style:config.landscape.pq.style,on:config.landscape.pq.on}},config.landscape.stack={patient:{direction:"top",margin:[5,0,10,0],xaxis:function(){return this.patient.x},yaxis:function(){return this.sample.y},attr:config.landscape.sample.attr,style:config.landscape.sample.style,on:config.landscape.sample.on},sample:{direction:"top",margin:[5,1,10,1],xaxis:function(){return this.sample.x},yaxis:function(){return this.sample.y},attr:config.landscape.sample.attr,style:config.landscape.sample.style,on:config.landscape.sample.on},gene:{direction:"left",margin:[5,10,41,90],xaxis:function(){return this.gene.x},yaxis:function(){return this.gene.y},attr:config.landscape.gene.attr,style:config.landscape.gene.style,on:config.landscape.gene.on}},config.landscape.heatmap={heatmap:{direction:"left",margin:[5,1,41,1],opt:{},xaxis:function(){return this.sample.x},yaxis:function(){return this.gene.y},attr:config.landscape.heatmap.attr,style:config.landscape.heatmap.style,on:config.landscape.heatmap.on},patient:{direction:"left",margin:[5,1,41,3.5],opt:{},xaxis:function(){return this.patient.x},yaxis:function(){return this.gene.y},attr:config.landscape.heatmap.attr,style:config.landscape.heatmap.style,on:config.landscape.heatmap.on}},config.landscape.group={group:{direction:"left",margin:[2,1,4,1],opt:{},xaxis:function(){return this.sample.x},attr:config.landscape.group.attr,style:config.landscape.group.style,on:config.landscape.group.on},patient:{direction:"left",margin:[2,1,4,4],opt:{},xaxis:function(){return this.patient.x},attr:config.landscape.group.attr,style:config.landscape.group.style,on:config.landscape.group.on}},config.exclusivity.separate=function(t){return"B"===t?["A","M"]:"E"===t?["D","M"]:"M"===t?[".","M"]:[t]},config.exclusivity.case=function(t,e){return"var"===t?"Mutation":e.toUpperCase().indexOf("AMP")>-1?"Amplification":"Deletion"},config.exclusivity.symbol=function(t){return{Amplification:"A",Deletion:"D",Mutation:"M",None:"."}[t]},config.exclusivity.name=function(t){return{A:"Amplification",D:"Deletion",M:"Mutation",".":"None"}[t]},config.exclusivity.priority=function(t){return{Amplification:0,Deletion:1,Mutation:2,None:3}[t]},config.exclusivity.color=function(t){return{Amplification:"#FFBDE0",Deletion:"#BDE0FF",Mutation:"#5CB755",None:"#D3D3D3"}[t]},config.exclusivity.legend={margin:[20,80,0,0],attr:{x:function(t,e,n){if(n.isText)return n.x[e]+2*n.padding;var i=n.shape+3*n.padding+n.mw,a=0,r=0;return n.x[e-1]?n.x[e-1]+i>n.w?(r=n.padding,a=r):(r=n.x[e-1]+i,a=r):(r=n.padding,a=r),n.x.push(a),a},y:function(t,e,n){if(n.isText){i="Mutation"===t?n.shape/3:0;return n.y[e]+n.shape/2+1-i}var i="Mutation"===t?n.shape/3:0;return n.x[e-1]?parseInt(n.x[e-1])!==parseInt(n.x[e])?(n.y.push(i),i):(n.y.push(e*n.shape+i),e*n.shape+i):(n.y.push(i),i)},width:function(t,e,n){return n.shape/2},height:function(t,e,n){return"Mutation"===t?n.shape/3:n.shape}},style:{fill:function(t,e,n){if(!n.isText)return config.exclusivity.color(t)}},text:function(t,e,n){return t}},config.exclusivity.heatmap={margin:[35,40,35,50],attr:{x:function(t,e,n){return n.sx(t.x)},y:function(t,e,n){return"Mutation"===t.value?n.sy(t.y)+scale.compatibleBand(n.sy)/3:n.sy(t.y)},width:function(t,e,n){return scale.compatibleBand(n.sx)},height:function(t,e,n){return"Mutation"===t.value?scale.compatibleBand(n.sy)/3:scale.compatibleBand(n.sy)}},style:{fill:function(t,e,n){return config.exclusivity.color(t.value)},stroke:function(t,e,n){return!1}}},config.exclusivity.division={margin:[10,40,0,50],attr:{x:function(t,e,n){return e>0?n.isText?n.scale(n.axis[n.axis.length-1])-draw.getTextWidth(t.text,n.font)-n.m.left/2-n.padding:n.scale(t.point):n.isText?n.m.left+n.padding:n.m.left},y:function(t,e,n){return n.isText?n.m.top+(n.textHeight+n.padding):n.m.top},width:function(t,e,n){return e>0?n.w-n.scale(t.point)-n.m.right:n.scale(t.point)-n.m.left},height:function(t,e,n){return n.textHeight+4*n.padding},rx:function(t,e,n){return 3},ry:function(t,e,n){return 3}},style:{fill:function(t,e,n){return n.isText?"#FFFFFF":t.color},stroke:function(t,e,n){return n.isLine?"#000000":"#FFFFFF"},dashed:function(t,e,n){return"4,2"}},line:{x:function(t){return t.scale(t.point)},y:function(t){return t.m.left+1.2*t.m.top}},text:function(t,e,n){return t.text}},config.exclusivity.sample={survival:{attr:{x:function(t,e,n){return n.data.sample.isAltered.indexOf(t.text)>-1?draw.getTextWidth(t.text,"15px")+draw.getTextWidth(t.text,"15px")/4:-5},y:function(t,e,n){return n.data.sample.isAltered.indexOf(t.text)>-1?draw.getTextHeight("15px").height/1.3:0}},style:{fill:function(t,e,n){return n.data.sample.isAltered.indexOf(t.text)>-1?t.color:"#FFFFFF"},fontSize:function(t,e,n){return"25px"}},text:function(t,e,n){return n.data.sample.isAltered.indexOf(t.text)>-1?" **":""}},division:{margin:[15,80,0,50],attr:{x:function(t,e,n){return t.type.indexOf("Altered group")>-1?0:n.e.attr("width")-n.m.left-(n.m.left-n.m.right)},y:function(t,e,n){return 0}},style:{fill:function(t,e,n){return t.type.indexOf("Altered group")>-1?"#FF6252":"#00AC52"}},text:function(t,e,n){return t.value}},legend:{margin:[35,80,0,0],attr:{x:function(t,e,n){if(n.isText){if(0===e)return 0;if(1===e)return this.previousSibling.getBoundingClientRect().width+2*n.padding;var i=this.previousSibling.getBoundingClientRect();return this.previousSibling.previousSibling.getBoundingClientRect().width+i.width+n.padding+draw.getTextWidth("A",n.font)}},y:function(t,e,n){return e>0?-draw.getTextHeight("25px").height/4.5:0}},style:{fill:function(t,e,n){if(n.isText)return 1===e?"#333":n.d[2].toUpperCase().indexOf("UN")>-1?"#00AC52":"#FF6252"},fontSize:function(t,e,n){return 0===e?"25px":n.font}},text:function(t,e,n){return t}}},config.variants.legend={margin:[10,10,0,0],attr:{x:function(t,e,n){if(n.isText)return n.x[e]+2*n.padding;var i=n.shape+3*n.padding+n.mw,a=0,r=0;return n.x[e-1]?n.x[e-1]+i>n.w?(r=n.padding,a=r):(r=n.x[e-1]+i,a=r-i):(r=n.padding,a=r),n.x.push(a),a},y:function(t,e,n){return n.isText?n.y[e]:n.x[e-1]?parseInt(n.x[e-1])!==parseInt(n.x[e])?(n.y.push(n.padding),n.padding):(n.y.push(e*n.mh+n.padding),e*n.mh+n.padding):(n.y.push(n.padding),n.padding)},r:function(t,e,n){return n.shape}},style:{fontSize:function(t,e,n){return n.font},fill:function(t,e,n){return n.isText?"#333333":config.landscape.color(t)},stroke:function(t,e,n){return"#333333"}},text:function(t,e,n){return draw.textOverflow(t,n.font,n.mw,0)}},config.variants.needle={margin:[10,30,70,60],radius:function(t){return 3*Math.sqrt(t)/1.25},attr:{x:function(t,e,n){return n.sx(t.x)<n.m.left?2*-n.m.left:n.sx(t.x)>n.w-n.m.right?n.w+2*n.m.left:n.sx(t.x)},y:function(t,e,n){return n.sy(t.y)},r:function(t,e,n){return t.value?config.variants.needle.radius(t.value):n.radius}},style:{fill:function(t,e,n){return!!t.info&&config.landscape.color(t.info[0].type)},stroke:function(t,e,n){return"#333333"}},on:{mouseover:function(t,e,n){draw.toFront(this),console.log(this),tooltip({element:this,contents:"Type: <b>"+t.info[0].type+"</b></br>AAChange: <b>"+t.info[0].aachange+"</b></br>Counts: <b>"+t.y+"</b></br>Position: <b>"+t.x+"</b></br>"})},mouseout:function(t,e,n){draw.toBack(this),tooltip("hide")}}},config.variants.needleGraph={margin:[0,30,60,60],now:{width:{}},attr:{x:function(t,e,n){var i=n.sx(t.x)>n.m.left?n.sx(t.x):n.m.left;return n.isText?i+5:i},y:function(t,e,n){return n.isText?draw.getTextHeight(draw.getFitTextSize(t.info.identifier,n.w,n.sh)).height/2+1:0},width:function(t,e,n){var i=0,a=n.sx(t.x),r=n.sx(t.x+t.width),o=config.variants.needleGraph;return i=a<n.m.left?r-n.m.left<0?0:r-n.m.left:r>n.w-n.m.right?a>n.w-n.m.right?0:n.w-n.m.right-a+2:r-a,o.now.width[t.info.identifier]=i},height:function(t,e,n){return console.log(n.sh),n.sh}},style:{fill:function(t,e,n){return n.isText?"#FFFFFF":t.color},stroke:function(t,e,n){return"#FFFFFF"},fontSize:function(t,e,n){return n.font=draw.getFitTextSize(t.info.identifier,config.variants.needleGraph.now.width[t.info.identifier],n.sh/2),n.font}},on:{mouseover:function(t,e,n){draw.toFront(this.parentNode),tooltip({element:this,contents:"<b>"+t.info.identifier+"</b></br>Desc: <b>"+t.info.description+"</b></br>Section: <b>"+t.x+" - "+(t.x+t.width)+"</b>"})},mouseout:function(t,e,n){draw.toBack(this.parentNode,"variants_needle_chart_base"),tooltip("hide")}},text:function(t,e,n){return draw.textOverflow(t.info.identifier,n.font,config.variants.needleGraph.now.width[t.info.identifier],5)}},config.variants.axis={left:{margin:[10,60,70,0]},top:{margin:[5,30,0,60]}},config.variants.navi={margin:[0,30,5,60],start:{init:0,now:0},end:{init:0,now:0},navi:{init:0,now:0,width:0,nowWidth:0},style:{fill:function(t,e,n){var i=!!t.info&&d3.rgb(config.landscape.color(t.info[0].type));return n.lg.selectAll("path").style("stroke","rgba(0, 0, 0, 0.1)"),!!i&&(i.opacity=.3,i)}},drag:{drag:function(t,e,n){function i(t,e){return t[e].now+=d3.event.dx,t[e].now=Math.max(t.start["end"===e?"now":"init"],Math.min(t.end["end"===e?"init":"now"],t["end"===e?"end":"start"].now)),t[e].now}var a=config.variants.navi,r=d3.select("#variants_navi_chart_navi");if("start"===t)d3.select(this).attr("x",i(a,"start")),a.navi.now=a.navi.init+(a.start.now-a.start.init),a.navi.nowWidth=a.navi.width-(a.end.init-a.end.now)-(a.start.now-a.start.init),r.attr("x",a.navi.now),r.attr("width",a.navi.nowWidth);else if("end"===t)d3.select(this).attr("x",i(a,"end")),a.navi.nowWidth=a.navi.width-(a.start.now-a.start.init)-(a.end.init-a.end.now),r.attr("width",a.navi.nowWidth);else{a.navi.now+=d3.event.dx;var o=a.navi.now=Math.max(a.navi.init,Math.min(a.navi.width+n.m.left-a.navi.nowWidth,a.navi.now));a.start.now=o-n.rect.width,a.end.now=o+a.navi.nowWidth-n.rect.width,r.attr("x",o),d3.select("#variants_navi_chart_start").attr("x",a.start.now),d3.select("#variants_navi_chart_end").attr("x",a.end.now)}}}},config.variants.patient={needle:{margin:[0,30,35,60],attr:{points:function(t,e,n){var i=n.s(t.position);return i<n.m.left?i=-n.m.left:i>n.w-n.m.right&&(i=n.w+n.m.right),i+","+n.len/2.5+" "+(i-n.len)+","+2*n.len+" "+(i+n.len)+","+2*n.len+" "+i+","+n.len/2.5}},style:{fill:function(t,e,n){return config.landscape.color(t.type)},stroke:function(t,e,n){return"#333333"}},on:{mouseover:function(t,e,n){tooltip({element:this,contents:"<b>"+t.id+"</b></br>Type: <b>"+t.type+"</b></br>AAChange: <b>"+t.aachange+"</b></br>Position: <b>"+t.position+"</b>"})},mouseout:function(t,e,n){tooltip("hide")}}},legend:{margin:[5,10,0,0],attr:{points:function(t,e,n){return n.padding+","+n.m.top+" "+(n.padding-n.shape/2)+","+2.5*n.m.top+" "+(n.padding+n.shape/2)+","+2.5*n.m.top+" "+n.padding+","+n.m.top},x:function(t,e,n){return n.shape/2+2*n.padding},y:function(t,e,n){return n.m.top/2+n.mh/2}},style:{fill:function(t,e,n){return n.isText?"#333333":"#FFFFFF"},stroke:function(t,e,n){return"#333333"},fontSize:function(t,e,n){return n.font}},text:function(t,e,n){return t}}},config.expression.colorSet=["#B82647","#0A8D5E","#F9D537","#0B6DB7","#E3DDCB","#9F494C","#CBDD61","#ED9149","#89236A","#D8C8B2","#CA5E59","#006494","#2E674E","#9A6B31","#403F95","#616264","#E2A6B4","#5AC6D0","#733E7F","#45436C"],config.expression.legend={bar:{margin:[5,5,5,5],text:function(t,e,n){return draw.textOverflow(t,"10px",.7*n.w)},attr:{x:function(t,e,n){return n.isText?n.m.left+2*n.padding:n.p},y:function(t,e,n){return n.isText?n.mh*e+(n.mh/4+.5)+3*e:n.mh*e+3*e},width:function(t,e,n){return n.mh/2},height:function(t,e,n){return n.mh/2}},style:{fill:function(t,e,n){return n.isText?"#333333":"NA"===t?"#A4AAA7":config.expression.colorSet[e]},stroke:function(t,e,n){return"#FFFFFF"},alignmentBaseline:function(t,e,n){return"middle"},fontSize:function(t,e,n){return"14px"}}},scatter:{margin:[30,10,10,10],text:function(t){return t},attr:{x:function(t,e,n){return n.isText?n.m.left+n.padding:n.p},y:function(t,e,n){return n.isText?n.mh*e+1:n.mh*e},r:function(t,e,n){return n.shape}},style:{fill:function(t,e,n){return"Alive"===t?"#5D5DD8":"#D86561"},fontSize:function(t,e,n){return"12px"}}},patient:{margin:[0,0,0,0],text:function(t){return t},attr:{},style:{}}},config.expression.scatter={margin:[10,30,35,20],attr:{x:function(t,e,n){return n.sx(t.x)-n.m.left},y:function(t,e,n){return n.sy(t.y)},r:function(t,e,n){return n.ss}},style:{fill:function(t,e,n){return void 0===t.value?"#333333":1===t.value?"#D86561":"#5D5DD8"},fillOpacity:function(t,e,n){return.6}},on:{mouseover:function(t,e,n){tooltip({element:this,contents:"ID: <b>"+t.x+"</b></br>Months: <b>"+t.y+"</b></br>Status: <b>"+("0"===t.value?"Alive":"Dead")+"</b>"})},mouseout:function(){tooltip("hide")}}},config.expression.bar={margin:[10,30,50,20],attr:{x:function(t,e,n){return n.sx(t.x)-n.m.left},y:function(t,e,n){return t.y-t.value<0?n.sy(t.value):n.sy(t.y)},width:function(t,e,n){return scale.compatibleBand(n.sx)},height:function(t,e,n){return t.y-t.value<0?n.sy(t.y)-n.sy(t.value):n.sy(t.value)-n.sy(t.y)}},style:{fill:function(t,e,n){return t.y-t.value==0?"#000":"#62C2E0"},stroke:function(t,e,n){return t.y-t.value==0?"#000":"#62C2E0"}},on:{mouseover:function(t,e,n){tooltip({element:this,direction:t.value>t.y?"top":"bottom",contents:"ID: <b>"+t.x+"</b></br>Average: <b>"+t.value+"</b>"})},mouseout:function(){tooltip("hide")}}},config.expression.heatmap={margin:[2,30,0,20],attr:{x:function(t,e,n){return n.sx(t.x)-n.m.left},y:function(t,e,n){return n.sy(t.y)},width:function(t,e,n){return scale.compatibleBand(n.sx)},height:function(t,e,n){return scale.compatibleBand(n.sy)}},on:{mouseover:function(t,e,n){tooltip({element:this,contents:"ID: <b>"+t.x+"</b></br>Gene: <b>"+t.y+"</b></br>TPM: <b>"+t.value+"</b>"})},mouseout:function(){tooltip("hide")}}},config.expression.division={margin:[0,30,25,20],marginScatter:[0,30,15,20],attr:{x:function(t,e,n){return e>0?n.isText?n.scale(n.axis[n.axis.length-1])-n.m.left-draw.getTextWidth(t.text,n.font)-2*n.padding:n.scale(t.point)-n.m.left:n.isText?n.scale(n.axis[0])-n.m.left+2*n.padding:n.scale(n.axis[0])-n.m.left},y:function(t,e,n){return n.isText?n.h-n.m.bottom+n.textHeight-n.padding:n.h-n.m.bottom},width:function(t,e,n){return e>0?n.scale(n.axis[n.axis.length-1])-n.scale(t.point):n.scale(t.point)-n.m.left},height:function(t,e,n){return n.textHeight+2*n.padding},rx:function(t,e,n){return 3},ry:function(t,e,n){return 3}},style:{fill:function(t,e,n){return n.isText?"#232323":t.color},stroke:function(t,e,n){return n.isLine?"#000000":"#FFFFFF"},dashed:function(t,e,n){return"4, 2"}},on:{mouseover:function(t,e,n){tooltip({element:this,contents:"<b>"+(t.text.indexOf("Low")>-1?"Left to adjust":"Right to adjust")+"</b>",type:"warning"})},mouseout:function(t,e,n){tooltip("hide")}},lowPos:0,highPos:0,drag:{drag:function(t,e,n){function i(t,e){return d3.select(t).selectAll("rect").filter(function(t,n){if(t.text.indexOf(e)>-1)return this})}config.expression.division;var a=this.id.indexOf("bar")>-1?"Low":"High",r=d3.select(this),o=d3.select(r.node().parentNode).select("path"),l="High"===a?i(".expression_bar_plot_chart.division-g-tag","High"):i(r.node().parentNode,"Low");"Low"===a?r.attr("cx",function(t){config.expression.division.lowPos+=d3.event.dx;var e=config.expression.division.lowPos=Math.max(0,Math.min(config.expression.division.highPos,config.expression.division.lowPos)),i=o.attr("d");l.attr("width");return o.attr("d",n.line([{x:e,y:parseFloat(i.substring(i.indexOf(",")+1,i.indexOf("L")))},{x:e,y:parseFloat(i.substring(i.lastIndexOf(",")+1))}])),l.attr("width",e),e}):r.attr("cx",function(t){config.expression.division.highPos+=d3.event.dx;var e=config.expression.division.highPos=Math.max(config.expression.division.lowPos,Math.min(n.scale(n.axis[n.axis.length-1])-n.m.left,config.expression.division.highPos));l.attr("x");return o.attr("d",n.line([{x:e,y:0},{x:e,y:n.h-n.m.bottom}])),l.attr("x",e),l.attr("width",n.scale(n.axis[n.axis.length-1])-n.m.left-(n.scale(n.point)-n.m.left)-(e-(n.scale(n.point)-n.m.left))),e})}},line:{x:function(t){return t.scale(t.point)-t.m.left},y:function(t){return t.id.indexOf("bar")>0?t.m.bottom/2:0}},text:function(t,e,n){return t.text},figure:{data:function(t,e){return e.id.indexOf("bar")>0?[t[0]]:[t[1]]},attr:{id:function(t,e,n){return n.id+"_div_marker"},cx:function(t,e,n){return config.expression.division.lowPos=n.scale(n.point)-n.m.left,config.expression.division.highPos=n.scale(n.point)-n.m.left,n.scale(n.point)-n.m.left},cy:function(t,e,n){return n.id.indexOf("scatter")>-1?n.h-n.m.bottom:n.m.bottom/2},r:function(t,e,n){return 3}},style:{fill:function(t,e){return t.color}}}},config.expression.patient={margin:[10,30,50,20],attr:{points:function(t,e,n){var i=n.sx(t.x),a=n.id.indexOf("bar")>0?(t.y-t.value<0?n.sy(t.value):n.sy(t.y))+5:n.h;return i+", "+a+" "+(i-4)+","+(a-7)+" "+(i+4)+","+(a-7)+" "+i+","+a}},style:{fill:function(t,e){return"#000000"},stroke:function(t,e){return"#B7B7B7"},"stroke-width":"1px",cursor:"pointer"},on:{mouseover:function(t,e){tooltip({element:this,contents:"<b>"+t.x+"</b></br>Value: <b>"+t.value+"</b>"})},mouseout:function(t,e){tooltip("hide")}}},config.expression.sample={attr:{x:function(t,e){var n=d3.select(".legend").node().getBoundingClientRect();return e.data.patient.data===t.text?n.right-n.left:-5},y:function(t,e){var n=d3.select(".legend text").node().getBoundingClientRect();return t.text.indexOf("Low")>-1?n.height/2+n.height/4:.7*draw.getTextHeight("14px").height}},style:{fill:function(t,e){return e.data.patient.data===t.text?t.color:"#FFFFFF"},fontSize:function(t){return"25px"}},text:function(t,e){return e.data.patient.data===t.text?" **":""}},config.expression.sampleLegend={};var divisionLine=function(t){"use strict";var e={};return function(t){if(e={},e.e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),e.m=size.setMargin(t.margin),e.id=e.e.attr("id"),e.w=t.width||e.e.attr("width"),e.h=t.height||e.e.attr("height"),e.g=render.addGroup(e.e,e.m.top,e.m.left,"division"),e.axis=t.xaxis||t.yaxis||[""],e.scale=scale.get(e.axis,t.xaxis?[e.m.left,e.w-e.m.right]:[e.m.top,e.h-e.m.bottom]),e.point="Array"===util.varType(t.point)?util.median(t.point):t.point,e.font=t.font||"10px",e.padding=t.padding||5,e.textHeight=draw.getTextHeight(e.font).height,e.data=t.data.map(function(t){return t.point=e.point,t}),e.line=(util.d3v4()?d3.line():d3.svg.line()).x(function(t){return t.x}).y(function(t){return t.y}),e.showRect=void 0===t.showRect&&!1!==t.showRect||t.showRect,e.showText=void 0===t.showText&&!1!==t.showText||t.showText,e.showLine=void 0===t.showLine&&!1!==t.showLine||t.showLine,e.marker=(void 0!==t.marker||!1===t.marker)&&(t.marker||"circle"),e.showRect&&render.rect({element:e.g.selectAll("#"+e.id+"_div_rect"),data:e.data,attr:{id:function(t){return e.id+"_div_rect"},x:function(n,i){return t.attr.x?t.attr.x.call(this,n,i,e):0},y:function(n,i){return t.attr.y?t.attr.y.call(this,n,i,e):0},width:function(n,i){return t.attr.width?t.attr.width.call(this,n,i,e):0},height:function(n,i){return t.attr.height?t.attr.height.call(this,n,i,e):0},rx:function(n,i){return t.attr.rx?t.attr.rx.call(this,n,i,e):0},ry:function(n,i){return t.attr.ry?t.attr.ry.call(this,n,i,e):0}},style:{fill:function(n,i){return t.style.fill?t.style.fill.call(this,n,i,e):"#000"},stroke:function(n,i){return t.style.stroke?t.style.stroke.call(this,n,i,e):"#000"}}}),e.showText&&render.text({element:e.g.selectAll("#"+e.id+"_div_text"),data:e.data,attr:{id:function(t){return e.isText=!0,e.id+"_div_text"},x:function(n,i){return t.attr.x?t.attr.x.call(this,n,i,e):0},y:function(n,i){return t.attr.y?t.attr.y.call(this,n,i,e):0}},style:{fill:function(n,i){return t.style.fill?t.style.fill.call(this,n,i,e):"#000"},"alignment-baseline":function(n,i){return t.style.alignmentBaseline?t.style.alignmentBaseline.call(this,n,i,e):"middle"},"font-size":function(n,i){return t.style.fontSize?t.style.fontSize.call(this,n,i,e):e.font},"font-weight":function(n,i){return t.style.fontWeight?t.style.fontWeight.call(this,n,i,e):"bold"}},text:function(n,i){return t.text?t.text.call(this,n,i,e):""}}),e.showLine){var n=t.lineX?t.lineX(e):0,i=t.lineY?t.lineY(e):0;render.line({element:e.g,attr:{id:function(t){return e.isLine=!0,e.id+"_div_line"},d:e.line([{x:n,y:i},{x:n,y:e.h-e.m.bottom}])},style:{stroke:function(n,i){return t.style.stroke?t.style.stroke.call(this,n,i,e):"#000"},"stroke-dasharray":function(n,i){return t.style.dashed?t.style.dashed.call(this,n,i,e):"5, 10"}}})}e.marker&&"circle"===e.marker&&render.circle({element:e.g.selectAll("#"+e.id+"_div_marker"),data:t.figure.data?t.figure.data(e.data,e):e.data,attr:{id:function(n,i){return t.figure.attr.id?t.figure.attr.id.call(this,n,i,e):""},cx:function(n,i){return t.figure.attr.cx?t.figure.attr.cx.call(this,n,i,e):0},cy:function(n,i){return t.figure.attr.cy?t.figure.attr.cy.call(this,n,i,e):0},r:function(n,i){return t.figure.attr.r?t.figure.attr.r.call(this,n,i,e):0}},style:{fill:function(n,i){return t.figure.style.fill?t.figure.style.fill.call(this,n,i,e):0},stroke:function(n,i){return t.figure.style.stroke?t.figure.style.stroke.call(this,n,i,e):0},cursor:"pointer"},on:{mouseover:function(n,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(this,n,i,e))},mouseout:function(n,i){return!!t.on&&(!!t.on.mouseout&&t.on.mouseout.call(this,n,i,e))}},call:{start:function(n,i){return!!t.drag&&(!!t.drag.start&&t.drag.start.call(this,n,i,e))},drag:function(n,i){return!!t.drag&&(!!t.drag.drag&&t.drag.drag.call(this,n,i,e))},end:function(n,i){return!!t.drag&&(!!t.drag.end&&t.drag.end.call(this,n,i,e))}}})}}(),draw=function(t){"use strict";function e(t,e){return t.parentNode.querySelector("#"+e).nextSibling}return t.ctx=null,t.clearCanvas=function(t){t.children.length>0&&t.removeChild(t.firstChild)},t.width=function(t){return"string"==typeof t?parseFloat(document.querySelector(t)):parseFloat(t.style.width)},t.height=function(t){return"string"==typeof t?parseFloat(document.querySelector(t)):parseFloat(t.style.height)},t.getTextWidth=function(t,e){var n=document.createElement("canvas"),i=n.getContext("2d"),a=0;return n.id="get-text-width",i.font=e||"10px",document.body.appendChild(n),t=t.replace(" ","A").toUpperCase(),a=i.measureText(t).width,document.body.removeChild(document.getElementById("get-text-width")),a},t.getMostWidthOfText=function(e,n){var i=0;return util.loop(e,function(e,a){i=i>t.getTextWidth(e,n)?i:t.getTextWidth(e,n)}),i},t.getTextHeight=function(t,e){var n=document.createElement("span"),i=document.createElement("div"),a=document.createElement("div");a.id="get_text_height",n.style.fontSize=t||"10px",n.innerHTML="Hg",i.style.display="inline-block",i.style.width="0px",i.style.height="0px",a.appendChild(n),a.appendChild(i),document.querySelector("body").appendChild(a);try{var r={};i.style.verticalAlign="baseline",r.ascent=i.offsetTop-n.offsetTop,i.style.verticalAlign="bottom",r.height=i.offsetTop-n.offsetTop,r.descent=r.height-r.ascent}finally{a.parentNode.removeChild(document.getElementById("get_text_height"))}return r},t.randomDraw=function(t,e){return Math.floor(Math.random()*t)+(e||0)},t.getDegree=function(t,e,n,i){var a=n-t,r=i-e,o=Math.atan2(a,r);return{radian:o,degree:Math.floor(180*o/Math.PI)}},t.noOverlap=function(e,n,i){for(var a=n.filter(function(t){return"node"===t.type}),r=n.filter(function(t){return"edge"===t.type}),o=0,l=a.length;o<l;o++){var s=a[o];s.textWidth=t.getTextWidth(e,"14px Calibri",s.text),s.width=s.width||1.2*s.textWidth,s.height=s.height||24,s.radius=5,i&&(s.top=i.members.indexOf(s.text)>-1?t.randomDraw(i.top+s.height/2,.7*i.height-s.height/2):(i.top-0)/2-s.height/2,s.left=t.randomDraw(i.left+i.width-i.left-s.width,i.left)),r.forEach(function(t){t.source=t.source.substring(0,s.text.length)===s.text?s.text:t.source,t.target=t.target.substring(0,s.text.length)===s.text?s.text:t.target,t.id=t.id.substring(0,t.source.length+t.target.length)})}return n},t.size=function(t){return t=util.d3v4()?t:t[0][0],t="Array"===util.varType(t)||"Object"===util.varType(t)?t:d3.select(t),{w:parseFloat(t.attr("width")),h:parseFloat(t.attr("height"))}},t.textOverflow=function(e,n,i){var a="";return e.split("").some(function(e){return t.getTextWidth(a+=e,n)>i}),a===e?e:a+"..."},t.getFitTextSize=function(e,n,i){for(var a=10;;){var r=a+"px";if(t.getTextHeight(r).height>i||t.getTextWidth(e,r)>n)break;a+=1}return a-1+"px"},t.textOverflow=function(e,n,i,a){var r="",a=a||0;return t.getTextWidth(e,n)<i-a?e:(util.loop(e.split(""),function(e){t.getTextWidth(r+=e,n)>i-a&&(r=r.substring(0,r.length-2))}),r)},t.getParentSvg=function(e){return"svg"===e.parentElement.tagName?e.parentElement:t.getParentSvg(e.parentElement)},t.toFront=function(t){t.parentNode.appendChild(t)},t.toBack=function(t,n){n?t.parentNode.insertBefore(t,e(t,n)):t.parentNode.insertBefore(t,t.parentNode.firstChild)},t}(draw||{}),eventHandler=function(t){"use strict";function e(t){function e(e){t({x:e.pageX-i.ctx.canvas.offsetLeft,y:e.pageY-i.ctx.canvas.offsetTop})}if(!i.ctx)throw new Error("Not found context of canvas.");i.ctx.canvas.removeEventListener("mousemove",e),i.ctx.canvas.addEventListener("mousemove",e)}function n(t,e){var n=!1;document.body.addEventListener(e,function(t){if(n)return t.preventDefault&&t.preventDefault(),!1}),t.addEventListener("mouseenter",function(t){n=!0}),t.addEventListener("mouseleave",function(t){n=!1})}var i={};return t.context=function(e){return i.ctx=e,arguments.length?t:i.ctx},t.data=function(e){return i.data=e,arguments.length?t:i.data},t.hover=function(t){e(function(t){})},t.onScroll=function(t,e){(t="object"==typeof t?t:document.querySelector(t)).addEventListener("scroll",e)},t.verticalScroll=function(t,e){if(!t)throw new Error("There are not given dom element");n(t,"mousewheel"),t.addEventListener("mousewheel",function(n){t.scrollTop+=n.wheelDelta,e&&e.call(t,n)})},t.hoverSVG=function(t,e){console.log(t)},t}(eventHandler||{}),exclusive=function(){"use strict";function t(){var t={};return util.loop(m.data.survival.data[m.now.geneset],function(e,n){e&&(n<=m.data.divisionIdx[m.now.geneset].idx?t[e.participant_id]="altered":t[e.participant_id]="unaltered")}),t}function e(){var e=document.querySelector("#exclusivity_survival"),n=parseFloat(e.style.width),i=parseFloat(e.style.height)/1.5;SurvivalCurveBroilerPlate.settings={canvas_width:n,canvas_height:i,chart_width:n-30,chart_height:i-30,chart_left:50,chart_top:15,include_info_table:!1,include_legend:!0,include_pvalue:!0,pval_x:n-200,pval_y:42},SurvivalCurveBroilerPlate.style={censored_sign_size:5,axis_stroke_width:1,axisX_title_pos_x:n/2,axisX_title_pos_y:i-25,axisY_title_pos_x:-n/2+25,axisY_title_pos_y:10,axis_color:"black",pval_font_size:14,pval_font_style:"normal"},SurvivalCurveBroilerPlate.subGroupSettings.legend={low:"Unaltered group",high:"Altered group"},survival({element:"#exclusivity_survival",margin:[20,20,20,20],data:m.data.survival.data[m.now.geneset],divisionData:t()})}function n(){console.log(m.now.geneset,m.data.network),network({data:m.data.network[m.now.geneset],element:"#exclusivity_network"})}function i(){layout.getSVG(m.svg,["heatmap"],function(t,e){axis.element(e).left({margin:[35,0,35,e.attr("width")-80],data:m.now.geneset.split(" "),opt:{remove:"line, path"}}).attr("id","exclusivity_heatmap_axis")})}function a(){layout.getSVG(m.svg,["heatmap"],function(t,e){heatmap({element:e,data:m.data.heatmap[m.now.geneset],opt:config.exclusivity.heatmap.opt,attr:config.exclusivity.heatmap.attr,style:config.exclusivity.heatmap.style,margin:config.exclusivity.heatmap.margin,xaxis:m.data.axis.heatmap.x[m.now.geneset],yaxis:m.data.axis.heatmap.y[m.now.geneset]})})}function r(){layout.getSVG(m.svg,["heatmap"],function(t,e){divisionLine({element:e,data:[{text:"Altered group",color:"#FF6252"},{text:"Unaltered group",color:"#00AC52"}],xaxis:m.data.axis.heatmap.x[m.now.geneset],margin:config.exclusivity.division.margin,padding:6,text:config.exclusivity.division.text,attr:config.exclusivity.division.attr,style:config.exclusivity.division.style,font:"14px",lineX:config.exclusivity.division.line.x,lineY:config.exclusivity.division.line.y,point:m.data.divisionIdx[m.now.geneset].idx+1})})}function o(){layout.getSVG(m.svg,["ty_legend"],function(t,e){legend({element:e,data:m.data.type[m.now.geneset],priority:config.exclusivity.priority,text:config.exclusivity.legend.text,font:"14px",attr:config.exclusivity.legend.attr,style:config.exclusivity.legend.style,margin:config.exclusivity.legend.margin})})}function l(){u(m.origin.sample),e(),n(),i(),a(),r(),o(),h()}function s(t,e){var n=document.getElementById("sample_id").value,i=m.now.geneset.split(" "),a=".";return t.length<1?["**",n+" Belongs to","Unaltered group"]:(util.loop(t,function(t){var n=e[i.indexOf(t.gene)];n.indexOf(t.value)>-1&&(a="."!==a?a:n[n.indexOf(t.value)])}),"."===a?["**",n+" Belongs to","Unaltered group"]:["**",n+" Belongs to","Altered group"])}function u(t){m.data.sample={data:[],isAltered:!1},util.loop(t,function(t){m.now.geneset.indexOf(t.gene)>-1&&m.data.sample.data.push({gene:t.gene,value:config.exclusivity.symbol(config.exclusivity.case(config.landscape.case(t.class),t.class))})}),m.data.sample.isAltered=s(m.data.sample.data,m.data.survival.heat[m.now.geneset])}function c(){layout.getSVG(m.svg,["sample_legend"],function(t,e){legend({element:e,data:m.data.sample.isAltered,font:"14px",attr:config.exclusivity.sample.legend.attr,style:config.exclusivity.sample.legend.style,text:config.exclusivity.sample.legend.text,margin:config.exclusivity.sample.legend.margin})})}function d(){layout.getSVG(m.svg,["heatmap"],function(t,e){var n=config.exclusivity.sample.division,i={};i.e=e,i.m=size.setMargin(n.margin),i.g=render.addGroup(e,i.m.top,i.m.left,"division-star"),render.text({element:i.g.selectAll("#"+e.attr("id")+"_sample"),data:[{value:"**",type:m.data.sample.isAltered}],attr:{id:function(t){return e.attr("id")+"_sample"},x:function(t,e){return n.attr.x.call(this,t,e,i)},y:function(t,e){return n.attr.y.call(this,t,e,i)}},style:{fill:function(t,e){return n.style.fill.call(this,t,e,i)},"font-size":"25px","alignment-baseline":"middle"},text:function(t,e){return n.text.call(this,t,e,i)}})})}function f(t,e){for(var n=0,i=t.length;n<i;n++){var a=t[n],r=e[n];m.data.sample.isAltered.indexOf(a.innerHTML)>-1&&(a.innerHTML+=" **",r.innerHTML+=" **")}}function p(t){var e=config.exclusivity.sample.survival;render.text({element:t,attr:{x:function(t,n,i){return e.attr.x.call(this,t,n,m)},y:function(t,n,i){return e.attr.y.call(this,t,n,m)}},style:{fill:function(t,n,i){return e.style.fill.call(this,t,n,m)},"font-size":function(t,n,i){return e.style.fontSize.call(this,t,n,m)}},text:function(t,n){return e.text.call(this,t,n,m)}})}function g(){var t={},e=setInterval(function(){t.ostb=document.querySelectorAll("#dfs_stat_table td b"),t.dfstb=document.querySelectorAll("#os_stat_table td b"),t.legends=d3.selectAll(".legend"),t.ostb.length>0&&t.dfstb.length>0&&t.legends.node()&&(f(t.ostb,t.dfstb),p(t.legends),clearInterval(e))},10)}function h(){c(),d(),g()}var m={now:{geneset:null}};return function(t){console.log("Given Exclusivity data: ",t);var e=document.querySelector(t.element||null),n=parseFloat(t.width||e.style.width||1400),i=parseFloat(t.height||e.style.height||700);e.style.background="#F7F7F7",m.origin=t.data,m.data=preprocessing.exclusivity(t.data),m.ids=size.chart.exclusivity(e,n,i),m.svg=layout.exclusivity(m.ids,m),m.now.geneset=m.data.geneset[0].join(" "),selectBox({element:"#exclusivity_select_geneset",initText:m.now.geneset,className:"exclusivity-geneset",viewName:"geneset",items:m.data.geneset.map(function(t){return t.join(" ")}),click:function(t){m.now.geneset=t.toUpperCase(),layout.removeG(),l()}}),l(),console.log("Exclusivity Model data: ",m)}}(),expression=function(t){"use strict";function n(t,e){A.data.survival.divide={},util.loop(t,function(t,n){t.value<=e?A.data.survival.divide[t.x]="unaltered":A.data.survival.divide[t.x]="altered"})}function i(t){A.now.osdfs!==t&&(layout.removeG(["scatter-g-tag"]),g(A.now.osdfs=t,A.now.osdfs),(A.divide.lowArr||A.divide.highArr)&&d(d3.selectAll("#expression_scatter_plot_chart_circle"),A.divide.lowArr,A.divide.highArr))}function a(){var t=document.getElementById("expression_survival").querySelectorAll("input");t[0].onclick=function(t){i("os")},t[1].onclick=function(t){i("dfs")}}function r(){var t=document.querySelector("#expression_survival"),e=parseFloat(t.style.width),i=parseFloat(t.style.height)/1.4;SurvivalCurveBroilerPlate.settings={canvas_width:e,canvas_height:i,chart_width:e-30,chart_height:i-30,chart_left:50,chart_top:15,include_info_table:!1,include_legend:!0,include_pvalue:!0,pval_x:e-190,pval_y:42},SurvivalCurveBroilerPlate.style={censored_sign_size:5,axis_stroke_width:1,axisX_title_pos_x:e/2,axisX_title_pos_y:i-25,axisY_title_pos_x:-e/2+25,axisY_title_pos_y:10,axis_color:"black",pval_font_size:12,pval_font_style:"normal"},SurvivalCurveBroilerPlate.subGroupSettings.legend={low:"Low score group",high:"High score group"};n(A.data.bar,A.data.axis.bar.y[1]);var r=survival({element:"#expression_survival",margin:[20,20,20,20],data:A.divide.patient_list||A.origin.patient_list,divisionData:A.divide.divide||A.data.survival.divide});A.data.survival.data=r.survivalData,A.data.scatter=Object.keys(A.data.scatter).length<1?A.data.survival.data.all:A.data.scatter,a()}function o(){layout.getSVG(A.svg,["bar_plot"],function(t,e){var n=A.data.axis.bar.y;config.expression.bar.margin.splice(1,1,A.data.axisLeft),bar({element:e,data:A.data.bar,direction:"bottom",margin:config.expression.bar.margin,attr:config.expression.bar.attr,style:config.expression.bar.style,xaxis:A.data.axis.bar.x,yaxis:[n[2],n[0]],on:config.expression.bar.on}),axis.element(e).left({margin:[10,0,50,e.attr("width")-A.data.axisLeft],data:[n[2],n[0]],opt:{tickValues:n}}).style("stroke-width","0.3")})}function l(){selectBox({element:"#expression_function",className:"expression-function",margin:[3,3,0,0],initText:"Average",viewName:"function",items:["Average"],click:function(t){A.now.func=t,console.log("Function is: ",A.now.func)}})}function s(t){if(!A.now.colorSet)return"#62C2E0";var e=t.info?t.info[A.now.col]:"NA";return"NA"===e?"#A4AAA7":config.expression.colorSet[A.now.colorSet.indexOf(e)]}function u(){selectBox({element:"#expression_color_mapping",margin:[3,3,0,0],className:"expression-color-mapping",initText:"Color Mapping",viewName:"color_mapping",items:A.data.subtype.map(function(t){return t.key}),click:function(t){A.now.col=t,A.data.subtype.some(function(t){return A.now.colorSet=t.value,A.now.col===t.key}),layout.removeG(["expression_bar_legend_chart"]),d3.selectAll("#expression_bar_plot_chart_rect").style("fill",s).style("stroke",s),c()}})}function c(){A.now.colorSet&&layout.getSVG(A.svg,["bar_legend"],function(t,e){legend({element:e,data:A.now.colorSet,text:config.expression.legend.bar.text,attr:config.expression.legend.bar.attr,style:config.expression.legend.bar.style,margin:config.expression.legend.bar.margin})})}function d(t,e,n){t.style("fill-opacity",function(i){return e.indexOf(i.x)<0&&n.indexOf(i.x)<0?.08:t.attr("id").indexOf("circle")>-1?.6:1}).style("stroke-opacity",function(t){return e.indexOf(t.x)<0&&n.indexOf(t.x)<0?.08:1})}function f(){function t(t){util.loop(t,function(t){t!==A.data.patient.name&&(util.loop(A.origin.patient_list,function(e){e.participant_id===t&&A.divide.patient_list.push(e)}),A.divide.divide[t]=A.data.survival.divide[t])})}function e(e,n){A.divide.divide={},A.divide.patient_list=[],A.divide.scatter={os:[],dfs:[]},t(e),t(n),r(),y(),d(d3.selectAll("#expression_bar_plot_chart_rect"),e,n),d(d3.selectAll("#expression_scatter_plot_chart_circle"),e,n)}config.expression.division.margin.splice(1,1,A.data.axisLeft),config.expression.division.marginScatter.splice(1,1,A.data.axisLeft);var n={padding:3,font:"12px",xaxis:A.data.axis.bar.x,margin:config.expression.division.margin,point:A.data.axis.bar.x[util.medIndex(A.data.axis.bar.x)],data:[{text:"Low score group",color:"#00AC52"},{text:"High score group",color:"#FF6252"}],text:config.expression.division.text,attr:config.expression.division.attr,style:config.expression.division.style,figure:config.expression.division.figure,lineX:config.expression.division.line.x,lineY:config.expression.division.line.y,marker:"circle",on:config.expression.division.on,drag:{drag:config.expression.division.drag.drag,end:function(t,n,i){var a=(new Array).concat(i.axis),r=scale.invert(i.scale);A.divide.lowSam=r(config.expression.division.lowPos+i.m.left),A.divide.highSam=r(config.expression.division.highPos+i.m.left),A.divide.highArr=a.splice(i.axis.indexOf(A.divide.highSam),a.length-1),A.divide.lowArr=a.splice(0,i.axis.indexOf(A.divide.lowSam)),e(A.divide.lowArr,A.divide.highArr)}}};layout.getSVG(A.svg,["bar_plot"],function(t,e){n.element=e,divisionLine(n)}),layout.getSVG(A.svg,["scatter_plot"],function(t,e){n.element=e,n.yAdjust=0,n.showRect=!1,n.showText=!1,n.margin=config.expression.division.marginScatter,divisionLine(n)})}function p(t){var e=[];return util.loop(t,function(t){util.loop(t,function(t,n){A.data.axis.scatter.x.indexOf(t)>-1&&e.push({x:t,y:n.months,value:n.status})})}),e}function g(t){layout.getSVG(A.svg,["scatter_plot"],function(e,n){var i=(new Array).concat(A.data.axis.scatter.y[t]).reverse();util.minmax(i);config.expression.scatter.margin.splice(1,1,A.data.axisLeft),scatter({element:n,data:p(A.data.scatter[t]),margin:config.expression.scatter.margin,attr:config.expression.scatter.attr,style:config.expression.scatter.style,xaxis:A.data.axis.scatter.x,yaxis:i,on:config.expression.scatter.on}),axis.element(n).left({margin:[10,0,35,n.attr("width")-A.data.axisLeft],data:i,opt:{}}).style("stroke-width","0.3")})}function h(){layout.getSVG(A.svg,"scatter_legend",function(t,e){legend({element:e,data:["Alive","Dead"],text:config.expression.legend.scatter.text,attr:config.expression.legend.scatter.attr,style:config.expression.legend.scatter.style,margin:config.expression.legend.scatter.margin})})}function m(){layout.getSVG(A.svg,["heatmap"],function(t,e){var n=draw.getTextHeight("12px").height,i=scale.get(A.data.axis.gradient.x,["#FF0000","#000000","#00FF00"]);e.attr("height",A.data.axis.heatmap.y.length*n),config.expression.heatmap.margin.splice(1,1,A.data.axisLeft),heatmap({element:e,data:A.data.heatmap,xaxis:A.data.axis.heatmap.x,yaxis:A.data.axis.heatmap.y,margin:config.expression.heatmap.margin,attr:config.expression.heatmap.attr,style:{fill:function(t,e){return i(t.value)}},on:config.expression.heatmap.on}),axis.element(e).left({margin:[2,0,0,e.attr("width")-A.data.axisLeft],data:A.data.axis.heatmap.y,opt:{remove:"path, line"}}),eventHandler.verticalScroll(e.node().parentNode)})}function x(){selectBox({element:"#expression_signature",className:"expression-signature",margin:[3,3,0,0],initText:A.init.sig,viewName:"signature",items:A.origin.signature_list.map(function(t){return t.signature}),click:function(t){A.now.sig&&A.now.sig!==t&&(A.now.sig=t,A.req.signature=A.now.sig,$.ajax({type:"GET",url:A.url,data:A.req,success:function(t){layout.removeG(),F(t.data)}}))}})}function v(){layout.getSVG(A.svg,["gradient"],function(t,e){A.data.colorGradient=colorGradient({element:e,offset:A.data.axis.gradient.x,adjustValue:6,colors:["#FF0000","#000000","#00FF00"]}),render.rect({element:render.addGroup(e,5,3,"gradient"),attr:{id:t+"_rect",x:0,y:0,rx:3,rx:3,width:e.attr("width")-6,height:.1*e.attr("height")},style:{fill:"url(#"+A.data.colorGradient.id+")"}}),axis.element(e).bottom({margin:[0,3,.9*e.attr("height"),10],data:[A.data.axis.gradient.x[0],A.data.axis.gradient.x[2]],opt:{tickValues:A.data.axis.gradient.x,remove:"path, line"}}).selectAll("text").style("fill","#999999")})}function y(){layout.getSVG(A.svg,["bar_plot","scatter_plot"],function(t,e){var n={},i=A.data.axis.bar.y;n.g=render.addGroup(e,0,0,t.indexOf("bar")>-1?"bar-patient":"scatter-patient"),n.id=e.attr("id"),n.m=size.setMargin(config.expression.patient.margin),n.w=e.attr("width"),n.h=e.attr("height"),n.sx=scale.get(A.data.axis.heatmap.x,[n.m.left,n.w-n.m.right]),n.sy=scale.get([i[2],i[0]],[n.m.top,n.h-n.m.bottom]),render.triangle({element:n.g.selectAll("#"+n.id+"_tri"),data:A.data.bar.filter(function(t){if(t.x===A.data.patient.name)return t}),attr:{id:function(t){return n.id+"_tri"},points:function(t,e){return config.expression.patient.attr.points.call(this,t,e,n)}},style:config.expression.patient.style,on:config.expression.patient.on})}),_()}function w(t,e){for(var n=0,i=t.length;n<i;n++){var a=t[n],r=e[n];A.data.patient.data===a.innerHTML&&(a.innerHTML+=" **",r.innerHTML+=" **")}}function b(t){var e=config.expression.sample;render.text({element:t,attr:{x:function(t){return e.attr.x(t,A)},y:function(t){return e.attr.y(t,A)}},style:{fill:function(t){return e.style.fill(t,A)},"font-size":function(t){return e.style.fontSize(t,A)}},text:function(t){return e.text(t,A)}})}function _(){var t={},e=setInterval(function(){t.ostb=document.querySelectorAll("#dfs_stat_table td b"),t.dfstb=document.querySelectorAll("#os_stat_table td b"),t.legends=d3.selectAll(".legend"),t.ostb.length>0&&t.dfstb.length>0&&t.legends.node()&&(w(t.ostb,t.dfstb),b(t.legends),clearInterval(e))},10)}function F(t){A.data=preprocessing.expression(t);var e=draw.getMostWidthOfText(A.data.axis.heatmap.y,"12px");A.data.axisLeft=10*Math.ceil(e/10),l(),u(),c(),r(),o(),f(),g(A.now.osdfs),h(),m(),x(),v(),y()}var A={init:{func:"Average",sig:null,col:null},now:{func:null,sig:null,col:null,osdfs:"os"},divide:{}};return function(t){A.e=document.querySelector(t.element||null),A.w=parseFloat(t.width||e.style.width||1400),A.h=parseFloat(t.height||e.style.height||700),A.e.style.background="#F7F7F7",A.origin=t.data,A.element=t.element,A.req=t.req,A.url=t.url||"/rest/expressions",A.ids=size.chart.expression(A.e,A.w,A.h),A.svg=layout.expression(A.ids,A),A.init.sig=A.origin.signature_list[0].signature,A.now.sig=A.init.sig,F(t.data),console.log("Given Expression data: ",t),console.log("Expression Model data: ",A)}}(),heatmap=function(t){"use strict";function e(t){util.loop(t,function(t,e){util.loop(i.mt,function(t,n){e[t][0]&&i.d.push({x:e.x,y:e.y,value:e[t][0],info:e[t].splice(1)})})})}function n(t){return util.loop(t,function(t,e){var n=t.x+t.y,a=config.landscape.case(t.value);i.v[n]?config.landscape.priority(i.v[n][a][0])>config.landscape.priority(t.value)?i.v[n][a].unshift(t.value):i.v[n][a].push(t.value):(i.v[n]={cnv:[],var:[],x:t.x,y:t.y},i.v[n][a].push(t.value))}),e(i.v)}var i={mt:["cnv","var"],v:{},d:[]};return function(t){(i={mt:["cnv","var"],v:{},d:[]}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),i.w=i.e.attr("width"),i.h=i.e.attr("height"),i.m=size.setMargin(t.margin),i.g=render.addGroup(i.e,i.m.top,i.m.left,"heatmap"),i.sx=scale.get(t.xaxis,[i.m.left,(t.width||i.w)-i.m.right]),i.sy=scale.get(t.yaxis,[i.m.top,(t.height||i.h)-i.m.bottom]);var e=i.e.attr("id");return render.rect({element:i.g.selectAll("#"+e+"_rect"),data:t.dup?(n(t.data),i.d):t.data,attr:{id:function(t,n){return e+"_rect"},x:function(e,n){return t.attr.x?t.attr.x.call(this,e,n,i):0},y:function(e,n){return t.attr.y?t.attr.y.call(this,e,n,i):0},width:function(e,n){return t.attr.width?t.attr.width.call(this,e,n,i):0},height:function(e,n){return t.attr.height?t.attr.height.call(this,e,n,i):0}},style:{fill:function(e,n){return t.style.fill?t.style.fill.call(this,e,n,i):"#000000"},stroke:function(e,n){return!!t.style.stroke&&t.style.stroke.call(this,e,n,i)}},on:{mouseover:function(e,n){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(this,e,n,i))},mouseout:function(e,n){return!!t.on&&(!!t.on.mouseout&&t.on.mouseout.call(this,e,n,i))}}}),i}}(),landscape=function(t){"use strict";function e(){C.div.title=document.querySelector("#landscape_title"),C.div.title.innerHTML=C.origin.title,C.div.title.style.fontSize=draw.getFitTextSize(C.origin.title,parseFloat(C.div.title.style.width),parseFloat(C.div.title.style.height)),C.div.title.style.lineHeight=parseFloat(C.div.title.style.height)+"px"}function n(t,e,n){var i=document.createElement("div");C.ids.push((i.id=t.id+"_"+e,i.id)),util.loop(n,function(t,e){i.style[t]=e}),t.appendChild(i)}function i(t){var e={_patient:document.getElementById("landscape_patient_group"),_axis:document.getElementById("landscape_axis_group"),_chart:document.getElementById("landscape_group")};util.loop(e,function(e,i){util.loop(t.map(function(t){return t.name}),function(a,r){n(i,util.removeWhiteSpace(a)+e,{width:draw.width(i)+"px",height:draw.height(i)/t.length+"px",overflowX:"hidden",overflowY:"hidden"})})})}function a(t,e,n,i){var a=!1;util.loop(t.split("_"),function(t,r){config.landscape[e][t]&&(a||(a=!0,i(config.landscape[e][t],n[t])))})}function r(t,e){return a(t,"axis",C.data.axis,e)}function o(t,e){return a(t,"bar",C.data,e)}function l(t,e){return a(t,"stack",C.data.stack,e)}function s(t,e){return a(t,"heatmap",C.data,e)}function u(t,e){return a(t,"group",C.data.group,e)}function c(t,e){var n;return t.indexOf("group")<0?e:(t.split("_").forEach(function(t){util.loop(e,function(e,i){t===e[0].replace(/\s/gi,"")&&(n=e)})}),n)}function d(t,e){var n;return util.loop(e,function(e,i){var a=(e.y||e[0].y).replace(/\s/gi,"");t.indexOf(a)>-1&&(n="Array"===util.varType(e)?e:[e])}),n}function f(t){var e=[];return util.loop(t,function(t){e=e.concat(t)}),e}function p(t,e,n){if(n.indexOf("group")>-1){util.loop(C.data.axis.group.y,function(e,n){if(e[0]===t){var i=(new Array).concat(C.data.group.group[n]);C.now.group=landscapeSort.byGroup.call(C,i,!!d3.event.altKey)}});var i={axis:"x",data:f(C.now.group.axis.data)};layout.removeG(),A(i),T(C.data,C.now.width)}else{var a=[];util.loop(C.data.heatmap,function(e,n){e.y===t&&a.push(e)}),layout.removeG(),A(landscapeSort.byGene(C.data.axis.heatmap.x,a)),T(C.data,C.now.width)}}function g(t,e){e.style("cursor","pointer").on("click",function(e,n){return p.call(this,e,n,t)}).on("mouseover",function(e){d3.select(this).style("font-size","12px"),tooltip({element:this,contents:t.indexOf("group")>-1?"<b>"+e+"</b></br>Click to Sort</br>Alt + Click add to key":"Sort by <b>"+e+"</b>"})}).on("mouseout",function(){d3.select(this).style("font-size","10px"),tooltip("hide")})}function h(){layout.getSVG(C.svg,["axis_sample","gene","pq","axis_group_"],function(t,e){r(t,function(n,i){n="Array"!==util.varType(n)?[n]:n,util.loop(n,function(n,a){t.indexOf("gene")>-1&&"right"===n.direction?n.margin[1]=config.landscape.stack.gene.margin[3]+10+draw.getMostWidthOfText(c(e.attr("id"),i.y,"10px")):t.indexOf("gene")>-1&&"bottom"===n.direction&&(n.margin[3]=config.landscape.stack.gene.margin[3]);var r=axis.element(e)[n.direction]({margin:n.margin,data:c(e.attr("id"),"top"===n.direction||"bottom"===n.direction?i.x:i.y),opt:n.opt});(t.indexOf("group")>-1||t.indexOf("gene")>-1&&"right"===n.direction)&&g(t,d3.select(r.node()).selectAll("g text"))})})})}function m(t,e,n,i){bar({data:e,opt:t.opt,element:n,attr:t.attr,style:t.style,on:t.on,margin:t.margin,direction:t.direction,width:i.indexOf("patient")<0&&i.indexOf("sample")>-1?C.now.width||C.init.width:null,xaxis:t.xaxis.call(C.data.axis),yaxis:t.yaxis.call(C.data.axis)})}function x(){layout.getSVG(C.svg,["pq"],function(t,e){o(t,function(n,i){m(n,i,e,t)})})}function v(){layout.getSVG(C.svg,["e_sample","patient_sample","gene"],function(t,e){l(t,function(n,i){m(n,i,e,t)})})}function y(){layout.getSVG(C.svg,["_heatmap"],function(t,e){s(t,function(n,i){heatmap({data:i,dup:!0,opt:n.opt,element:e,attr:n.attr,style:n.style,on:n.on,margin:n.margin,xaxis:n.xaxis.call(C.data.axis),yaxis:n.yaxis.call(C.data.axis),width:t.indexOf("patient")<0?C.now.width||C.init.width:null})})})}function w(){layout.getSVG(C.svg,["t_group_","e_group_"],function(t,e){u(t,function(n,i){heatmap({element:e,opt:n.opt,attr:n.attr,style:n.style,on:n.on,margin:n.margin,data:d(t,i),width:t.indexOf("patient")<0?C.now.width||C.init.width:null,xaxis:n.xaxis.call(C.data.axis),yaxis:C.data.axis.group.y.filter(function(e,n){if(t.indexOf(e[0].replace(/\s/gi,""))>-1)return e})[0]})})})}function b(){layout.getSVG(C.svg,["legend"],function(t,e){legend({element:e,data:C.data.type,margin:config.landscape.legend.margin,priority:config.landscape.priority,text:config.landscape.legend.text,attr:config.landscape.legend.attr,style:config.landscape.legend.style,margin:[e.attr("height")/3,20,0,0]})})}function _(){C.init.width=2*draw.width(d3.select("#landscape_heatmap").node()),C.init.height=draw.height(d3.select("#landscape_heatmap").node())}function F(){landscapeScaleOption.set({element:"#landscape_option",default:100,defaultValue:C.init.width,interval:10,unit:"%",btn:[{id:"upscale",className:"upscale"},{id:"downscale",className:"downscale"},{id:"initialize",className:"initialize"}],input:{id:"viewscale",className:"viewscale"},change:function(t,e){return layout.removeG(),"initialize"===t?(A({axis:"x",data:C.init.axis.x}),A({axis:"y",data:C.init.axis.y}),T(C.data,(C.now.width=C.init.width,C.now.width))):T(C.data,(C.now.width=e,C.now.width))}})}function A(t){"x"===t.axis?(C.data.axis.group[t.axis]=t.data,C.data.axis.sample[t.axis]=t.data,C.data.axis.heatmap[t.axis]=t.data):(C.data.axis.pq[t.axis]=t.data,C.data.axis.gene[t.axis]=t.data,C.data.axis.heatmap[t.axis]=t.data)}function k(){var t=["axis_sample","gene","pq"],e=["#Mutations","#Mutations","-log10(p-value)"],n=0;layout.getSVG(C.svg,t,function(t,i){var a={};a.id=i.attr("id"),a.w=i.attr("width"),a.h=i.attr("height"),a.m=size.setMargin(config.landscape.stack.gene.margin),a.g=render.addGroup(i,a.m.top,a.m.left),a.id.indexOf("sample")>-1&&a.g.attr("transform","translate("+a.m.top+","+a.m.left+") rotate(270)"),render.text({element:a.g.selectAll("#"+a.id+"_sort_text"),data:[e[n++]],id:function(t){return a.id+"sort_text"},attr:{x:function(t,e){return a.id.indexOf("sample")>-1?2*-a.m.bottom+a.m.top:a.id.indexOf("gene")>-1?a.w-2*a.m.right+a.m.left:a.id.indexOf("pq")>-1?a.m.left:void 0},y:function(t,e){return a.id.indexOf("sample")>-1?a.w-a.m.bottom:a.h-2.8*a.m.top}},style:{"alignment-baseline":"middle","font-weight":"bold","font-size":"12px",cursor:"pointer",fill:"#333333"},on:{click:function(t,e){var n="";a.id.indexOf("sample")>-1?n="sample":a.id.indexOf("gene")>-1?n="gene":a.id.indexOf("pq")>-1&&(n="pq"),C.now.sort[n]&&"asc"===C.now.sort[n]?C.now.sort[n]="desc":C.now.sort[n]="asc",layout.removeG(),A(landscapeSort[C.now.sort[n]](n,C.data)),T(C.data,C.now.width)},mouseover:function(){tooltip({element:this,contents:"Sort by <b>"+d3.select(this).text()+"</b>"})},mouseout:function(){tooltip("hide")}},text:function(t,e){return t}})})}function S(t){layout.getSVG(C.svg,["e_group_","e_sample","e_heatmap"],function(e,n){n.attr("width",t||C.now.width||C.init.width)})}function T(t,e){S(e),h(),v(),x(),y(),w(),b(),k()}var C={div:{},init:{axis:{x:[],y:[]},width:0,height:0},now:{sort:{gene:null,sample:null,pq:null},group:[],axis:{x:[],y:[]},width:0,height:0},exclusive:{init:null}};return function(t){var n=document.querySelector(t.element||null),a=size.rightToSize("landscape",t.width||n.style.width,t.height||n.style.height);bio.setting("landscape",t),n.style.background="#F7F7F7",C.origin=t.data,C.data=preprocessing.landscape(t.data.data),C.ids=size.chart.landscape(n,a.width,a.height),_(),e(),F(),i(C.origin.data.group_list),C.svg=layout.landscape(C.ids,C),C.exclusive.init=landscapeSort.exclusive(C.data.heatmap,C.data.gene),C.init.axis.x=(new Array).concat(C.exclusive.init.data),C.init.axis.y=(new Array).concat(C.data.axis.gene.y),A(C.exclusive.init),T(C.data,C.init.width),eventHandler.onScroll("#landscape_heatmap",function(t){var e=document.querySelector("#landscape_sample"),n=document.querySelector("#landscape_group").children,i=Array.prototype.slice.call(n);e.scrollLeft=this.scrollLeft,util.loop.call(this,i,function(t,e){t.scrollLeft=this.scrollLeft})}),console.log("Given Landscape data: ",t),console.log("Landscape Model data: ",C)}}(),landscapeScaleOption=function(t){"use strict";function e(t){return{upscale:"fa fa-caret-up",downscale:"fa fa-caret-down",initialize:"fa fa-refresh"}[t]}function n(t){var e=document.querySelector("#viewscale");switch(this.id){case"upscale":r.status+=r.interval;break;case"downscale":r.status-=r.interval;break;case"initialize":r.status=r.default;break;default:return}var n="upscale"===this.id?1:-1,i=parseInt(.1*r.defaultValue);r.nowValue="initialize"===this.id?r.defaultValue:(this.id,r.nowValue+n*i),r.status=r.defaultValue/2>r.nowValue?(r.status+=r.interval,r.status):r.status>200?200:r.status,e.value=r.status+" %",r.nowValue=r.defaultValue/2>r.nowValue?r.defaultValue/2:2*r.defaultValue<r.nowValue?2*r.defaultValue:r.nowValue,!!r.change&&r.change(this.id,r.nowValue)}function i(t,i){for(var a=0,r=i.btn.length;a<r;a++){var o=i.btn[a],l=document.createElement("button"),s=document.createElement("i");s.className=e(o.id),l.id=o.id,l.addEventListener("click",n),l.appendChild(s),t.appendChild(l)}}function a(t,e){util.loop(e.input,function(e,n){var i=document.createElement("input");i.id=e.id,i.readOnly=!0,i.tabIndex=-1,i.value=(r.value||r.default)+" "+r.unit,t.appendChild(i)})}var r={};return t.set=function(e){if(d3.select(".scale-option-frame").empty()){var n=document.createElement("div");n.className="scale-option-frame",(r=e).status=e.default,r.e=document.querySelector(e.element),r.width=parseFloat(e.width||r.e.style.width||140),r.height=parseFloat(e.height||r.e.style.height||105),r.change=e.change||null,r.defaultValue=e.defaultValue,r.nowValue=r.defaultValue,r.e.appendChild(n),e.btn=e.btn.length?e.btn:[e.btn],e.input=e.input.length?e.input:[e.input],a(n,e),i(n,e)}return t},t.change=function(e){return e(r),t},t}(landscapeScaleOption||{}),landscapeSort=function(t){"use strict";function e(t,e){switch(t){case"gene":return e.stack.gene;case"sample":return e.stack.sample;case"pq":return e.pq;case"init":return e.init;default:throw new Error("No matching any data")}}function n(t,e){var n={};return util.loop(t,function(t,i){n[t[e]]=n[t[e]]?n[t[e]]+=t.value:n[t[e]]=t.value}),n}function i(t){var e=[];return util.loop(t,function(t,n){e.push({key:t,value:n})}),e}function a(t,e){var n="asc"===t?1:-1;return e.sort(function(t,e){return t.value>e.value?1*n:-1*n})}function r(t,e){return{axis:"y",data:a(t,i(n(e,"y"))).map(function(t){return t.key})}}function o(t,e){return{axis:"x",data:a(t,i(n(e,"x"))).map(function(t){return t.key})}}function l(t,e){return{axis:"y",data:a(t,e).map(function(t){return t.y})}}function s(t,e,n){switch(t){case"gene":return r(e,n);case"sample":return o(e,n);case"pq":return l(e,n);default:throw new Error("Not matching any function")}}function u(t,e,n){var i=2*e.indexOf(n.y),a="cnv"===config.landscape.case(n.value)?0:1;t.value=t.value.replaceAt(i,"00".replaceAt(a,"1"))}function c(t){for(var e="",n=0;n<t;n++)e+="00";return e}function d(t){return{axis:"x",data:t.sort(function(t,e){return t.value<e.value?1:-1}).map(function(t,e){return t.key})}}function f(t){var e={};return util.loop(t,function(t,n){e[t.value]?e[t.value].push(t):e[t.value]=[t]}),e}function p(t){var e=[];return util.loop(Object.keys(t).sort(function(t,e){return config.landscape.orderedName.indexOf(t)>config.landscape.orderedName.indexOf(e)?1:-1}),function(n,i){e.push(t[n])}),e}function g(e){var n=this,i=[];return util.loop(e,function(e,a){var r=[];util.loop(e,function(t,e){r=r.concat(t.info)}),i.push(t.exclusive(r,n.data.gene))}),i}function h(t){var e=p(f(t)),n=g.call(this,e),i={};return util.loop(n,function(t,e){i.axis=t.axis,i.data?i.data.push(t.data):i.data=[t.data]}),{group:e,axis:i}}function m(t,e){var n=[];return util.loop(t,function(t,i){util.loop(e,function(e,i){t.x===e.x&&n.push(t)})}),n}var x={exclusive:[]};return t.exclusive=function(t,e){var n={},i=[],a=0;return util.loop(t,function(t){n[t.x]?n[t.x]=n[t.x]:(n[t.x]=!0,i.push({key:t.x,value:c(e.length)}),a+=1),u(i[a-1],e,t)}),x.exclusive=i,d(i)},t.asc=function(t,n){return s(t,"asc",e(t,n))},t.desc=function(t,n){return s(t,"desc",e(t,n))},t.byGene=function(e,n){var i=t.exclusive(n,n[0].y);return util.loop(e,function(t){i.data.indexOf(t)<0&&i.data.push(t)}),i},t.byGroup=function(t,e){if(e){if(this.now.group.length<1)throw new Error("There are empty now group data");var n=this,i=[],a={group:[],axis:{axis:"x",data:[]}};return util.loop(this.now.group.group,function(e,a){i.push(h.call(n,m(t,e)))}),util.loop(i,function(t,e){a.group=a.group.concat(t.group),a.axis.data=a.axis.data.concat(t.axis.data)}),a}return h.call(this,t)},t}(landscapeSort||{}),layout=function(t){"use strict";function e(t,e,n){return util.loop(n,function(n,a){var r=!0;util.loop(t,function(t,e){n.indexOf(t)>-1&&(r=!r)}),r&&(i[e][n]=render.createSVG(n))}),i[e]}function n(t){var e=Array.prototype.slice.call(t).map(function(t){return util.varType(t)});if(e.indexOf("Object")<0)throw new Error("Not found svg set");if(e.indexOf("Function")<0)throw new Error("Not found CallBack function")}var i={exclusivity:{},expression:{},landscape:{},variants:{}};return t.getSVG=function(t,e,i){n(arguments),e="Array"===util.varType(e)?e:[e],util.loop(t,function(t,n){util.loop(e||[""],function(e,a){if(t.indexOf(e)>-1)return i(t,n)})})},t.removeG=function(t){t?(t="Array"===util.varType(t)?t:[t],util.loop(t,function(t){d3.selectAll(t.indexOf(".")>-1?t:"."+t).remove()})):d3.selectAll("svg g").remove()},t.exclusivity=function(t){return e(["geneset","survival","network"],"exclusivity",t)},t.landscape=function(t){return e(["option","title"],"landscape",t)},t.variants=function(t){return e(["title"],"variants",t)},t.expression=function(t){return e(["title","function","color_mapping","signature"],"expression",t)},t}(layout||{}),legend=function(t){"use strict";function e(t){return(new Array).concat(t).sort(function(t,e){return t.length<e.length?1:-1})[0]}var n={};return function(t){(n={}).d=t.priority?t.data.sort(function(e,n){return t.priority(e)>t.priority(n)?1:-1}):t.data,n.e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),n.id=n.e.attr("id"),n.m=size.setMargin(t.margin),n.w=t.width||n.e.attr("width"),n.h=t.height||n.e.attr("height"),n.t=n.m.top||0,n.l=n.m.left||0,n.padding=t.padding||5,n.font=t.font||"10px",n.sg=render.addGroup(n.e,n.t,n.l,"legend-shape"),n.tg=render.addGroup(n.e,n.t,n.l,"legend-text"),n.mt=e(n.d),n.mw=draw.getMostWidthOfText(n.d,n.font),n.mh=draw.getTextHeight(n.font).height,n.x=[],n.y=[],n.shape=t.attr&&t.attr.r?n.mh/3:n.mh/1.5,n.ew=n.w-n.shape-2*n.padding,n.font=t.font||draw.getFitTextSize(n.mt,n.ew,n.shape),t.attr&&t.attr.r?render.circle({element:n.sg.selectAll("#"+n.id+"_circle"),data:n.d,attr:{id:function(t){return n.id+"_circle"},cx:function(e,i){return t.attr.x?t.attr.x.call(this,e,i,n):0},cy:function(e,i){return t.attr.y?t.attr.y.call(this,e,i,n):0},r:function(e,i){return t.attr.r?t.attr.r.call(this,e,i,n):0}},style:{fill:function(e,i){return t.style.fill?t.style.fill.call(this,e,i,n):"#000000"},stroke:function(e,i){return!!t.style.stroke&&t.style.stroke.call(this,e,i,n)}},on:{mouseover:function(e,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(this,e,i,n))}}}):t.attr&&t.attr.points?render.triangle({element:n.sg.selectAll("#"+n.id+"_triangle"),data:n.d,attr:{id:function(t){return n.id+"_triangle"},points:function(e,i){return t.attr.points?t.attr.points.call(this,e,i,n):[0,0]}},style:{fill:function(e,i){return t.style.fill?t.style.fill.call(this,e,i,n):"#000000"},stroke:function(e,i){return!!t.style.stroke&&t.style.stroke.call(this,e,i,n)},"stroke-width":function(e,i){return t.style.strokeWidth?t.style.strokeWidth.call(this,e,i,n):"1px"}},on:{mouseover:function(e,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(this,e,i,n))}}}):t.attr&&t.attr.width&&t.attr.height&&render.rect({element:n.sg.selectAll("#"+n.id+"_rect"),data:n.d,attr:{id:function(t){return n.id+"_rect"},x:function(e,i){return t.attr.x?t.attr.x.call(this,e,i,n):0},y:function(e,i){return t.attr.y?t.attr.y.call(this,e,i,n):0},width:function(e,i){return t.attr.width?t.attr.width.call(this,e,i,n):5},height:function(e,i){return t.attr.height?t.attr.height.call(this,e,i,n):5}},style:{fill:function(e,i){return t.style.fill?t.style.fill.call(this,e,i,n):"#000000"},stroke:function(e,i){return!!t.style.stroke&&t.style.stroke.call(this,e,i,n)}},on:{mouseover:function(e,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(this,e,i,n))}}}),render.text({element:n.tg.selectAll("#"+n.id+"_text"),data:n.d,attr:{id:function(t){return n.isText=!0,n.id+"_text"},x:function(e,i){return t.attr.x?t.attr.x.call(this,e,i,n):0},y:function(e,i){return t.attr.y?t.attr.y.call(this,e,i,n):0}},style:{"font-size":function(e,i){return t.style.fontSize?t.style.fontSize.call(this,e,i,n):n.font},"font-family":function(e,i){return t.style.fontFamily?t.style.fontFamily.call(this,e,i,n):"Arial"},"font-weight":function(e,i){return t.style.fontWeight?t.style.fontWeight.call(this,e,i,n):"1"},"alignment-baseline":function(e,i){return t.style.alignmentBaseline?t.style.alignmentBaseline.call(this,e,i,n):"middle"},fill:function(e,i){return t.style.fill?t.style.fill.call(this,e,i,n):"#333333"}},on:{mouseover:function(e,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(this,e,i,n))}},text:function(e,i){return t.text?t.text.call(this,e,i,n):"legend "+i}})}}();!function(t){"use strict";t.bio={draw:draw,config:config,render:render,pathways:"",expression:expression,landscape:landscape,exclusive:exclusive,variants:variants,chart:{bar:bar,legend:legend,needle:needle,network:network,heatmap:heatmap,scatter:scatter,survival:survival},tools:{tooltip:tooltip,selectBox:selectBox,needleNavi:needleNavi,needleGraph:needleGraph,divisionLine:divisionLine,colorGradient:colorGradient,landscapeSort:landscapeSort,landscapeScaleOption:landscapeScaleOption},util:util,size:size,scale:scale,layout:layout,eventHandler:eventHandler,preprocessing:preprocessing}}(window||{});var needle=function(t){"use strict";var e={};return function(t){(e={}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),e.w=t.width||e.e.attr("width"),e.h=t.height||e.e.attr("height"),e.id=e.e.attr("id"),e.m=size.setMargin(t.margin),e.t=e.m.top||0,e.l=e.m.left||0,e.lg=render.addGroup(e.e,e.m.top,e.m.left,"needle-line"),e.cg=render.addGroup(e.e,e.m.top,e.m.left,"needle-circle"),e.radius=t.radius||5,e.sx=scale.get(t.xaxis,[e.m.left,e.w-e.m.right]),e.sy=scale.get(t.yaxis,[e.h-e.m.bottom,e.m.top]),e.line=(util.d3v4()?d3.line():d3.svg.line()).x(function(t,n){return e.sx(t.x)<e.m.left?-100:e.sx(t.x)>e.w-e.m.right?e.w+100:e.sx(t.x)}).y(function(t,n){return e.sy(t.y)}),util.loop(t.lineData,function(t,n){render.line({element:e.lg,attr:{id:function(t){return e.id+"_line"},d:e.line(t.value)},style:{stroke:"#A8A8A8"}})}),render.circle({element:e.cg.selectAll("#"+e.id+"_circle"),data:t.circleData,attr:{id:function(t){return e.id+"_circle"},cx:function(n,i){return t.attr.x?t.attr.x.call(this,n,i,e):0},cy:function(n,i){return t.attr.y?t.attr.y.call(this,n,i,e):0},r:function(n,i){return t.attr.r?t.attr.r.call(this,n,i,e):e.radius}},style:{fill:function(n,i){return t.style.fill?t.style.fill.call(this,n,i,e):"#000000"},stroke:function(n,i){return t.style.stroke?t.style.stroke.call(this,n,i,e):"#FFFFFF"},cursor:function(n,i){return t.style.cursor?t.style.cursor.call(this,n,i,e):"none"}},on:{mouseover:function(n,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(this,n,i,e))},mouseout:function(n,i){return!!t.on&&(!!t.on.mouseout&&t.on.mouseout.call(this,n,i,e))}}})}}(),needleGraph=function(t){"use strict";var e={};return function(t){(e={}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),e.id=e.e.attr("id"),e.m=size.setMargin(t.margin),e.w=t.width||e.e.attr("width"),e.h=t.height||e.e.attr("height"),e.t=e.h-e.m.bottom,e.l=e.m.left||0,e.g=render.addGroup(e.e,e.t,e.l,"needle-graph"),e.font=t.font||"10px",e.sx=scale.get(t.xaxis,[e.m.left,e.w-e.m.right]),e.sy=scale.get(t.yaxis,[e.h-e.m.bottom,e.m.top]),e.sh=Math.abs(e.sy(1)-e.sy(0))/2>25?Math.abs(e.sy(1)-e.sy(0))/2:25,render.rect({element:e.g.selectAll("#"+e.id+"_base"),data:[""],attr:{id:e.id+"_base",x:e.sx(util.minmax(t.xaxis).min)+5,y:.1*e.sh,width:e.w-e.m.right-e.m.left-5,height:.8*e.sh,rx:1,ry:1},style:{fill:"#DADFE1",stroke:"#CCCDCE","stroke-width":"5px"}});var n=e.g.selectAll("#"+e.id+"_graph").data(t.data).enter().append("g").attr("id",e.id+"_graph").attr("transform","translate(0, 0)");render.rect({element:n,attr:{id:function(t){return e.id+"_rect"},x:function(n,i){return t.attr.x?t.attr.x.call(this,n,i,e):0},y:function(n,i){return t.attr.y?t.attr.y.call(this,n,i,e):0},width:function(n,i){return t.attr.width?t.attr.width.call(this,n,i,e):0},height:function(n,i){return t.attr.height?t.attr.height.call(this,n,i,e):0},rx:3,ry:3},style:{fill:function(n,i){return t.style.fill?t.style.fill.call(this,n,i,e):"#000000"},stroke:function(n,i){return t.style.stroke?t.style.stroke.call(this,n,i,e):"#FFFFFF"}},on:{mouseover:function(n,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(this,n,i,e))},mouseout:function(n,i){return!!t.on&&(!!t.on.mouseout&&t.on.mouseout.call(this,n,i,e))}}}),render.text({element:n,attr:{id:function(t){return e.isText=!0,e.id+"_text"},x:function(n,i){return t.attr.x?t.attr.x.call(this,n,i,e):0},y:function(n,i){return t.attr.y?t.attr.y.call(this,n,i,e):0}},style:{fill:function(n,i){return t.style.fill?t.style.fill.call(this,n,i,e):"#333333"},"alignment-baseline":function(n,i){return t.style.alignmentBaseline?t.style.alignmentBaseline.call(this,n,i,e):"middle"},"font-size":function(n,i){return t.style.fontSize?t.style.fontSize.call(this,n,i,e):e.font}},text:function(n,i){return t.text?t.text.call(this,n,i,e):0}})}}(),needleNavi=function(t){"use strict";function e(t,e){util.loop(e,function(e,i){render.rect({element:n.g.selectAll("#"+n.id+"_"+e),data:[e],attr:{id:function(t){return n.id+"_"+t},x:"end"===e?n.end+n.m.left-n.rect.width:n.start-n.rect.width,y:.25*n.h,width:2*n.rect.width,height:n.rect.height,rx:5,rx:5},style:{fill:"#A8A8A8",stroke:"#EAECED","stroke-width":"2px",cursor:"ew-resize"},call:{start:function(e,i){return!!t.drag&&(!!t.drag.start&&t.drag.start.call(this,e,i,n))},drag:function(e,i){return!!t.drag&&(!!t.drag.drag&&t.drag.drag.call(this,e,i,n))},end:function(e,i){return!!t.drag&&(!!t.drag.end&&t.drag.end.call(this,e,i,n))}}})})}var n={start:0,end:0};return function(t){(n={}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),n.id=n.e.attr("id"),n.w=t.width||n.e.attr("width"),n.h=t.height||n.e.attr("height"),n.m=size.setMargin(t.margin),n.t=n.m.top||0,n.l=n.m.left||0,n.g=render.addGroup(n.e,n.m.top,n.m.left,"needle-navi"),n.sx=scale.get(t.xaxis,[n.m.left,n.w-n.m.right]),n.sy=scale.get(t.yaxis,[n.h-n.m.bottom,n.m.top]),n.rect={width:5,height:.4*n.h},n.start=n.sx(util.minmax(t.xaxis).min),n.end=n.w-n.m.right-n.m.left,config.variants.navi.start.init=n.start-n.rect.width,config.variants.navi.end.init=n.end-n.rect.width+n.m.left,config.variants.navi.start.now=n.start-n.rect.width,config.variants.navi.end.now=n.end-n.rect.width+n.m.left,config.variants.navi.navi.init=n.start,config.variants.navi.navi.now=n.start,config.variants.navi.navi.width=n.end,config.variants.navi.navi.nowWidth=n.end-n.start,needle({element:n.e,lineData:t.data.needle,circleData:t.data.fullNeedle,attr:config.variants.needle.attr,style:t.style,margin:[5,30,15,60],xaxis:t.xaxis,yaxis:t.yaxis}),render.rect({element:n.g.selectAll("#"+n.id+"_navi"),data:["navi"],attr:{id:function(t){return n.id+"_navi"},x:n.start,y:0,width:n.end,height:n.h-n.m.bottom,rx:3,ry:3},style:{fill:"rgba(255, 225, 50, 0.1)",stroke:"#FFDF6D",cursor:"move"},call:{start:function(e,i){return!!t.drag&&(!!t.drag.start&&t.drag.start.call(this,e,i,n))},drag:function(e,i){return!!t.drag&&(!!t.drag.drag&&t.drag.drag.call(this,e,i,n))},end:function(e,i){return!!t.drag&&(!!t.drag.end&&t.drag.end.call(this,e,i,n))}}}),e(t,["start","end"]),n.e.node().removeChild(n.e.node().firstChild),n.e.node().appendChild(n.g.node())}}(),network=function(){"use strict";return function(t){var e=[],n={},i="";t.data.map(function(t){if("compound"===t.type)i=t.members,e.push({group:"nodes",data:{id:"n0",bgcolor:t.bgcolor,bdcolor:t.bordercolor||"rgb(0, 0, 0)",width:100,height:150,isComp:!0,per:t.text},position:{}});else if("node"===t.type){var a={data:{id:i.indexOf(t.text)>-1?"n0:"+t.text:t.text,name:t.text,bgcolor:t.bgcolor,bdcolor:t.bordercolor||"rgb(0, 0, 0)",width:draw.getTextWidth(t.text,"14px Calibri"),height:20,fontSize:10,isComp:!1},group:"nodes"};n[t.text]={parent:i.indexOf(t.text)>-1?"n0:":""},i.indexOf(t.text)>-1&&(a.data.parent="n0"),e.push(a)}else if("edge"===t.type){var r="",o="",l="";for(var s in n)t.source.substring(0,s.length)===s&&(r=n[s].parent+s,l=t.source.substring(s.length,t.source.length),o=n[t.target.substring(0,t.target.indexOf(l))].parent+t.target.substring(0,t.target.indexOf(l)));e.push({data:{id:r+o,source:r,target:o,color:t.linecolor},group:"edges"})}}),cytoscape({container:document.querySelector(t.element),boxSelectionEnabled:!1,autoungrabify:!0,autounselectify:!0,pixelRatio:"auto",elements:e,style:cytoscape.stylesheet().selector("node").css({shape:"rectangle",width:"data(width)",height:"data(height)","font-size":"10",content:"data(name)","text-valign":"center","background-color":"data(bgcolor)","border-color":"data(bdcolor)","border-width":"1"}).selector(":parent").css({"background-color":"rgba(255, 255, 255, 0.5)","border-color":"rgb(150, 0, 0)","border-width":"1",content:"data(per)","font-size":"10","text-valign":"top"}).selector("edge").css({"curve-style":"bezier","target-arrow-shape":"triangle","target-arrow-color":"data(color)","arrow-scale":"1","line-color":"data(color)"}),layout:{name:"cose-bilkent",animate:!1}}).resize(550,10,10,10)}}(),preprocessing=function(t){"use strict";function e(t){util.loop(t,function(t,e){var n=0,i={key:t,value:[{x:parseFloat(t),y:n,value:0}]};J.axis.needle.y.push(n),util.loop(e,function(e,a){i.value.push({x:parseFloat(t),y:n+=a.length,value:a.length,info:a})}),J.axis.needle.y.push(n),J.needle.push(i)})}function n(t){var n={};util.loop(t,function(t,e){t.type=config.landscape.name(t.type);var i=t.position+" "+t.type+" "+t.aachange;n[t.position]?n[t.position][i]?n[t.position][i].push(t):n[t.position][i]=[t]:(n[t.position]={},n[t.position][i]=[t]),J.type.indexOf(t.type)<0&&J.type.push(t.type)}),e(n)}function i(){util.loop(J.needle,function(t,e){util.loop(t.value,function(e,n){e.info&&(e.value=e.y-t.value[n-1].y,J.fullNeedle.push(e))})})}function a(t){util.loop(t,function(t,e){J.graph.push({x:t.start,y:0,width:t.end-t.start,height:15,color:t.colour,info:t})})}function r(t){J.axis.needle.x=[0,t[0].length],J.axis.needle.y=J.axis.needle.y.length<1?[0,1]:[util.minmax(J.axis.needle.y).min,util.minmax(J.axis.needle.y).max]}function o(t){return/[\[][\w(\s|,)]+[\]]/.exec(t)[0].replace(/\[|\]/g,"").split(" ")}function l(t){return"rgb("+t.split(" ").join(",")+")"}function s(t){var e=[];return util.loop(t,function(t,n){var i={};util.loop(t.split("\t"),function(t,e){i[t.split(":")[0]]=t.split(":")[0].indexOf("color")<0?t.split(":")[1]:l(t.split(":")[1])}),e.push(i)}),e}function u(t){util.loop(t,function(t,e){K.network[t]=s(e)})}function c(t){var e={};util.loop(t.split("\n"),function(t,n){util.loop(K.geneset,function(n,i){t.indexOf(n.join(""))>-1&&(e[n.join(" ")]?e[n.join(" ")].push(t):e[n.join(" ")]=[t])})}),u(e)}function d(t){return K.type[t.join(" ")]=[]}function f(t,e,n,i,a,r,o){util.loop(e.split(""),function(e,l){a.push(""+l),r.push(""+l),util.loop(config.exclusivity.separate(e),function(e,a){e=config.exclusivity.name(e),n.push({x:l,y:t,value:e}),i.indexOf(e)<0?i.push(e):i=i}),o.idx="."!==e?o.idx>l?o.idx:l:o.idx})}function p(t,e,n){var i=d(e);util.loop(t,function(t,a){util.loop(e,function(a,r){if(t.indexOf(a)>-1){var o=e.join(" ");K.axis.heatmap.x[o]=[],K.axis.heatmap.y[o]=e,K.axis.division.x[o]=[],K.divisionIdx[o]={idx:0},f(a,t.substring(0,t.indexOf(" ")),n,i,K.axis.heatmap.x[o],K.axis.division.x[o],K.divisionIdx[o])}})})}function g(t){util.loop(t.split("\n\n"),function(t,e){if(""!==t){var n=o(t),i=t.split("\n"),a=i.splice(1,i.length);p(a,n,K.heatmap[n.join(" ")]=[]);K.survival.heat[n.join(" ")]=a,K.fullGeneset.concat(n),K.geneset.push(n)}});var e=K.geneset[4];K.geneset[4]=K.geneset[0],K.geneset[0]=e}function h(t){var e={};return util.loop(t,function(t,n){e[t.gene]=["."]}),e}function m(t,e){var n={};return util.loop(t,function(t,i){var a=config.landscape.name(t.type),r="Amplification"===a||"Homozygous_deletion"===a?"Amplification"===a?"A":"D":"M",o=util.cloneObject(e);n[t.participant_id]?"."===n[t.participant_id][t.gene][0]?n[t.participant_id][t.gene]=[r]:n[t.participant_id][t.gene].push(r):(o[t.gene]=[r],n[t.participant_id]=o)}),n}function x(t,e){var n=h(e),i=m(e,n);util.loop(t,function(t,e){t.gene=i[t.participant_id]?i[t.participant_id]:n}),K.survival.merge=t}function v(t){return t.indexOf("A")>-1&&t.indexOf("M")>-1?"B":t.indexOf("D")>-1&&t.indexOf("M")>-1?"E":t[0]}function y(t){var e={};util.loop(K.survival.heat,function(t,n){for(var i=K.axis.heatmap.x[t].length,a=t.split(" "),r=K.survival.data[t]?K.survival.data[t]:K.survival.data[t]=[],o=e[t]={},l=0;l<i;l++)K.survival.merge.some(function(t){for(var e=!0,i=0;i<a.length;i++)v(t.gene[a[i]])!==n[i][l]&&(e=!1);if(e&&void 0===o[t.participant_id])return o[t.participant_id]="",r[l]=t,void 0!==r[l]})})}function w(t){U.type[t]||(U.type[t]=null)}function b(t){t[U.keys.t]=Z.name(t[U.keys.t])}function _(t,e,n,i,a){return"gene"===t?{x:e,y:n,value:i,info:a}:{x:n,y:e,value:i,info:a}}function F(t,e){var n=[];return util.loop(e,function(e,i){var a=0,r=0;util.loop(i,function(i,o){n.push(_(t,a,e,o,i)),a+=o,r+=o}),U.axis[t]["gene"===t?"x":"y"].push(r)}),n}function A(t,e,n){t[e]=t[e]?t[e]:{},t[e][n]=t[e][n]?t[e][n]+1:1}function k(t,e){t.push({x:e[U.keys.p],y:e[U.keys.g],value:e[U.keys.t]})}function S(t,e){util.loop(t,function(t,n){b(t),w(t[U.keys.t]),e(t,n)})}function T(t){S(t,function(t,e){A(U.stack.gene,t[U.keys.g],t[U.keys.t]),A(U.stack.sample,t[U.keys.p],t[U.keys.t]),k(U.heatmap,t),U.axis.sample.x.indexOf(t[U.keys.p])<0&&U.axis.sample.x.push(t[U.keys.p])})}function C(t){S(t,function(t,e){A(U.stack.patient,t[U.keys.p],t[U.keys.t]),k(U.patient,t),U.axis.patient.x.indexOf(t[U.keys.p])<0&&U.axis.patient.x.push(t[U.keys.p])})}function O(t){return Math.log(t)/Math.log(12)*-1}function B(t,e){var n=[];return util.loop(t,function(t,i){n.push({x:0,y:t[U.keys.g],value:O(t[e])})}),n}function E(t){util.loop(t,function(t,e){var n=[];util.loop(t.data,function(e,i){var a=[];util.loop(U.heatmap,function(t,n){e[U.keys.p]===t.x&&a.push(t)}),n.push({x:e[U.keys.p],y:t.name,value:e.value,info:a})}),U.group.group.push(n),U.axis.group.y.push([t.name]),U.group.patient.push({x:U.axis.patient.x[0],y:t.name,value:"NA"})})}function D(){U.axis.gene.x=[util.minmax(U.axis.gene.x).max,0],U.axis.sample.y=[util.minmax(U.axis.sample.y).max,0],U.axis.pq.x=[0,util.minmax(U.pq.map(function(t){return Math.ceil(t.value)})).max]}function z(){U.axis.pq.y=U.gene,U.axis.gene.y=U.gene,U.axis.heatmap.y=U.gene,U.axis.heatmap.x=U.axis.sample.x,U.axis.group.x=U.axis.sample.x}function G(t,e){var n={};return util.loop(e,function(e,i){t.indexOf(i)>-1?n.g=e:Z.color(Z.name(i))?n.t=e:n.p=e}),n}function M(t){return Math.log(t+1)/Math.LN2}function L(t){Q.axis.scatter.y={os:[],dfs:[]},Q.patSubtype={},util.loop(t,function(t){Q.axis.scatter.y.os.push(t.os_days/30),Q.axis.scatter.y.dfs.push(t.dfs_days/30),Q.patSubtype[t.participant_id]=t});var e=util.minmax(Q.axis.scatter.y.os),n=util.minmax(Q.axis.scatter.y.dfs);Q.axis.scatter.y.os=[e.min,e.max],Q.axis.scatter.y.dfs=[n.min,n.max]}function N(t){Q.axis.heatmap.x[t.participant_id]?Q.axis.heatmap.x[t.participant_id].push({key:t.hugo_symbol,value:t.tpm}):Q.axis.heatmap.x[t.participant_id]=[{key:t.hugo_symbol,value:t.tpm}]}function V(t){var e=util.minmax(t),n=util.median(t);Q.axis.gradient.x=[e.min,n,e.max],Q.axis.gradient.y=[""]}function q(t){util.loop(t,function(t,e){var n=0,i=0;util.loop(e,function(t){Q.axis.heatmap.y[t.key]="",n+=t.value}),i=n/e.length,Q.bar.push({x:t,value:i,info:Q.patSubtype[t]}),Q.func.avg.push(i)}),Q.func.avg.sorted=Q.func.avg.sort(function(t,e){return t>e?1:-1});var e=util.minmax(Q.func.avg),n=util.median(Q.func.avg);Q.axis.bar.y=[e.min,n,e.max]}function W(t,e){return{average:q(e)}[t]}function H(t){var e=(new Array).concat(Q.func.avg),n=[];util.loop(t,function(t){n[e.indexOf(t.value)]=t.x}),Q.axis.heatmap.x=n}function I(t,e){return{average:H(e)}[t]}function j(t){var e=Q.func.now||Q.func.default;util.loop(t,function(t,e){t.tpm=M(t.tpm+1),N(t),Q.tpms.push(t.tpm),Q.heatmap.push({x:t.participant_id,y:t.hugo_symbol,value:t.tpm})}),V(Q.tpms),W(e,Q.axis.heatmap.x),I(e,Q.bar),Q.axis.heatmap.y=util.keyToArr(Q.axis.heatmap.y),Q.axis.scatter.x=Q.axis.heatmap.x,Q.axis.bar.x=Q.axis.heatmap.x}function P(t){var e={};return util.loop(t,function(t,n){e[t.subtype]?e[t.subtype].push(t.value):e[t.subtype]=[t.value]}),e}function R(t){var e=P(t);util.loop(e,function(t,e){Q.subtype.push({key:t,value:e})})}function $(t){return Q.axis.bar.y[1]>=Q.func.avg[Q.axis.bar.x.indexOf(t)]?"Low score group":"High score group"}function Y(){X.expression={func:{default:"average",now:null,avg:[]},tpms:[],heatmap:[],scatter:{},subtype:[],survival:{},bar:[],axis:{gradient:{x:{},y:{}},heatmap:{x:{},y:{}},scatter:{x:{},y:{}},bar:{x:{},y:{}}}},Q=X.expression}var X={expression:{func:{default:"average",now:null,avg:[]},tpms:[],heatmap:[],scatter:{},subtype:[],survival:{},bar:[],axis:{gradient:{x:{},y:{}},heatmap:{x:{},y:{}},scatter:{x:{},y:{}},bar:{x:{},y:{}}}},exclusivity:{heatmap:{},network:{},type:{},survival:{merge:{},heat:{},data:{}},geneset:[],fullGeneset:[],axis:{heatmap:{x:{},y:{}},division:{x:{},y:[]}},divisionIdx:{}},landscape:{keys:{},type:{},group:{group:[],patient:[]},heatmap:[],patient:[],stack:{gene:{},sample:{},patient:{}},axis:{pq:{x:[],y:[]},gene:{x:[],y:[]},group:{x:[],y:[]},sample:{x:[],y:[]},heatmap:{x:[],y:[]},patient:{x:[],y:[]}}},variants:{needle:[],fullNeedle:[],type:[],graph:[],axis:{needle:{x:[],y:[]}}}},U=X.landscape,K=X.exclusivity,Q=X.expression,J=X.variants,Z=config.landscape;return t.variants=function(t){return n(t.variants.public_list),a(t.variants.graph),r(t.variants.graph),i(),J.patient=t.variants.patient_list.map(function(t,e){return t.type=config.landscape.name(t.type),t}),console.log("Preprocess of Variants: ",J),J},t.exclusivity=function(t){return x(t.survival.patient,t.survival.types),g(t.heatmap),c(t.network),y(t.heatmap),console.log("Preprocess of Exclusivity: ",K),K},t.landscape=function(t){return U.gene=t.gene_list.map(function(t){return t.gene}),U.keys=G(U.gene,t.mutation_list.concat(t.patient_list)[0]),T(t.mutation_list),C(t.patient_list),E(t.group_list),U.type=util.keyToArr(U.type),U.pq=B(t.gene_list,t.pq||"p"),U.stack.gene=F("gene",U.stack.gene),U.stack.sample=F("sample",U.stack.sample),U.stack.patient=F("patient",U.stack.patient),D(),z(),console.log("Preprocess of Landscape: ",U),U},t.expression=function(t){return Y(),Q.allRna=(new Array).concat(t.cohort_rna_list.concat(t.sample_rna_list)),Q.genes=t.gene_list.map(function(t){return t.hugo_symbol}),L(t.patient_list),R(t.subtype_list),j(Q.allRna),Q.patient={name:t.sample_rna_list[0].participant_id,data:$(t.sample_rna_list[0].participant_id)},util.loop(Q.bar,function(t){t.y=Q.axis.bar.y[1]}),console.log("Preprocessing of Expression: ",Q),Q},t}(preprocessing||{}),render=function(t){"use strict";function e(t,e){if(!e)return!1;for(var n in e)t.attr(n,e[n])}function n(t,e){if(!e)return!1;for(var n in e)t.style(n,e[n])}function i(t,e){if(!e)return!1;for(var n in e)t.on(n,e[n])}function a(t,e){if(!e)return!1;var n=util.d3v4()?d3.drag():d3.behavior.drag().origin(Object);for(var i in e){var a=util.d3v4()?i:"drag"!==i?"drag"+i:i;n.on(a,e[i])}t.call(n)}function r(t,e){t.text(e)}function o(t){if(!this.element)throw new Error("Not defined SVG Element");var o=this.data?this.element.data(this.data).enter().append(t):this.element.append(t);return!!this.text&&r(o,this.text),e(o,this.attr),n(o,this.style),i(o,this.on),a(o,this.call),o}return t.createSVG=function(t,e,n){var t=t.indexOf("#")<0?"#"+t:t,i=document.querySelector(t);return d3.select(t).append("svg").attr("id",t.replace("#","")+"_chart").attr("width",(e||parseFloat(i.style.width))+1).attr("height",n||parseFloat(i.style.height))},t.addGroup=function(t,e,n,i){t=util.d3v4()?t:t[0][0],t="Array"===util.varType(t)||"Object"===util.varType(t)?t:d3.select(t);var a=d3.selectAll("."+t.attr("id")+"."+i+"-g-tag");return a.node()?a:t.append("g").attr("class",t.attr("id")+" "+i+"-g-tag").attr("transform","translate("+n+", "+e+")")},t.rect=function(t){return o.call(t,"rect")},t.circle=function(t){return o.call(t,"circle")},t.text=function(t){return o.call(t,"text")},t.line=function(t){var i=t.element.append("path");return e(i,t.attr),n(i,t.style),i},t.triangle=function(t){return o.call(t,"polygon")},t.star=function(t){var e=(util.d3v4()?d3.symbol():d3.svg.symbol()).type(util.d3v4()?d3.symbolStar:"star"),a=t.element.append("path").attr("d",e.size(t.size));return n(a,t.style),i(a,t.on),a},t}(render||{}),scale=function(t){"use strict";function e(t,e){var n=[];if("number"==typeof e[0]&&"number"==typeof e[1]&&e.length<3){for(var a=Math.max(e[0],e[1]),r=Math.min(e[0],e[1]),o=a+r-r,l=r;l<=o;l++)n.push(l);return i.data.push(n),i.len.push(o),"ordinal"===t?n:[e[0],e[1]]}return i.data.push(e),i.len.push(e.length),e}function n(t){return"String"===util.varType(t[0])?"ordinal":"linear"}var i={data:[],len:[]};return t.ordinal=function(t,n){var i=e("ordinal",t);return d3.scaleBand?d3.scaleBand().domain(i).range(n):d3.scale.ordinal().domain(i).rangeBands(n)},t.linear=function(t,n){var i=e("linear",t);return d3.scaleLinear?d3.scaleLinear().domain(i).range(n):d3.scale.linear().domain(i).range(n)},t.getType=function(t){return"number"==typeof t[0]?"linear":"ordinal"},t.compatibleBand=function(t){return t.bandwidth?t.bandwidth():t.rangeBand()},t.getDomain=function(){return i.data.shift()},t.getDomainLength=function(){return i.len.shift()},t.getDistance=function(e){return"ordinal"===e?t.compatibleBand():t(1)-t(0)},t.get=function(e,i){return t[n(e)](e,i)},t.invert=function(t){var e=t.domain(),i=t.range();return("linear"===n(e)?util.d3v4()?d3.scaleLinear():d3.scale.linear():util.d3v4()?d3.scaleQuantize():d3.scale.quantize()).domain(i).range(e)},t}(scale||{}),scatter=function(t){"use strict";var e={};return function(t){(e={}).e=t.element="Object"===util.varType(t.element)||"Array"===util.varType(t.element)?t.element:/\W/.test(t.element[0])?d3.select(t.element):d3.select("#"+t.element),e.m=size.setMargin(t.margin),e.d=t.data,e.w=e.e.attr("width"),e.h=e.e.attr("height"),e.t=t.top||e.m.top||0,e.l=t.left||e.m.left||0,e.f=t.fontSize||"10px",e.ss=t.shapeSize||5,e.sx=scale.get(t.xaxis,[e.m.left,e.w-e.m.right]),e.sy=scale.get(t.yaxis,[e.m.top,e.h-e.m.bottom]),e.g=render.addGroup(e.e,e.t,e.l,"scatter");var n=e.e.attr("id");t.attr.r?render.circle({element:e.g.selectAll("#"+n+"_circle"),data:e.d,attr:{id:function(t){return n+"_circle"},cx:function(n,i){return t.attr.x?t.attr.x.call(this,n,i,e):0},cy:function(n,i){return t.attr.y?t.attr.y.call(this,n,i,e):0},r:function(n,i){return t.attr.r?t.attr.r.call(this,n,i,e):0}},style:{fill:function(n,i){return t.style.fill?t.style.fill.call(this,n,i,e):"#000000"},"fill-opacity":function(n,i){return t.style.fillOpacity?t.style.fillOpacity.call(this,n,i,e):"1"},stroke:function(n,i){return!!t.style.stroke&&t.style.stroke.call(this,n,i,e)}},on:{mouseover:function(n,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(this,n,i,e))},mouseout:function(n,i){return!!t.on&&(!!t.on.mouseout&&t.on.mouseout.call(this,n,i,e))}}}):t.attr.points?render.triangle({element:e.g.selectAll("#"+n+"_triangle"),data:e.d,attr:{id:function(t){return n+"_triangle"},points:function(n,i){return t.attr.points?t.attr.points.call(this,n,i,e):[0,0]}},style:{fill:function(n,i){return t.style.fill?t.style.fill.call(this,n,i,e):"#000000"},"fill-opacity":function(n,i){return t.style.fillOpacity?t.style.fillOpacity.call(this,n,i,e):"1"},stroke:function(n,i){return!!t.style.stroke&&t.style.stroke.call(this,n,i,e)},"stroke-width":function(n,i){return t.style.strokeWidth?t.style.strokeWidth.call(this,n,i,e):"1px"}},on:{mouseover:function(n,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(this,n,i,e))},mouseout:function(n,i){return!!t.on&&(!!t.on.mouseout&&t.on.mouseout.call(this,n,i,e))}}}):render.rect({element:e.g.selectAll("#"+n+"_rect"),data:e.d,attr:{id:function(t){return n+"_rect"},x:function(n,i){return t.attr.x?t.attr.x.call(e,n,i):0},y:function(n,i){return t.attr.y?t.attr.y.call(e,n,i):0},width:function(n,i){return t.attr.width?t.attr.width.call(e,n,i):5},height:function(n,i){return t.attr.height?t.attr.height.call(e,n,i):5}},style:{fill:function(e){return t.style.fill?t.style.fill(e):"#000000"},"fill-opacity":function(e){return t.style.fillOpacity?t.style.fillOpacity(e):"1"},stroke:function(e){return!!t.style.stroke&&t.style.stroke(e)}},on:{mouseover:function(n,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(this,e,n,i))},mouseout:function(n,i){return!!t.on&&(!!t.on.mouseout&&t.on.mouseout.call(this,n,i,e))}}}),t.text&&render.text({element:e.g.selectAll("#"+e.e.attr("id")+"_text"),data:e.d,attr:{id:function(t){return e.isText=!0,e.e.attr("id")+"_text"},x:function(n,i){return t.attr.x?t.attr.x.call(e,n,i):0},y:function(n,i){return t.attr.y?t.attr.y.call(e,n,i):0}},style:{"font-size":function(e){return t.style.fontSize?t.style.fontSize(e):"10px"},"font-family":function(e){return t.style.fontFamily?t.style.fontFamily(e):"Arial"},"alignment-baseline":function(e){return t.style.alignmentBaseline?t.style.alignmentBaseline:"middel"}},on:{mouseover:function(n,i){return!!t.on&&(!!t.on.mouseover&&t.on.mouseover.call(this,e,n,i))},mouseout:function(n,i){return!!t.on&&(!!t.on.mouseout&&t.on.mouseout.call(this,n,i,e))}},text:function(n,i){return t.text?t.text.call(e,n,i):"legend "+i}})}}(),selectBox=function(t){"use strict";function e(t){var e=document.createElement("div"),n=o.h-2*o.m.top<40?o.h-2*o.m.top:40;return e.className=t+" drop-menu",e.style.width=o.w-2*o.m.left+"px",e.style.height=n+"px",e.style.marginLeft=o.m.left+"px",e.style.marginTop=o.m.top+"px",e.style.fontSize=o.fontSize,e}function n(t,e){var n=document.createElement("div"),i=document.createElement("span"),a=document.createElement("i");return n.className=t+" select",n.style.paddingTop=10-o.m.top+1+"px",n.style.paddingBottom=10-o.m.top+1+"px",n.style.paddingLeft=10-o.m.left+1+"px",n.style.paddingRight=10-o.m.left+1+"px",i.innerHTML=e,a.className="fa fa-chevron-down",n.appendChild(i),n.appendChild(a),n}function i(t){var e=document.createElement("input");return e.type="hidden",e.name=t,e}function a(t){var e=document.createElement("ul");return e.className="dropeddown",util.loop(t,function(t){var n=document.createElement("li");n.id=t.toLowerCase(),n.title=t,n.innerHTML=draw.textOverflow(t,o.fontSize,.4*o.w),e.appendChild(n)}),e}function r(t,e){var n="."+t;$(n).click(function(t){$(this).attr("tabindex",1).focus(),$(this).toggleClass("active"),$(this).find(".dropeddown").slideToggle(300)}),$(n).focusout(function(){$(this).removeClass("active"),$(this).find(".dropeddown").slideUp(300)}),$(n+" .dropeddown li").click(function(t){return $(this).parents(".drop-menu").find("span").text($(this).text()),$(this).parents(".drop-menu").find("span").attr("title",$(this).attr("id")),$(this).parents(".drop-menu").find("input").attr("value",$(this).attr("id")),!!e&&e($(this).attr("id").toLowerCase())})}var o={};return function(t){(o={}).e=document.querySelector(t.element),o.m=size.setMargin(t.margin||[0,0,0,0]),o.w=t.width||parseFloat(o.e.style.width),o.h=t.height||parseFloat(o.e.style.height),o.className=t.className||"",o.initText=t.initText||"Select item",o.viewName=t.viewName||"select",o.fontSize=t.fontSize||"14px",o.items=t.items||[""],o.click=t.click||null,o.frame=e(o.className),o.initText=n(o.className,o.initText),o.viewer=i(o.viewName),o.setItemts=a(o.items),o.e.children.length<1&&(o.frame.appendChild(o.initText),o.frame.appendChild(o.viewer),o.frame.appendChild(o.setItemts),o.e.appendChild(o.frame),r(o.className,o.click))}}(),size=function(t){"use strict";function e(){var t=document.createElement("div");t.id="biochart_tooltip",t.className="biochart-tooltip",document.body.appendChild(t)}function n(t){util.loop.call(this,t,function(t,e){var n=document.createElement("div");n.id=t,n.style.width=e.w+"px",n.style.height=e.h+"px",i.ids.push(t),this.appendChild(n)}),e()}var i={ids:[]};return t.chart={},t.rightToSize=function(t,e,n){var i=0,a=0;return e=parseFloat(e),n=parseFloat(n),"variants"===t?(i=e<900?900:e>1100?1100:e,a=n<300?300:n>500?500:n):"landscape"===t&&(i=e<1100?1100:e>1620?1620:e,a=n<500?500:n>750?750:n),{width:i,height:a}},t.setMargin=function(t){if(!t.length)return{top:t,left:t,bottom:t,right:t};if("[object Object]"===Object.prototype.toString.call(t))return t;switch(t.length){case 1:return{top:t[0],left:t[0],bottom:t[0],right:t[0]};case 2:return{top:t[0],left:t[1],bottom:t[0],right:t[1]};case 3:return{top:t[0],left:t[1],bottom:t[2],right:t[1]};case 4:default:return{top:t[0],left:t[1],bottom:t[2],right:t[3]}}},t.setSize=function(t,e,n){return i={ids:[]},t.style.width=e+"px",t.style.height=n+"px",t},t.chart.exclusivity=function(e,a,r){var o={exclusivity_select_geneset:{w:.25*a,h:.1*r},exclusivity_upper_empty:{w:.34*a,h:.2*r},exclusivity_survival:{w:.4*a,h:r},exclusivity_network:{w:.25*a,h:.55*r},exclusivity_heatmap:{w:.35*a,h:.3*r},exclusivity_legend:{w:.35*a,h:.05*r},exclusivity_sample_legend:{w:.35*a,h:.05*r}};return n.call(t.setSize(e,a,r),o),i.ids},t.chart.landscape=function(e,a,r){var o={landscape_title:{w:a,h:.05*r},landscape_legend:{w:.1*a,h:.95*r},landscape_axis_sample:{w:.14*a,h:.15*r},landscape_patient_sample:{w:.01*a,h:.15*r},landscape_sample:{w:.65*a,h:.15*r},landscape_scale_option:{w:.1*a,h:.15*r},landscape_axis_group:{w:.14*a,h:.2*r},landscape_patient_group:{w:.01*a,h:.2*r},landscape_group:{w:.65*a,h:.2*r},landscape_option:{w:.1*a,h:.2*r},landscape_gene:{w:.14*a,h:.6*r},landscape_patient_heatmap:{w:.01*a,h:.6*r},landscape_heatmap:{w:.65*a,h:.6*r},landscape_pq:{w:.1*a,h:.6*r}};return n.call(t.setSize(e,a,r),o),i.ids},t.chart.variants=function(e,a,r){var o={variants_title:{w:a,h:.075*r},variants_needle:{w:.85*a,h:.825*r},variants_legend:{w:.15*a,h:.5*r},variants_patient_legend:{w:.15*a,h:.425*r},variants_navi:{w:.85*a,h:.1*r}};return n.call(t.setSize(e,a,r),o),i.ids},t.chart.expression=function(e,a,r){var o={expression_title:{w:a,h:.05*r},expression_survival:{w:.4*a,h:.95*r},expression_bar_plot:{w:.4*a,h:.4*r},expression_function:{w:.2*a,h:.05*r},expression_color_mapping:{w:.2*a,h:.05*r},expression_bar_legend:{w:.2*a,h:.3*r},expression_scatter_plot:{w:.4*a,h:.3*r},expression_scatter_empty:{w:.2*a,h:.2*r},expression_scatter_legend:{w:.2*a,h:.1*r},expression_heatmap:{w:.4*a,h:.24*r},expression_signature:{w:.2*a,h:.05*r},expression_color_gradient:{w:.2*a,h:.25*r}};return n.call(t.setSize(e,a,r),o),i.ids},t}(size||{}),survival=function(t){"use strict";function e(t){function e(t,e,n,i){var a={};a[t]={case_id:t,months:e,status:n},i.push(a)}var n={os:[],dfs:[]},i={os:[],dfs:[]},a={os:[],dfs:[]};return util.loop(t,function(t,r){if(t){var o=t.os_days/30,l=t.dfs_days/30;n.os.push(o),n.dfs.push(l),null!=o&&null!=t.os_status&&e(t.participant_id,o,t.os_status,i.os),null!=l&&null!=t.dfs_status&&e(t.participant_id,l,t.dfs_status,i.dfs),e(t.participant_id,o,t.os_status,a.os),e(t.participant_id,l,t.dfs_status,a.dfs)}}),{month:n,pure:i,all:a}}function n(t,e){var n=document.createElement("input");return n.id=t+"_survival",n.name="tabs",n.type="radio",n.checked=0===e,n}function i(t,e){var n=document.createElement("label");return n.htmlFor=t+"_survival",n.innerHTML=e,n}function a(t,e){var n=document.createElement("div");return n.id=t,n}function r(t,e){document.querySelector(t).innerHTML="";for(var r=document.querySelector(t),o=0,l=e.length;o<l;o++){var s=e[o],u=e[o].toLowerCase();r.appendChild(n(u,o)),r.appendChild(i(u,s))}for(var o=0,l=e.length;o<l;o++){var c=a(e[o].toLowerCase());c.appendChild(a(e[o].toLowerCase()+"_survival_curve")),c.appendChild(a(e[o].toLowerCase()+"_stat_table")),r.appendChild(c)}}var o={};return function(t){return o.survivalData=e(t.data),r(t.element,["OS","DFS"]),SurvivalTab.init(t.divisionData,o.survivalData.pure),o}}(),tooltip=function(t){"use strict";function e(t,e,n){return t.left-n.width/2<e.left?"right":t.top-n.height<e.top?"bottom":t.right+n.width>e.right?"left":(t.bottom,n.height,e.bottom,"top")}function n(t,n,i){if(!t)throw new Error("Do not find a Tooltip element");var a=t.getBoundingClientRect(),r=n.getBoundingClientRect(),o=e(r,i.getBoundingClientRect(),a);t.className=o,t.style.visibility="visible",t.style.top=function(t,e,n){if("left"!==t&&"top"!==t&&"bottom"!==t&&"right"!==t)throw new Error("Wrong direction");return{top:e.top-n-10+window.scrollY+"px",left:e.top-n/2+window.scrollY+"px",bottom:e.bottom+10+window.scrollY+"px",right:e.top-n/2+window.scrollY+"px"}[t]}(o,r,a.height),t.style.left=function(t,e,n){if("left"!==t&&"top"!==t&&"bottom"!==t&&"right"!==t)throw new Error("Wrong direction");return{top:e.left-n/2+window.scrollX+"px",left:e.left-n-10+"px",bottom:e.left-n/2+window.scrollX+"px",right:e.right+10+"px"}[t]}(o,r,a.width)}function i(t){if(!t)throw new Error("Do not find a Tooltip element");t.innerHTML="",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden"}return function(t){if("String"===util.varType(t)){if(!document.getElementById("biochart_tooltip"))throw new Error('Not found "#biochart_tooltip"');return i(document.getElementById("biochart_tooltip"))}var e=t.element||null,a=draw.getParentSvg(e),r=t.contents||"",o=document.getElementById("biochart_tooltip");return o.innerHTML=r,n(o,e,a)}}(),util=function(t){"use strict";return t.d3v4=function(){return 0!==d3.version.indexOf("3")},t.camelCase=function(t){return t.substring(0,1).toUpperCase()+t.substring(1).toLowerCase()},t.loop=function(e,n){if("Array"===t.varType(e))for(var i=0,a=e.length;i<a;i++)n.call(this,e[i],i);else if("Object"===t.varType(e))for(var r in e)n.call(this,r,e[r])},t.cloneObject=function(e){if(null===e||"object"!=typeof e)return e;var n=e.constructor();return t.loop(e,function(t,i){e.hasOwnProperty(t)&&(n[t]=e[t])}),n},t.varType=function(t){var e=Object.prototype.toString.call(t);return e.substring(e.indexOf(" ")+1,e.indexOf("]"))},t.keyToArr=function(e){var n=[];return t.loop(e,function(t,e){n.push(t)}),n},t.minmax=function(t,e){return arguments.length<2?{min:Math.min.apply(null,t),max:Math.max.apply(null,t)}:{min:Math.min.call(null,t,e),max:Math.max.call(null,t,e)}},t.median=function(e){return(new Array).concat(e).sort()[t.medIndex(e)]},t.medIndex=function(t){return t.length%2==1?(t.length+1)/2:t.length/2},t.removeWhiteSpace=function(t){return t.replace(/\s/gi,"")},String.prototype.replaceAt=function(t,e){return this.substr(0,t)+e+this.substr(t+e.length)},Array.prototype.fill=function(t,e){for(var n=0;n<t;n++)this.push(e);return this},t}(util||{}),variants=function(t){"use strict";function e(){f.div.title=document.querySelector("#variants_title"),f.div.title.innerHTML=f.origin.variants.title,f.div.title.style.fontSize=draw.getFitTextSize(f.origin.variants.title,parseFloat(f.div.title.style.width),parseFloat(f.div.title.style.height)),f.div.title.style.lineHeight=parseFloat(f.div.title.style.height)+"px"}function n(t,e,n){return["top"===t?e.attr("height")-n[0]:n[0],n[1]]}function i(){var t=(new Array).concat(f.data.axis.needle.y);layout.getSVG(f.svg,["needle"],function(e,i){util.loop(["left","top"],function(e,a){axis.element(i)[e]({margin:config.variants.axis[e].margin,position:n(e,i,config.variants.axis[e].margin),data:"left"===e?t.reverse():f.data.axis.needle.x,opt:{}})})})}function a(t){layout.getSVG(f.svg,["needle"],function(e,n){needle({element:n,lineData:f.data.needle,circleData:f.data.fullNeedle,line:config.variants.needle.line,attr:config.variants.needle.attr,style:config.variants.needle.style,margin:config.variants.needle.margin,xaxis:t||f.data.axis.needle.x,yaxis:f.data.axis.needle.y,on:config.variants.needle.on})})}function r(t){layout.getSVG(f.svg,["needle"],function(e,n){needleGraph({element:n,data:f.data.graph,attr:config.variants.needleGraph.attr,style:config.variants.needleGraph.style,margin:config.variants.needleGraph.margin,text:config.variants.needleGraph.text,xaxis:t||f.data.axis.needle.x,yaxis:f.data.axis.needle.y,on:config.variants.needleGraph.on})})}function o(){layout.getSVG(f.svg,["navi"],function(t,e){needleNavi({element:e,data:f.data,margin:config.variants.navi.margin,style:config.variants.navi.style,xaxis:f.data.axis.needle.x,yaxis:f.data.axis.needle.y,drag:{drag:config.variants.navi.drag.drag,end:function(t,e,n){var i=config.variants.navi,o=scale.invert(n.sx),l=[o(i.start.now+n.rect.width),o(i.end.now+n.rect.width)],s=[n.m.left,n.w-n.m.right];d3.selectAll(".top-axis-g-tag").call(axis.byVersion(scale.get(l,s),"top")),layout.removeG([".variants_needle_chart.needle-line-g-tag",".variants_needle_chart.needle-circle-g-tag",".variants_needle_chart.needle-graph-g-tag",".variants_needle_chart.needle-patient-g-tag"]),a(l),r(l),u(l)}}})})}function l(t,e){layout.getSVG(f.svg,["needle"],function(n,i){var a={},r=config.variants.patient.needle;a.m=size.setMargin(r.margin),a.id=i.attr("id"),a.w=i.attr("width"),a.h=i.attr("height"),a.g=render.addGroup(i,a.h-a.m.bottom,a.m.left,"needle-patient"),a.s=scale.get(e||f.data.axis.needle.x,[a.m.left,a.w-a.m.right]),a.len=5,render.triangle({element:a.g.selectAll("#"+a.id+"_tri"),data:t,attr:{id:function(t,e){return a.id+"_tri"},points:function(t,e){return r.attr.points?r.attr.points.call(this,t,e,a):[0,0]}},style:{fill:function(t,e){return r.style.fill?r.style.fill.call(this,t,e,a):"#000000"},stroke:function(t,e){return r.style.stroke?r.style.stroke.call(this,t,e,a):"#FFFFFF"}},on:{mouseover:function(t,e){return!!r.on.mouseover&&r.on.mouseover.call(this,t,e,a)},mouseout:function(t,e){return!!r.on.mouseout&&r.on.mouseout.call(this,t,e,a)}}})})}function s(t){layout.getSVG(f.svg,["nt_legend"],function(e,n){legend({element:n,data:[t[0].id],attr:config.variants.patient.legend.attr,style:config.variants.patient.legend.style,text:config.variants.patient.legend.text,margin:config.variants.patient.legend.margin})})}function u(t){if(t)return l(f.data.patient,t);l(f.data.patient),s(f.data.patient)}function c(){var t=draw.getTextHeight(config.variants.legend.style.fontSize).height;document.querySelector("#variants_legend").style.height=(t+6)*f.data.type.length+"px",layout.getSVG(f.svg,["ts_legend"],function(t,e){legend({element:e,data:f.data.type,priority:config.landscape.priority,text:config.variants.legend.text,attr:config.variants.legend.attr,style:config.variants.legend.style,margin:config.variants.legend.margin})})}function d(){layout.removeG(),i(),c(),a(),o(),r(),u()}var f={div:{}};return function(t){f={div:{}};var n=document.querySelector(t.element||null),i=parseFloat(t.width||n.style.width||1400),a=parseFloat(t.height||n.style.height||700);n.style.background="#F7F7F7",f.origin=t.data,f.data=preprocessing.variants(t.data),f.ids=size.chart.variants(n,i,a),f.svg=layout.variants(f.ids,f),e(),d(),console.log("Given Variants data: ",t),console.log("Variants model data: ",f)}}();