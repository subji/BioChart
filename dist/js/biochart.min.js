function boilerPlate(){"use strict";var t={};return t.variantInfo={Amplification:{color:"#FFBDE0",order:0},Homozygous_deletion:{color:"#BDE0FF",order:1},Nonsense_mutation:{color:"#EA3B29",order:2},Splice_site:{color:"#800080",order:3},Translation_start_site:{color:"#AAA8AA",order:4},De_novo_start_inframe:{color:"#AAA8AA",order:4},De_novo_start_outofframe:{color:"#AAA8AA",order:4},Missense_mutation:{color:"#3E87C2",order:5},Start_codon_snp:{color:"#3E87C2",order:5},Start_codon_indel:{color:"#3E87C2",order:5},Nonstop_mutation:{color:"#070078",order:6},Frame_shift_indel:{color:"#F68D3B",order:7},Stop_codon_indel:{color:"F68D3B",order:7},In_frame_indel:{color:"#F2EE7E",order:8},Silent:{color:"#5CB755",order:9},Rna:{color:"#FFDF97",order:10},Lincrna:{color:"#FFDF97",order:10},Intron:{color:"#A9A9A9",order:11},"5'utr":{color:"#A9A9A9",order:11},"3'utr":{color:"#A9A9A9",order:11},Igr:{color:"#A9A9A9",order:11},"5'flank":{color:"#A9A9A9",order:11}},t.clinicalInfo={},t.exclusivityInfo={Amplification:"#FFBDE0",Deletion:"#BDE0FF",Mutation:"#5CB755",None:"#D3D3D3"},t}function layout(){"use strict";var t={svg:{pathway:{},variants:{},landscape:{},expression:{},exclusivity:{}}};function e(e,i,n,a){if(n)return bio.iteration.loop(n,function(n){var o=!0,r=!0;bio.iteration.loop(e,function(t){n.indexOf(t)>-1&&(o=!o)}),o&&(n=n.replace("/",""),a&&bio.iteration.loop(a,function(t){n.indexOf(t)>-1&&!a[t]&&("patient"===t&&$("#landscape_patient_group, #landscape_patient_sample, #landscape_patient_heatmap").css("box-shadow","None").css("background","#fff"),r=!1)}),r&&(t.svg[i][n]=bio.rendering().createSVG(n)))}),t.svg[i]}return t.landscape=function(t,i){return e(["option","title"],"landscape",t,i)},t.variants=function(t){return e(["title"],"variants",t)},t.expression=function(t){return e(["title","function","color_mapping","signature"],"expression",t)},t.exclusivity=function(t){return e(["title","geneset","survival","empty"],"exclusivity",t)},t.pathway=function(t){return e(["title"],"pathway",t)},t.get=function(t,e,i){!function(t){var e=(t=Array.prototype.slice.call(t)).map(function(t){return bio.objects.getType(t)});if(e.indexOf("Object")<0)throw new Error("Not found svg set");if(e.indexOf("Function")<0)throw new Error("Not found callback")}(arguments),e="Array"===bio.objects.getType(e)?e:[e],bio.iteration.loop(t,function(t,n){bio.iteration.loop(e,function(e){if(t.indexOf(e)>-1)return i(t,n)})})},t.removeGroupTag=function(t){t&&"string"!=typeof t?(t="Array"===bio.objects.getType(t)?t:[t],bio.iteration.loop(t,function(t){d3.selectAll(t.indexOf(".")>-1?t:"."+t).remove()})):"string"==typeof t?bio.iteration.loop(d3.selectAll("svg").nodes(),function(e){e.id.indexOf(t)<0&&d3.select(e).selectAll("g").remove()}):d3.selectAll("svg g").remove()},function(){return t}}function setting(){"use strict";var t=null;return function(e,i){t=bio.initialize("setting");var n,a,o,r,l,s,c,u,d,p,g,f,h=null,v=i.plot?i.plot:null,m=i.data.data?i.data.data.gene_list:void 0;return i.data.data&&i.data.data.name&&(h=i.data.data.group_list),{defaultData:i.data,targetedElement:(f=i.element,t.dom=bio.dom().get(f),t.dom),targetedElementSize:(g=i,t.size.width=g.width||parseFloat(t.dom.style.width),t.size.height=g.height||parseFloat(t.dom.style.height),{width:t.size.width,height:t.size.height}),preprocessData:bio.preprocess(e)(i.data,v),layoutIds:(r=e,l=t.dom,s=t.size.width,c=t.size.height,u=h,d=v,p=m,t.ids=bio.sizing.chart[r](l,s,c,u,d,p),t.ids),svgs:(n=e,a=t.ids,o=v,bio.layout()[n](a,o))}}}function sizing(){"use strict";var t={chart:{},ids:[]};function e(e){!function(){document.getElementById("biochart_tooltip")&&document.body.removeChild(document.getElementById("biochart_tooltip"));var t=document.createElement("div");t.id="biochart_tooltip",t.className="biochart-tooltip",document.body.appendChild(t)}(),bio.iteration.loop.call(this,e,function(e,i){var n=document.createElement("div");n.id=e,n.style.width=i.width+"px",n.style.height=i.height+"px",t.ids.push(e),this.appendChild(n)})}function i(e,i,n){return t=bio.initialize("sizing"),e.style.width=i+"px",e.style.height=n+"px",e}function n(t,e,i,n,a){var o=document.createElement("div"),r=document.createElement("div");return o.id=t+"_title",r.id=t+"_contents",o.style.width=i+"px",o.style.height=n*a+"px",r.style.width=i+"px",r.style.height=n*(100-a)+"px",e.appendChild(o),e.appendChild(r),{title:o,contents:r}}function a(t,e,i,n,a){var o=.16*n/t.length,r={patient:{w:.01*i,h:o},axis:{w:.14*i,h:o},group:{w:.65*i,h:o}};return bio.iteration.loop(t,function(t){var i=t.name.removeWhiteSpace().replace("/",""),n="group"===r[a]?"":a;e["landscape_"+n+"_group_"+i]={width:r[a].w.toFixed(1),height:r[a].h.toFixed(1)}}),e}return t.setMargin=function(t){if(t.length||"string"!=typeof t){if("Object"===bio.objects.getType(t))return t;var e=t.length;return{top:t[0],left:e>1?t[1]:t[0],bottom:e>2?t[2]:t[0],right:1===e?t[0]:e>3?t[3]:t[1]}}return{top:t,left:t,bottom:t,right:t}},t.chart.landscape=function(o,r,l,s,c,u){var d=u.length,p=d>=40?1:-1,g=(Math.abs(40-d),l*(.62+.01*d*p)),f=.95+.0095*d*p;f=f<.61?.6*l:l*f,g=d<5?360:g,f=d<5?630:f;var h={landscape_temp_sample:{width:.12*r,height:.15*l},landscape_axis_sample:{width:.14*r,height:.15*l},landscape_patient_sample:{width:.01*r,height:.15*l},landscape_sample:{width:.63*r,height:.15*l},landscape_scale_option:{width:.1*r,height:.15*l},landscape_option:{width:.12*r,height:.16*l},landscape_axis_group:{width:.14*r,height:.15*l},landscape_patient_group:{width:.01*r,height:.16*l},landscape_group:{width:.63*r,height:.16*l},landscape_temp_group:{width:.1*r,height:.16*l},landscape_legend:{width:.12*r,height:g},landscape_gene:{width:.14*r,height:g},landscape_patient_heatmap:{width:.01*r,height:g},landscape_heatmap:{width:.63*r,height:g},landscape_pq:{width:.1*r,height:g}};bio.iteration.loop(c,function(t){(t.indexOf("pq")>-1||t.indexOf("gene")>-1)&&(h.landscape_sample.width=.72*r,h.landscape_heatmap.width=.72*r,h.landscape_group.width=.72*r,h.landscape_pq.width=.01*r,h.landscape_temp_group.width=.01*r,h.landscape_scale_option.width=.01*r)});var v=n("landscape",o,r,l,.05),m=a(s,{},r,l,"axis"),x=a(s,{},r,l,"group"),b=a(s,{},r,l,"patient");return e.call(i(v.contents,r,f),h),e.call(bio.dom().get("#landscape_group"),x),e.call(bio.dom().get("#landscape_axis_group"),m),e.call(bio.dom().get("#landscape_patient_group"),b),t.ids},t.chart.variants=function(a,o,r){var l={variants_needle:{width:.82*o,height:.825*r},variants_legend:{width:.175*o,height:.5*r},variants_patient_legend:{width:.175*o,height:.42*r},variants_navi:{width:.82*o,height:.1*r}},s=n("variants",a,o,r,.075);return e.call(i(s.contents,o,.925*r),l),t.ids},t.chart.expression=function(a,o,r){var l={expression_survival:{width:.4*o,height:.925*r},expression_bar_plot:{width:.4*o,height:.32*r},expression_function:{width:.2*o,height:.05*r},expression_color_mapping:{width:.2*o,height:.05*r},expression_bar_legend:{width:.2*o,height:.35*r},expression_division:{width:.4*o,height:.04*r},expression_scatter_plot:{width:.4*o,height:.3*r},expression_scatter_empty:{width:.2*o,height:.08*r},expression_scatter_legend:{width:.2*o,height:.2*r},expression_heatmap:{width:.4*o,height:.25*r},expression_signature:{width:.2*o,height:.05*r},expression_color_gradient:{width:.194*o,height:.075*r}},s=n("expression",a,o,r,.075);return e.call(i(s.contents,o,.925*r),l),t.ids},t.chart.exclusivity=function(a,o,r){var l={exclusivity_select_geneset:{width:.59*o,height:.12*r},exclusivity_survival:{width:.4*o,height:.925*r},exclusivity_network:{width:.25*o,height:.65*r},exclusivity_heatmap:{width:.35*o,height:.45*r},exclusivity_legend:{width:.35*o,height:.05*r},exclusivity_sample_legend:{width:.35*o,height:.05*r}},s=n("exclusivity",a,o,r,.075);return e.call(i(s.contents,o,.925*r),l),t.ids},t.chart.pathway=function(a,o,r){var l=n("pathway",a,o,r,.075);return e.call(i(l.contents,o,.925*r),{}),t.ids},t.chart.default=function(t,e){return t.id=e.element.attr("id"),t.margin=e.margin?bio.sizing.setMargin(e.margin):null,t.width=parseFloat(e.element.attr("width")),t.height=parseFloat(e.element.attr("height")),t.element="Object"===bio.objects.getType(e.element)||"Array"===bio.objects.getType(e.element)?e.element:/\W/.test(e.element[0])?d3.select(e.element):d3.select("#"+e.element),t},t}function handler(){"use strict";function t(t,e){bio.dom().get(t).addEventListener("scroll",e,!1)}function e(t,e){if(!t)throw new Error("No given element");var i,n,a;i=t,n="mousewheel",a=!1,document.body.addEventListener(n,function(t){if(a)return t.preventDefault&&t.preventDefault(),!1}),i.addEventListener("mouseenter",function(t){a=!0}),i.addEventListener("mouseleave",function(t){a=!1}),t.addEventListener("mousewheel",function(i){t.scrollTop+=t.wheelDelta,e&&e.call(t,i)})}return function(){return{scroll:t,scrollOnHidden:e}}}function commonConfig(){"use strict";var t={};return t.typeFormat=function(t){return t.replace(/(_ins|_del)$/gi,"_indel").pronoun()},function(){return t}}function exclusivityConfig(){"use strict";function t(t){return"B"===t?["A","M"]:"E"===t?["D","M"]:"M"===t?[".","M"]:[t]}function e(t,e){return"var"===t?"Mutation":e.toUpperCase().indexOf("AMP")>-1?"Amplipication":"Deletion"}function i(t){return"Amplification"===t?"A":"Homozygous_deletion"===t?"D":"M"}function n(t){return{Amplification:"A",Deletion:"D",Mutation:"M",None:"."}[t]}function a(t){return{A:"Amplification",D:"Deletion",M:"Mutation",".":"None"}[t]}function o(t){return{Amplification:0,Deletion:1,Mutation:2,None:3}[t]}function r(t,e,i){var n=null;return{legend:{attr:{x:function(t,i,a){var o=n||0,r=t.text.replace(" ","H");return n=n?n+bio.drawing().textSize.width(r,"14px"):bio.drawing().textSize.width(r,"14px")+5,e+o},y:function(t,e,i){return"**"===t.text?18:15}},style:{fill:function(t,e,i){return t.color},fontSize:function(t,e,i){return"**"===t.text?"16px":"14px"}},text:function(t,e,i){return t.text}},division:{attr:{x:function(t,n,a){var o=bio.drawing().textSize.width(t.text,"18px");return"#00AC52"===t.color?i.attr("width")-(10+o):e},y:function(t,e,n){return.05*i.attr("height")}},style:{fill:function(t,e,i){return t.color},fontSize:"18px"},text:function(t,e,i){if("**"===t.text)return t.text}}}[t]}function l(t){var e=".exclusivity_legend_svg.legend-shape-g-tag",i=".exclusivity_legend_svg.legend-text-g-tag";return{margin:[0,t,0,0],attr:{x:function(t,e,i){return"text"===this.tagName?e*(1.3*i.fontWidth.value)+5:e*(1.3*i.fontWidth.value)},y:function(t,e,i){return"text"===this.tagName?.8*i.height/2+.2*i.height:t.indexOf("Mutation")>-1?.2*i.height+.8*i.height/4.5:.2*i.height},width:2.5,height:function(t,e,i){return"Mutation"===t?.8*i.height/2:.8*i.height}},style:{fill:function(t,e,i){return"text"===this.tagName?"#333333":bio.boilerPlate.exclusivityInfo[t]},fontSize:"11px"},on:{mouseover:function(t,n,a){var o=a.legendData.indexOf(t),r=bio.drawing().nthChild(e,o),l=bio.drawing().nthChild(i,o),s=bio.rendering().opacity(bio.boilerPlate.exclusivityInfo[t],.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,n,a){var o=a.legendData.indexOf(t),r=bio.drawing().nthChild(e,o),l=bio.drawing().nthChild(i,o);d3.select(r).transition(10).style("fill",bio.boilerPlate.exclusivityInfo[t]),d3.select(l).style("font-weight","normal")}},text:function(t,e,i){return t}}}function s(){return{}}function c(t,e,i){var n=e.attr("height");return{shape:{margin:[.2*n,i,0,10],attr:{x:function(t,e,i){return i.scaleX(t.x)},y:function(t,e,i){return"Mutation"===t.value?i.scaleY(t.y)+bio.scales().band(i.scaleY)/3:i.scaleY(t.y)},width:function(t,e,i){return bio.scales().band(i.scaleX)},height:function(t,e,i){return"Mutation"===t.value?bio.scales().band(i.scaleY)/3:bio.scales().band(i.scaleY)}},style:{fill:function(t,e,i){return bio.boilerPlate.exclusivityInfo[t.value]}}},axis:{margin:[.2*n,i,0,10],range:[.2*n,n]}}[t]}function u(){return{attr:{x:function(t,e,i){return d3.select(".legend").node().getBoundingClientRect().width},y:function(t,e,i){return d3.select(".legend text").node().getBoundingClientRect().height/3}},style:{fill:function(t,e,i){var n=null;return bio.iteration.loop(i.data.sample.isAltered,function(e){e.text===t.text&&(n=t.color)}),n||"none"},fontSize:"25px"},text:function(t,e,i){return"**"}}}function d(t){return{margin:[20,t,0,9],attr:{x:function(t,e,i){return"text"===this.tagName?t.text.indexOf("Un")>-1?t.end-t.textWidth-i.margin.right:t.start+i.margin.right:"path"===this.tagName?t.path_x:t.start},y:function(t,e,i){return"text"===this.tagName?.05*i.height+i.margin.top:"path"===this.tagName?0===e?i.margin.top:t.path_y:i.margin.top},width:function(t,e,i){return t.end-t.start},height:function(t,e,i){return.1*i.height}},style:{fill:function(t,e,i){return"text"===this.tagName?"#FFFFFF":t.color},stroke:function(t,e,i){return"path"===this.tagName?"#333333":"none"},fontSize:"11px"},text:function(t,e,i){return t.text}}}return function(){return{name:a,symbol:n,byCase:e,legend:l,sample:r,network:s,heatmap:c,survival:u,separate:t,priority:o,division:d,abbreviation:i}}}function expressionConfig(){"use strict";function t(t){var e=".expression_bar_legend_svg.legend-shape-g-tag",i=".expression_bar_legend_svg.legend-text-g-tag",n=".expression_scatter_legend_svg.legend-shape-g-tag",a=".expression_scatter_legend_svg.legend-text-g-tag";return{color_mapping:{margin:[10,15,0,0],attr:{x:function(t,e,i){return"text"===this.tagName?i.margin.left:0},y:function(t,e,i){return"text"===this.tagName?e*i.fontHeight+i.fontHeight/2-1.5:e*i.fontHeight},width:8,height:8},style:{fill:function(t,e,i){return"text"===this.tagName?"#333333":"NA"===t?"#A4AAA7":bio.boilerPlate.clinicalInfo[t].color},fontSize:"11px"},on:{mouseover:function(t,n,a){var o=a.legendData.indexOf(t),r=bio.drawing().nthChild(e,o),l=bio.drawing().nthChild(i,o),s=bio.rendering().opacity("NA"===t?"#A4AAA7":bio.boilerPlate.clinicalInfo[t].color,.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,n,a){var o=a.legendData.indexOf(t),r=bio.drawing().nthChild(e,o),l=bio.drawing().nthChild(i,o);d3.select(r).transition(10).style("fill","NA"===t?"#A4AAA7":bio.boilerPlate.clinicalInfo[t].color),d3.select(l).style("font-weight","normal")}},text:function(t,e,i){return bio.drawing().textOverflow(t,"11px",.75*i.width)}},scatter:{margin:[15,15,20,15],attr:{cx:0,cy:function(t,e,i){return e*(i.fontHeight+3)},r:5,x:function(t,e,i){return i.margin.left},y:function(t,e,i){return e*(i.fontHeight+3)+1}},style:{fill:function(t,e,i){return"Alive"===t?"#5D5DD8":"#D86561"},fontSize:"11px"},on:{mouseover:function(t,e,i){var o=i.legendData.indexOf(t),r=bio.drawing().nthChild(n,o),l=bio.drawing().nthChild(a,o),s=bio.rendering().opacity("Alive"===t?"#5D5DD8":"#D86561",.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,e,i){var o=i.legendData.indexOf(t),r=bio.drawing().nthChild(n,o),l=bio.drawing().nthChild(a,o);d3.select(r).transition(10).style("fill","Alive"===t?"#5D5DD8":"#D86561"),d3.select(l).style("font-weight","normal")}},text:function(t,e,i){return t}}}[t]}function e(t,e){return{shape:{margin:[10,e,30,20],attr:{cx:function(t,e,i){return i.scaleX(t.x)},cy:function(t,e,i){return i.scaleY(t.y)},r:5},style:{fill:function(t,e,i){return void 0===t.value?"#333333":1===t.value?"#D86561":"#5D5DD8"},fillOpacity:.6},on:{mouseover:function(t,e,i){bio.tooltip({element:this,contents:"ID: <b>"+t.x+"</b></br>Months: <b>"+t.y+"</b></br>Status: <b>"+("0"===t.value?"Alive":"Dead")+"</b>"})},mouseout:function(t,e,i){bio.tooltip("hide")}}},axis:{top:0,left:e,margin:[0,0,0,0],exclude:"path, line"}}[t]}function i(t,e){return{shape:{margin:[0,e,0,20],attr:{id:function(t,e,i){return"expression_heatmap_rect"},x:function(t,e,i){return i.scaleX(t.x)},y:function(t,e,i){return i.scaleY(t.y)},width:function(t,e,i){return bio.scales().band(i.scaleX)},height:function(t,e,i){return bio.scales().band(i.scaleY)}},on:{mouseover:function(t,e,i){bio.tooltip({element:this,contents:"ID: <b>"+t.x+"</b></br>Gene: <b>"+t.y+"</b></br>TPM: <b>"+t.value+"</b></br>"})},mouseout:function(t,e,i){bio.tooltip("hide")}}},axis:{top:0,left:e,margin:[0,0,0,0],exclude:"path, line"}}[t]}function n(t){return{margin:[0,t,0,20],attr:{points:function(t,e,i){var n=i.id.indexOf("bar")>-1?t.y-t.value<0?i.scaleY(t.y)+8:i.scaleY(t.y)+3:i.height,a=i.id.indexOf("bar")>-1&&t.y-t.value<0?"top":"bottom";return bio.rendering().triangleStr(i.scaleX(t.x),n,10,a)}},style:{fill:"#333333"},on:{mouseover:function(t,e,i){bio.tooltip({element:this,contents:"<b>"+t.x+"</b></br>Value: <b>"+t.value+"</b></br>"})},mouseout:function(t,e,i){bio.tooltip("hide")}}}}function a(t,e){return{shape:{margin:[20,e+1,15,19],attr:{id:function(t,e,i){return"expression_bar_plot_rect"},x:function(t,e,i){return i.scaleX(t.x)},y:function(t,e,i){return t.y-t.value<0?i.scaleY(t.value):i.scaleY(t.y)},width:function(t,e,i){return bio.scales().band(i.scaleX)},height:function(t,e,i){return t.y-t.value<0?i.scaleY(t.y)-i.scaleY(t.value):i.scaleY(t.value)-i.scaleY(t.y)}},style:{fill:function(t,e,i){return t.y-t.value==0?"#000000":"#62C2E0"},stroke:function(t,e,i){return t.y-t.value==0?"#000000":"#62C2E0"}},on:{mouseover:function(t,e,i){bio.tooltip({element:this,contents:"ID: <b>"+t.x+"</b></br>Average: <b>"+t.value+"</b>"})},mouseout:function(t,e,i){bio.tooltip("hide")}}},axis:{top:0,left:e,margin:[10,0,10,0]}}[t]}function o(t,e){var i;return{axis:{top:20,left:0,margin:[0,5,0,10],exclude:"path, line",range:[5,{width:(i=e)?i.attr("width"):0,height:i?i.attr("height"):0}.width-10]},shape:{attr:{x:5,y:5,rx:3,ry:3,width:function(t,e,i){return d3.select(bio.drawing().getParentSVG(this)).attr("width")-10},height:15},style:{fill:function(t,e,i){return"url(#"+i.data.colorGradient.id+")"}}}}[t]}function r(t,e){var i=".division-path-0-g-tag path",n="#expression_division_svg_division_shape_rect";function a(t,e,i){t.attr("points",function(t,n,a){return bio.rendering().triangleStr(i+e.additional,e.path_y,10,e.direction)})}function o(t,e){var i=t.attr("d"),n=i.substring(i.indexOf("M")+1,i.indexOf(","));t.attr("d",i.replace(new RegExp(n,"gi"),e))}return{bar:{margin:[0,e,0,20]},division:{margin:[0,e,0,20],attr:{x:function(t,e,i){return i.position.init.low=i.position.init.low?i.position.init.low:t.path_x,i.position.init.high=i.position.init.high?i.position.init.high:t.path_x,i.position.now.low=i.position.init.low,i.position.now.high=i.position.init.high,"text"===this.tagName?t.text.indexOf("Low")>-1?t.start+5:t.end-t.textWidth-15:"path"===this.tagName?t.path_x:t.start},y:function(t,e,i){return"text"===this.tagName?i.height/2:"path"===this.tagName?t.text.indexOf("Low")>-1?0===e?t.path_y-5:t.path_y:0===e?t.path_y:t.path_y+5:0},points:function(t,e,i){return bio.rendering().triangleStr(t.path_x+t.additional,t.path_y,10,t.direction)},width:function(t,e,i){return t.end-t.start},height:function(t,e,i){return i.height},rx:3,ry:3},style:{fill:function(t,e,i){return"text"===this.tagName?"#FFFFFF":t.text.indexOf("Low")>-1?"#00AC52":"#FF6252"},stroke:function(t,e,i){return"text"===this.tagName?t.text.indexOf("Low")>-1?"#00AC52":"#FF6252":"none"},strokeWidth:"0.5px",fontSize:"12px",fontWeight:"bold",cursor:function(t,e,i){return"polygon"===this.tagName?"pointer":"normal"}},call:{drag:function(t,e,r){if(t.text.indexOf("Low")>-1){r.position.init.low=r.position.init.low?r.position.init.low:t.path_x,r.position.now.low=r.position.now.low?r.position.now.low+=d3.event.dx:t.path_x;var l=r.position.now.low=Math.max(t.start,Math.min(r.position.now.high||t.path_x,r.position.now.low));a(d3.select(this),t,r.position.now.low),o(d3.select(i),l),d3.selectAll(n).attr("width",function(e,i,n){return e.text===t.text?l-e.start:e.end-r.position.now.high})}else{r.position.init.high=r.position.init.high?r.position.init.high:t.path_x,r.position.now.high=r.position.now.high?r.position.now.high+=d3.event.dx:t.path_x;l=r.position.now.high=Math.max(r.position.now.low||t.path_x,Math.min(t.end,r.position.now.high));var s=d3.select(i).attr("d");s.substring(s.indexOf("M")+1,s.indexOf(","));a(d3.select(this),t,r.position.now.high),o(d3.select(".division-path-1-g-tag path"),l),d3.selectAll(n).attr("x",function(e,i,n){return e.text===t.text?l:e.start}).attr("width",function(e,i,n){return e.text===t.text?e.end-l:r.position.now.low-e.start})}}},text:function(t,e,i){return t.text}},scatter:{margin:[0,e,0,20]}}[t]}function l(t){return{legend:{attr:{x:function(t,e,i){var n=d3.select(".legend").node().getBoundingClientRect();return n.right-n.left},y:function(t,e,i){var n=d3.select(".legend text").node().getBoundingClientRect();bio.drawing().textSize.height("11px");return n.height/2.5}},style:{fill:function(t,e,i){return i.data.patient.data===t.text?t.color:"#FFFFFF"}},text:function(t,e,i){return i.data.patient.data===t.text?" **"===i.data.patient.data?"":" **":""}}}[t]}return function(){return{bar:a,legend:t,scatter:e,heatmap:i,patient:n,gradient:o,division:r,survival:l}}}function landscapeConfig(){"use strict";function t(t){return bio.boilerPlate.variantInfo[bio.commonConfig().typeFormat(t)].order<2?"cnv":"var"}function e(t,e,i){if("common"===t)return{on:{mouseover:function(t,e,i){var n=this.parentNode.parentNode.className.baseVal;if(n.indexOf("gene")>-1&&n.indexOf("right")>-1||n.indexOf("group")>-1){var a=n.indexOf("gene")>-1?"Sort by alt + <b>"+this.innerHTML+"</b>":"<b>"+this.innerHTML+"</b></br>Click to sort </br> Alt + Click "+bio.tooltip({element:this,contents:a});d3.select(this).transition().style("font-size",11).style("font-weight","bold")}},mouseout:function(t,e){bio.tooltip("hide"),d3.select(this).transition().style("font-size",10).style("font-weight","normal")}}};var n=parseFloat(i.attr("width")),a=parseFloat(i.attr("height"));return{sampleY:{top:5,left:n-5,direction:"left",range:[5,a-25],margin:[5,0,25,0]},groupY:{top:5,left:30,range:[0,0],direction:"right",margin:[0,0,0,0],exclude:"path, line",on:{click:function(t,e,i){var n,a;return bio.iteration.loop(i.data.axis.group.y,function(e,n){if(e[0]===t){var a=[].concat(i.data.group.group[n]);i.now.group=bio.landscapeSort().group.call(i,a,!!d3.event.altKey)}}),{sorted:{axis:"x",data:(n=i.now.group.axis.data,a=[],bio.iteration.loop(n,function(t){a=a.concat(t)}),a)},model:i}}}},geneY:{top:0,left:n-70,direction:"right",range:[10,a-45],exclude:"path, line",margin:[10,0,45,0],on:{click:function(t,e,i){var n=[];if(bio.iteration.loop(i.data.heatmap,function(e){e.y===t&&n.push(e)}),d3.event.altKey)return{sorted:bio.landscapeSort().gene(i.data.axis.heatmap.x,n),model:i}}}},geneX:{left:15,top:a-45,range:[15,n-85],direction:"bottom",margin:[0,15,0,85]},pqX:{left:5,top:a-45,direction:"bottom",range:[10,n-20],margin:[0,10,20,20]}}[t+e]}function i(t){return{pq:{margin:[5,15,13,5],attr:{rx:3,ry:3,x:function(t,e,i){return"text"===this.tagName?i.margin.left:i.margin.left-i.margin.right},y:function(t,e,i){return"text"===this.tagName?i.height-i.margin.bottom:i.height-1.75*i.margin.bottom},width:function(t,e,i){return i.mostWidth.value+2*i.margin.right},height:function(t,e,i){return i.mostHeight+i.margin.top}}},gene:{margin:[5,5,13,125],attr:{rx:3,ry:3,x:function(t,e,i){return"text"===this.tagName?i.width-i.margin.right:i.width-i.margin.right-i.margin.left},y:function(t,e,i){return"text"===this.tagName?i.height-i.margin.bottom:i.height-1.75*i.margin.bottom},width:function(t,e,i){return i.mostWidth.value-2*i.margin.left},height:function(t,e,i){return i.mostHeight+i.margin.top}}},sample:{margin:[10,6.5,25,45],attr:{rx:3,ry:3,x:function(t,e,i){return"text"===this.tagName?-1*i.height+i.margin.bottom:-1*i.height+.65*i.margin.bottom},y:function(t,e,i){return"text"===this.tagName?i.width-i.margin.right:i.width-i.margin.right-i.margin.top},width:function(t,e,i){return i.mostWidth.value-i.margin.left},height:function(t,e,i){return i.mostHeight+i.margin.top/2}}},common:{titles:["#Mutations","-log10(p-value)"],style:{fontSize:"10px",fontWeight:"bold",filter:"url(#drop_shadow)",fill:function(t,e,i){return"text"===this.tagName?"#FFFFFF":"#595959"}},on:{click:function(t,e,i){return{sorted:bio.landscapeSort()[i.now.sort[i.sortName]](i.sortName,i.data),model:i}},mouseover:function(t,e,i){bio.tooltip({element:"text"===this.tagName?this.nextSibling?this.nextSibling:this.previousSibling:this,contents:"Sort by <b>"+t.text+"</b>"})},mouseout:function(t,e,i){bio.tooltip("hide")}},text:function(t,e,i){return t.text}}}[t]}function n(t){return{pq:{margin:[10,15,45.5,30],attr:{id:function(t,e,i){return"landscape_gene_"+t.y+"_pq_rect"},x:function(t,e,i){return bio.math.min(i.rangeX)},y:function(t,e,i){return i.scaleY(t.y)+.25},width:function(t,e,i){return i.scaleX(t.value)},height:function(t,e,i){return bio.scales().band(i.scaleY)-.5}},style:{fill:"#BFBFBF"},on:{mouseover:function(t,e,i){bio.tooltip({element:this,contents:"<b>"+t.y+"</b></br>Value: <b>"+t.value+"</b>"}),d3.select(this).transition(10).style("fill","#7A7A7A").style("filter","url(#drop_shadow)")},mouseout:function(t,e,i){bio.tooltip("hide"),d3.select(this).transition(10).style("fill","#BFBFBF").style("filter","none")}}},gene:{margin:[10,30,45.5,70],attr:{id:function(t,e,i){return"landscape_gene_"+t.y+"_bar_rect"},x:function(t,e,i){return i.scaleX(t.x+t.value)+.125},y:function(t,e,i){return i.scaleY(t.y)+.25},width:function(t,e,i){return i.scaleX(t.x)-i.scaleX(t.x+t.value)-.25},height:function(t,e,i){return bio.scales().band(i.scaleY)-.5}},style:{fill:function(t,e,i){return bio.boilerPlate.variantInfo[t.info].color}},on:{mouseover:function(t,e,i){var n=bio.rendering().opacity(bio.boilerPlate.variantInfo[t.info].color,.3);bio.tooltip({element:this,contents:"<b>"+t.y+"</b></br>Type: <b>"+t.info+"</b></br>Count: <b>"+t.value+"</b>"}),d3.select(this).transition(10).style("fill",n).style("filter","url(#drop_shadow)")},mouseout:function(t,e,i){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.variantInfo[t.info].color).style("filter","none")}}},sample:{margin:[10,5,20,0],attr:{x:function(t,e,i){return i.scaleX(t.x)+.25},y:function(t,e,i){return i.scaleY(t.y+t.value)+.25},width:function(t,e,i){return bio.scales().band(i.scaleX)-.5},height:function(t,e,i){return i.scaleY(t.y)-i.scaleY(t.y+t.value)-.5}},style:{fill:function(t,e,i){return bio.boilerPlate.variantInfo[t.info].color}},on:{mouseover:function(t,e,i){var n=bio.rendering().opacity(bio.boilerPlate.variantInfo[t.info].color,.3);bio.tooltip({element:this,contents:"<b>"+t.x+"</b></br>Type: <b>"+t.info+"</b></br>Count: <b>"+t.value+"</b>"}),d3.select(this).transition(10).style("fill",n).style("filter","url(#drop_shadow)")},mouseout:function(t,e,i){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.variantInfo[t.info].color).style("filter","none")}}}}[t]}function a(e){return{heatmap:{margin:[10,5,45.5,0],attr:{id:function(t,e,i){return"landscape_gene_"+t.y+"_heatmap_rect"},x:function(t,e,i){return i.scaleX(t.x)},y:function(e,i,n){return"cnv"!==t(e.value)?bio.scales().band(n.scaleY)/3+n.scaleY(e.y):n.scaleY(e.y)},width:function(t,e,i){return bio.scales().band(i.scaleX)},height:function(e,i,n){return"cnv"!==t(e.value)?bio.scales().band(n.scaleY)/3:bio.scales().band(n.scaleY)}},style:{fill:function(t,e,i){return bio.boilerPlate.variantInfo[t.value].color}},on:{mouseover:function(t,e,i){var n=bio.rendering().opacity(bio.boilerPlate.variantInfo[t.value].color,.3),a="";t.info.length>0&&bio.iteration.loop(t.info,function(t){a+="</br><b>"+t+"</b>"}),bio.tooltip({element:this,contents:"<b>Gene mutations</b></br>X: <b>"+t.x+"</b></br>Y: <b>"+t.y+"</b></br>Type: </br><b>"+t.value+"</b>"+a}),d3.select(this).transition(10).style("fill",n).style("filter","url(#drop_shadow)")},mouseout:function(t,e,i){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.variantInfo[t.value].color).style("filter","none")}}},group:{margin:[0,5,7,0],attr:{x:function(t,e,i){return i.scaleX(t.x)||i.margin.left},y:function(t,e,i){return i.scaleY(t.y)},width:function(t,e,i){return bio.scales().band(i.scaleX)},height:function(t,e,i){return bio.scales().band(i.scaleY)}},style:{fill:function(t,e,i){return bio.boilerPlate.clinicalInfo[t.value].color}},on:{mouseover:function(t,e,i){var n=bio.rendering().opacity(bio.boilerPlate.clinicalInfo[t.value].color,.3);bio.tooltip({element:this,contents:"<b>"+t.y+"</b></br>Sample: <b>"+t.x+"</b></br>Value: <b>"+t.value+"</b></br>"}),d3.select(this).transition(10).style("fill",n).style("filter","url(#drop_shadow)")},mouseout:function(t,e,i){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.clinicalInfo[t.value].color).style("filter","none")}}}}[e]}function o(){var e=".legend-shape-g-tag",i=".legend-text-g-tag";return{margin:[20,15,5,15],attr:{x:function(t,e,i){return"text"===this.tagName?i.margin.left:0},y:function(e,i,n){var a="text"===this.tagName?i*(n.fontHeight+n.padding):i*(n.fontHeight+n.padding)-n.fontHeight/2-1;return"rect"===this.tagName&&"var"===t(e)?a+n.fontHeight/4:a},width:function(t,e,i){return i.fontHeight/2},height:function(e,i,n){return"var"===t(e)?n.fontHeight/2:n.fontHeight}},style:{fill:function(t,e,i){return"text"===this.tagName?"#333333":bio.boilerPlate.variantInfo[t].color},fontSize:"8px"},on:{mouseover:function(t,n,a){var o=a.legendData.indexOf(t),r=bio.drawing().nthChild(e,o),l=bio.drawing().nthChild(i,o),s=bio.rendering().opacity(bio.boilerPlate.variantInfo[t].color,.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,n,a){var o=a.legendData.indexOf(t),r=bio.drawing().nthChild(e,o),l=bio.drawing().nthChild(i,o);d3.select(r).transition(10).style("fill",bio.boilerPlate.variantInfo[t].color),d3.select(l).style("font-weight","normal")}},text:function(t,e,i){return t}}}return function(){return{bar:n,axis:e,legend:o,byCase:t,title:i,heatmap:a}}}function pathwayConfig(){"use strict";var t={drug_color:{type1:{class:"agent-red",color:"red"},type2:{class:"agent-blue",color:"blue"},type3:{class:"agent-black",color:"black"}}};function e(){return{style:{fill:function(t,e,i){return"rect"===this.tagName?function(t){if(t){var e=bio.scales().get([0,50],[1,.5]),i=d3.hsl("Y"===t.active?"red":"blue");return i.l=e(t.frequency),i}return"#d0d0d0"}(t):t&&t.frequency>=30?"#F2F2F2":"#333333"}},on:{mouseover:function(t,e,i){var n,a,o="rect"===this.tagName?this:d3.select(this.parentNode).select("rect").node(),r=t?t.frequency:"NA",l=t?"Y"===t.active?"RED":"BLUE":"#E8E8E8",s=t?"Y"===t.active?"Activated":"Inactivated":"NA",c=(n=this,(a=d3.select(n).node().parentNode.id).substring(a.lastIndexOf("_")+1,a.length).toUpperCase());bio.tooltip({element:o,contents:"<b>"+c+"</b></br>frequency : "+r+'</br><span style="color : '+l+'"><b>'+s+"</b></span>"})},mouseout:function(t,e,i){bio.tooltip("hide")}}}}function i(){function e(t){var e="mouseout"===d3.event.type?0:1,i=e?.02:0,n=e?-5:0;d3.select(this).transition().attr("transform",function(){return"matrix("+(t.scaleX+i)+", 0, 0, "+(t.scaleY+i)+", "+(t.translateX+n)+", "+(t.translateY+n)+")"}).style("cursor","pointer").selectAll("path").style("stroke",e?"#FBFD24":"#FFFFFF").style("stroke-width",e?20:0)}return{on:{click:function(e,i,n){this.id.split("_")[1],document.querySelector(".modal-title");var a=document.querySelector(".modal-body");$("#drug_modal").modal({keyboard:!1,backdrop:"static"}),$("#drug_modal").on("shown.bs.modal",function(i){var n=$(this).find(".modal-body").css("height");console.log(n),bio.table({height:parseFloat(n)-70,element:a,heads:["Type","Drug","Level of approval","Treated Cancer","Reference"],data:e.drugs,columns:function(e,i,n,a,o){if(0===e)return s=a.drug_type,c=t.drug_color[s].color,u=document.querySelector("#legend_icon_"+c).cloneNode(!0),d=document.createElement("svg"),u.setAttribute("transform","matrix(0.04, 0, 0, 0.04, 10, 0)"),d.setAttribute("width",40),d.setAttribute("height",20),d.appendChild(u),d.outerHTML;if(1===e){var r=(l=a).nci_id?"http://www.cancer.gov/about-cancer/treatment/drugs/"+l.nci_id:!l.nci_id&&l.dailymed_id?"http://www.dailymed.nlm.nih.gov/dailymed/drugInfo.cfm?setid="+l.dailymed_id:null;return r?a.agent+'<a class="drug-link" href='+r+" target='drug'><i class=\"fa fa-external-link\"></i></a>":a.agent}return 2===e?a.drug_class:3===e?a.cancer:4===e?a.source:void 0;var l,s,c,u,d}})})},mouseover:e,mouseout:e}}}return function(){return{node:e,drug:i}}}function variantsConfig(){"use strict";function t(t){return 3*Math.sqrt(t)/1.25}function e(t,e,i){if("common"===t)return{};var n=parseFloat(i.attr("width")),a=parseFloat(i.attr("height"));return{needleX:{top:a-35,left:0,direction:"bottom",range:[40,n-40],margin:[10,40,35,40]},needleY:{top:0,left:40,direction:"left",range:[20,a-80],margin:[20,40,80,0]}}[t+e]}function i(t){var e=".legend-shape-g-tag",i=".legend-text-g-tag",n=".variants_patient_legend_svg"+e,a=".variants_patient_legend_svg"+i;return{needle:{margin:[15,10,5,15],attr:{cx:function(t,e,i){return i.margin.left},cy:function(t,e,i){return e*(i.fontHeight+5)},r:5,x:function(t,e,i){return"text"===this.tagName?2*i.margin.left:i.margin.left},y:function(t,e,i){return e*(i.fontHeight+5)+1}},style:{fill:function(t,e,i){return"text"===this.tagName?"#333333":bio.boilerPlate.variantInfo[t].color}},on:{mouseover:function(t,n,a){var o=a.legendData.indexOf(t),r=bio.drawing().nthChild(e,o),l=bio.drawing().nthChild(i,o),s=bio.rendering().opacity(bio.boilerPlate.variantInfo[t].color,.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,n,a){var o=a.legendData.indexOf(t),r=bio.drawing().nthChild(e,o),l=bio.drawing().nthChild(i,o);d3.select(r).transition(10).style("fill",bio.boilerPlate.variantInfo[t].color),d3.select(l).style("font-weight","normal")}},text:function(t,e,i){return t}},patient:{margin:[15,10,5,15],attr:{x:function(t,e,i){return"text"===this.tagName?2*i.margin.left:i.margin.left},y:0,points:function(t,e,i){return bio.rendering().triangleStr(i.margin.left,-5,8,"top")}},style:{fill:function(t,e,i){return"text"===this.tagName?"#333":"#FFFFFF"},stroke:function(t,e,i){return"text"===this.tagName?"none":"#333333"},strokeWidth:"1px"},on:{mouseover:function(t,e,i){var o=i.legendData.indexOf(t),r=bio.drawing().nthChild(n,o),l=bio.drawing().nthChild(a,o),s=bio.rendering().opacity("#333333",.3);d3.select(r).transition(10).style("stroke",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,e,i){var o=i.legendData.indexOf(t),r=bio.drawing().nthChild(n,o),l=bio.drawing().nthChild(a,o);d3.select(r).transition(10).style("stroke","#333333"),d3.select(l).style("font-weight","normal")}},text:function(t,e,i){return t}}}[t]}function n(){return{margin:[20,40,80,40],attr:{cx:function(t,e,i){var n=i.scaleX(t.x);return n>i.width-i.margin.right||n<i.margin.left?n*i.width:n},cy:function(t,e,i){return i.scaleY(t.y)},r:function(e,i,n){return t(e.value)},x:function(t,e,i){var n=i.scaleX(t.x);return n>i.width-i.margin.right||n<i.margin.left?n*i.width:n},y:function(t,e,i){return i.scaleY(t.y)}},style:{fill:function(t,e,i){return"path"===this.tagName?"#A8A8A8":i.id.indexOf("needle")>-1?bio.boilerPlate.variantInfo[t.info[0].type].color:bio.rendering().opacity(bio.boilerPlate.variantInfo[t.info[0].type].color,.3)},stroke:function(t,e,i){return"path"===this.tagName?"#A8A8A8":"none"}},on:{mouseover:function(t,e,i){var n=bio.rendering().opacity(bio.boilerPlate.variantInfo[t.info[0].type].color,.5);bio.tooltip({element:this,contents:"Type: <b>"+t.info[0].type+"</b></br>AAChange: <b>"+t.info[0].aachange+"</b></br>Counts: <b>"+t.y+"</b></br>Position: <b>"+t.x+"</b>"}),d3.select(this).transition(10).style("fill",n)},mouseout:function(t,e,i){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.variantInfo[t.info[0].type].color)}}}}function a(){return{margin:[0,40,5,40],end:{init:0,now:0},start:{init:0,now:0},navi:{init:0,now:0,width:0,nowWidth:0},attr:{x:function(t,e,i){return"main"===t?i.start:"end"===t?i.end+i.margin.left-i.controls.width:i.start-i.controls.width},y:function(t,e,i){return"main"===t?0:.25*i.height},width:function(t,e,i){return"main"===t?i.end:2*i.controls.width},height:function(t,e,i){return"main"===t?i.height-i.margin.bottom:i.controls.height},rx:function(t,e,i){return"main"===t?3:5},ry:function(t,e,i){return"main"===t?3:5}},style:{fill:function(t,e,i){return"main"===t?"rgba(255, 255, 50, 0.1)":"#A8A8A8"},stroke:function(t,e,i){return"main"===t?"#FFDF6D":"#EAECED"},strokeWidth:function(t,e,i){return"main"===t?"1px":"2px"},cursor:function(t,e,i){return"main"===t?"move":"ew-resize"}},call:{drag:function(t,e,i){var n=d3.select("#variants_navi_svg_navi_main_rect"),a=d3.select("#variants_navi_svg_navi_start_rect"),o=d3.select("#variants_navi_svg_navi_end_rect"),r=i.opts.drag;function l(t){return r[t].now+=d3.event.dx,r[t].now=Math.max(r.start["end"===t?"now":"init"],Math.min(r.end["end"===t?"init":"now"],r["end"===t?"end":"start"].now)),r[t].now}if("start"===t)d3.select(this).attr("x",l(t)),r.navi.now=r.navi.init+(r.start.now-r.start.init),r.navi.nowWidth=r.navi.width-(r.end.init-r.end.now)-(r.start.now-r.start.init),n.attr("x",r.navi.now).attr("width",r.navi.nowWidth);else if("end"===t)d3.select(this).attr("x",l(t)),r.navi.nowWidth=r.navi.width-(r.start.now-r.start.init)-(r.end.init-r.end.now),n.attr("width",r.navi.nowWidth);else{r.navi.now+=d3.event.dx;var s=r.navi.now=Math.max(r.navi.init,Math.min(r.navi.width+i.margin.left-r.navi.nowWidth,r.navi.now));r.start.now=s-i.controls.width,r.end.now=s+r.navi.nowWidth-i.controls.width,n.attr("x",s),a.attr("x",r.start.now),o.attr("x",r.end.now)}}}}}function o(){return{margin:[20,40,80,40],attr:{x:function(t,e,i){var n=i.scaleX(t.x);return this.id.indexOf("base")>-1?i.margin.left:this.id.indexOf("text")>-1?n+5:n<i.margin.left?i.margin.left:n>i.width-i.margin.right?i.width-i.margin.right:n},y:function(t,e,i){var n=.4*(i.height-10-(i.height-i.margin.bottom));return"text"!==this.tagName?i.height-i.margin.bottom:i.height-i.margin.bottom+n/2},width:function(t,e,i){var n=i.scaleX(t.x),a=i.scaleX(t.x+t.width);if(n<i.margin.left){if((a-=i.margin.left-n)<0)return 0}else if(n+(a-n)>i.width-i.margin.right&&(a-=n+a-n-(i.width-i.margin.right))-n<0)return 0;return this.id.indexOf("base")>-1?i.width-i.margin.left-i.margin.right:a-n},height:function(t,e,i){return.4*(i.height-10-(i.height-i.margin.bottom))},rx:function(t,e,i){return this.id.indexOf("base")>-1?1:3},ry:function(t,e,i){return this.id.indexOf("base")>-1?1:3}},style:{fill:function(t,e,i){return this.id.indexOf("base")>-1?"#DADFE1":this.id.indexOf("text")>-1?"#FFFFFF":t.color}},on:{mouseover:function(t,e,i){var n=this.id.indexOf("base")>-1?null:"text"===this.tagName?this.previousSibling?this.previousSibling:this.nextSibling:this,a=bio.rendering().opacity(t.color,.5);n&&(bio.tooltip({element:n,contents:"<b>"+t.info.identifier+"</b></br>Desc: <b>"+t.info.description+"</b></br>Section: <b>"+t.x+" - "+(t.x+t.width)+"</b>"}),d3.select(n).transition(10).style("fill",a))},mouseout:function(t,e,i){var n=this.id.indexOf("base")>-1?null:"text"===this.tagName?this.previousSibling?this.previousSibling:this.nextSibling:this;n&&(bio.tooltip("hide"),d3.select(n).transition(10).style("fill",t.color))}},text:function(t,e,i){var n=i.scaleX(t.x),a=i.scaleX(t.x+t.width);return bio.drawing().textOverflow(t.info.identifier,"10px",a-n,5)}}}function r(){return{margin:[20,40,25,40],attr:{points:function(t,e,i){var n=i.scaleX(t.x);return(n<i.margin.left||n>i.width-i.margin.right)&&(n=i.width+i.margin.right),bio.rendering().triangleStr(n,i.scaleY(0)-i.margin.bottom,10,"top")}},style:{fill:function(t,e,i){return"path"===this.tagName?"#A8A8A8":bio.boilerPlate.variantInfo[t.info[0].type].color},stroke:function(t,e,i){return"path"===this.tagName?"#A8A8A8":"none"}}}}return function(){return{axis:e,navi:a,graph:o,legend:i,needle:n,radius:t,patient:r}}}function exclusivity(){"use strict";var t={};function e(e){t.data.sample={data:[],isAltered:!1};var i,n,a,o,r,l=bio.exclusivityConfig(),s=bio.landscapeConfig();bio.iteration.loop(e,function(e){t.now.geneset.indexOf(e.gene)>-1&&t.data.sample.data.push({gene:e.gene,value:l.symbol(l.byCase(s.byCase(e.class),e.class))})}),t.data.sample.isAltered=(i=t.data.sample.data,n=t.data.survival.heat[t.now.geneset],a="SMCLUAD1690060028",o=t.now.geneset.split(" "),r=".",i.length<1?[{text:"**",color:"#00AC52"},{text:a+" Belongs to",color:"#333333"},{text:"Unaltered group",color:"#00AC52"}]:(bio.iteration.loop(i,function(t){var e=n[o.indexOf(t.gene)];e.indexOf(t.value)>-1&&(r="."!==r?r:e[e.indexOf(t.value)])}),"."===r?[{text:"**",color:"#00AC52"},{text:a+" Belongs to",color:"#333333"},{text:"Unaltered group",color:"#00AC52"}]:[{text:"**",color:"#FF6252"},{text:a+" Belongs to",color:"#333333"},{text:"Altered group",color:"#FF6252"}]))}function i(e){var i={},n=setInterval(function(){var e,a;i.os_tb=document.querySelectorAll("#os_stat_table td b"),i.dfs_tb=document.querySelectorAll("#dfs_stat_table td b"),i.legend=d3.selectAll(".legend"),i.os_tb.length>0&&i.dfs_tb.length>0&&i.legend.node()&&(!function(e,i){for(var n=0,a=e.length;n<a;n++){var o=e[n],r=i[n];bio.iteration.loop(t.data.sample.isAltered,function(t){t.text===o.innerHTML&&(o.innerHTML+=" **",r.innerHTML+=" **")})}}(i.os_tb,i.dfs_tb),e=i.legend,a=bio.exclusivityConfig().survival(),bio.text({element:e,text:a.text,attr:{x:function(e,i){return a.attr.x(e,i,t)},y:function(e,i){return a.attr.y(e,i,t)}},style:{fill:function(e,i){return a.style.fill(e,i,t)},fontSize:"14px"},text:function(e,i){return a.text(e,i,t)}}),clearInterval(n))},10)}function n(e){var n,a;n=e,bio.layout().get(t.setting.svgs,["sample_legend"],function(e,i){var a=bio.rendering().addGroup(i,0,0,"sample-legend"),o=bio.exclusivityConfig().sample("legend",n.mostGeneWidth.value);bio.text({text:o.text,attr:o.attr,style:o.style,id:e+"_sample_legend",data:n.sample.isAltered,element:a.selectAll("#"+e+"_sample_legend")},t)}),a=e,bio.layout().get(t.setting.svgs,["heatmap"],function(e,i){var n=bio.rendering().addGroup(i,0,0,"sample-division"),o=bio.exclusivityConfig().sample("division",a.mostGeneWidth.value,i);bio.text({text:o.text,attr:o.attr,style:o.style,id:e+"_sample_division",data:a.sample.isAltered,element:n.selectAll("#"+e+"_sample_division")},t)}),i()}function a(e){var i,n,a,o=document.querySelector("#exclusivity_survival"),r=parseFloat(o.style.width),l=parseFloat(o.style.height);bio.survival({element:"#exclusivity_survival",margin:[20,20,20,20],data:e.survival.data[t.now.geneset],division:(i=t.now.geneset,n=e,a={},bio.iteration.loop(n.survival.data[i],function(t,e){t&&(a[t.participant_id]=e<=n.divisionIdx[i].idx?"altered":"unaltered")}),a),legends:{high:{text:"Unaltered group",color:"#FF6252"},low:{text:"Altered group",color:"#00AC52"}},styles:{size:{chartWidth:.9*r,chartHeight:.59*l},position:{chartTop:15,chartLeft:50,axisXtitlePosX:r/2,axisXtitlePosY:l/1.725,axisYtitlePosX:-r/2,axisYtitlePosY:10,pvalX:r/1.95,pvalY:40}}})}function o(i){var o,r,l,s,c;e(t.setting.defaultData.sample),o=i,bio.layout().get(t.setting.svgs,["ty_legend"],function(e,i){var n=bio.exclusivityConfig(),a=n.legend(o.mostGeneWidth.value);bio.legend({element:i,on:a.on,attr:a.attr,text:a.text,style:a.style,margin:a.margin,data:o.type[t.now.geneset].sort(function(t,e){return n.priority(t)>n.priority(e)?1:-1})}),document.querySelector("#exclusivity_legend").style.height=i.attr("height")+"px"}),r=i,bio.layout().get(t.setting.svgs,["network"],function(e,i){bio.exclusivityConfig().network(),bio.network({element:i,data:r.network[t.now.geneset.replaceAll(" ","")]})}),l=i,s=i.axis.heatmap,bio.layout().get(t.setting.svgs,["heatmap"],function(e,i){var n=l.mostGeneWidth.value,a=bio.exclusivityConfig().heatmap("shape",i,n),o=bio.exclusivityConfig().heatmap("axis",i,n);i.attr("height"),bio.heat({element:i,attr:a.attr,style:a.style,margin:a.margin,xaxis:s.x[t.now.geneset],yaxis:s.y[t.now.geneset],data:l.heatmap[t.now.geneset]}),bio.axises().left({top:0,left:n,element:i,direction:"left",range:o.range,exclude:"path, line",margin:o.margin,domain:s.y[t.now.geneset]})}),a(i),c=i,bio.layout().get(t.setting.svgs,["heatmap"],function(e,i){var n=bio.exclusivityConfig().division(c.mostGeneWidth.value);bio.divisionLine({element:i,isMarker:!1,pathElement:[i],info:[{text:"Altered group",color:"#FF6252"},{text:"Unaltered group",color:"#00AC52"}],text:n.text,attr:n.attr,style:n.style,margin:n.margin,axis:c.axis.heatmap.x[t.now.geneset],idxes:c.divisionIdx[t.now.geneset].idx+1},t)}),n(i)}return function(e){(t=bio.initialize("exclusivity")).setting=bio.setting("exclusivity",e),t.data=t.setting.preprocessData,bio.title("#exclusivity_title","Mutual Exclusivity"),t.now.geneset=t.data.geneset[0].join(" "),bio.selectBox({viewName:"geneset",margin:[0,0,0,0],fontSize:"14px",defaultText:t.now.geneset,className:"exclusivity-geneset",id:"#exclusivity_select_geneset",items:t.data.geneset.map(function(t){return t.join(" ")}),clickItem:function(e){t.now.geneset=e.toUpperCase(),bio.layout().removeGroupTag(),o(t.data)}}),o(t.data),console.log(">>> Exclusivity reponse data: ",e),console.log(">>> Exclusivity setting data: ",t.setting),console.log(">>> Exclusivity model data: ",t)}}function colorGradient(){"use strict";var t={};function e(e,i){t.offsets.show.push({offset:e,color:i}),t.offsets.data.push({offset:e,color:i})}return function(i,n){var a,o,r;return t=bio.objects.clone(n||{}),(t=bio.sizing.chart.default(t,i)).offsets=bio.initialize("colorGradient"),t.adjustValue=i.adjustValue||0,t.id=i.id||"linear_gradient",t.colors=i.colors||["#000000","#FFFFFF"],t.offset=i.offset||[0,100],t.defs=t.element.append("defs"),t.lineGradient=t.defs.append("linearGradient").attr("id",t.id),a=t.offset,o=t.colors,r=[].concat(a).splice(1,a.length-2),e("0%",o[0]),bio.iteration.loop(r,function(e,i){var n=Math.round((bio.math.max(a)-bio.math.min(a))/e*10);t.offsets.show.push({offset:n-t.adjustValue+"%",color:o[i+1]}),t.offsets.data.push({offset:n+"%",color:o[i+1]})}),e("100%",o[a.length-1]),t.lineGradient.selectAll("stop").data(t.offsets.show).enter().append("stop").attr("offset",function(t,e){return t.offset}).attr("stop-color",function(t,e){return t.color}),t}}function expression(){"use strict";var t={};function e(e){t.now.function=e.toLowerCase(),t.data.bar=t.data.func.bar[e.toLowerCase()],t.data.axis.bar.x=t.data.func.xaxis[e.toLowerCase()],t.data.axis.bar.y=t.data.func.yaxis[e.toLowerCase()],t.data.axis.scatter.x=t.data.func.xaxis[e.toLowerCase()],t.data.axis.heatmap.x=t.data.func.xaxis[e.toLowerCase()]}function i(e,i,n){if(!t.now.subtypeSet)return"#62C2E0";if(e.info){var a=Object.keys(e.info),o="NA";return bio.iteration.loop(a,function(i){i.toLowerCase()===t.now.subtype_mapping.toLowerCase()&&(o=e.info[i])}),"NA"===o?"#D6E2E3":bio.boilerPlate.clinicalInfo[o].color}}function n(e){var n=document.querySelector("#expression_bar_legend");bio.layout().removeGroupTag(["expression_bar_legend_svg"]),n.className.indexOf("active")<0&&(n.className+="active"),d3.selectAll("#expression_bar_plot_rect").style("fill",i).style("stroke",i),o("color_mapping",e||t.now.subtypeSet),n.style.marginBottom=parseFloat(t.init.bar_legend_height)-parseFloat(n.style.height)-5+"px"}function a(e,i){bio.selectBox({fontSize:"12px",margin:[3,3,0,0],viewName:"subtype_mapping",defaultText:i||"Subtype Mapping",id:"#expression_color_mapping",className:"expression-color-mapping",items:e.map(function(t){return t.key}),clickItem:function(i){bio.iteration.loop(e,function(e){e.key.toLowerCase()===i.toLowerCase()&&(t.now.subtype_mapping=e.key,t.now.subtypeSet=e.value)}),n(t.now.subtypeSet),t.subtypeFunc&&t.subtypeFunc(t.now.subtype_mapping,bio.boilerPlate.clinicalInfo,t)}})}function o(e,i){var n="scatter"===e?"scatter_leg":"bar_leg";bio.layout().get(t.setting.svgs,[n],function(t,n){var a=bio.expressionConfig().legend(e);i&&(i.indexOf("NA")>-1&&i.push(i.splice(i.indexOf("NA"),1)[0]),bio.legend({data:i,element:n,on:a.on,attr:a.attr,text:a.text,style:a.style,margin:a.margin}))})}function r(e,i,n){bio.layout().get(t.setting.svgs,["heatmap"],function(t,a){var o=bio.scales().get(n,["#00FF00","#000000","#FF0000"]),r=bio.expressionConfig(),l=r.heatmap("shape",e.axisMargin),s=r.heatmap("axis",e.axisMargin);a.attr("height",10*i.y.length),bio.heat({element:a,xaxis:i.x,yaxis:i.y,on:l.on,data:e.heatmap,attr:l.attr,margin:l.margin,style:{fill:function(t,e,i){return o(t.value)}}}),bio.axises().left({element:a,domain:i.y,top:s.top,left:s.left,margin:s.margin,exclude:s.exclude,range:[0,10*i.y.length]})})}function l(e,i){bio.layout().get(t.setting.svgs,["bar_plot"],function(t,n){var a=bio.expressionConfig(),o=a.bar("shape",e.axisMargin),r=a.bar("axis",e.axisMargin);bio.bar({element:n,xaxis:i.x,data:e.bar,on:o.on,attr:o.attr,style:o.style,margin:o.margin,yaxis:[i.y[2],i.y[0]]}),bio.axises().left({element:n,top:r.top,left:r.left,tickValues:i.y,margin:r.margin,domain:[i.y[2],i.y[0]],range:[20,n.attr("height")-15]}).selectAll("path, line").style("stroke","#999999")})}function s(e,i){t.now.osdfs!==e&&(bio.layout().removeGroupTag([".expression_scatter_plot_svg.scatter-g-tag",".expression_scatter_plot_svg.left-axis-g-tag"]),t.now.osdfs=e,u(i,i.axis.scatter,t.now.osdfs),(t.divide.low_arr||t.divide.high_arr)&&g(d3.selectAll("#expression_scatter_plot_svg_scatter_shape_circle"),t.divide.low_arr,t.divide.high_arr))}function c(e){var i,n,a=document.querySelector("#expression_survival"),o=parseFloat(a.style.width),r=parseFloat(a.style.height)/1.4,l=(function(e,i){t.data.survival.divide={};var n=[].concat(e);n.sort(function(t,e){return t.value>e.value?1:-1});var a=n.length%2==1?(n.length+1)/2:n.length/2;bio.iteration.loop(n,function(e,i){t.data.survival.divide[e.x]=i<=a?"unaltered":"altered"})}(e.bar,e.axis.bar.y[1]),bio.survival({element:"#expression_survival",margin:[20,20,20,20],data:t.divide.patient_list||t.setting.defaultData.patient_list,division:t.divide.divide||e.survival.divide,pvalueURL:void 0,legends:{high:{text:"High score group",color:"#FF6252"},low:{text:"Low score group",color:"#00AC52"}},styles:{size:{chartWidth:.9*o,chartHeight:.9*r},position:{chartTop:15,chartLeft:50,axisXtitlePosX:o/2,axisXtitlePosY:r/1.125,axisYtitlePosX:-o/2,axisYtitlePosY:10,pvalX:o/1.95,pvalY:40},pvalFontSize:10}}));t.data.survival.data=l.survival_data,t.data.scatter=Object.keys(t.data.scatter).length<1?t.data.survival.data.all:t.data.scatter,i=e,(n=document.querySelector("#expression_survival").querySelectorAll("input"))[0].onclick=function(t){s("os",i)},n[1].onclick=function(t){s("dfs",i)}}function u(e,i,n){bio.layout().get(t.setting.svgs,["scatter_p"],function(t,a){var o,r,l,s=bio.expressionConfig(),c=s.scatter("shape",e.axisMargin),u=s.scatter("axis",e.axisMargin),d=[].concat(i.y[n]).reverse();bio.scatter({element:a,yaxis:d,xaxis:i.x,on:c.on,attr:c.attr,style:c.style,margin:c.margin,data:(o=e.scatter[n],r=i.x,l=[],bio.iteration.loop(o,function(t){bio.iteration.loop(t,function(t,e){r.indexOf(t)>-1&&l.push({x:t,y:e.months,value:e.status})})}),l)}),bio.axises().left({ticks:15,element:a,domain:d,top:u.top,left:u.left,margin:u.margin,range:[10,a.attr("height")-30]}).selectAll("path, line").style("stroke","#999999")})}function d(){var e={},i=setInterval(function(){var n,a;e.os_tb=document.querySelectorAll("#os_stat_table td b"),e.dfs_tb=document.querySelectorAll("#dfs_stat_table td b"),e.legend=d3.selectAll(".legend"),e.os_tb.length>0&&e.dfs_tb.length>0&&e.legend.node()&&(!function(e,i){for(var n=0,a=e.length;n<a;n++){var o=e[n],r=i[n];t.data.patient.data===o.innerHTML&&(o.innerHTML+=" **",r.innerHTML+=" **")}}(e.os_tb,e.dfs_tb),n=e.legend,a=bio.expressionConfig().survival("legend"),bio.text({element:n,attr:{x:function(e,i){return a.attr.x(e,i,t)},y:function(e,i){return a.attr.y(e,i,t)}},style:{fill:function(e,i){return a.style.fill(e,i,t)}},text:function(e,i){return a.text(e,i,t)}}),clearInterval(i))},10)}function p(e){bio.layout().get(t.setting.svgs,["bar_p","scatter_p"],function(t,i){var n={},a=t.indexOf("bar")>-1?"bar":"scatter",o=bio.expressionConfig().patient(e.axisMargin);n.group=bio.rendering().addGroup(i,0,0,a+"-patient"),n.id=t+"_"+a+"_patient",n.margin=bio.sizing.setMargin(o.margin),n.width=parseFloat(i.attr("width")),n.height=parseFloat(i.attr("height")),n.scaleX=bio.scales().get(e.axis.heatmap.x,[n.margin.left,n.width-n.margin.right]),n.scaleY=bio.scales().get([e.axis.bar.y[2],e.axis.bar.y[0]],[n.margin.top,n.height-n.margin.bottom]),bio.triangle({element:n.group.selectAll("#"+n.id+"_"+a+"_patient"),data:e.bar.filter(function(t){if(t.x===e.patient.name)return t}),attr:{id:function(t,e,i){return n.id+"_"+a+"_patient"},points:o.attr.points},style:o.style,on:o.on},n)}),d()}function g(t,e,i){t.style("fill-opacity",function(n,a,o){return e.indexOf(n.x)<0&&i.indexOf(n.x)<0?.08:t.attr("id").indexOf("shape")>-1?.6:1}).style("stroke-opacity",function(t,n,a){return e.indexOf(t.x)<0&&i.indexOf(t.x)<0?.08:1})}function f(){var e,i,n,a,o=Object.keys(t.divide).length>0?t.divide:t.data.survival.divide,r=(i=[],n=[],a=[],(e=o).low_arr&&e.high_arr?(bio.iteration.loop(t.data.axis.bar.x,function(t){e.low_arr.indexOf(t)<0&&e.high_arr.indexOf(t)<0&&n.push(t)}),i=e.low_arr,a=e.high_arr):bio.iteration.loop(e,function(t,n){"altered"===e[t]?a.push(t):i.push(t)}),{low:i,mid:n,high:a});t.divisionFunc&&t.divisionFunc(r.low,r.mid,r.high,t.data.axis.heatmap.y,t.data.all_rna_list)}function h(e,i){function n(e,i){bio.iteration.loop(e,function(e){t.data.patient?e!==t.data.patient.name&&(bio.iteration.loop(t.setting.defaultData.patient_list,function(i){i.participant_id===e&&t.divide.patient_list.push(i)}),t.divide.divide[e]=i):(bio.iteration.loop(t.setting.defaultData.patient_list,function(i){i.participant_id===e&&t.divide.patient_list.push(i)}),t.divide.divide[e]=i)})}var a=bio.expressionConfig().division;bio.layout().get(t.setting.svgs,["division"],function(i,o){var r=a("division",e.axisMargin);bio.divisionLine({element:o,pathElement:[d3.select("#expression_bar_plot_svg"),d3.select("#expression_scatter_plot_svg")],info:[{additional:-10,color:"#00AC52",direction:"right",text:"Low score group"},{additional:10,color:"#FF6252",direction:"left",text:"High score group"}],data:e.bar,text:r.text,attr:r.attr,call:{drag:r.call.drag,end:function(i,a,o){var r,l,s=[].concat(o.axis);t.divide.low_sample=o.invert(o.position.now.low),t.divide.high_sample=o.invert(o.position.now.high),t.divide.high_arr=s.splice(o.axis.indexOf(t.divide.high_sample),s.length-1),t.divide.low_arr=s.splice(0,o.axis.indexOf(t.divide.low_sample)),r=t.divide.low_arr,l=t.divide.high_arr,t.divide.divide={},t.divide.patient_list=[],t.divide.scatter={os:[],dfs:[]},n(r,"unaltered"),n(l,"altered"),c(e),e.patient&&p(e),g(d3.selectAll("#expression_bar_plot_rect"),r,l),g(d3.selectAll("#expression_scatter_plot_svg_scatter_shape_circle"),r,l),f()}},style:r.style,margin:r.margin,axis:e.axis.bar.x,idxes:e.axis.bar.y},t)})}function v(i,s){var d,g,v,m;d=["Average"],g="Average",bio.iteration.loop(t.riskFunctions,function(t){d.push(t.name),t.isDefault&&(g=t.name)}),e(g),bio.selectBox({fontSize:"12px",items:d,viewName:"function",margin:[3,3,0,0],defaultText:g,id:"#expression_function",className:"expression-function",clickItem:function(i){e(i),bio.layout().removeGroupTag([".expression_bar_plot_svg.bar-g-tag",".expression_bar_plot_svg.left-axis-g-tag",".expression_bar_plot_svg.division-path-0-g-tag",".expression_bar_plot_svg.division-shape-0-g-tag",".expression_scatter_plot_svg.scatter-g-tag",".expression_scatter_plot_svg.left-axis-g-tag",".expression_scatter_plot_svg.division-path-1-g-tag",".expression_scatter_plot_svg.division-shape-1-g-tag",".expression_heatmap_svg.heatmap-g-tag",".expression_heatmap_svg.left-axis-g-tag",".expression_division_svg.division-shape-g-tag",".expression_division_svg.division-text-g-tag"]),t.divide.divide=void 0,t.divide.patient_list=void 0,t.divide.scatter=void 0,t.divide={},r(t.data,t.data.axis.heatmap,t.data.axis.gradient.x),l(t.data,t.data.axis.bar),a(t.data.subtype,t.now.subtype_mapping),t.now.subtype_mapping&&n(t.now.subtypeSet),u(t.data,t.data.axis.scatter,t.now.osdfs),c(t.data),h(t.data),f()}}),a(i.subtype),s.signature_list&&(v=s.signature_list,bio.selectBox({fontSize:"14px",margin:[3,3,0,0],viewName:"signature",id:"#expression_signature",className:"expression-signature",defaultText:t.now.signature,items:v.map(function(t){return t.signature}),clickItem:function(e){t.now.signature&&t.now.signature!==e&&(t.now.signature=e,t.requestData.signature=t.now.signature,$.ajax({type:"get",url:t.requestURL,data:t.requestData,beforeSend:function(){bio.loading().start(t.setting.targetedElement,t.setting.targetedElementSize.width,t.setting.targetedElementSize.height)},success:function(e){bio.dom().remove(t.setting.targetedElement,[document.querySelector("#expression_title"),document.querySelector("#expression_contents")]),bio.layout().removeGroupTag(),bio.expression({element:t.setting.targetedElement.id,width:t.setting.targetedElementSize.width,height:t.setting.targetedElementSize.height,requestData:{source:t.requestData.source,cancer_type:t.requestData.cancer_type,sample_id:t.requestData.sample_id,signature:t.now.signature,filter:t.requestData.filter},data:e.data}),bio.loading().end()}}))}})),o("color_mapping",t.now.subtypeSet||null),o("scatter",["Alive","Dead"]),m=i.axis.gradient.x,bio.layout().get(t.setting.svgs,["gradient"],function(e,i){var n=bio.expressionConfig().gradient("shape"),a=bio.expressionConfig().gradient("axis",i);t.data.colorGradient=bio.colorGradient({element:i,offset:m,adjustValue:6,colors:["#00FF00","#000000","#FF0000"]}),bio.rectangle({element:bio.rendering().addGroup(i,0,0,"gradient-shape"),attr:n.attr,style:n.style},t),bio.axises().bottom({element:i,top:a.top,left:a.left,range:a.range,margin:a.margin,exclude:a.exclude,tickValues:m,domain:[m[0],m[2]]}).selectAll("text").style("fill","#999999")}),r(i,i.axis.heatmap,i.axis.gradient.x),l(i,i.axis.bar),c(i),u(i,i.axis.scatter,t.now.osdfs),i.patient&&p(i),h(i),f()}return function(e){t={},(t=bio.initialize("expression")).riskFunctions=e.riskFunctions?e.riskFunctions:[],e.data.riskFunctions=t.riskFunctions,t.setting=bio.setting("expression",e),t.data=t.setting.preprocessData,bio.clinicalGenerator(t.data.subtype,"expression"),t.divisionFunc=e.divisionFunc?e.divisionFunc:null,t.subtypeFunc=e.onSubtypeSelection?e.onSubtypeSelection:null,t.requestData=e.requestData||{},t.requestURL=e.requestURL||"/rest/expressions",t.init.signature=e.data.signature_list?e.data.signature_list[0].signature:[],t.now.signature=t.requestData.signature,t.init.bar_legend_height=document.querySelector("#expression_bar_legend").style.height,bio.title("#expression_title","Expressions"),v(t.data,t.setting.defaultData)}}function landscape(){"use strict";var t={};function e(e){var i=t.data.iterMut([{obj:{},data:"participant_id",type:"type",keyName:"sample"}],e),n=t.data.byStack([],"sample",i.result.sample),a=t.data.makeLinearAxis("sample",n.axis);t.data.axis.sample.y=a,t.data.stack.sample=n.data}function i(t){var e=document.createElement("label"),i=document.createElement("input");return i.id="option_"+t,i.setAttribute("type","radio"),i.setAttribute("name","options"),i.setAttribute("value",t),i.setAttribute("autocomplete","off"),i.checked="1"===t,e.className="btn btn-default btn-sm"+("1"===t?" active":""),e.innerText="TYPE "+t,e.appendChild(i),e}function n(e){var i="x"===e.axis?"group":"pq",n="x"===e.axis?"sample":"gene";t.data.axis[i][e.axis]=e.data,t.data.axis[n][e.axis]=e.data,t.data.axis.heatmap[e.axis]=e.data}function a(e,i){if(!e)return!1;t=e.model,bio.layout().removeGroupTag("survival"),n(e.sorted),b(t.data,t.now.width),Object.keys(t.now.geneline.removedMutationObj).length>0&&(p(),d(i))}function o(e){t.now.geneline.isDraggable=!0;var i=this.parentNode,n=d3.select(i).attr("transform").replace(/translate\(|\)/gi,"").split(","),a=t.data.gene.indexOf(e),o=Math.max(t.init.geneline.firstYAxis,Math.min(parseFloat(n[1])+d3.event.y,t.init.geneline.lastYAxis));if(t.data.clinicalList.indexOf(e)>-1)return!1;try{if("disable"===t.now.geneline.axis[e].isGene)return!1}catch(t){console.log("")}d3.select(i).attr("transform","translate(0, "+o+")");var r=t.data.gene[a-1],l=t.data.gene[a+1],s=t.data.gene[a],c=this.parentNode,u=t.now.geneline.axis[e].value,d=d3.event.sourceEvent.movementY>-1?1:-1;function p(i,n,a,o,r,l){if("disable"===t.now.geneline.axis[a].isGene)return!1;t.now.geneline.axis[e].idx+=n,t.now.geneline.axis[e].value=t.now.geneline.axis[a].value,t.now.geneline.axis[a].idx-=n,t.now.geneline.axis[a].value=r,d3.select(t.now.geneline.sortedSiblings[t.data.gene.indexOf(a)]).attr("transform","translate(0, "+t.now.geneline.axis[e].value+")").transition().attr("transform","translate(0, "+t.now.geneline.axis[a].value+")"),t.data.gene[o]=t.data.gene[o+n],t.data.gene[o+n]=l,t.now.geneline.sortedSiblings[o]=t.now.geneline.sortedSiblings[o+n],t.now.geneline.sortedSiblings[o+n]=c}r=r||s,l=l||s,o>t.now.geneline.axis[l].value-t.init.geneline.axisHalfHeight&&u!==t.now.geneline.axis[l].value?p(0,d,l,a,u,s):o<t.now.geneline.axis[r].value+t.init.geneline.axisHalfHeight&&u!==t.now.geneline.axis[r].value&&p(0,d,r,a,u,s)}function r(e){if(t.now.geneline.isDraggable){var i=t.now.exclusivity_opt?t.now.exclusivity_opt:t.init.exclusivity_opt;if(bio.layout().removeGroupTag([".landscape_heatmap_svg.heatmap-g-tag",".landscape_gene_svg.bar-g-tag",".landscape_gene_svg.right-axis-g-tag"]),t.exclusive.now=bio.landscapeSort().exclusive(t.data.heatmap,t.data.gene,i),t.now.geneline.groupList){var a=[];t.now.geneline.pidList=g(),bio.iteration.loop(t.now.geneline.pidList.arr,function(t){a=a.concat(t.data)}),n({axis:"x",data:a})}else n(t.now.geneline.groupList||t.exclusive.now);t.data.axis.gene.y=t.data.gene,t.data.axis.heatmap.y=t.data.gene,t.data.axis.pq.y=t.data.gene,h("gene","Y"),m("pq",t.data.pq,t.data.axis.pq,["top","left"]),m("gene",t.data.stack.gene,t.data.axis.gene,["top","left"]),x("heatmap",t.data.heatmap,t.data.axis.heatmap),y(),Object.keys(t.now.geneline.removedMutationObj).length>0&&(p(),d(t.now.geneline.groupList?t.now.geneline.pidList.data:void 0))}}function l(e){t.now.geneline.isDraggable=!1}function s(){t.now.divisionPathData&&bio.iteration.loop(t.now.divisionPathData.data,function(t){bio.path({element:d3.select(".landscape_heatmap_svg.heatmap-g-tag"),data:t,attr:{id:function(t,e,i){return"landscape_gene_division_path"},x:function(t,e,i){return t.x},y:function(t,e,i){return t.y-40}},style:{stroke:"#333333",strokeWidth:"0.5px",strokeDash:"3"}})})}function c(e){var i,n=0,a=0,o=0;return bio.iteration.loop(e,function(e){var i=t.data.axis.heatmap.x.indexOf(e.participant_id);a=a>i?a:i}),i=t.data.axis.heatmap.x[a],d3.selectAll("#landscape_heatmap_svg rect").datum(function(t){if(t.x===i){var e=d3.select(this);n=parseFloat(e.attr("x")),o=parseFloat(e.attr("width"))}return t}),{maximum:a,divPosx:n+o,element:i}}function u(e){return t.now.mutation_list?c(e||t.now.mutation_list):void 0}function d(e){var i=[],n=!1,a=d3.select("#landscape_heatmap_svg");if(e)bio.iteration.loop(e,function(t){i.push(u(t))});else{if(!u())return!1;i.push(u())}if(bio.iteration.loop(i,function(t){t&&(n=!0)}),n)if(t.now.divisionPathData={data:[]},bio.iteration.loop(i,function(e){t.now.divisionPathData.data.push([{x:e.divPosx,y:0},{x:e.divPosx,y:parseFloat(a.attr("height"))}])}),e){var o=0;bio.iteration.loop(e,function(t){o+=t.length}),o!==t.init.mutation_list.length&&s()}else s()}function p(){t.now.geneline.axis&&bio.iteration.loop(t.now.geneline.axis,function(e,i){"enable"===t.now.geneline.axis[e].isGene?(d3.selectAll("#landscape_gene_"+e+"_bar_rect").style("fill-opacity","1"),d3.selectAll("#landscape_gene_"+e+"_heatmap_rect").style("fill-opacity","1")):(d3.selectAll("#landscape_gene_"+e+"_bar_rect").style("fill-opacity","0.2"),d3.selectAll("#landscape_gene_"+e+"_heatmap_rect").style("fill-opacity","0.2"))})}function g(){var e=[],i=[],n=!1,a=t.now.exclusivity_opt||t.init.exclusivity_opt;return t.now.geneline.groupList?(bio.iteration.loop(t.now.geneline.groupList,function(o){var r,l=[];bio.iteration.loop(t.now.mutation_list||t.init.mutation_list,function(e){o.indexOf(e.participant_id)>-1&&(Object.keys(t.now.geneline.removedMutationObj).length>0?bio.iteration.loop(t.now.geneline.removedMutationObj,function(t,i){e.gene!==t&&l.push(e),i&&(n=!0)}):l.push(e))});var s=l.map(function(t){return{x:t.participant_id,y:t.gene,value:t.type}});r=bio.landscapeSort().exclusive(s,t.data.gene,a),e.push(l),i.push(r)}),bio.iteration.loop(t.now.geneline.groupList,function(t,e){bio.iteration.loop(t,function(t){i[e].data.indexOf(t)<0&&i[e].data.push(t)})})):e=t.now.geneline.mutationList,{isRemovable:n,data:e,arr:i}}function f(){if(t.divisionFunc){var e=[];bio.iteration.loop(t.now.geneline.removedMutationObj,function(i,n){e=e.concat(t.now.geneline.removedMutationObj[i])});var i=(o=t.now.mutation_list||t.init.mutation_list,r=[],bio.iteration.loop(o,function(t){r.indexOf(t.participant_id)<0&&r.push(t.participant_id)}),r),n=t.data.axis.sample.x.filter(function(t){return i.indexOf(t)<0}),a=t.data.group.group[0].map(function(t){return t.x});a=(a=a.filter(function(t){if(i.indexOf(t)<0&&n.indexOf(t)<0)return t}))||[],t.divisionFunc(i,n,a)}var o,r}function h(i,s){var c={sample:"s_s",gene:"gene",pq:"pq",group:"s_g"}[i];bio.layout().get(t.setting.svgs,[c],function(c,u){var h=bio.landscapeConfig().axis(i,s,u),v=bio.landscapeConfig().axis("common"),m=t.data.axis[i][s.toLowerCase()];"group"===i&&bio.iteration.loop(m,function(t){c.indexOf(t[0].removeWhiteSpace().replace("/",""))>-1&&(m=t)});var x=d3.drag().on("start",l).on("drag",o).on("end",r);bio.axises()[h.direction]({element:u,domain:m,top:h.top,left:h.left,range:h.range,margin:h.margin,exclude:h.exclude}).selectAll("text").on("mouseout",!!v.on&&v.on.mouseout).on("mouseover",function(e,i){var n=this.parentNode.parentNode.className.baseVal;if(n.indexOf("gene")>-1&&n.indexOf("right")>-1||n.indexOf("group")>-1){var a="";a=n.indexOf("gene")>-1?t.now.geneline.removedMutationObj[e]?"<b>Click to Enable</b></br>Sort by alt + <b>"+this.innerHTML+"</b>":"<b>Click to Disable</b></br>Sort by alt + <b>"+this.innerHTML+"</b>":"<b>"+this.innerHTML+"</b></br>Click to sort </br> Alt + Click add to key",bio.tooltip({element:this,contents:a}),d3.select(this).transition().style("font-size",11).style("font-weight","bold")}}).on("click",function(o,r){if("group"===i&&"Y"===s){var l=!!h.on&&h.on.click.call(this,o,r,t),c=[];bio.iteration.loop(t.now.group.group,function(t){var e=[];t.filter(function(t){l.sorted.data.indexOf(t.x)>-1&&(e[l.sorted.data.indexOf(t.x)]=t.x)}),c.push(e.filter(function(t){return t}))}),t.now.geneline.groupList=c,t.now.geneline.pidList=g(),t.now.geneline.mutationList=t.now.geneline.pidList.data,a(l,t.now.geneline.pidList.isRemovable?t.now.geneline.pidList.data:void 0),d3.event.altKey||t.onClickClinicalName(o)}if("gene"===i&&"Y"===s&&!t.now.geneline.isDraggable)if(d3.event.altKey){l=!!h.on&&h.on.click.call(this,o,r,t);t.now.geneline.mutationList=void 0,a(l)}else{var u=[].concat(t.data.gene),v=void 0,m=void 0;if("enable"===t.now.geneline.axis[o].isGene){var x=u.indexOf(o),y=u.splice(x+1);u=u.splice(0,x).concat(y).concat([o]),t.data.gene=u,t.now.geneline.axis[o].isGene="disable",t.now.mutation_list=t.now.mutation_list?t.now.mutation_list:t.init.mutation_list,t.now.mutation_list=t.now.mutation_list.filter(function(e){if(e.gene!==o)return e;t.now.geneline.removedMutationObj[e.gene]?t.now.geneline.removedMutationObj[e.gene].indexOf(e.participant_id)<0&&t.now.geneline.removedMutationObj[e.gene].push(e.participant_id):t.now.geneline.removedMutationObj[e.gene]=[e.participant_id],t.now.geneline.removedMutationArr[e.gene]?t.now.geneline.removedMutationArr[e.gene].indexOf(e.participant_id)<0&&t.now.geneline.removedMutationArr[e.gene].push(e):t.now.geneline.removedMutationArr[e.gene]=[e]}),t.now.geneline.sortedSiblings.push(t.now.geneline.sortedSiblings.splice(x,1)[0]),t.now.geneline.pidList=g(),v=t.now.geneline.pidList.data,m=t.now.geneline.pidList.arr,_()}else{var w=u.indexOf(o),k=(x=t.now.geneline.axis[o].idx,!1);u.splice(w,1),u.splice(x,0,o),t.data.gene=u,t.now.geneline.axis[o].isGene="enable",t.now.mutation_list=t.now.mutation_list.concat(t.now.geneline.removedMutationArr[o]),t.now.geneline.removedMutationObj[o]=void 0,t.now.geneline.removedMutationArr[o]=void 0,t.now.geneline.pidList=g(),bio.iteration.loop(t.now.geneline.axis,function(t,e){"disable"===e.isGene&&(k=!0)}),v=k?t.now.geneline.pidList.data:void 0,m=t.now.geneline.pidList.arr,t.now.geneline.sortedSiblings.splice(x,0,t.now.geneline.sortedSiblings.splice(w,1)[0]),_()}t.data.axis.gene.y=t.data.gene,t.data.axis.heatmap.y=t.data.gene,t.data.axis.pq.y=t.data.gene;var A=t.now.exclusivity_opt?t.now.exclusivity_opt:t.init.exclusivity_opt;if(bio.layout().removeGroupTag("survival"),t.exclusive.now=bio.landscapeSort().exclusive(t.data.heatmap,t.data.gene,A),e(t.now.mutation_list),t.now.geneline.groupList){var C=[];bio.iteration.loop(m,function(t){C=C.concat(t.data)}),n({axis:"x",data:C})}else n(t.exclusive.now);b(t.data,t.now.width),p(),d(v),f()}}).call(x)})}function v(e){bio.layout().get(t.setting.svgs,[e],function(e,i){var n,o,r=bio.landscapeConfig().title("common"),l=(n=i.attr("id"),o=r,n.indexOf("pq")<0?n.indexOf("gene")>-1?[{name:"gene",text:o.titles[0]}]:[{name:"sample",text:o.titles[0]}]:[{name:"pq",text:o.titles[1]}]),s=bio.landscapeConfig().title(l[0].name);bio.sortTitle({data:l,element:i,attr:s.attr,text:r.text,style:r.style,margin:s.margin,titles:r.titles,on:{mouseover:r.on.mouseover,mouseout:r.on.mouseout,click:function(e,i,n){t.sortName=l[0].name,t.now.sort[e.name]&&"asc"===t.now.sort[e.name]?t.now.sort[e.name]="desc":t.now.sort[e.name]="asc",a(r.on.click.call(this,e,i,t))}}},t)})}function m(e,i,n,a){var o={sample:{id:"e_s",config:"sample"},samplePatient:{id:"t_s",config:"sample"},gene:{id:e,config:e},pq:{id:e,config:e}}[e];bio.layout().get(t.setting.svgs,[o.id],function(t,r){var l=bio.landscapeConfig().bar(o.config);e.indexOf("Patient")>-1&&(l.margin[3]=5),bio.bar({data:i,element:r,on:l.on,xaxis:n.x,yaxis:n.y,startTo:a,attr:l.attr,style:l.style,margin:l.margin})})}function x(e,i,n){var a,o,r=(o=n,(a=e).indexOf("group")>-1||a.indexOf("patientGroup")>-1?o.y[0].removeWhiteSpace():""),l={group:{id:"p_group_",config:"group"},patientGroup:{id:"t_group_",config:"group"},heatmap:{id:"e_h",config:"heatmap"},patientHeatmap:{id:"t_h",config:"heatmap"}};bio.layout().get(t.setting.svgs,[l[e].id+r.replace("/","")],function(t,a){var o=bio.landscapeConfig().heatmap(l[e].config),r=e.indexOf("map")>-1?bio.initialize("landscapeHeatmap"):null;(e.indexOf("patientHeatmap")>-1||e.indexOf("patientGroup")>-1)&&(o.margin[3]=5),bio.heat({data:i,element:a,xaxis:n.x,yaxis:n.y,on:o.on,attr:o.attr,style:o.style,margin:o.margin},r)})}function b(e,i){var n,a,o=t.data;n=i,bio.layout().get(t.setting.svgs,["e_gr","e_s","e_h"],function(e,i){i.attr("width",n||t.now.width||t.init.width)}),h("pq","X"),h("gene","X"),h("gene","Y"),h("group","Y"),h("sample","Y"),v("pq"),v("s_s"),v("gene"),m("pq",o.pq,o.axis.pq,["top","left"]),m("gene",o.stack.gene,o.axis.gene,["top","left"]),m("sample",o.stack.sample,o.axis.sample,["top","left"]),m("samplePatient",o.stack.patient,o.axis.patient.sample,["top","left"]),x("heatmap",o.heatmap,o.axis.heatmap),x("patientHeatmap",o.patient,o.axis.patient.heatmap),bio.iteration.loop(o.axis.group.y,function(t,e){var i=o.axis.group.y[e],n={x:o.axis.group.x,y:i},a={x:o.axis.patient.group.x,y:i},r=[];bio.iteration.loop(o.group.group[e],function(t){o.axis.group.x.indexOf(t.x)>-1&&r.push(t)}),x("group",r,n),x("patientGroup",[o.group.patient[e]],a)}),a=o.type,bio.layout().get(t.setting.svgs,["legend"],function(t,e){var i=bio.landscapeConfig().legend();bio.legend({data:a,element:e,on:i.on,attr:i.attr,text:i.text,style:i.style,margin:i.margin})})}function y(){var e=document.querySelector(".landscape_gene_svg.right-axis-g-tag"),i=bio.dom().siblings(e.children),n=[];t.init.geneline.sortedSiblings=i,bio.iteration.loop(i,function(e,i){var a=e.innerHTML.substring(e.innerHTML.indexOf(">")+1,e.innerHTML.lastIndexOf("<"));n[t.data.gene.indexOf(a)]=e}),t.now.geneline.sortedSiblings=n}function _(){bio.iteration.loop(t.data.gene,function(e,i){var n=d3.select(".landscape_gene_svg.right-axis-g-tag").selectAll("g").nodes()[i],a=parseFloat(d3.select(n).attr("transform").replace(/translate\(|\)/gi,"").split(",")[1]);t.now.geneline.axis[e].value=a})}function w(){t.init.geneline={gene:[],axis:{},heat:[],pq:[],temp:{}},bio.iteration.loop(t.data.gene,function(e,i){var n,a,o,r=d3.select(".landscape_gene_svg.right-axis-g-tag").selectAll("g").nodes()[i],l=parseFloat(d3.select(r).attr("transform").replace(/translate\(|\)/gi,"").split(",")[1]),s=parseFloat(d3.select("#landscape_gene_"+e+"_bar_rect").attr("y")),c=parseFloat(d3.select("#landscape_gene_"+e+"_heatmap_rect").attr("y"));t.init.geneline.axis[e]={idx:i,value:l,group:r,isGene:"enable"},t.init.geneline.gene.push({name:e,y:s}),t.init.geneline.heat.push({name:e,y:c}),n=0,a=0,o=0,bio.iteration.loop(t.init.geneline.axis,function(e,i){0===t.init.geneline.axis[e].idx?n=t.init.geneline.axis[e].value:1===t.init.geneline.axis[e].idx?a=t.init.geneline.axis[e].value:t.init.geneline.axis[e].idx===t.data.gene.length-1&&(o=t.init.geneline.axis[e].value)}),t.init.geneline.firstYAxis=n,t.init.geneline.axisHeight=parseFloat((a-n).toFixed(3)),t.init.geneline.axisHalfHeight=t.init.geneline.axisHeight/2,t.init.geneline.lastYAxis=o}),t.now.geneline=bio.objects.clone(t.init.geneline),t.now.geneline.pidList=void 0,t.now.geneline.enabledDivisionValues={},t.now.geneline.disabledDivisionValues={},t.now.geneline.removedMutationObj={},t.now.geneline.removedMutationArr={},t.now.geneline.removedMutationList={},y()}function k(e){var i;if(t.init.mutation_list=t.setting.defaultData.data.mutation_list,t.exclusive.init=bio.landscapeSort().exclusive(t.data.heatmap,t.data.gene,e),t.init.axis.x=[].concat(t.exclusive.init.data),t.init.axis.y=[].concat(t.data.axis.gene.y),t.init.axis.sampleY=[].concat(t.data.axis.sample.y),t.data.type.sort(function(t,e){return bio.boilerPlate.variantInfo[t].order>bio.boilerPlate.variantInfo[e].order?1:-1}),(i=t.data.axis).patient.heatmap={x:i.patient.x,y:i.gene.y},i.patient.group={x:["NA"],y:i.group.y},i.patient.sample={x:i.patient.x,y:i.sample.y},t.now.geneline.groupList){var a=[];t.now.geneline.pidList=g(),bio.iteration.loop(t.now.geneline.pidList.arr,function(t){a=a.concat(t.data)}),n({axis:"x",data:a})}else n(t.exclusive.now||t.exclusive.init);if(t.now.geneline)if(t.now.geneline.groupList){a=[];t.now.geneline.pidList=g(),bio.iteration.loop(t.now.geneline.pidList.arr,function(t){a=a.concat(t.data)}),n({axis:"x",data:a})}else t.exclusive.now=bio.landscapeSort().exclusive(t.data.heatmap,t.data.gene,e),n(t.exclusive.now||t.exclusive.init);bio.layout().removeGroupTag("survival"),b(t.data,t.init.width),p(),d(t.now.geneline.groupList?t.now.geneline.pidList.data:void 0)}return function(a){var o,r,l,s,c,u,d,p;(t=bio.initialize("landscape")).isPlotted=a.plot,t.setting=bio.setting("landscape",a),t.data=t.setting.preprocessData,t.divisionFunc=a.divisionFunc?a.divisionFunc:null,t.clinicalFunc=a.clinicalFunc?a.clinicalFunc:null,t.onClickClinicalName=a.onClickClinicalName?a.onClickClinicalName:null,bio.clinicalGenerator(t.data.group.group,"landscape"),d3.selectAll("#landscape_group_svg, #landscape_axis_group_svg, #landscape_patient_group_svg").remove(),bio.title("#landscape_title",t.setting.defaultData.title),o=t.init,r=bio.dom().get("#landscape_heatmap"),o.width=parseFloat(r.style.width),o.height=parseFloat(r.style.height),t.setting,bio.scaleSet({element:"#landscape_option",defaultValue:t.init.width,change:function(i,a){if(bio.layout().removeGroupTag("survival"),"refresh"===a.type){n({axis:"x",data:t.init.axis.x}),n({axis:"y",data:Object.keys(t.init.geneline.axis)}),e(t.init.mutation_list),t.data.gene=Object.keys(t.init.geneline.axis),t.now.exclusivity_opt=t.init.exclusivity_opt,bio.iteration.loop(t.init.geneline.axis,function(t,e){e.isGene="enable"}),t.now.mutation_list=t.init.mutation_list,t.now.geneline.axis=bio.objects.clone(t.init.geneline.axis),t.now.geneline.sortedSiblings=t.init.geneline.sortedSiblings,t.now.geneline.groupList=void 0,t.now.geneline.mutationList=void 0,t.now.geneline.pidList=void 0,t.now.geneline.removedMutationArr={},t.now.geneline.removedMutationList={},t.now.geneline.removedMutationObj={},t.now.exclusive=void 0;var o=document.querySelectorAll("label");return o[0].className="btn btn-default btn-sm active",o[1].className="btn btn-default btn-sm",document.querySelector("#option_1").checked=!0,document.querySelector("#option_2").checked=!1,k(t.now.exclusivity_opt),f(),t.onClickClinicalName(null),!1}return b(t.data,(t.now.width=a.value,t.now.width)),!1}}),l=document.querySelector("#landscape_option"),s=document.createElement("div"),c=document.createElement("div"),u=document.createElement("div"),d=i("1"),p=i("2"),c.id="option_group",c.className="btn-group",c.setAttribute("data-toggle","buttons"),c.appendChild(d),c.appendChild(p),u.id="option_label",u.innerHTML="Exclusivity",l.appendChild(u),l.appendChild(c),l.appendChild(s),t.init.exclusivity_opt="1",$('input[type="radio"]').change(function(e){t.now.exclusivity_opt=this.value,bio.layout().removeGroupTag("survival"),k(this.value)}),k("1"),w(),f(),t.clinicalFunc&&t.clinicalFunc(t.data.group,bio.boilerPlate.clinicalInfo),bio.handler().scroll("#landscape_heatmap",function(t){var e=bio.dom().get("#landscape_sample"),i=bio.dom().get("#landscape_group");e.scrollLeft=this.scrollLeft,i.scrollLeft=this.scrollLeft})}}function landscapeSort(){"use strict";var t={};function e(t,e){var i={};return bio.iteration.loop(t,function(t,n){i[t[e]]=i[t[e]]?i[t[e]]+=t.value:i[t[e]]=t.value}),i}function i(t){var e=[];return bio.iteration.loop(t,function(t,i){e.push({key:t,value:i})}),e}function n(t,e){var i="asc"===t?1:-1;return e.sort(function(t,e){return t.value>e.value?1*i:-1*i})}function a(t,a,o){switch(t){case"gene":return{axis:"y",data:n(a,i(e(o,"y"))).map(function(t){return t.key})};case"sample":return{axis:"x",data:n(a,i(e(o,"x"))).map(function(t){return t.key})};case"pq":return{axis:"y",data:n(a,o).map(function(t){return t.y})};default:throw new Error("Not matching function")}}function o(t,e){switch(t){case"gene":return e.stack.gene;case"sample":return e.stack.sample;case"pq":return e.pq;case"init":return e.init;default:throw new Error("No matching any data")}}function r(t,e){return a(t,"asc",o(t,e))}function l(t,e){return a(t,"desc",o(t,e))}function s(t,e){var i=bio.landscapeSort().exclusive(e,e[0].y);return bio.iteration.loop(t,function(t){i.data.indexOf(t)<0&&i.data.push(t)}),i}function c(t){var e,i,n,a,o=(n=t,a={},bio.iteration.loop(n,function(t){a[t.value]?a[t.value].push(t):a[t.value]=[t]}),a),r=(e=o,i=[],bio.iteration.loop(Object.keys(e).sort(function(t,e){return bio.boilerPlate.clinicalInfo[t].order>bio.boilerPlate.clinicalInfo[e].order?1:-1}),function(t,n){i.push(e[t])}),i),l=function(t){var e=[];return bio.iteration.loop.call(this,t,function(t){var i=[];bio.iteration.loop(t,function(t){i=i.concat(t.info)}),e.push(bio.landscapeSort().exclusive(i,this.data.gene))}),e}.call(this,r),s={};return bio.iteration.loop(l,function(t){s.axis=t.axis,s.data?s.data.push(t.data):s.data=[t.data]}),{group:r,axis:s}}function u(t,e){if(e){if(this.now.group.length<1)throw new Error("There are empty group data");var i=[],n={group:[],axis:{axis:"x",data:[]}};return bio.iteration.loop.call(this,this.now.group.group,function(e){var n,a,o;i.push(c.call(this,(n=t,a=e,o=[],bio.iteration.loop(n,function(t){bio.iteration.loop(a,function(e){t.x===e.x&&o.push(t)})}),o)))}),bio.iteration.loop(i,function(t){n.group=n.group.concat(t.group),n.axis.data=n.axis.data.concat(t.axis.data)}),n}return c.call(this,t)}function d(e,i,n){n=n||"1";var a,o,r,l,s={},c=[];return bio.iteration.loop(e,function(t){s[t.x]?s[t.x]=s[t.x]:(s[t.x]=!0,c.push({key:t.x,value:[].fill(i.length,"00").join("")}))}),a=c,o=i,r=e,l=n,bio.iteration.loop(a,function(t){bio.iteration.loop(r,function(e){if(e.x===t.key){var i=2*o.indexOf(e.y),n=i+1,a=bio.landscapeConfig().byCase(e.value);t.value=t.value.replaceAt(i,"1"),t.value=t.value.replaceAt(n,"cnv"===a&&"1"===l?"1":"0")}})}),t.exclusive=c,{axis:"x",data:c.sort(function(t,e){return t.value<e.value?1:-1}).map(function(t){return t.key})}}return function(){return t=bio.initialize("landscapeSort"),{asc:r,desc:l,gene:s,group:u,exclusive:d}}}function scaleSet(){"use strict";var t={};function e(e){if(t.change){var i,n=(i=this.className).indexOf("caret")>-1?i.indexOf("up")>-1?"up":"down":"refresh",a=parseInt(.1*t.defaultValue),o={up:1,down:-1}[n];t.scaleValue="refresh"!==n?t.scaleValue+o*a:t.defaultValue,t.scaleRate="refresh"!==n?"up"===n?(t.scaleRate+=t.termRate,t.scaleRate):(t.scaleRate-=t.termRate,t.scaleRate):t.defaultRate,t.scaleRate=t.defaultValue>t.scaleValue?(t.scaleRate+=t.termRate,t.scaleRate):2*t.defaultValue<t.scaleValue?2*t.defaultRate:t.scaleRate,t.scaleValue=t.defaultValue>t.scaleValue?t.defaultValue:2*t.defaultValue<t.scaleValue?2*t.defaultValue:t.scaleValue,t.input.value=t.scaleRate+"%",t.change.call(this,e,{type:n,value:t.scaleValue})}}return function(i){if(!i.element)throw new Error("Please, pass the element");var n,a,o,r,l=bio.dom().get(i.element);(t={unit:i.unit||"%",change:i.change||null,termRate:i.termRate||10,scaleRate:i.defaultRate||100,defaultRate:i.defaultRate||100,scaleValue:i.defaultValue||100,defaultValue:i.defaultValue||100}).div=((n=document.createElement("div")).id="scale_set_div",n),t.input=((o=document.createElement("input")).id="scale_set_input",o.value=a||"100%",o),t.buttons=((r=document.createElement("div")).id="scale_options",bio.iteration.loop(["caret-up","caret-down","refresh"],function(t){var i=document.createElement("i"),n=document.createElement("div"),a=document.createElement("button");a.className="scale-"+t,i.className="fa fa-"+t,a.addEventListener("click",e),a.appendChild(i),n.appendChild(a),r.appendChild(n)}),r),t.div.appendChild(t.input),t.div.appendChild(t.buttons),l.appendChild(t.div)}}function sortTitle(){"use strict";var t={};return function(e,i){t=bio.objects.clone(i||{}),t=bio.sizing.chart.default(t,e),bio.rendering().dropShadow(e.element,1,-.1,1),t.font=e.style.fontSize+" "+e.style.fontWeight,t.mostWidth=bio.drawing().mostWidth(e.titles,t.font),t.mostHeight=bio.drawing().textSize.height(t.font),t.group=bio.rendering().addGroup(e.element,0,0,"sort-title"),t.id.indexOf("sample")>-1&&t.group.attr("transform","translate(0, 0) rotate(270)"),t.opts={text:bio.objects.clone(e),shape:bio.objects.clone(e)},t.opts.text.id=t.id+"_sorttitle_text",t.opts.text.element=t.group.selectAll("#"+t.id+"_text"),t.opts.shape.id=t.id+"_sorttitle_shape",t.opts.shape.element=t.group.selectAll("#"+t.id+"_shape"),bio.rectangle(t.opts.shape,t),bio.text(t.opts.text,t)}}function pathway(){"use strict";var t={};function e(t,e,i,n){var a=bio.pathwayConfig().node();n>-1&&function(t,e){if(e>-1){var i=!1;setInterval(function(){i=!i,t.style("stroke",i?"#ff0000":"#333").style("stroke-width",i?3:1)},500)}}(t,n),t.attr("cursor","pointer").style("fill",function(t){return a.style.fill.call(this,e)}).on("mouseover",function(t,n){a.on.mouseover.call(this,e,n,i)}).on("mouseout",function(t,n){a.on.mouseout.call(this,e,n,i)})}function i(t,i){var n,a=bio.dependencies.version.d3v4()?d3.selectAll("text").nodes():bio.drawing().nodes(d3.selectAll("text"));bio.iteration.loop(a,function(n){var a,o,r,l=(a=n.textContent,o=t,r=null,bio.iteration.loop(o,function(t){t.gene_id===a&&(r={is:!0,data:t})}),r||{is:!1,data:null});if(l.is||/gene_/i.test(n.parentNode.id)){var s=d3.select(n.parentNode).select("rect"),c=i.indexOf(n.textContent),u={x:parseInt(s.attr("x")),y:parseInt(s.attr("y")),width:parseInt(s.attr("width")),height:parseInt(s.attr("height"))};e(s,l.data,u,c),e(d3.select(n),l.data,u)}}),n=a[0].parentNode.parentNode,bio.iteration.loop(n.childNodes,function(t,e){/gene_/i.test(e.id)&&d3.select(e).data({index:t})}),d3.selectAll("text, rect").attr("class","")}function n(t){var e=d3.selectAll('g[id*="drug_"]').nodes();bio.iteration.loop(e,function(e){var i=e.id.replace("drug_","").replace("_","/").toUpperCase(),n=!1;bio.iteration.loop(t,function(t,a){t.gene.toUpperCase()===i&&(n=!0,d3.select(e).datum(function(e){return{drugs:t.drugs}}),function(t,e,i){var n=d3.select('path[id*="'+e+'_color"]');if("type1"===i)n.style("fill","#ff0000");else if("type2"===i)n.style("fill","#0000ff");else{if("type3"!==i)return;n.style("fill","#000000")}}(0,e.id,t.drugs[0].drug_type))}),n||d3.select(e).remove()})}return function(e){var a,o;a=e.cancer_type,o=function(a){bio.modal({id:"drug_modal",element:document.querySelector(e.element)}),(t=bio.initialize("pathway")).setting=bio.setting("pathway",e),t.data=t.setting.preprocessData,t.modalID="drug_modal",bio.title("#pathway_title",e.cancer_type.toUpperCase()+" - Pathway");var o,r,l,s=document.getElementById("pathway_contents"),c=document.querySelector(".modal-body"),u=parseFloat(d3.select("#pathway_title").node().style.height);s.style.height=parseFloat(s.style.height)-u+"px",d3.select(a.documentElement).attr("width",parseFloat(s.style.width)).attr("height",parseFloat(s.style.height)),s.appendChild(a.documentElement),c.style.height=.8*parseFloat(s.style.height)+"px",i(t.setting.defaultData.pathway,t.setting.defaultData.patient),o=e.cancer_type,r=t.data.drugs,l=bio.pathwayConfig().drug(),n(r),d3.selectAll('g[id*="drug_"]').datum(function(t){var e=d3.select(this).attr("transform"),i=bio.dependencies.version.d3v4()?bio.rendering().translation(e):d3.transform(e);return{drugs:t.drugs,cancer:o,scaleX:i.scale[0],scaleY:i.scale[1],translateX:i.translate[0],translateY:i.translate[1]}}).on("click",l.on.click).on("mouseover",l.on.mouseover).on("mouseout",l.on.mouseout)},bio.drawing().importSVG("/data/pathway/"+a+".svg",o),console.log(">>> Pathway reponse data: ",e),console.log(">>> Pathway setting data: ",t.setting),console.log(">>> Pathway model data: ",t)}}function initialize(){"use strict";var t={layout:{svg:{variants:{},landscape:{},expression:{},exclusivity:{}}},sizing:{ids:[],chart:{}},setting:{idx:[],dom:null,size:{width:0,height:0}},preprocess:{pathway:null,variants:{needle:{line:[],shape:[]},patient:{line:[],shape:[]},type:[],graph:[],axis:{needle:{x:[],y:[]},now:{x:[],y:[]}}},landscape:{type:{},group:{group:[],patient:[]},heatmap:[],patient:[],stack:{gene:{},sample:{},patient:{}},axis:{pq:{x:[],y:[]},gene:{x:[],y:[]},group:{x:[],y:[]},sample:{x:[],y:[]},heatmap:{x:[],y:[]},patient:{x:[],y:[]}}},expression:{func:{default:"average",now:null,data:{},xaxis:{},yaxis:{},bar:{},tpmMinMax:{}},riskFuncs:{average:function(t){var e=[];return bio.iteration.loop(t,function(t){var i=0;bio.iteration.loop(t.values,function(t){i+=t.tpm}),e.push({pid:t.pid,score:i/t.values.length})}),e}},tpms:[],heatmap:[],scatter:{},subtype:[],survival:{},bar:[],axis:{gradient:{x:{},y:{}},heatmap:{x:{},y:{}},scatter:{x:{},y:{}},bar:{x:{},y:{}}}},exclusivity:{heatmap:{},network:{},type:{},survival:{merge:{},heat:{},data:{}},geneset:[],geneset_all:[],axis:{heatmap:{x:{},y:{}},division:{x:{},y:[]}},divisionIdx:{}}},loading:{},expression:{init:{function:"Average",signature:null,color_mapping:null},now:{function:null,signature:null,color_mapping:null,osdfs:"os"},divide:{}},exclusivity:{now:{geneset:null}},colorGradient:{show:[],data:[]},variants:{div:{}},variantsNavi:{start:0,end:0},landscape:{div:{},init:{axis:{x:[],y:[]},width:0,height:0,geneline:[]},now:{sort:{gene:null,sample:null,pq:null},group:[],axis:{x:[],y:[]},width:0,height:0,geneline:[]},exclusive:{init:null}},landscapeSort:{exclusive:[]},landscapeHeatmap:{mutationType:["cnv","var"],value:{},duplicate:[]}};return function(e){return bio.objects.clone(t[e]?t[e]:{})}}function preprocess(){"use strict";return function(t){return{pathway:bio.preprocPathway,variants:bio.preprocVariants,landscape:bio.preprocLandscape,expression:bio.preprocExpression,exclusivity:bio.preprocExclusivity}[t]}}function preprocExclusivity(){"use strict";var t={};function e(e,i){var n,a,o,r,l,s=(r=i,l={},bio.iteration.loop(r,function(t){l[t.gene]=["."]}),l),c=(n=i,a=s,o={},bio.iteration.loop(n,function(t){var e=bio.boilerPlate.variantInfo[t.type],i=bio.exclusivityConfig().abbreviation(e),n=bio.objects.clone(a);o[t.participant_id]?"."===o[t.participant_id][t.gene][0]?o[t.participant_id][t.gene]=[i]:o[t.participant_id][t.gene].push(i):(n[t.gene]=[i],o[t.participant_id]=n)}),o);bio.iteration.loop(e,function(t){t.gene=c[t.participant_id]?c[t.participant_id]:s}),t.survival.merge=e}function i(e){var i=e.matchAll(t.regex.geneset),n=e.matchAll(t.regex.heatmap),a=bio.exclusivityConfig(),o=0;bio.iteration.loop(i,function(e){var i,r=e.replace(/\[|\]/g,"").split(" "),l=r.length+o,s=r.join(" "),c=(i=r,t.type[i.join(" ")]=[]),u=[];t.heatmap[s]=[],t.axis.heatmap.x[s]=[],t.axis.heatmap.y[s]=r,t.axis.division.x[s]=[],t.divisionIdx[s]={idx:0};for(var d=0,p=n[0].length;d<p;d++)t.axis.heatmap.x[s].push(""+d),t.axis.division.x[s].push(""+d);for(;o<l;o++)bio.iteration.loop(n[o].split(""),function(e,i){bio.iteration.loop(a.separate(e),function(e){e=a.name(e),t.heatmap[s].push({x:i,y:r[o>=r.length?o-(l-r.length):o],value:e}),c.indexOf(e)<0?c.push(e):c=c}),t.divisionIdx[s].idx="."!==e?t.divisionIdx[s].idx>i?t.divisionIdx[s].idx:i:t.divisionIdx[s].idx}),u.push(n[o]);t.geneset.push(r),t.geneset_all=t.geneset_all.concat(r),t.survival.heat[s]=u});var r=t.geneset[4];t.geneset[4]=t.geneset[0],t.geneset[0]=r}function n(e){var i=null;bio.iteration.loop(e,function(e,n){var a,o;t.network[e]=(a=n,o=[],bio.iteration.loop(a,function(t){var e={};t=t.replace(new RegExp(/\t|\s{2,}|\s(?=\D)/,"ig"),"\t"),bio.iteration.loop(t.split("\t"),function(t){var i=t.split(":");e[i[0]]=i[0].indexOf("color")<0?i[1]:"rgb("+i[1].split(" ").join(",")+")"}),o.push(e)}),o),bio.iteration.loop(t.network[e],function(t){"compound"===t.type?(i=t.id,t.bgcolor=t.bgcolor.replace('"',""),t.textcolor=t.textcolor.replace('"',"")):"edge"===t.type?(t.source=t.source.replace(i,""),t.target=t.target.replace(i,""),t.linecolor=t.linecolor.replace('"',"")):"node"===t.type&&(t.bgcolor=t.bgcolor.replace('"',""))})})}return function(a){var o,r,l;return t={},(t=bio.initialize("preprocess").exclusivity).regex={geneset:new RegExp(/\[\w+(\s\w+)+\w+\]/,"g"),heatmap:new RegExp(/(A|B|D|E|M|\.){10,}/,"g")},e(a.survival.patient,a.survival.types),i(a.heatmap),o=a.network,r={},o=(o=o.replace(/\\n{1}/g,"\n")).replace(/\\t{1}/g,"\t"),bio.iteration.loop(o.split("\n"),function(e){bio.iteration.loop(t.geneset,function(t){var i=t.join("");e.indexOf(i)>-1&&(r[i]?r[i].push(e):r[i]=[e])})}),n(r),a.survival,l={},bio.iteration.loop(t.survival.heat,function(e,i){for(var n=t.axis.heatmap.x[e].length,a=e.split(" "),o=t.survival.data[e]?t.survival.data[e]:t.survival.data[e]=[],r=l[e]={},s=0;s<n;s++)t.survival.merge.some(function(t){for(var e,n=!0,l=0,c=a.length;l<c;l++)((e=t.gene[a[l]]).indexOf("A")>-1&&e.indexOf("M")>-1?"B":e.indexOf("D")>-1&&e.indexOf("M")>-1?"E":e[0])!==i[l][s]&&(n=!1);if(n&&void 0===r[t.participant_id])return r[t.participant_id]="",o[s]=t,void 0!==o[s]})}),t.mostGeneWidth=bio.drawing().mostWidth(t.geneset_all,"12px"),console.log(">>> Preprocess exclusivity data: ",a),console.log(">>> Preprocess data: ",t),t}}function preprocExpression(){"use strict";var t={};function e(e){var i,n,a=(i=e,n={},bio.iteration.loop(i,function(t){n[t.subtype]?n[t.subtype].push(t.value):n[t.subtype]=[t.value]}),n);bio.iteration.loop(a,function(e,i){t.subtype.push({key:e,value:i})})}function i(e,i,n){var a=[];bio.iteration.loop(n,function(e,i){bio.iteration.loop(i,function(e){t.axis.heatmap.y[e.key]=""}),a.push({pid:e,values:i.map(function(t){return{gene:t.key,tpm:t.value}})})});var o=i(a);bio.iteration.loop(o,function(i){t.func.bar[e]?t.func.bar[e].push({x:i.pid,value:i.score,info:t.patient_subtype[i.pid]}):t.func.bar[e]=[{x:i.pid,value:i.score,info:t.patient_subtype[i.pid]}],t.func.data[e]?t.func.data[e].push(i.score):t.func.data[e]=[i.score]}),bio.iteration.loop(t.func.data,function(e,i){var n,a,o,r,l,s,c;t.func.data[e]=t.func.data[e].sort(function(t,e){return t>e?1:-1}),n=e,a=t.func.bar[e],o=t.func.data,r=[].concat(o[n]),l=[],s=null,c=0,bio.iteration.loop(a,function(t){null===s?(l[r.indexOf(t.value)]=t.x,s=t.value,c=r.indexOf(t.value)):t.value===s?l[c+=1]=t.x:(s=t.value,c=r.indexOf(t.value),l[r.indexOf(t.value)]=t.x)}),t.func.xaxis[n]=l,t.func.yaxis[n]=[bio.math.min(o[n]),bio.math.median(o[n]),bio.math.max(o[n])],bio.iteration.loop(a,function(e){e.y=t.func.yaxis[n][1]})})}function n(e){var n,a,o,r;t.func.now||t.func.default;bio.iteration.loop(e,function(e){var i,n;e.tpm=(i=e.tpm+1,Math.log(i+1)/Math.LN2),n=e,t.axis.heatmap.x[n.participant_id]?t.axis.heatmap.x[n.participant_id].push({key:n.hugo_symbol,value:n.tpm}):t.axis.heatmap.x[n.participant_id]=[{key:n.hugo_symbol,value:n.tpm}],t.tpms.push(e.tpm),t.heatmap.push({x:e.participant_id,y:e.hugo_symbol,value:e.tpm})}),n=t.tpms,t.axis.gradient.x=[bio.math.min(n),bio.math.median(n),bio.math.max(n)],t.axis.gradient.y=[""],bio.iteration.loop(t.riskFuncs,function(e){i(e,t.riskFuncs[e],t.axis.heatmap.x)}),(!t.func.now||Object.keys(t.func.now).length<1)&&(t.bar=t.func.bar.average,t.axis.bar.y=t.func.yaxis.average,t.axis.heatmap.x=t.func.xaxis.average,t.func.now=t.func.default),t.axis.heatmap.y=(a=e,Object.keys(t.axis.heatmap.y),o={},r=[],bio.iteration.loop(a,function(t){o[t.hugo_symbol]?o[t.hugo_symbol]+=t.tpm:o[t.hugo_symbol]=t.tpm}),bio.iteration.loop(o,function(e,i){r.push({gene:e,avgTpm:i/t.axis.heatmap.x.length})}),r.sort(function(t,e){return t.avgTpm<e.avgTpm?1:-1}).map(function(t){return t.gene})),t.axis.scatter.x=t.axis.heatmap.x,t.axis.bar.x=t.axis.heatmap.x}return function(i){var a,o,r,l;return t={},(t=bio.initialize("preprocess").expression).all_rna_list=[].concat(i.cohort_rna_list.concat(i.sample_rna_list)),t.genes=i.gene_list.map(function(t){return t.hugo_symbol}),a=i.riskFunctions,bio.iteration.loop(a,function(e){t.riskFuncs[e.name.toLowerCase()]=e.func}),function(e){t.axis.scatter.y={os:[],dfs:[]},t.patient_subtype={},bio.iteration.loop(e,function(e){t.axis.scatter.y.os.push(e.os_days/30),t.axis.scatter.y.dfs.push(e.dfs_days/30),t.patient_subtype[e.participant_id]=e});var i=bio.math.min(t.axis.scatter.y.os),n=bio.math.max(t.axis.scatter.y.os),a=bio.math.min(t.axis.scatter.y.dfs),o=bio.math.max(t.axis.scatter.y.dfs);t.axis.scatter.y.os=[i,n],t.axis.scatter.y.dfs=[a,o]}(i.patient_list),e(i.subtype_list),n(t.all_rna_list),i.sample_rna_list.length>0?t.patient={name:i.sample_rna_list[0].participant_id,data:(o=i.sample_rna_list[0].participant_id,t.axis.bar.y[1]>=t.func.xaxis[t.func.now||t.func.default][t.axis.bar.x.indexOf(o)]?"Low score group":"High score group")}:t.patient=null,bio.iteration.loop(t.bar,function(e){e.y=t.axis.bar.y[1]}),t.axisMargin=(r=t.axis.heatmap.y,l=0,bio.iteration.loop(r,function(t){var e=bio.drawing().textSize.width(t,"10px");l=l>e?l:e}),1.5*l),t}}function preprocLandscape(){"use strict";var t={};function e(t,e){t.indexOf(e)<0&&t.push(e)}function i(t,e){t.push({x:e.participant_id,y:e.gene,value:e.type})}function n(t,e,i){t[e]=t[e]?t[e]:{},t[e][i]=t[e][i]?t[e][i]+1:1}function a(e,i){bio.iteration.loop(e,function(e,n){e.type=bio.commonConfig().typeFormat(e.type),t.type[e.type]=null,i(e,n)}),t.isIterateCommonOk=!0}function o(o,r){var l={};return a(r,function(a){bio.iteration.loop(o,function(t){n(t.obj,a[t.data],a[t.type])}),i(t.heatmap,a),e(t.axis.sample.x,a.participant_id)}),bio.iteration.loop(o,function(t){l[t.keyName]=t.obj}),{result:l,heatmap:t.heatmap}}function r(o){a(o,function(a){n(t.stack.patient,a.participant_id,a.type),i(t.patient,a),e(t.axis.patient.x,a.participant_id)})}function l(e){bio.iteration.loop(e,function(e){var i=[];bio.iteration.loop(e.data,function(n){var a=[];bio.iteration.loop(t.heatmap,function(t){n.participant_id===t.x&&a.push(t)}),i.push({x:n.participant_id,y:e.name,value:n.value,info:a})}),t.group.group.push(i),t.axis.group.y.push([e.name]),t.group.patient.push({x:t.axis.patient.x[0],y:e.name,value:"NA"})})}function s(e,i,n){var a=[],o="gene"===i?"x":"y";return bio.iteration.loop(n,function(n,r){var l=0,s=0;bio.iteration.loop(r,function(t,e){var o,r,c,u;a.push((o=l,r=n,c=e,u=t,"gene"===i?{x:o,y:r,value:c,info:u}:{x:r,y:o,value:c,info:u})),l+=e,s+=e}),e.push(s),t.axis[i][o].push(s)}),{data:a,axis:e}}function c(t,e,i,n){return"gene"===t?[bio.math.max(e),0]:"pq"===t?[0,bio.math.max(e.map(function(t){return Math.ceil(t.value)}))]:i&&i.patient?[bio.math.max(e),0]:[bio.math.max(bio.math.max(n),bio.math.max(e)),0]}function u(e){var i,n,a,o;i=t.group.group[0].map(function(t){return t.x}),t.axis.sample.x=t.axis.sample.x.concat(i),t.axis.pq.y=t.axis.gene.y=t.axis.heatmap.y=(n=e,a={},o=[],bio.iteration.loop(n,function(t){a[t.y]=a[t.y]?a[t.y]+t.value:t.value}),bio.iteration.loop(a,function(t,e){o.push({gene:t,total:a[t]})}),o.sort(function(t,e){return t.total<e.total?1:-1}),o.map(function(t){return t.gene})),t.axis.heatmap.x=t.axis.group.x=t.axis.sample.x}return function(e,i){t=bio.initialize("preprocess").landscape;var n,a,d,p={};(e=e.gene_list?e:e.data).mutation_list.map(function(t){p[t.participant_id]=!0}),e.group_list[0].data.length>Object.keys(p).length&&(e.mutation_list=(n=e.mutation_list,a=e.group_list[0].data,d=[],bio.iteration.loop(a,function(t){bio.iteration.loop(n,function(e){t.participant_id===e.participant_id&&d.push(e)})}),d)),t.iterMut=o,t.iterPat=r,t.iterGroup=l,t.byStack=s;var g,f;t.iterMut([{obj:t.stack.gene,data:"gene",type:"type",keyName:"gene"},{obj:t.stack.sample,data:"participant_id",type:"type",keyName:"sample"}],e.mutation_list);return t.iterPat(e.patient_list),t.iterGroup(e.group_list),t.type=Object.keys(t.type),t.pq=(g=e.gene_list,f=e.pq||"p",g.map(function(t){var e=Math.log(t[f])/Math.log(12)*-1;return{x:0,y:t.gene,value:e}})),t.stack.gene=t.byStack(t.axis.gene.x,"gene",t.stack.gene).data,t.stack.sample=t.byStack(t.axis.sample.y,"sample",t.stack.sample).data,t.stack.patient=t.byStack(t.axis.patient.y,"patient",t.stack.patient).data,t.makeLinearAxis=c,t.makeOrdinalAxis=u,t.axis.gene.x=t.makeLinearAxis("gene",t.axis.gene.x),t.axis.pq.x=t.makeLinearAxis("pq",t.pq),t.axis.sample.y=t.makeLinearAxis("sample",t.axis.sample.y,i,t.axis.patient.y),t.makeOrdinalAxis(t.stack.gene),t.gene=[].concat(t.axis.gene.y),t.clinicalList=[],bio.iteration.loop(t.axis.group.y,function(e){t.clinicalList=t.clinicalList.concat(e)}),t}}function preprocPathway(){"use strict";var t={};return function(e){var i,n;return t={},i=e.pathway,n=e.drugs,t.drugs=[],bio.iteration.loop(i,function(e){var i={},a=[];bio.iteration.loop(n,function(t){e.gene_id===t.gene_id&&a.push(t)}),i.gene=e.gene_id,i.drugs=a,i.drugs.length>0&&(i.drugs=i.drugs.sort(function(t,e){return t.drug_type>e.drug_type?1:-1}),t.drugs.push(i))}),console.log(">>> Preprocess pathway data: ",e),console.log(">>> Preprocess data: ",t),t}}function preprocVariants(){"use strict";var t={};function e(e,i){var n,a,o={};bio.iteration.loop(e,function(e){e.type=bio.commonConfig().typeFormat(e.type);var i=e.position+" "+e.type+" "+e.aachange;o[e.position]?o[e.position][i]?o[e.position][i].push(e):o[e.position][i]=[e]:(o[e.position]={},o[e.position][i]=[e]),t.type.indexOf(e.type)<0&&t.type.push(e.type)}),n=o,a=i,bio.iteration.loop(n,function(e,i){var n=0,o={key:e,value:[{x:parseFloat(e),y:n,value:0}]};t.axis.needle.y.push(n),bio.iteration.loop(i,function(t,i){o.value.push({x:parseFloat(e),y:(n+=i.length,n),value:i.length,info:i})}),t.axis.needle.y.push(n),a.push(o)})}function i(t,e){bio.iteration.loop(t,function(t){bio.iteration.loop(t.value,function(i,n){i.info&&(i.value=i.y-t.value[n-1].y,e.push(i))})})}return function(n){var a,o;return t=bio.initialize("preprocess").variants,e(n.variants.public_list,t.needle.line),e(n.variants.patient_list,t.patient.line),a=n.variants.graph,bio.iteration.loop(a,function(e,i){t.graph.push({x:e.start,y:0,width:e.end-e.start,height:15,color:e.colour,info:e})}),o=n.variants.graph,t.axis.needle.x=[0,o[0].length],t.axis.needle.y=t.axis.needle.y.length<1?[0,1]:[bio.math.min(t.axis.needle.y),bio.math.max(t.axis.needle.y)],i(t.needle.line,t.needle.shape),i(t.patient.line,t.patient.shape),console.log(">>> Preprocess variants data: ",n),console.log(">>> Preprocess data: ",t),t}}!function(t){"use strict";var e={initialize:initialize(),sizing:sizing(),layout:layout(),setting:setting(),boilerPlate:boilerPlate(),commonConfig:commonConfig(),pathwayConfig:pathwayConfig(),variantsConfig:variantsConfig(),landscapeConfig:landscapeConfig(),expressionConfig:expressionConfig(),exclusivityConfig:exclusivityConfig(),preprocess:preprocess(),preprocPathway:preprocPathway(),preprocVariants:preprocVariants(),preprocLandscape:preprocLandscape(),preprocExpression:preprocExpression(),preprocExclusivity:preprocExclusivity(),modal:modal(),title:title(),table:table(),loading:loading(),tooltip:tooltip(),selectBox:selectBox(),clinicalGenerator:clinicalGenerator(),bar:bar(),text:text(),path:path(),heat:heat(),axises:axises(),circle:circle(),scales:scales(),needle:needle(),legend:legend(),drawing:drawing(),scatter:scatter(),network:network(),triangle:triangle(),survival:survival(),rectangle:rectangle(),rendering:rendering(),divisionLine:divisionLine(),dom:dom(),math:math(),handler:handler(),strings:strings(),objects:objects(),iteration:iteration(),dependencies:dependencies(),expression:expression(),colorGradient:colorGradient(),exclusivity:exclusivity(),scaleSet:scaleSet(),sortTitle:sortTitle(),landscape:landscape(),landscapeSort:landscapeSort(),variants:variants(),variantsNavi:variantsNavi(),variantsGraph:variantsGraph(),variantsPatient:variantsPatient(),pathway:pathway()};t.bio=e}(window||{});var SurvivalCurveBroilerPlate={elem:{svg:"",xScale:"",yScale:"",xAxis:"",yAxis:"",line:"",curve:"",dots:[],censoredDots:""},settings:{canvas_width:400,canvas_height:400,chart_width:370,chart_height:370,chart_left:50,chart_top:25,include_info_table:!1,include_legend:!0,include_pvalue:!0,pval_x:220,pval_y:57},divs:{curveDivId:"",headerDivId:"",infoTableDivId:""},subGroupSettings:{line_color:"red",mouseover_color:"#F5BCA9",legend:"",curveId:""},text:{xTitle:"",yTitle:"",qTips:{estimation:"",censoredEvent:"",failureEvent:""},infoTableTitles:{total_cases:"#total cases",num_of_events_cases:"",median:""},pValTitle:"Logrank Test P-Value: "},style:{censored_sign_size:5,axis_stroke_width:1,axisX_title_pos_x:260,axisX_title_pos_y:30,axisY_title_pos_x:10,axisY_title_pos_y:10,axis_color:"black",pval_font_size:12,pval_font_style:"normal"},vals:{pVal:0}};if(void 0===cbio)var cbio={};cbio.util=function(){var t=function(t){return null===t||void 0===t};function e(t){var e={show:{ready:!0},hide:{fixed:!0,delay:100},style:{classes:"qtip-light qtip-rounded qtip-shadow",tip:!0},position:{my:"top left",at:"bottom right",viewport:$(window)}},i=t.data.qTipOpts;jQuery.extend(!0,e,i),$(this).qtip(e)}function i(t,e,i){for(var n=t,a=n.indexOf(e);-1!=a;)a=(n=n.replace(e,i)).indexOf(e);return n}return{toPrecision:function(t,e,i){return 1e-6<=t&&t<i?t.toExponential(e):t.toPrecision(e)},getObjectLength:function(t){var e=0;for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e++;return e},checkNullOrUndefined:t,uniqueElementsOfArray:function(t){for(var e=[],i={},n=0,a=t.length;n<a;n++)t[n]in i||(e.push(t[n]),i[t[n]]=1);return e},arrayToAssociatedArrayIndices:function(e,i){t(i)&&(i=0);for(var n={},a=0,o=e.length;a<o;a++)n[e[a]]=a+i;return n},alterAxesAttrForPDFConverter:function(t,e,i,n,a){a&&(e*=-1,n*=-1);var o=t.selectAll(".tick").selectAll("text"),r=i.selectAll(".tick").selectAll("text"),l=parseInt(o.attr("y")),s=parseInt(r.attr("y"));o.attr("y",l+e),r.attr("y",s+n)},lcss:function(t,e){for(var i=0;i<t.length&&i<e.length&&t[i]===e[i];)i++;return t.substring(0,i)},b64ToByteArrays:function(t,e){e=e||512;for(var i=atob(t),n=[],a=0;a<i.length;a+=e){for(var o=i.slice(a,a+e),r=new Array(o.length),l=0;l<o.length;l++)r[l]=o.charCodeAt(l);var s=new Uint8Array(r);n.push(s)}return n},browser:function(){var t={},e=navigator.userAgent.toLowerCase();if(t.firefox=/mozilla/.test(e)&&/firefox/.test(e),t.mozilla=t.firefox,t.chrome=/webkit/.test(e)&&/chrome/.test(e),t.safari=/applewebkit/.test(e)&&/safari/.test(e)&&!/chrome/.test(e),t.opera=/opera/.test(e),t.msie=/msie/.test(e),t.version="",t.msie||t.firefox||t.chrome||t.safari||t.opera||/trident/.test(e)&&(t.msie=!0,t.version=11),""===t.version)for(var i in t)if(t[i]){t.version=e.match(new RegExp("("+i+")( |/)([0-9]+)"))[3];break}return t}(),getWindowOrigin:function(){var t=window.location.origin;return t||(t=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),t},sortByAttribute:function(t,e){return t.sort(function(t,i){return t[e]<i[e]?-1:t[e]>i[e]?1:0}),t},safeProperty:function(t){return t.replace(/[^a-zA-Z0-9-]/g,"_")},autoHideOnMouseLeave:function(t,e){$(t).mouseenter(function(t){e.fadeIn({complete:function(){$(this).css({visibility:"visible"}),$(this).css({display:"inline"})}})}),$(t).mouseleave(function(t){e.fadeOut({complete:function(){$(this).css({visibility:"hidden"}),$(this).css({display:"inline"})}})})},swapElement:function(t,e,i){var n=t[e];t[e]=t[i],t[i]=n},getTargetWindow:function(t){var e=document.getElementById(t),i=e;return e.contentWindow&&(i=e.contentWindow),i},getTargetDocument:function(t){var e=document.getElementById(t),i=e.contentDocument;return!i&&e.contentWindow&&(i=e.contentWindow.document),i},getLinkToPatientView:function(t,e){return"case.do?cancer_study_id="+t+"&case_id="+e},getLinkToSampleView:function(t,e){return"case.do?cancer_study_id="+t+"&sample_id="+e},addTargetedQTip:function(t,i){t?(t[0]&&t[0].ownerSVGElement?t=t[0]:t[0]&&t[0][0]&&t[0][0].ownerSVGElement&&(t=t[0][0]),$(t).off("mouseenter",e),$(t).one("mouseenter",{qTipOpts:i},e)):console.error("qTip target is not defined.")},baseMutationMapperOpts:function(){return{proxy:{pdbProxy:{options:{servletName:"get3dPdb.json",listJoiner:" ",subService:!1}},variantAnnotationProxy:{options:{initMode:"full",data:{}}}}}},toTitleCase:function(t){var e;if(null==t)return t;e=(e=i(e=t.replace(/\s+$/,""),"_"," ")).toLowerCase();var n=new Array;n.push(e.charAt(0).toUpperCase());for(var a=1;a<e.length;a++)" "==e.charAt(a-1)?n.push(e.charAt(a).toUpperCase()):n.push(e.charAt(a));return n.join("")},getHotSpotDesc:function(){return'<b>Recurrent Hotspot</b><br/>This mutated amino acid was identified as a recurrent hotspot (statistically significant) in a population-scale cohort of tumor samples of various cancer types using methodology based in part on <a href="http://www.ncbi.nlm.nih.gov/pubmed/26619011" target="_blank">Chang et al., Nat Biotechnol, 2016</a>.<br/><br/>Explore all mutations at <a href="http://cancerhotspots.org/" target="_blank">http://cancerhotspots.org/</a>.'},replaceAll:i,findExtremes:function(t,e){var i=[],n=!1;_.each(t,function(t){$.isNumeric(t)&&i.push(Number(t))}),i.sort(function(t,e){return t-e});var a,o,r=i[Math.floor(i.length/4)],l=i[Math.ceil(.75*i.length)>i.length-1?i.length-1:Math.ceil(.75*i.length)],s=l-r;if(i[Math.ceil(.5*i.length)]<.001&&(n=!0),l<1?(a=Number((l+1.5*s).toFixed(2)),o=Number((r-1.5*s).toFixed(2))):(a=Math.ceil(l+1.5*s),o=Math.floor(r-1.5*s)),o<i[0]&&(o=i[0]),a>i[i.length-1]&&(a=i[i.length-1]),e){var c=0;if(-1===i.indexOf(o)){for(;o>i[c]&&o>i[c+1];)c++;o=i[c+1]}if(c=i.length-1,-1===i.indexOf(a)){for(;a<i[c]&&a<i[c-1];)c--;a=i[c-1]}}return[o,a,n]}}}(),Array.prototype.forEach||(Array.prototype.forEach=function(t){var e=this.length>>>0;if("function"!=typeof t)throw new TypeError;for(var i=arguments[1],n=0;n<e;n++)n in this&&t.call(i,this[n],n,this)});var KmEstimator=function(){return{calc:function(t){var e=1;for(var i in t){var n=t[i];"1"==n.status?(n.survival_rate=e*((n.num_at_risk-1)/n.num_at_risk),e=n.survival_rate):"0"==n.status&&(n.survival_rate=e)}}}},LogRankTest=function(t){var e={time:"",num_of_failure_1:0,num_of_failure_2:0,num_at_risk_1:0,num_at_risk_2:0,expectation:0,variance:0},i=[];function n(n,a,o){for(var r,l,s=0,c=0;s<n.length&&c<a.length;){if(n[s].time<a[c].time){if((u=jQuery.extend(!0,{},e)).time=n[s].time,"1"!=n[s].status){s+=1;continue}u.num_of_failure_1=1,u.num_at_risk_1=n[s].num_at_risk,u.num_at_risk_2=a[c].num_at_risk,s+=1}else if(n[s].time>a[c].time){if((u=jQuery.extend(!0,{},e)).time=a[c].time,"1"!=a[c].status){c+=1;continue}u.num_of_failure_2=1,u.num_at_risk_1=n[s].num_at_risk,u.num_at_risk_2=a[c].num_at_risk,c+=1}else{var u;if((u=jQuery.extend(!0,{},e)).time=n[s].time,"1"!=n[s].status&&"1"!=a[c].status){s+=1,c+=1;continue}"1"==n[s].status&&(u.num_of_failure_1=1),"1"==a[c].status&&(u.num_of_failure_2=1),u.num_at_risk_1=n[s].num_at_risk,u.num_at_risk_2=a[c].num_at_risk,s+=1,c+=1}i.push(u)}r=o,$.each(i,function(t,e){e.expectation=e.num_at_risk_1/(e.num_at_risk_1+e.num_at_risk_2)*(e.num_of_failure_1+e.num_of_failure_2)}),l=r,$.each(i,function(t,e){var i=e.num_of_failure_1+e.num_of_failure_2,n=e.num_at_risk_1+e.num_at_risk_2;e.variance=i*(n-i)*e.num_at_risk_1*e.num_at_risk_2/(n*n*(n-1))}),function(e){var n=0,a=0,o=0;$.each(i,function(t,e){n+=e.num_of_failure_1,a+=e.expectation,o+=e.variance});var r=(n-a)*(n-a)/o;$.post(t,{chi_square_score:r}).done(function(t){e(t)})}(l)}return{calc:function(t,e,a){i.length=0,n(t,e,a)}}},SurvivalCurve=function(){var t="",e="",i="",n="",a="",o="",r={},l={},s={};function c(e,i,n){var a,o;null!==e&&e.length>0&&(0!==e[0].time&&e.unshift((a=e[0].num_at_risk,(o=jQuery.extend(!0,{},{case_id:"",time:"",status:"",num_at_risk:-1,survival_rate:0})).case_id="NA",o.time=0,o.status="NA",o.num_at_risk=a,o.survival_rate=1,o)),t.curve=t.svg.append("path").attr("id",n+"-line").attr("d",t.line(e)).style("fill","none").style("stroke",i.line_color))}function u(a){t.svg.append("text").attr("class","pval").attr("x",e.pval_x).attr("y",e.pval_y).attr("font-size",n.pval_font_size).attr("font-style",n.pval_font_style).style("text-anchor","front").text(i.pValTitle+cbio.util.toPrecision(Number(a),3,.001))}function d(n,a,o){var u,d,p,g,f,h,v,m=a.data,x=a.settings,b={};b.id=x.curveId,b.color=x.line_color,r[b.id]=b,t.dots[b.id]=t.svg.append("g").attr("id",b.id+"-dots"),t.line=d3.line().x(function(e){return t.xScale(e.time)}).y(function(e){return t.yScale(e.survival_rate)}),c(m.getData(),x,b.id),s[o]=a.settings,m.getData().shift(),u=m.getData(),d=x,p=b.id,t.censoredDots.append("g").attr("id",p+"-crossdots").selectAll("path").data(u).enter().append("path").filter(function(t){return"0"==t.status}).attr("transform",function(e){return"translate("+t.xScale(e.time)+","+t.yScale(e.survival_rate)+")"}).attr("d",d3.symbol().type(function(t){return d3.symbolCross}).size(25)).attr("fill",d.line_color),g=b.id,f=m.getData(),h=x.mouseover_color,t.dots[g].selectAll("path").data(f).enter().append("svg:path").attr("d",d3.symbol().size(400).type(function(t){return d3.symbolCircle})).attr("transform",function(e){return"translate("+t.xScale(e.time)+", "+t.yScale(e.survival_rate)+")"}).attr("fill",h).style("opacity",0),v=b.id,t.dots[v].selectAll("path").on("mouseover",function(t){if(d3.select(this).transition().duration(400).style("opacity",.9),!$(this).data("qtip")){var e=window.QuerySession?window.QuerySession.getCancerStudyIds()[0]:window.cancerStudyId||window.cancer_study_id||window.cancer_study_id_selected,n="<font size='2'>";n+=i.qTips.id+": <strong><a href='"+l(e,t.case_id)+"' target='_blank'>"+t.case_id+"</a></strong><br>",n+=i.qTips.estimation+": <strong>"+(100*t.survival_rate).toFixed(2)+"%</strong><br>","0"===t.status?n+=i.qTips.censoredEvent+": <strong>"+t.time.toFixed(2)+" </strong>months (censored)<br>":n+=i.qTips.failureEvent+": <strong>"+t.time.toFixed(2)+" </strong>months<br>",n+="</font>",$(this).qtip({content:{text:n},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow qtip-wide"},show:{event:"mouseover",ready:!0},hide:{fixed:!0,delay:100,event:"mouseout"},position:{my:"left bottom",at:"top right"}})}}),t.dots[v].selectAll("path").on("mouseout",function(){d3.select(this).transition().duration(400).style("opacity",0)}),e.include_legend&&function(i){var n=[];$.each(i,function(t,e){var i={};i.text=e.settings.legend,i.color=e.settings.line_color,n.push(i)});var a=t.svg.selectAll(".legend").data(n).enter().append("g").attr("class","legend").attr("transform",function(t,i){return"translate("+e.chart_left+", "+(20+15*i)+")"});a.append("path").attr("width",18).attr("height",18).attr("d",d3.symbol().size(60).type(function(t){return d3.symbolSquare})).attr("fill",function(t){return t.color}).attr("stroke","black").attr("stroke-width",.9),a.append("text").attr("x",15).attr("y",4).style("text-anchor","front").text(function(t){return t.text})}(n)}function p(n){var a;e.include_pvalue&&!isNaN(n)?t.svg.select(".pval").empty()?u(n):(a=n,t.svg.select(".pval").text(i.pValTitle+cbio.util.toPrecision(Number(a),3,1e-4))):t.svg.select(".pval").empty()||t.svg.select(".pval").remove()}return{init:function(r,c){t=c.elem,e=c.settings,i=c.text,n=c.style,a=c.divs,o=c.vals,l=c.qtipFunc;var p,g,f,h,v,m,x,b,y,w=!1;if($.each(r,function(t,e){if(0===e.data.getData().length)return w=!0,!1}),w)$("#"+a.infoTableDivId).empty(),$("#"+a.infoTableDivId).append("<span style='margin: 20px; color: grey;'>Survival data not available</span>");else{if($("#"+a.curveDivId).empty(),t.svg=d3.select("#"+a.curveDivId).append("svg").attr("id","survival_plot").attr("width",e.canvas_width).attr("height",e.canvas_height),t.curve=t.svg.append("g"),t.censoredDots=t.svg.append("g").attr("id","crossDots"),x=r,b=[],y=d3.format(".0%"),$.each(x,function(t,e){var i=e.data;$.each(i.getData(),function(t,e){b.push(e.time)})}),t.xScale=d3.scaleLinear().domain([0,d3.max(b)+.1*d3.max(b)]).range([e.chart_left,e.chart_width]),t.yScale=d3.scaleLinear().domain([-.03,1.05]).range([e.chart_height-40,e.chart_left]),t.xAxis=d3.axisBottom(t.xScale).tickSize(6,0,0),t.yAxis=d3.axisLeft(t.yScale).tickFormat(y).tickSize(6,0,0),v=t.xAxis,m=t.yAxis,t.svg.append("g").style("stroke-width",n.axis_stroke_width).style("fill","none").style("stroke",n.axis_color).attr("class","survival-curve-x-axis-class").style("shape-rendering","crispEdges").attr("transform","translate(0, "+(e.chart_height-40)+")").call(v),t.svg.append("g").style("stroke-width",n.axis_stroke_width).style("fill","none").style("stroke",n.axis_color).style("shape-rendering","crispEdges").attr("transform","translate(0, "+e.chart_left+")").call(v.ticks(0)),t.svg.append("g").style("stroke-width",n.axis_stroke_width).style("fill","none").style("stroke",n.axis_color).attr("class","survival-curve-y-axis-class").style("shape-rendering","crispEdges").attr("transform","translate("+e.chart_left+", 0)").call(m),t.svg.append("g").style("stroke-width",n.axis_stroke_width).style("fill","none").style("stroke",n.axis_color).style("shape-rendering","crispEdges").attr("transform","translate("+(e.chart_width-1)+", 0)").call(m.ticks(0)),t.svg.selectAll("text").style("font-family","sans-serif").style("font-size","11px").style("stroke-width",.5).style("stroke","black").style("fill","black"),f=i.xTitle,h=i.yTitle,t.svg.append("text").attr("class","label").attr("x",n.axisX_title_pos_x).attr("y",n.axisX_title_pos_y).style("text-anchor","middle").style("font-size","11px").style("font-weight","bold").text(f),t.svg.append("text").attr("class","label").attr("transform","rotate(-90)").attr("x",n.axisY_title_pos_x).attr("y",n.axisY_title_pos_y).style("text-anchor","middle").style("font-size","11px").style("font-weight","bold").text(h),$.each(r,function(t,e){d(r,e,t)}),g=r,$("#"+a.headerDivId).append("<button id='"+a.curveDivId+"_svg_download' style='font-size:12px;'>SVG</button>"),$("#"+a.headerDivId).append("<button id='"+a.curveDivId+"_pdf_download' style='font-size:12px;'>PDF</button>"),$("#"+a.headerDivId).append("<button id='"+a.curveDivId+"_data_download' style='font-size:12px;'>Data</button>"),$("#"+a.curveDivId+"_svg_download").click(function(){var t=new XMLSerializer,e=cbio.download.addSvgHeader(t.serializeToString($("#"+a.curveDivId+" svg")[0]));cbio.download.clientSideDownload([e],"survival_study.svg","application/svg+xml")}),$("#"+a.curveDivId+"_pdf_download").click(function(){cbio.download.initDownload($("#"+a.curveDivId+" svg")[0],{filename:"survival_study.pdf",contentType:"application/pdf",servletName:"svgtopdf.do"})}),$("#"+a.curveDivId+"_data_download").click(function(){var t="",e="",i=this.id;-1!==i.indexOf("os")?(t+="Overall Survival Kaplan-Meier Estimate\n",e="os_survival_data.txt"):-1!==i.indexOf("dfs")&&(t+="Disease Free Survival Kaplan-Meier Estimate\n",e="dfs_survival_data.txt"),_.each(g,function(e){var n="\n"+e.settings.legend+"\n";n+="Case ID\tNumber at Risk\tStatus\tSurvival Rate\tTime (months)\n",_.each(e.data.getData(),function(t){var e="";-1!==i.indexOf("os")?"0"==t.status?e="censored":"1"===t.status&&(e="deceased"):-1!==i.indexOf("dfs")&&("0"==t.status?e="censored":"1"==t.status&&(e="relapsed")),n+=t.case_id+"\t"+t.num_at_risk+"\t"+e+"\t"+t.survival_rate+"\t"+t.time+"\n"}),t+=n}),cbio.download.clientSideDownload([t],e)}),c.settings.include_info_table){var k=[];$.each(r,function(t,e){var i=jQuery.extend(!0,{},e.data.getStats());i.groupName=e.settings.legend,k.push(i)}),p=k,$("#"+a.infoTableDivId).empty(),$.each(p,function(t,e){var n=s[t].line_color,o=$("#exclusivity_survival div").width();$("#"+a.infoTableDivId).append('<tr><td style="width: '+o+'px; text-align:right;"></td><td style="width:'+o+'px; text-align:center;"><b style="color : '+n+';">'+e.groupName+'</b></td></tr><tr><td style="width:'+o+'px; text-align:right;">'+i.infoTableTitles.total_cases+'</td><td style="width:'+o+'px; text-align:center;"><b>'+e.num_cases+'</b></td></tr><tr><td style="width: '+o+'px; text-align:right;">'+i.infoTableTitles.num_of_events_cases+'</td><td style="width: '+o+'px; text-align:center;"><b>'+e.num_of_events_cases+'</b></td></tr><tr><td style="width: '+o+'px; text-align:right;">'+i.infoTableTitles.median+'</td><td style="width: '+o+'px; text-align:center;"><b>'+parseFloat(e.median).toFixed(2)+"</b></td></tr>")})}c.settings.include_pvalue&&u(o.pVal)}},updateView:function(t,i){i&&function(t){if(t)for(var i in t)e[i]=t[i]}(i.settings),t&&p(t.pval)},addCurve:function(t){t.settings.curveId in r?console.log("%c Error: Curve ID exists","color:red"):d([t],t)},removeCurve:function(t){d3.selectAll("#"+t+"-dots").remove(),d3.selectAll("#"+t+"-line").remove(),d3.selectAll("#"+t+"-crossdots").remove(),delete r[t]}}},SurvivalCurveProxy=function(){var t={case_id:"",time:"",status:"",num_at_risk:-1,survival_rate:0},e=[],i={pVal:0,num_cases:0,num_of_events_cases:0,median:0},n={},a="",o=[];function r(){a.calc(e);var t=jQuery.extend(!0,{},i);0!==e.length?t.num_cases=e.length:t.num_cases="NA",t.num_of_events_cases=function(t){if(0!==t.length){var e=0;for(var i in t)"1"==t[i].status&&(e+=1);return e}return"NA"}(e),t.median=function(t){var e=0;if(0!==t.length){for(var i in t)if(t[i].survival_rate<=.5){e=parseFloat(t[i].time);break}return 0==e?"NA":e}return"NA"}(e),n=t}return{init:function(i,n,l,s){o=n,a=l,s,function(i){var n={};i.forEach(function(t){var e=Object.keys(t)[0];n[e]=t[e]}),i=n;var a=0;for(var r in i)if(i.hasOwnProperty(r)&&""!==i[r]&&-1!==o.indexOf(r)){var l=jQuery.extend(!0,{},t);l.case_id=i[r].case_id,l.time=i[r].months,l.status=i[r].status,"NA"!==l.time&&"NA"!==l.status&&void 0!==l.status&&void 0!==l.status&&(e.push(l),a+=1)}cbio.util.sortByAttribute(e,"time");for(var s in e)e[s].num_at_risk=a,a+=-1}(i),0===e.length||0!==e.length&&r()},getData:function(){return e},getStats:function(){return n}}},SurvivalCurveView=function(t){var e=t,i="",n="",a=[],o=[],r=[],l=function(t){e.vals.pVal=t,(new SurvivalCurve).init(r,e)};return{getResultInit:function(t,e){i=new KmEstimator,n=new LogRankTest(SurvivalCurveBroilerPlate.pvalueSettings.url);for(var s in t)"altered"===t[s]?a.push(s):"unaltered"===t[s]&&o.push(s);var c=new SurvivalCurveProxy,u=new SurvivalCurveProxy;c.init(e,a,i,n),u.init(e,o,i,n);var d=jQuery.extend(!0,{},SurvivalCurveBroilerPlate.subGroupSettings);d.line_color=SurvivalCurveBroilerPlate.subGroupSettings.line_color.low,d.mouseover_color=SurvivalCurveBroilerPlate.subGroupSettings.line_color.low,d.legend=SurvivalCurveBroilerPlate.subGroupSettings.legend.low;var p=jQuery.extend(!0,{},SurvivalCurveBroilerPlate.subGroupSettings);p.line_color=SurvivalCurveBroilerPlate.subGroupSettings.line_color.high,p.mouseover_color=SurvivalCurveBroilerPlate.subGroupSettings.line_color.high,p.legend=SurvivalCurveBroilerPlate.subGroupSettings.legend.high;var g={},f={};g.data=c,g.settings=p,f.data=u,f.settings=d,r=[g,f],n.calc(r[0].data.getData(),r[1].data.getData(),l)},pValCallBackFunc:l}},SurvivalTab={init:function(t,e){var i=jQuery.extend(!0,{},SurvivalCurveBroilerPlate),n=jQuery.extend(!0,{},SurvivalCurveBroilerPlate);i.text.xTitle="Months Survival",i.text.yTitle="Surviving",i.text.qTips.estimation="Survival estimate",i.text.qTips.censoredEvent="Time of last observation",i.text.qTips.failureEvent="Time of death",i.text.qTips.id="Patient ID",i.settings.include_info_table=!0,i.divs.curveDivId="os_survival_curve",i.divs.headerDivId="os_header",i.divs.infoTableDivId="os_stat_table",i.text.infoTableTitles.total_cases="#total cases",i.text.infoTableTitles.num_of_events_cases="#cases deceased",i.text.infoTableTitles.median="median months survival",i.qtipFunc=cbio.util.getLinkToPatientView,n.text.xTitle="Months Disease Free",n.text.yTitle="Disease Free",n.text.qTips.estimation="Disease free estimate",n.text.qTips.censoredEvent="Time of last observation",n.text.qTips.failureEvent="Time of relapse",n.text.qTips.id="Patient ID",n.settings.include_info_table=!0,n.divs.curveDivId="dfs_survival_curve",n.divs.headerDivId="dfs_header",n.divs.infoTableDivId="dfs_stat_table",n.text.infoTableTitles.total_cases="#total cases",n.text.infoTableTitles.num_of_events_cases="#cases relapsed",n.text.infoTableTitles.median="median months disease free",n.qtipFunc=cbio.util.getLinkToPatientView,new SurvivalCurveView(i).getResultInit(t,e.os),new SurvivalCurveView(n).getResultInit(t,e.dfs)}};function dependencies(){"use strict";var t={version:{}};return t.version.d3v4=function(){if(!d3)throw new Error("D3JS is not found");return 0!==d3.version.indexOf("3")},t}function dom(){"use strict";var t={};return t.get=function(t){if("object"==typeof t)return t;var e=t.removeSymbol(),i=null;return bio.iteration.loop(["#","."],function(t){var n=t+e,a=document.querySelector(n);a&&(i=a)}),i},t.remove=function(t,e){if(bio.objects.getType(t).indexOf("HTML")<0)throw new Error("Not a dom element");bio.iteration.loop(e,function(e){t.removeChild(e)})},t.removeAll=function(t){if(bio.objects.getType(t).indexOf("HTML")<0)throw new Error("Not a dom element");for(;t.firstChild;)t.removeChild(t.firstChild)},t.siblings=function(t){for(var e=[],i=t.length-1;i>=0;i--)e.push(t[i]);return e},function(){return t}}function iteration(){"use strict";var t={};return t.loop=function(t,e){if("object"!=typeof t)throw new Error("This is not Object or Array");if("Array"===bio.objects.getType(t))for(var i=0,n=t.length;i<n;i++)e.call(this,t[i],i);else for(var a in t)e.call(this,a,t[a])},Array.prototype.fill=function(t,e){for(var i=0;i<t;i++)this.push(e);return this},t}function math(){"use strict";var t={};return t.medianIndex=function(t){var e=t.length;return e%2==1?(e+1)/2:e/2},t.median=function(e){var i=bio.objects.clone(e);return i.sort(function(t,e){return t>e?1:-1})[t.medianIndex(i)]},t.min=function(t,e){return arguments.length<2?Math.min.apply(null,t):Math.min.call(null,t,e)},t.max=function(t,e){return arguments.length<2?Math.max.apply(null,t):Math.max.call(null,t,e)},t.random=function(t,e){return t=t||0,e=e||1,Math.floor(Math.random()*e)+t},t}function objects(){"use strict";var t={};return t.getType=function(t){var e=Object.prototype.toString.call(t);return e.substring(e.indexOf(" ")+1,e.indexOf("]"))},t.clone=function(e){if("object"!=typeof e)return e;if("Array"===t.getType(e))return(new Array).concat(e);var i={};return bio.iteration.loop(e,function(n,a){e.hasOwnProperty(n)&&(i[n]=t.clone(e[n]))}),i},t.getKey=function(t,e){return Object.keys(t)[Object.values(t).indexOf(e)]},t}function strings(){"use strict";String.prototype.matchAll=function(t){for(var e,i=[];e=t.exec(this);)i.push(e[0]);return i},String.prototype.pronoun=function(){return this[0].toUpperCase()+this.substring(1).toLowerCase()},String.prototype.removeWhiteSpace=function(){return this.replace(/\s/gi,"")},String.prototype.removeSymbol=function(){return this.replace(/\W/gi,"")},String.prototype.replaceAt=function(t,e){return this.substring(0,t)+e+this.substring(t+1)},String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"ig"),e)}}function axises(){"use strict";var t={axises:{}};function e(t,e){var i=[e.top||0,e.left||0];return{group:bio.rendering().addGroup(e.element,i[0],i[1],t+"-axis"),position:i,margin:bio.sizing.setMargin(e.margin),scale:bio.scales().get(e.domain,e.range)}}function i(e,i,n){var a=t.byD3v(e.scale,n,i);return i.tickValues,i.exclude?function(t,e){if("string"!=typeof e)throw new Error("2nd Parameter type is not a string");return e?(t.selectAll(e).remove(),t):t}(e.group.call(a),i.exclude):e.group.call(a)}return t.byD3v=function(t,e,i){var n=(bio.dependencies.version.d3v4()?d3["axis"+e.pronoun()](t):d3.svg.axis().scale(t).orient(e)).ticks(5);return i&&i.tickValues?n.tickValues(i.tickValues):i&&i.ticks&&n.ticks(i.ticks),n},t.top=function(t){return i(e("top",t),t,"top")},t.left=function(t){return i(e("left",t),t,"left")},t.bottom=function(t){return i(e("bottom",t),t,"bottom")},t.right=function(t){return i(e("right",t),t,"right")},function(){return t}}function bar(){"use strict";var t={};function e(t,e,i,n){return"left"===n||"top"===n?[e,t-i]:[t-i,e]}return function(i,n){t=bio.objects.clone(n||{}),(t=bio.sizing.chart.default(t,i)).copyX=[].concat(i.xaxis),t.copyY=[].concat(i.yaxis),t.startTo=i.startTo||["top","left"],t.rangeX=e(t.width,t.margin.left,t.margin.right,t.startTo[1]),t.rangeY=e(t.height,t.margin.top,t.margin.bottom,t.startTo[0]),t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.group=bio.rendering().addGroup(i.element,0,0,"bar"),t.opts=bio.objects.clone(i),t.opts.id=t.id+"_bar_rect",t.opts.element=t.group.selectAll("."+t.id+"_bar_rect"),bio.rectangle(t.opts,t)}}function circle(){"use strict";return function(t,e){e=e||{},bio.rendering().circle({element:t.element,data:t.data||null,attr:t.attr?{id:function(i,n){return t.attr.id?"function"!=typeof t.attr.id?(t.id||e.id||t.element.attr("id"))+"_circle":t.attr.id.call(this,i,n,e):(t.id||e.id||t.element.attr("id"))+"_circle"},cx:function(i,n){return t.attr.cx?"function"!=typeof t.attr.cx?t.attr.cx:t.attr.cx.call(this,i,n,e):0},cy:function(i,n){return t.attr.cy?"function"!=typeof t.attr.cy?t.attr.cy:t.attr.cy.call(this,i,n,e):0},r:function(i,n){return t.attr.r?"function"!=typeof t.attr.r?t.attr.r:t.attr.r.call(this,i,n,e):0}}:null,style:t.style?{fill:function(i,n){return t.style.fill?"function"!=typeof t.style.fill?t.style.fill:t.style.fill.call(this,i,n,e):"#000000"},"fill-opacity":function(i,n){return t.style.fillOpacity?"function"!=typeof t.style.fillOpacity?t.style.fillOpacity:t.style.fillOpacity.call(this,i,n,e):1},stroke:function(i,n){return t.style.stroke?"function"!=typeof t.style.stroke?t.style.stroke:t.style.stroke.call(this,i,n,e):"none"},"stroke-width":function(i,n){return t.style.strokeWidth?"function"!=typeof t.style.strokeWidth?t.style.strokeWidth:t.style.strokeWidth.call(this,i,n,e):"0px"},filter:function(i,n){return!!t.style.filter&&("function"!=typeof t.style.filter?t.style.filter:t.style.filter.call(this,i,n,e))},cursor:function(i,n){return!!t.style.cursor&&("function"!=typeof t.style.cursor?t.style.cursor:t.style.cursor.call(this,i,n,e))}}:null,on:t.on?{click:function(i,n){t.on.click&&t.on.click.call(this,i,n,e)},mouseover:function(i,n){t.on.mouseover&&t.on.mouseover.call(this,i,n,e)},mouseout:function(i,n){t.on.mouseout&&t.on.mouseout.call(this,i,n,e)}}:null})}}function divisionLine(){"use strict";var t={};return function(e,i){t=bio.objects.clone(i||{}),(t=bio.sizing.chart.default(t,e)).position={now:{},init:{}},t.isMarker=void 0===e.isMarker||e.isMarker,e.pathElement="Array"!==bio.objects.getType(e.pathElement)?[e.pathElement]:e.pathElement,t.division_data=e.data,t.division_info=e.info||[{additional:0,color:"#000000",direction:null,text:"Low",textWidth:10},{additional:0,color:"#FFFFFF",direction:null,text:"High",textWidth:10}],bio.iteration.loop(t.division_info,function(t){t.textWidth=bio.drawing().textSize.width(t.text.replace(" ","a"),e.style.fontSize||"10px")}),t.axis=[].concat(e.axis),t.range=[t.margin.left,t.width-t.margin.right],t.scale=bio.scales().get(t.axis,t.range),t.invert=bio.scales().invert(t.scale),i.data.bar?e.idxes[0]!==e.idxes[1]&&e.idxes[1]!==e.idxes[2]&&e.idxes[0]!==e.idxes[1]!==e.idxes[2]?bio.iteration.loop(i.data.bar,function(i,n){i.value===e.idxes[0]?t.division_info[0].start=t.scale(i.x):i.value===e.idxes[1]?(t.division_info[0].end=t.scale(i.x),t.division_info[1].start=t.scale(i.x)):i.value===e.idxes[2]&&(t.division_info[1].end=t.scale(i.x))}):(e.idxes[0]===e.idxes[1]===e.idxes[2]&&(t.division_info[0].start=t.scale(i.data.bar[0].x),t.division_info[0].end=t.scale(i.data.bar[i.data.bar.length%2==1?(i.data.bar.length+1)/2:i.data.bar.length/2].x),t.division_info[1].start=t.scale(i.data.bar[i.data.bar.length%2==1?(i.data.bar.length+1)/2:i.data.bar.length/2].x),t.division_info[1].end=t.scale(i.data.bar[i.data.bar.length-1].x)),e.idxes[0]===e.idxes[1]!==e.idxes[2]&&(t.division_info[0].start=t.scale(i.data.bar[0].x),t.division_info[0].end=t.scale(i.data.bar[i.data.bar.length%2==1?(i.data.bar.length+1)/2:i.data.bar.length/2].x),t.division_info[1].start=t.scale(i.data.bar[i.data.bar.length%2==1?(i.data.bar.length+1)/2:i.data.bar.length/2].x)),e.idxes[1]===e.idxes[2]!==e.idxes[0]&&(t.division_info[0].end=t.scale(i.data.bar[i.data.bar.length%2==1?(i.data.bar.length+1)/2:i.data.bar.length/2].x),t.division_info[1].start=t.scale(i.data.bar[i.data.bar.length%2==1?(i.data.bar.length+1)/2:i.data.bar.length/2].x),t.division_info[1].end=t.scale(i.data.bar[i.data.bar.length-1].x))):t.now.geneset&&(t.division_info[0].start=t.scale(t.axis[0]),t.division_info[0].end=t.scale(e.idxes),t.division_info[1].start=t.scale(e.idxes),t.division_info[1].end=t.scale(t.axis.length-1)),t.shapeGroup=bio.rendering().addGroup(e.element,0,0,"division-shape"),t.textGroup=bio.rendering().addGroup(e.element,0,0,"division-text"),t.opts={text:bio.objects.clone(e),shape:bio.objects.clone(e)},t.opts.text.id=t.id+"_division_text",t.opts.text.data=t.division_info,t.opts.text.element=t.textGroup.selectAll("#"+t.id+"_division_text"),t.opts.shape.id=t.id+"_division_shape",t.opts.shape.data=t.division_info,t.opts.shape.element=t.shapeGroup.selectAll("#"+t.id+"_division_shape"),bio.text(t.opts.text,t),bio.rectangle(t.opts.shape,t),bio.iteration.loop(e.pathElement,function(i,n){var a="shape_"+n,o="path_"+n,r=bio.objects.clone(t.division_info[n]),l=bio.objects.clone(t.division_info[n]),s=[r,l];r.path_x=t.division_info[0].end,l.path_x=t.division_info[0].end,r.path_y=0===n?10:0,l.path_y=0===n?i.attr("height"):i.attr("height")-18,t.opts[o]=bio.objects.clone(e),t.opts[o].id=t.id+"_division_path_"+n,t.opts[o].data=s,t.opts[o].element=bio.rendering().addGroup(i,0,0,"division-path-"+n),t.opts[a]=bio.objects.clone(e),t.opts[a].id=t.id+"_division_shape_"+n,t.opts[a].data=[s[n]],t.opts[a].element=bio.rendering().addGroup(i,0,0,"division-shape-"+n).selectAll("#"+t.id+"_division_shape_"+n),t.isMarker&&bio.triangle({element:t.opts[a].element,data:t.opts[a].data,attr:t.opts[a].attr,style:t.opts[a].style,call:t.opts[a].call},t),bio.path({element:t.opts[o].element,data:t.opts[o].data,attr:t.opts[o].attr,style:{stroke:"#333333",strokeWidth:"0.5px"}},t)})}}function drawing(){"use strict";var t={textSize:{}};function e(t,e,i){var n=document.createElement("span"),a=document.createElement("div"),o=document.createElement("div");"width"===t?i=i.split(" "):e=e.split(" "),o.id="get_text_"+t,n.style.fontSize="width"===t?i[0]:e[0],n.style.fontWeight="width"===t?i[1]:e[1],n.innerHTML="width"===t?e:"Hg",a.style.display="inline-block",a.style.width="1px",a.style.height="0px",o.appendChild(n),o.appendChild(a),document.body.appendChild(o);try{var r=n.getBoundingClientRect()[t].toFixed()}finally{document.body.removeChild(document.getElementById("get_text_"+t))}return parseFloat(r)}return t.textSize.width=function(t,i){return e("width",t,i)},t.mostWidth=function(e,i){var n=[];return bio.iteration.loop(e,function(e){n.push({text:e,value:t.textSize.width(e,i)})}),n.sort(function(t,e){return t.value<e.value?1:-1})[0]},t.textSize.height=function(t){return e("height",t)},t.fitText=function(e,i,n,a){for(var o=10,r=o+"px "+(a||"normal");t.textSize.height(r)<n&&t.textSize.width(e,r)<i;)r=(o+=1)+"px "+a;return o-1+"px"},t.textOverflow=function(e,i,n,a){var o="";return a=a||5,t.textSize.width(e,i)<n-a?e:(bio.iteration.loop(e.split(""),function(e){t.textSize.width(o+=e,i)>n-a&&(o=o.substring(0,o.length-2))}),o)},t.getParentSVG=function(e){return"svg"===e.parentElement.tagName?e.parentElement:t.getParentSVG(e.parentElement)},t.nthChild=function(t,e){return d3.select(t).node().children[e]},t.findDom=function(t,e){if(t.children<1)throw new Error("There are no any child elements");var i=Array.prototype.slice.call(t.children),n=null;return bio.iteration.loop(i,function(t){t.tagName!==e.toUpperCase()&&"."+t.className!==e&&"#"+t.id!==e||(n=t)}),n},t.slideDown=function(t){var e=t.style.height?parseFloat(t.style.height):t.getBoundingClientRect().height,i=0;t.style.height="0px";var n=setInterval(function(){i+=1,t.style.height=i+"px",i===e&&clearInterval(n)},5)},t.slideUp=function(t){var e=t.style.height?parseFloat(t.style.height):t.getBoundingClientRect().height,i=parseFloat(t.style.height),n=setInterval(function(){i-=1,t.style.height=i+"px",0===i&&(clearInterval(n),t.style.height=e+"px",t.style.display="none")},5)},t.importSVG=function(t,e){var i=null;return d3.xml(t).mimeType("image/svg+xml").get(function(t,n){if(t)throw t;return e?e(n):i=n}),i},t.nodes=function(t){var e=[];return t.each(function(t){e.push(this)}),e},function(){return t}}function heat(){"use strict";var t={};function e(e){return bio.iteration.loop(e,function(e){var i=e.x+e.y,n=bio.landscapeConfig().byCase(e.value);t.value[i]?bio.boilerPlate.variantInfo[t.value[i][n][0]]>bio.boilerPlate.variantInfo[e.value]?t.value[i][n].unshift(e.value):t.value[i][n].push(e.value):(t.value[i]={cnv:[],var:[],x:e.x,y:e.y},t.value[i][n].push(e.value))}),i=t.value,bio.iteration.loop(i,function(e,i){bio.iteration.loop(t.mutationType,function(e){i[e][0]&&t.duplicate.push({x:i.x,y:i.y,value:i[e][0],info:i[e].splice(1)})})}),t.duplicate;var i}return function(i,n){t=bio.objects.clone(n||{}),(t=bio.sizing.chart.default(t,i)).copyX=[].concat(i.xaxis),t.copyY=[].concat(i.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.margin.top,t.height-t.margin.bottom],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.group=bio.rendering().addGroup(i.element,0,0,"heatmap"),t.opts=bio.objects.clone(i),t.opts.data=t.duplicate?e(t.opts.data):t.opts.data,t.opts.id=t.id+"_heatmap_rect",t.opts.element=t.group.selectAll("."+t.id+"_heatmap_rect"),bio.rectangle(t.opts,t)}}function legend(){"use strict";var t={};return function(e,i){t=bio.objects.clone(i||{}),(t=bio.sizing.chart.default(t,e)).legendData=e.data,t.padding=e.padding||5,t.fontSize=e.style.font||"10px",t.fontWidth=bio.drawing().mostWidth(t.legendData,t.fontSize),t.fontHeight=bio.drawing().textSize.height(t.fontSize),t.shapeWidth=t.width-(t.margin.left+t.margin.right+t.fontWidth.value),t.shapeGroup=bio.rendering().addGroup(e.element,t.margin.top,t.margin.left,"legend-shape"),t.textGroup=bio.rendering().addGroup(e.element,t.margin.top,t.margin.left,"legend-text"),t.opts={text:bio.objects.clone(e),shape:bio.objects.clone(e)},t.opts.text.id=t.id+"_legend_text",t.opts.text.element=t.textGroup.selectAll("#"+t.id+"_legend_text"),t.opts.shape.id=t.id+"_legend_shape",t.opts.shape.element=t.shapeGroup.selectAll("#"+t.id+"_legend_shape"),e.attr&&e.attr.width?bio.rectangle(t.opts.shape,t):e.attr&&e.attr.r?bio.circle(t.opts.shape,t):e.attr&&e.attr.points&&bio.triangle(t.opts.shape,t),bio.text(t.opts.text,t);var n=e.element.node().parentNode,a=t.textGroup.node().getBoundingClientRect();n.style.height=a.height+t.margin.top+t.padding+"px",n.style.width=t.width-5+"px"}}function needle(){"use strict";var t={};return function(e,i){t=bio.objects.clone(i||{}),(t=bio.sizing.chart.default(t,e)).copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.height-t.margin.bottom,t.margin.top],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.lineGroup=bio.rendering().addGroup(e.element,0,0,"needle-line"),t.shapeGroup=bio.rendering().addGroup(e.element,0,0,"needle-shape"),t.opts={line:bio.objects.clone(e),shape:bio.objects.clone(e)},t.opts.line.element=t.lineGroup,t.opts.shape.data=e.shapeData,t.opts.shape.element=t.shapeGroup.selectAll("#"+t.id+"_needle_shape"),bio.iteration.loop(e.lineData,function(e){t.opts.line.data=e.value,bio.path(t.opts.line,t)}),bio.circle(t.opts.shape,t)}}function network(){"use strict";var t={};function e(e,i,n,a,o){var r=bio.rendering().addGroup(t.element,0,0,e);bio.rectangle({id:e,element:r,attr:{rx:2,ry:2,y:i,x:n,width:a,height:o},style:{strokeWidth:2,fill:"#FFFFFF",stroke:"#333333",filter:'url("#drop_shadow")',fillOpacity:function(t){return"compound"===e?1:.3}}},t)}return function(i,n){t=bio.objects.clone(n||{}),(t=bio.sizing.chart.default(t,i)).bcr=t.element.node().getBoundingClientRect(),t.network_data=i.data,t.arrow_width=5;var a=null,o=[],r=[];bio.iteration.loop(t.network_data,function(t){"compound"===t.type?a=t:"node"===t.type?o.push(t):r.push(t)}),bio.iteration.loop(o,function(t){a.members.indexOf(t.text)>-1&&(t.group=1),t.radius=(bio.drawing().textSize.width(t.text,"12px")+10)/2});var l,s,c,u,d={};bio.iteration.loop(r,function(t){d[t.target]=!0}),bio.iteration.loop(r,function(t){t.isOne=Object.keys(d).length}),bio.rendering().dropShadow(t.element.append("svg:defs"),1,-.1,1),bio.rendering().marker({id:"id",data:r,color:"linecolor",width:t.arrow_width,height:t.arrow_width,svg:t.element.append("svg:defs")}),e("infomation",.05*t.height,10,t.width-20,.1*t.height),e("compound",.15*t.height,10,t.width-20,.54*t.height),l=a.text,s=.105*t.height,c=t.width/2-bio.drawing().textSize.width(a.text,"16px")/2,u=bio.rendering().addGroup(t.element,0,0,"network-info"),bio.text({element:u,text:l,id:"network_info",attr:{x:c,y:s},style:{fontSize:"16px",fontWeight:"bold"}});for(var p,g,f,h,v=bio.dependencies.version.d3v4()?(f=o,h=r,d3.forceSimulation(f).force("charge",d3.forceManyBody().strength(function(t,e){return t.group,-300-t.radius/100*600})).force("link",d3.forceLink(h).id(function(t){return t.text}).distance(function(t){return t.source.group&&t.target.group?90-t.source.radius/100*90:1===t.isOne?10+t.source.radius/100*1050:190-t.source.radius/100*190})).force("x",d3.forceX(function(e){return e.group?t.width/2.1:t.width-t.width*(e.index/10)})).force("y",d3.forceY(function(e){return e.group?t.height/2.5:.95*t.height}))):(p=o,g=r,d3.layout.force().nodes(p).links(g).charge(-300).linkDistance(150)),m=0,x=Math.ceil(Math.log(v.alphaMin())/Math.log(1-v.alphaDecay()));m<x;++m)v.tick();var b=bio.rendering().addGroup(t.element,0,0,"link-layer"),y=bio.rendering().addGroup(t.element,0,0,"node-layer"),_=b.selectAll(".link").data(r).enter().append("svg:path").attr("class","link").attr("marker-end",function(t){return'url("#marker_'+t.id+'")'}).style("fill","#FFFFFF").style("fill-opacity",.1).style("stroke",function(t){return t.linecolor}).style("stroke-width",1.5).style("stroke-dasharray",function(t){return"Dashed"===t.style?"3, 3":"none"}),w=y.selectAll(".node").data(o).enter().append("g").attr("class"," node");w.append("circle").attr("r",function(t){return(bio.drawing().textSize.width(t.text,"12px")+10)/2}).attr("fill",function(t){return t.bgcolor}).attr("stroke","#333333").attr("stroke-width",1),w.append("text").attr("dx",0).attr("dy",5).attr("text-anchor","middle").style("font-size","12px").style("font-weight","bold").text(function(t){return t.text});v.on("tick",function(){w.attr("transform",function(e,i){e.x=e.group?e.x:t.width/2.5,e.y=e.group?e.y:.78*t.height}),_.attr("d",function(e){var i=e.target.x-e.source.x,n=e.target.y-e.source.y,a=Math.sqrt(i*i+n*n),o=i*(e.target.radius+t.arrow_width)/a,r=n*(e.target.radius+t.arrow_width)/a;return"M"+e.source.x+","+e.source.y+"A"+a+","+a+" 0 0,1 "+(e.target.x-o)+","+(e.target.y-r)}),w.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})})}}function path(){"use strict";return function(t,e){e=e||{},bio.rendering().line({element:t.element,attr:t.attr?{id:function(i,n){return t.attr.id?"function"!=typeof t.attr.id?(t.id||e.id||t.element.attr("id"))+"_path":t.attr.id.call(this,i,n,e):(t.id||e.id||t.element.attr("id"))+"_path"},d:function(i,n){return function(t,e){var i=this;return(bio.dependencies.version.d3v4()?d3.line():d3.svg.line()).x(function(n,a){return t.attr.x?"function"!=typeof t.attr.x?t.attr.x:t.attr.x.call(i,n,a,e):0}).y(function(n,a){return t.attr.y?"function"!=typeof t.attr.y?t.attr.y:t.attr.y.call(i,n,a,e):0})}.call(this,t,e)(t.data)}}:null,style:t.style?{fill:function(i,n){return t.style.fill?"function"!=typeof t.style.fill?t.style.fill:t.style.fill.call(this,i,n,e):"#A8A8A8"},stroke:function(i,n){return t.style.stroke?"function"!=typeof t.style.stroke?t.style.stroke:t.style.stroke.call(this,i,n,e):"#A8A8A8"},"stroke-width":function(i,n){return t.style.strokeWidth?"function"!=typeof t.style.strokeWidth?t.style.strokeWidth:t.style.strokeWidth.call(this,i,n,e):"1px"},"stroke-dasharray":function(i,n){return t.style.strokeDash?"function"!=typeof t.style.strokeDash?t.style.strokeDash:t.style.strokeDash.call(this,i,n,e):"none"}}:null})}}function rectangle(){"use strict";return function(t,e){return e=e||{},bio.rendering().rect({element:t.element,data:t.data||null,attr:t.attr?{id:function(i,n){return t.attr.id?"function"!=typeof t.attr.id?(t.id||e.id||t.element.attr("id"))+"_rect":t.attr.id.call(this,i,n,e):(t.id||e.id||t.element.attr("id"))+"_rect"},x:function(i,n){return t.attr.x?"function"!=typeof t.attr.x?t.attr.x:t.attr.x.call(this,i,n,e):0},y:function(i,n){return t.attr.y?"function"!=typeof t.attr.y?t.attr.y:t.attr.y.call(this,i,n,e):0},rx:function(i,n){return t.attr.rx?"function"!=typeof t.attr.rx?t.attr.rx:t.attr.rx.call(this,i,n,e):0},ry:function(i,n){return t.attr.ry?"function"!=typeof t.attr.ry?t.attr.ry:t.attr.ry.call(this,i,n,e):0},width:function(i,n){return t.attr.width?"function"!=typeof t.attr.width?t.attr.width:t.attr.width.call(this,i,n,e)<0?Math.abs(t.attr.width.call(this,i,n,e)):t.attr.width.call(this,i,n,e):1},height:function(i,n){return t.attr.height?"function"!=typeof t.attr.height?t.attr.height:t.attr.height.call(this,i,n,e)<0?Math.abs(t.attr.height.call(this,i,n,e)):t.attr.height.call(this,i,n,e):1}}:null,style:t.style?{fill:function(i,n){return t.style.fill?"function"!=typeof t.style.fill?t.style.fill:t.style.fill.call(this,i,n,e):"#000000"},"fill-opacity":function(i,n){return t.style.fillOpacity?"function"!=typeof t.style.fillOpacity?t.style.fillOpacity:t.style.fillOpacity.call(this,i,n,e):"none"},stroke:function(i,n){return t.style.stroke?"function"!=typeof t.style.stroke?t.style.stroke:t.style.stroke.call(this,i,n,e):"none"},"stroke-width":function(i,n){return t.style.strokeWidth?"function"!=typeof t.style.strokeWidth?t.style.strokeWidth:t.style.strokeWidth.call(this,i,n,e):"0px"},filter:function(i,n){return!!t.style.filter&&("function"!=typeof t.style.filter?t.style.filter:t.style.filter.call(this,i,n,e))},cursor:function(i,n){return!!t.style.cursor&&("function"!=typeof t.style.cursor?t.style.cursor:t.style.cursor.call(this,i,n,e))}}:null,on:t.on?{click:function(i,n){t.on.click&&t.on.click.call(this,i,n,e)},mouseover:function(i,n){t.on.mouseover&&t.on.mouseover.call(this,i,n,e)},mouseout:function(i,n){t.on.mouseout&&t.on.mouseout.call(this,i,n,e)}}:null,call:t.call?{start:function(i,n){t.call.start&&t.call.start.call(this,i,n,e)},drag:function(i,n){t.call.drag&&t.call.drag.call(this,i,n,e)},end:function(i,n){t.call.end&&t.call.end.call(this,i,n,e)}}:null})}}function rendering(){"use strict";var t={};function e(t,e){if(!e)return!1;bio.iteration.loop(e,function(e,i){t.attr(e,i)})}function i(t,e){if(!e)return!1;bio.iteration.loop(e,function(e,i){t.style(e,i)})}function n(t){if(!this.element)throw new Error("Not defined SVG Element");var n,a,o=this.data?this.element.data(this.data).enter().append(t):this.element.append(t);return this.text&&(n=o,a=this.text,n.text(a)),e(o,this.attr),i(o,this.style),function(t,e){if(!e)return!1;bio.iteration.loop(e,function(e,i){t.on(e,i)})}(o,this.on),function(t,e){if(!e)return!1;var i=bio.dependencies.version.d3v4()?d3.drag():d3.behavior.drag().origin(Object);bio.iteration.loop(e,function(t,e){t=bio.dependencies.version.d3v4()?t:"drag"!==t?"drag"+t:t,i.on(t,e)}),t.call(i)}(o,this.call),o}return t.createSVG=function(t,e,i){var n=bio.dom().get(t),a=n.id?"#"+n.id:"."+n.className,o=e||parseFloat(n.style.width),r=i||parseFloat(n.style.height);return d3.select(a).append("svg").attr("id",n.id+"_svg").attr("width",o).attr("height",r)},t.addGroup=function(t,e,i,n){t=bio.dependencies.version.d3v4()?t:t[0][0],t="Array"===bio.objects.getType(t)||"Object"===bio.objects.getType(t)?t:d3.select(t),n=n||"";var a=t.attr("id"),o=d3.selectAll("."+a+"."+n+"-g-tag");return(o.node()?o:t).append("g").attr("class",a+" "+n+"-g-tag").attr("transform","translate("+i+", "+e+")")},t.rect=function(t){return n.call(t,"rect")},t.circle=function(t){return n.call(t,"circle")},t.triangle=function(t){return n.call(t,"polygon")},t.triangleStr=function(t,e,i,n){var a,o,r,l,s="left"===n||"bottom"===n?-1:1;return"left"===n||"right"===n?(o=i/2*-1,r=a=i*s,l=i/2):(a=i/2*-1,r=i/2,l=o=i*s),t+","+e+" "+(t+a)+","+(e+o)+" "+(t+r)+","+(e+l)+" "+t+","+e},t.text=function(t){return n.call(t,"text")},t.line=function(t){var n=t.element.append("path");return e(n,t.attr),i(n,t.style),n},t.dropShadow=function(t,e,i,n){var a=t.append("defs").append("filter").attr("id","drop_shadow");a.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",e||3).attr("result","blur"),a.append("feOffset").attr("in","blur").attr("dx",i||2).attr("dy",n||2).attr("result","offsetBlur");var o=a.append("feMerge");o.append("feMergeNode").attr("in","offsetBlur"),o.append("feMergeNode").attr("in","SourceGraphic")},t.marker=function(t){t.svg.selectAll("marker").data(t.data||[""]).enter().append("svg:marker").attr("id",function(e){return t.id?"marker_"+e[t.id]:"marker"}).attr("viewBox","0 -5 10 10").attr("refX",5).attr("refY",0).attr("markerWidth",t.width||5).attr("markerHeight",t.height||5).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5").attr("fill",function(e){return t.color?e[t.color]:"#333333"})},t.opacity=function(t,e){var i=d3.rgb(t);return i.opacity=e||.3,i},t.translation=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttributeNS(null,"transform",t);var i=e.transform.baseVal.consolidate().matrix;return{scale:[i.a,i.d],translate:[i.e,i.f],rotate:i.b,skew:i.c}},function(){return t}}function scales(){"use strict";var t={};function e(t){return"Number"===bio.objects.getType(t[0])?"linear":"ordinal"}return t.ordinal=function(t,e){return bio.dependencies.version.d3v4()?d3.scaleBand().domain(t).range(e):d3.scale.ordinal().domain(t).rangeBands(e)},t.linear=function(t,e){return bio.dependencies.version.d3v4()?d3.scaleLinear().domain(t).range(e):d3.scale.linear().domain(t).range(e)},t.get=function(i,n){return t[e(i)](i,n)},t.invert=function(t){var i=t.domain(),n=t.range();return("linear"===e(i)?bio.dependencies.version.d3v4()?d3.scaleLinear():d3.scale.linear():bio.dependencies.version.d3v4()?d3.scaleQuantize():d3.scale.quantize()).domain(n).range(i)},t.band=function(t){return bio.dependencies.version.d3v4()?t.bandwidth():t.rangeBand()},function(){return t}}function scatter(){"use strict";var t={};return function(e,i){t=bio.objects.clone(i||{}),(t=bio.sizing.chart.default(t,e)).scatter_data=e.data,t.copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.margin.top,t.height-t.margin.bottom],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.group=bio.rendering().addGroup(e.element,0,0,"scatter"),t.opts=bio.objects.clone(e),t.opts.data=t.scatter_data,t.opts.id=t.id+"_scatter_shape",t.opts.element=t.group.selectAll("#"+t.id+"_scatter_shape"),bio.circle(t.opts,t)}}function survival(){"use strict";var t={};function e(t,e){var i=document.createElement("div");return i.id=t,i}return function(i){return t.survival_data=function(t){var e={os:[],dfs:[]},i={os:[],dfs:[]},n={os:[],dfs:[]};function a(t,e,i,n){var a={};a[t]={case_id:t,months:e,status:i},n.push(a)}return bio.iteration.loop(t,function(t){if(t){var o=t.os_days/30,r=t.dfs_days/30;e.os.push(o),e.dfs.push(r),null!=o&&null!=t.os_status&&a(t.participant_id,o,t.os_status,i.os),null!=r&&null!=t.dfs_status&&a(t.participant_id,r,t.dfs_status,i.dfs),a(t.participant_id,o,t.os_status,n.os),a(t.participant_id,r,t.dfs_status,n.dfs)}}),{month:e,pure:i,all:n}}(i.data),function(t,i){document.querySelector(t).innerHTML="";for(var n,a,o,r,l,s,c=document.querySelector(t),u=0,d=i.length;u<d;u++){var p=i[u],g=i[u].toLowerCase();c.appendChild((r=g,l=u,s=void 0,(s=document.createElement("input")).id=r+"_survival",s.name="tabs",s.type="radio",s.checked=0===l,s)),c.appendChild((n=g,a=p,o=void 0,(o=document.createElement("label")).htmlFor=n+"_survival",o.innerHTML=a,o))}for(u=0,d=i.length;u<d;u++){var f=e(i[u].toLowerCase());f.appendChild(e(i[u].toLowerCase()+"_survival_curve")),f.appendChild(e(i[u].toLowerCase()+"_stat_table")),c.appendChild(f)}}(i.element,["OS","DFS"]),i.legends?(SurvivalCurveBroilerPlate.subGroupSettings.legend={low:i.legends.low.text,high:i.legends.high.text},SurvivalCurveBroilerPlate.subGroupSettings.line_color={low:i.legends.low.color,high:i.legends.high.color}):(SurvivalCurveBroilerPlate.subGroupSettings.legend={low:"Low score group",high:"High score group"},SurvivalCurveBroilerPlate.subGroupSettings.line_color={low:"#00AC52",high:"#FF6252"}),SurvivalCurveBroilerPlate.pvalueSettings={url:i.pvalueURL||"http://www.cbioportal.org/calcPval.do"},i.styles&&(SurvivalCurveBroilerPlate.settings={canvas_width:i.styles.size.chartWidth,canvas_height:i.styles.size.chartHeight,chart_width:i.styles.size.chartWidth,chart_height:i.styles.size.chartHeight,chart_left:i.styles.position.chartLeft,chart_top:i.styles.position.chartTop,include_legend:!0,include_pvalue:!0,pval_x:i.styles.position.pvalX,pval_y:i.styles.position.pvalY},SurvivalCurveBroilerPlate.style={axisX_title_pos_x:i.styles.position.axisXtitlePosX,axisX_title_pos_y:i.styles.position.axisXtitlePosY,axisY_title_pos_x:i.styles.position.axisYtitlePosX,axisY_title_pos_y:i.styles.position.axisYtitlePosY,pval_font_size:i.styles.pvalFontSize}),SurvivalTab.init(i.division,t.survival_data.pure),t}}function text(){"use strict";return function(t,e){e=e||{},bio.rendering().text({element:t.element,data:t.data||null,attr:t.attr?{id:function(n){return t.attr.id?"function"!=typeof t.attr.id?(t.id||e.id||t.element.attr("id"))+"_text":t.attr.id.call(this,n,i,e):(t.id||e.id||t.element.attr("id"))+"_text"},x:function(i,n){return t.attr.x?"function"!=typeof t.attr.x?t.attr.x:t.attr.x.call(this,i,n,e):0},y:function(i,n){return t.attr.y?"function"!=typeof t.attr.y?t.attr.y:t.attr.y.call(this,i,n,e):0}}:null,style:t.style?{fill:function(i,n){return t.style.fill?"function"!=typeof t.style.fill?t.style.fill:t.style.fill.call(this,i,n,e):"#000000"},"font-size":function(i,n){return t.style.fontSize?"function"!=typeof t.style.fontSize?t.style.fontSize:t.style.fontSize.call(this,i,n,e):"10px"},"font-family":function(i,n){return t.style.fontFamily?"function"!=typeof t.style.fontFamily?t.style.fontFamily:t.style.fontFamily.call(this,i,n,e):"Arial"},"font-weight":function(i,n){return t.style.fontWeight?"function"!=typeof t.style.fontWeight?t.style.fontWeight:t.style.fontWeight.call(this,i,n,e):"normal"},"alignment-baseline":function(i,n){return t.style.alignmentBaseline?"function"!=typeof t.style.alignmentBaseline?t.style.alignmentBaseline:t.style.alignmentBaseline.call(this,i,n,e):"middle"},cursor:function(i,n){return!!t.style.cursor&&("function"!=typeof t.style.cursor?t.style.cursor:t.style.cursor.call(this,i,n,e))},stroke:function(i,n){return!!t.style.stroke&&("function"!=typeof t.style.stroke?t.style.stroke:t.style.stroke.call(this,i,n,e))},"stroke-width":function(i,n){return!!t.style.strokeWidth&&("function"!=typeof t.style.strokeWidth?t.style.strokeWidth:t.style.strokeWidth.call(this,i,n,e))}}:null,on:t.on?{click:function(i,n){t.on.click&&t.on.click.call(this,i,n,e)},mouseover:function(i,n){t.on.mouseover&&t.on.mouseover.call(this,i,n,e)},mouseout:function(i,n){t.on.mouseout&&t.on.mouseout.call(this,i,n,e)}}:null,text:function(i,n){return t.text?"function"!=typeof t.text?t.text:t.text.call(this,i,n,e):""}})}}function triangle(){"use strict";return function(t,e){e=e||{},bio.rendering().triangle({element:t.element,data:t.data||null,attr:t.attr?{id:function(i,n){return t.attr.id?"function"!=typeof t.attr.id?(t.id||e.id||t.element.attr("id"))+"_triangle":t.attr.id.call(this,i,n,e):(t.id||e.id||t.element.attr("id"))+"_triangle"},points:function(i,n){return t.attr.points?"function"!=typeof t.attr.points?t.attr.points:t.attr.points.call(this,i,n,e):0}}:null,style:t.style?{fill:function(i,n){return t.style.fill?"function"!=typeof t.style.fill?t.style.fill:t.style.fill.call(this,i,n,e):"#000000"},stroke:function(i,n){return t.style.stroke?"function"!=typeof t.style.stroke?t.style.stroke:t.style.stroke.call(this,i,n,e):"none"},"stroke-width":function(i,n){return t.style.strokeWidth?"function"!=typeof t.style.strokeWidth?t.style.strokeWidth:t.style.strokeWidth.call(this,i,n,e):"0px"},filter:function(i,n){return!!t.style.filter&&("function"!=typeof t.style.filter?t.style.filter:t.style.filter.call(this,i,n,e))},cursor:function(i,n){return!!t.style.cursor&&("function"!=typeof t.style.cursor?t.style.cursor:t.style.cursor.call(this,i,n,e))}}:null,on:t.on?{click:function(i,n){t.on.click&&t.on.click.call(this,i,n,e)},mouseover:function(i,n){t.on.mouseover&&t.on.mouseover.call(this,i,n,e)},mouseout:function(i,n){t.on.mouseout&&t.on.mouseout.call(this,i,n,e)}}:null,call:t.call?{start:function(i,n){t.call.start&&t.call.start.call(this,i,n,e)},drag:function(i,n){t.call.drag&&t.call.drag.call(this,i,n,e)},end:function(i,n){t.call.end&&t.call.end.call(this,i,n,e)}}:null})}}function clinicalGenerator(){"use strict";var t={},e="#D6E2E3";function i(i){bio.iteration.loop(i,function(i,n){var a=0;bio.iteration.loop(n,function(i,n){var o="#";if("NA"!==i){for(var r=i.length,l=(a=a>r?a-r:a)+3;a<l;a++){var s=a.toString(16);o+=i.charCodeAt(a).toString(16).split("")[1]+s}t[i].color=o}else t[i].color=e})})}function n(e){bio.iteration.loop(e,function(e,i){var n=null;i.indexOf("NA")>-1?(n=i.splice(i.indexOf("NA"),1),bio.iteration.loop(i.sort(function(t,e){return t>e?1:-1}),function(e,i){t[e]||(t[e]={order:i+1})}),t.NA={order:i.length+1},i.push(n[0])):bio.iteration.loop(i.sort(function(t,e){return t>e?1:-1}),function(e,i){t[e]||(t[e]={order:i+1})})})}function a(t,e,i){t[e]?t[e].indexOf(i)<0&&t[e].push(i):t[e]=[i]}function o(t,e){var o,r,l,s;"landscape"===e?(l=t,s={},bio.iteration.loop(l,function(t){bio.iteration.loop(t,function(t){a(s,t.y,t.value)})}),n(s),i(s)):"expression"===e&&(o=t,r={},bio.iteration.loop(o,function(t){bio.iteration.loop(t.value,function(e){a(r,t.key,e)})}),n(r),i(r))}return function(e,i){t={},o(e,i),bio.boilerPlate.clinicalInfo=t}}function loading(){"use strict";var t={};function e(t,e,i){var n,a,o=document.createElement("div"),r=document.createElement("div"),l=(n=[1,2,3,4],a=[],bio.iteration.loop(n,function(t){var e=document.createElement("div");e.className="loading-circle-"+t,a.push(e)}),a),s=document.createElement("span");o.className="loading",o.style.width=e+"px",o.style.height=i+"px",s.className="loading-text",s.innerHTML="Loading";for(var c=0,u=l.length;c<u;c++)r.appendChild(l[c]);return o.appendChild(r),o.appendChild(s),t.appendChild(o),o}function i(i,n,a){if(!n||!a)throw new Error("Please define the width and height");t.loadingElement=document.querySelector(".loading")?document.querySelector(".loading"):e(i,n,a),"none"===t.loadingElement.style.display&&(t.loadingElement.style.display="block")}function n(e,i){$(t.loadingElement).fadeOut("slow")}return function(t,e,a){return{start:i,end:n}}}function modal(){"use strict";var t={};function e(e){var i;t.modal=document.createElement("div"),t.modal.setAttribute("tabindex","-1"),t.modal.setAttribute("role","dialog"),t.modal.setAttribute("aria-labelledby",e),t.dialog=document.createElement("div"),t.dialog.setAttribute("role","document"),t.content=document.createElement("div"),t.header=document.createElement("div"),t.footer=document.createElement("div"),t.title=document.createElement("div"),t.body=document.createElement("div"),t.modal.id=e,t.body.className="modal-body",t.modal.className="modal fade",t.title.className="modal-title",t.dialog.className="modal-dialog",t.footer.className="modal-footer",t.header.className="modal-header",t.content.className="modal-content",t.body.style.height="0px",t.modal.style.display="none",t.header.appendChild(t.title),t.content.appendChild(t.header),t.content.appendChild(t.body),t.footer.appendChild(((i=document.createElement("button")).id="modal_close",i.className="btn btn-default",i.innerHTML="Close",i.setAttribute("type","button"),i.setAttribute("data-dismiss","modal"),i)),t.content.appendChild(t.footer),t.dialog.appendChild(t.content),t.modal.appendChild(t.dialog)}return function(i){e(i.id||"modal"),t.element=i.element,t.element.appendChild(t.modal)}}function selectBox(){"use strict";var t={};return function(e){var i,n,a,o,r,l,s,c,u,d,p,g,f,h,v;(t={}).element=document.querySelector(e.id),t.className=e.className||"",t.margin=bio.sizing.setMargin(e.margin||[0,0,0,0]),t.width=e.width||parseFloat(t.element.style.width),t.height=e.height||parseFloat(t.element.style.height),t.defaultText=e.defaultText||"Select",t.viewName=e.viewName||"viewName",t.fontSize=e.fontSize||"10px",t.items=e.items||[""],t.clickItem=e.clickItem||null,t.frame=(i=t.className,n=document.createElement("div"),a=t.width-2*t.margin.left,o=t.height-2*t.margin.top<40?t.height-2*t.margin.top:40,n.className=i+" drop-menu",n.style.width=a+"px",n.style.height=o+"px",n.style.marginLeft=t.margin.left+"px",n.style.marginTop=t.margin.top+"px",n.style.fontSize=t.fontSize,n),t.defaultText=(r=t.className,l=t.defaultText,s=document.createElement("div"),c=document.createElement("span"),u=document.createElement("i"),s.className=r+" select",s.style.paddingTop=10-t.margin.top+1+"px",s.style.paddingBottom=10-t.margin.top+1+"px",s.style.paddingLeft=10-t.margin.left+1+"px",s.style.paddingRight=10-t.margin.left+1+"px",c.title=l,c.innerHTML=l,u.className="fa fa-chevron-down",s.appendChild(c),s.appendChild(u),s),t.viewer=(d=t.viewName,(p=document.createElement("input")).type="hidden",p.name=d,p),t.addItems=(g=t.items,(f=document.createElement("ul")).className="dropeddown",bio.iteration.loop(g,function(e){var i=document.createElement("li");i.id=e,i.title=e,i.innerHTML=bio.drawing().textOverflow(e,t.fontSize,.8*t.width),f.appendChild(i)}),f),t.element.children.length<1&&(t.frame.appendChild(t.defaultText),t.frame.appendChild(t.viewer),t.frame.appendChild(t.addItems),t.element.appendChild(t.frame),h=t.className,v=t.clickItem,h="."+h,$(h).click(function(t){$(this).attr("tabindex",1).focus(),$(this).toggleClass("active"),$(this).find(".dropeddown").slideToggle(300)}),$(h).focusout(function(){$(this).removeClass("active"),$(this).find(".dropeddown").slideUp(300)}),$(h+" .dropeddown li").click(function(t){return $(this).parents(".drop-menu").find("span").text($(this).text()),$(this).parents(".drop-menu").find("span").attr("title",$(this).attr("id")),$(this).parents(".drop-menu").find("input").attr("value",$(this).attr("id")),!!v&&v($(this).attr("id").toLowerCase())}),document.querySelector(".drop-menu .select").style.lineHeight=t.fontSize)}}function table(){"use strict";var t={cellData:[],cellWidth:[]};function e(t){var e=document.createElement("div");return e.id=t||"",e.className="table-row",e.style.display="table-row",e}function i(t,e,i){var n=document.createElement("div");return n.className="table-cell "+t.removeWhiteSpace(),n.style.padding="5px",n.style.width=e+"px",n.style.height=(i||35)+"px",n.style.lineHeight=(i||25)+"px",n.style.display="table-cell",n.innerHTML=t,n}function n(t){var e,i=document.createElement("div"),n=t.indexOf("<")>-1?t.substring(0,t.indexOf("<")):t;return i.id="temp_width",i.style.fontSize="16px",i.style.fontWeight="bold",i.style.overflow="hidden",i.style.border="1px solid",i.style.whiteSpace="nowrap",i.style.display="table-cell",i.style.textOverflow="ellipse",i.innerHTML=n,document.body.appendChild(i),e=i.getBoundingClientRect().width,document.body.removeChild(document.querySelector("#temp_width")),e+12}return function(a){if(document.querySelector(".table-frame")&&a.element.removeChild(document.querySelector(".table-frame")),!a.columns)throw new Error("Not found Columns");var o,r,l,s,c,u,d,p,g;(t={cellData:[],cellWidth:[]}).element=a.element,t.width=a.width||0,t.height=a.height||0,t.frame=(o=t.width,r=t.height,(l=document.createElement("div")).className="table-frame",l.style.width=o+"px",l.style.height=r+"px",l),function(e,i,a){t.cellWidth.fill(e.length,0),bio.iteration.loop(e,function(e,i){t.cellWidth[i]=n(e)}),bio.iteration.loop(i,function(i,o){var r=[];bio.iteration.loop(e,function(e,l){var s=a(l,o,e,i);t.cellWidth[l]=t.cellWidth[l]>n(s)?t.cellWidth[l]:n(s),r.push(s)}),t.cellData.push(r)});var o=0;bio.iteration.loop(t.cellWidth,function(t){o+=t}),t.frame.style.width=o+20+"px"}(a.heads,a.data,a.columns),t.frame.appendChild((s=a.title,(c=document.createElement("div")).innerHTML=s||"",c.className="table-caption",c.style.display="table-caption",c)),u=t.frame,d=a.heads,p=document.createElement("div"),g=e(),p.className="table-header",bio.iteration.loop(d,function(e,n){g.appendChild(i(e,t.cellWidth[n]))}),p.appendChild(g),u.appendChild(p),function(n,a,o){var r=document.createElement("div");if(r.className="table-contents",r.style.height=o.height+"px",bio.iteration.loop(a,function(n){var a=e();bio.iteration.loop(n,function(e,n){a.appendChild(i(e,t.cellWidth[n]))}),r.appendChild(a)}),o.data.length<1)return r;n.appendChild(r)}(t.frame,t.cellData,a),t.element.appendChild(t.frame)}}function title(){"use strict";return function(t,e){var i=bio.dom().get(t),n=parseFloat(i.style.width),a=parseFloat(i.style.height);i.innerHTML=e,i.style.fontSize=bio.drawing().fitText(e,n,a,"bold"),i.style.lineHeight=i.style.height}}function tooltip(){"use strict";return function(t){if("String"===bio.objects.getType(t)){if(!document.getElementById("biochart_tooltip"))throw new Error('Not found "#biochart_tooltip"');return function(t){if(!t)throw new Error("Do not find a Tooltip element");t.innerHTML="",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden"}(document.getElementById("biochart_tooltip"))}var e=t.element||null,i=t.contents||"",n=bio.drawing().getParentSVG(e),a=document.getElementById("biochart_tooltip");return a.innerHTML=i,function(t,e,i){if(!t)throw new Error("Do not find a Tooltip element");var n,a,o,r=t.getBoundingClientRect(),l=e.getBoundingClientRect(),s=i.getBoundingClientRect(),c=(a=s,o=r,(n=l).left-o.width/2<a.left?"right":n.top-o.height<a.top?"bottom":n.right+o.width>a.right?"left":(n.bottom,o.height,a.bottom,"top"));t.className=c,t.style.visibility="visible",t.style.top=function(t,e,i){if("left"!==t&&"top"!==t&&"bottom"!==t&&"right"!==t)throw new Error("Wrong direction");return{top:e.top-i-10+window.scrollY+"px",left:e.top-i/2+window.scrollY+"px",bottom:e.bottom+10+window.scrollY+"px",right:e.top-i/2+window.scrollY+"px"}[t]}(c,l,r.height),t.style.left=function(t,e,i){if("left"!==t&&"top"!==t&&"bottom"!==t&&"right"!==t)throw new Error("Wrong direction");return{top:e.left-i/2+window.scrollX+"px",left:e.left-i-10+"px",bottom:e.left-i/2+window.scrollX+"px",right:e.right+10+"px"}[t]}(c,l,r.width)}(a,e,n)}}function variants(){"use strict";var t={};function e(e,i){var n=[].concat(t.data.axis.needle.y);bio.layout().get(t.setting.svgs,["needle"],function(a,o){var r=bio.variantsConfig().axis(e,i,o),l=(bio.variantsConfig().axis("common"),t.data.axis.needle[i.toLowerCase()]);bio.axises()[r.direction]({element:o,top:r.top,left:r.left,range:r.range,margin:r.margin,exclude:r.exclude,domain:"Y"===i?n.reverse():l})})}function i(e,i){var n={needle:"s_legend",patient:"t_legend"}[e];i=i.sort(function(t,e){return bio.boilerPlate.variantInfo[t].order>bio.boilerPlate.variantInfo[e].order?1:-1}),bio.layout().get(t.setting.svgs,[n],function(t,n){var a=bio.variantsConfig().legend(e);bio.legend({data:i,element:n,on:a.on,attr:a.attr,text:a.text,style:a.style,margin:a.margin})})}function n(e,i,n,a){bio.layout().get(t.setting.svgs,["needle"],function(t,o){var r=bio.variantsConfig().needle();bio.needle({element:o,yaxis:n.y,on:r.on,lineData:e,shapeData:i,attr:r.attr,style:r.style,margin:r.margin,xaxis:a||n.x})})}function a(e,i,n){bio.layout().get(t.setting.svgs,["needle"],function(t,a){var o=bio.variantsConfig().graph();bio.variantsGraph({data:e,element:a,on:o.on,yaxis:i.y,text:o.text,attr:o.attr,style:o.style,margin:o.margin,xaxis:n||i.x})})}function o(e,i,n){bio.layout().get(t.setting.svgs,["needle"],function(t,a){var o=bio.variantsConfig().patient(),r=bio.variantsConfig().needle();bio.variantsPatient({data:e,element:a,yaxis:i.y,attr:o.attr,style:o.style,on:r.on,margin:o.margin,xaxis:n||i.x})})}function r(r){var l,s;bio.layout().removeGroupTag(),e("needle","X"),e("needle","Y"),i("needle",r.type),i("patient",[r.patient.shape[0].info[0].id]),n(r.needle.line,r.needle.shape,r.axis.needle),l=r,s=r.axis.needle,bio.layout().get(t.setting.svgs,["navi"],function(e,i){var r=bio.variantsConfig().navi();bio.variantsNavi({data:l,element:i,xaxis:s.x,yaxis:s.y,on:r.on,attr:r.attr,style:r.style,margin:r.margin,call:{drag:r.call.drag,end:function(e,i,r){var l=r.opts.drag,s=bio.scales().invert(r.scaleX),c=[s(l.start.now+r.controls.width),s(l.end.now+r.controls.width)],u=[r.margin.left,r.width-r.margin.right];d3.selectAll(".bottom-axis-g-tag").call(bio.axises().byD3v(bio.scales().get(c,u),"bottom")),bio.layout().removeGroupTag([".variants_needle_svg.needle-line-g-tag",".variants_needle_svg.needle-shape-g-tag",".variants_needle_svg.needle-graph-g-tag",".variants_needle_svg.needle-patient-shape-g-tag"]),n(t.data.needle.line,t.data.needle.shape,t.data.axis.needle,c),a(t.data.graph,t.data.axis.needle,c),o(t.data.patient.shape,t.data.axis.needle,c)}}})}),a(r.graph,r.axis.needle),o(r.patient.shape,r.axis.needle)}return function(e){(t=bio.initialize("variants")).setting=bio.setting("variants",e),t.data=t.setting.preprocessData,bio.title("#variants_title",t.setting.defaultData.variants.title),r(t.data),console.log(">>> Variants reponse data: ",e),console.log(">>> Variants setting data: ",t.setting),console.log(">>> Variants model data: ",t)}}function variantsGraph(){"use strict";var t={};return function(e,i){t=bio.objects.clone(i||{}),(t=bio.sizing.chart.default(t,e)).graphData=e.data,t.copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.margin.top,t.height-t.margin.bottom],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.group=bio.rendering().addGroup(e.element,0,0,"needle-graph"),t.opts={base:bio.objects.clone(e),graph:bio.objects.clone(e)},t.opts.base.data=[""],t.opts.base.id=t.id+"_graph_base",t.opts.base.element=t.group.selectAll("#"+t.id+"_graph_base"),bio.rectangle(t.opts.base,t),t.opts.graph.id=t.id+"_graph_group",t.opts.graph.data=null,t.opts.graph.element=t.group.selectAll("#"+t.id+"_graph_group").data(t.graphData).enter().append("g").attr("id",t.id+"_graph_group").attr("transform","translate(0, 0)"),bio.rectangle(t.opts.graph,t),bio.text(t.opts.graph,t)}}function variantsNavi(){"use strict";var t={};return function(e,i){var n=bio.variantsConfig().navi();t=bio.initialize("variantsNavi"),t=bio.objects.clone(i||{}),(t=bio.sizing.chart.default(t,e)).naviData=e.data,t.copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.height-t.margin.bottom,t.margin.top],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.controls={width:5,height:.4*t.height},t.start=t.scaleX(bio.math.min(t.copyX)),t.end=t.width-t.margin.left-t.margin.right,n.start.init=t.start-t.controls.width,n.end.init=t.end-t.controls.width+t.margin.left,n.start.now=n.start.init,n.end.now=n.end.init,n.navi.init=t.start,n.navi.now=t.start,n.navi.width=t.end,n.navi.nowWidth=t.end-t.start,t.group=bio.rendering().addGroup(e.element,0,0,"heatmap");var a=bio.variantsConfig().needle();bio.variantsConfig().navi();bio.needle({xaxis:t.copyX,yaxis:t.copyY,element:e.element,attr:a.attr,style:a.style,margin:[10,40,10,40],lineData:t.naviData.needle.line,shapeData:t.naviData.needle.shape}),t.opts={end:bio.objects.clone(e),main:bio.objects.clone(e),start:bio.objects.clone(e),drag:n},t.opts.main.data=["main"],t.opts.main.id=t.id+"_navi_main",t.opts.main.element=t.group.selectAll("#"+t.id+"_navi_main"),t.opts.start.data=["start"],t.opts.start.id=t.id+"_navi_start",t.opts.start.element=t.group.selectAll("#"+t.id+"_navi_start"),t.opts.end.data=["end"],t.opts.end.id=t.id+"_navi_end",t.opts.end.element=t.group.selectAll("#"+t.id+"_navi_end"),bio.rectangle(t.opts.main,t),bio.rectangle(t.opts.start,t),bio.rectangle(t.opts.end,t),d3.selectAll("#"+t.id+" path").remove()}}function variantsPatient(){"use strict";var t={};return function(e,i){t=bio.objects.clone(i||{}),(t=bio.sizing.chart.default(t,e)).patientData=e.data,t.copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.height-t.margin.bottom,t.margin.top],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.shapeGroup=bio.rendering().addGroup(e.element,0,0,"needle-patient-shape"),t.opts=bio.objects.clone(e),t.opts.data=t.patientData,t.opts.element=t.shapeGroup.selectAll("#"+t.id+"_needle_patient_shape"),bio.triangle(t.opts,t)}}