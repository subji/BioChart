function boilerPlate(){"use strict";var t={};return t.variantInfo={Amplification:{color:"#FFBDE0",order:0},Homozygous_deletion:{color:"#BDE0FF",order:1},Nonsense_mutation:{color:"#EA3B29",order:2},Splice_site:{color:"#800080",order:3},Translation_start_site:{color:"#AAA8AA",order:4},Missense_mutation:{color:"#3E87C2",order:5},Start_codon_snp:{color:"#3E87C2",order:5},Nonstop_mutation:{color:"#070078",order:6},Frame_shift_indel:{color:"#F68D3B",order:7},Stop_codon_indel:{color:"F68D3B",order:7},In_frame_indel:{color:"#F2EE7E",order:8},Silent:{color:"#5CB755",order:9},Rna:{color:"#FFDF97",order:10},Intron:{color:"#A9A9A9",order:11},"5'utr":{color:"#A9A9A9",order:11},"3'utr":{color:"#A9A9A9",order:11},Igr:{color:"#A9A9A9",order:11}},t.clinicalInfo={alive:{color:"#04CDA4",order:1},dead:{color:"#C50E36",order:2},female:{color:"E0A4E5",order:1},male:{color:"#0F67B6",order:2},"american indian or alaska native":{color:"#38120B",order:1},asian:{color:"#CB771F",order:2},"black or african american":{color:"#302F24",order:3},white:{color:"#9CB1CE",order:4},"hispanic or latino":{color:"#B8642F",order:1},"not hispanic or latino":{color:"#55C53E",order:2},"lung acinar adenocarcinoma":{color:"#716190",order:1},"lung adenocarcinoma mixed subtype":{color:"#5154DE",order:2},"lung adenocarcinoma- not otherwise specified (nos)":{color:"#8E9A7E",order:3},"lung bronchioloalveolar carcinoma mucinous":{color:"#2F91DE",order:4},"lung bronchioloalveolar carcinoma nonmucinous":{color:"#ED6EBD",order:5},"lung clear cell adenocarcinoma":{color:"#1C8D7A",order:6},"lung micropapillary adenocarcinoma":{color:"#B2EE86",order:7},"lung mucinous adenocarcinoma":{color:"#785E54",order:8},"lung papillary adenocarcinoma":{color:"#69B4C4",order:9},"lung signet ring adenocarcinoma":{color:"#C1386E",order:10},"lung solid pattern predominant adenocarcinoma":{color:"#D7A355",order:11},"mucinous (colloid) carcinoma":{color:"#243833",order:12},bronchial:{color:"#F9E3B9",order:1},"l-lower":{color:"#FBA2A3",order:2},"l-upper":{color:"#0CA3C7",order:3},"other (please specify)":{color:"#D3A16C",order:4},"r-lower":{color:"#388A4E",order:5},"r-middle":{color:"#D61E43",order:6},"r-upper":{color:"#B81BCC",order:7},no:{color:"#D73A64",order:1},yes:{color:"#1990AA",order:2},"yes, history of prior malignancy":{color:"#3BDB11",order:3},"yes, history of synchronous/bilateral malignancy":{color:"#803F11",order:4},no:{color:"#D73A64",order:1},yes:{color:"#1990AA",order:2},no:{color:"#D73A64",order:1},yes:{color:"#1990AA",order:2},t1:{color:"#060CDB",order:1},t1a:{color:"#696DE9",order:2},t1b:{color:"#CDCEF7",order:3},t2:{color:"#F6251D",order:4},t2a:{color:"#F96D69",order:5},t2b:{color:"#FDCECD",order:6},t3:{color:"#1AEB42",order:7},t4:{color:"#EBBD34",order:8},tx:{color:"#9943DE",order:9},n0:{color:"#DC5B35",order:1},n1:{color:"#217C1F",order:2},n2:{color:"#18A6F3",order:3},n3:{color:"#EA68C3",order:4},nx:{color:"#F4E831",order:5},m0:{color:"#F0820D",order:1},m1:{color:"#C45A43",order:2},m1a:{color:"#A523C2",order:3},m1b:{color:"#C97BDA",order:4},mx:{color:"#EDD3F2",order:5},"stage i":{color:"#01C606",order:1},"stage ia":{color:"#018404",order:2},"stage ib":{color:"#002C01",order:3},"stage ii":{color:"#0E22C3",order:4},"stage iia":{color:"#08136C",order:5},"stage iib":{color:"#040B41",order:6},"stage iiia":{color:"#BB0C2E",order:7},"stage iiib":{color:"#75081D",order:8},"stage iv":{color:"#F0CA53",order:9},r0:{color:"#DB8EC0",order:1},r1:{color:"#FFD046",order:2},r2:{color:"#495C50",order:3},rx:{color:"#0E5F8A",order:4},"exon 19 deletion":{color:"#4A312A",order:1},l858r:{color:"#74C04C",order:2},l861q:{color:"#FBED09",order:3},other:{color:"#C91DAB",order:4},t790m:{color:"#2C517B",order:5},g12a:{color:"#DED0D1",order:1},g12c:{color:"#AE8A8E",order:2},g12d:{color:"#5D161D",order:3},g12s:{color:"#410F14",order:4},g12v:{color:"#25080B",order:5},other:{color:"#C91DAB",order:6},"complete remission/response":{color:"#BDED73",order:1},"partial remission/response":{color:"#8649F3",order:2},"progressive disease":{color:"#C1746B",order:3},"stable disease":{color:"#CD4C2A",order:4},"complete remission/response":{color:"#BDED73",order:1},"partial remission/response":{color:"#8649F3",order:2},"progressive disease":{color:"#C1746B",order:3},"stable disease":{color:"#CD4C2A",order:4},"Lifelong Non-Smoker":{color:"#C4B5BB",order:1},"Current Smoker":{color:"#896C78",order:2},"Current Reformed Smoker for > 15 yrs":{color:"#3B0A1E",order:3},"Current Reformed Smoker for < or = 15 yrs":{color:"#2F0818",order:4},"Current Reformed Smoker, Duration Not Specified":{color:"#17040C",order:5},NA:{color:"#D6E2E3",order:6}},t.exclusivityInfo={Amplification:"#FFBDE0",Deletion:"#BDE0FF",Mutation:"#5CB755",None:"#D3D3D3"},t}function layout(){"use strict";function t(t,e,n){if(n)return bio.iteration.loop(n,function(n){var o=!0;bio.iteration.loop(t,function(t){n.indexOf(t)>-1&&(o=!o)}),o&&(i.svg[e][n]=bio.rendering().createSVG(n))}),i.svg[e]}function e(t){var e=(t=Array.prototype.slice.call(t)).map(function(t){return bio.objects.getType(t)});if(e.indexOf("Object")<0)throw new Error("Not found svg set");if(e.indexOf("Function")<0)throw new Error("Not found callback")}var i={svg:{pathway:{},variants:{},landscape:{},expression:{},exclusivity:{}}};return i.landscape=function(e){return t(["option","title"],"landscape",e)},i.variants=function(e){return t(["title"],"variants",e)},i.expression=function(e){return t(["title","function","color_mapping","signature"],"expression",e)},i.exclusivity=function(e){return t(["title","geneset","survival","empty"],"exclusivity",e)},i.pathway=function(e){return t(["title"],"pathway",e)},i.get=function(t,i,n){e(arguments),i="Array"===bio.objects.getType(i)?i:[i],bio.iteration.loop(t,function(t,e){bio.iteration.loop(i,function(i){if(t.indexOf(i)>-1)return n(t,e)})})},i.removeGroupTag=function(t){t?(t="Array"===bio.objects.getType(t)?t:[t],bio.iteration.loop(t,function(t){d3.selectAll(t.indexOf(".")>-1?t:"."+t).remove()})):d3.selectAll("svg g").remove()},function(){return i}}function setting(){"use strict";function t(t){return o.dom=bio.dom().get(t),o.dom}function e(t){return o.size.width=t.width||parseFloat(o.dom.style.width),o.size.height=t.height||parseFloat(o.dom.style.height),{width:o.size.width,height:o.size.height}}function i(t,e,i,n,a){return o.ids=bio.sizing.chart[t](e,i,n,a),o.ids}function n(t,e){return bio.layout()[t](e)}var o=null;return function(a,r){o=bio.initialize("setting");var l=null;return r.data.data&&r.data.data.name&&(l=r.data.data.group_list),{defaultData:r.data,targetedElement:t(r.element),targetedElementSize:e(r),preprocessData:bio.preprocess(a)(r.data),layoutIds:i(a,o.dom,o.size.width,o.size.height,l),svgs:n(a,o.ids)}}}function sizing(){"use strict";function t(){document.getElementById("biochart_tooltip")&&document.body.removeChild(document.getElementById("biochart_tooltip"));var t=document.createElement("div");t.id="biochart_tooltip",t.className="biochart-tooltip",document.body.appendChild(t)}function e(e){t(),bio.iteration.loop.call(this,e,function(t,e){var i=document.createElement("div");i.id=t,i.style.width=e.width+"px",i.style.height=e.height+"px",a.ids.push(t),this.appendChild(i)})}function i(t,e,i){return a=bio.initialize("sizing"),t.style.width=e+"px",t.style.height=i+"px",t}function n(t,e,i,n,o){var a=document.createElement("div"),r=document.createElement("div");return a.id=t+"_title",r.id=t+"_contents",a.style.width=i+"px",a.style.height=n*o+"px",r.style.width=i+"px",r.style.height=n*(100-o)+"px",e.appendChild(a),e.appendChild(r),{title:a,contents:r}}function o(t,e,i,n,o){var a=.16*n/t.length,r={patient:{w:.01*i,h:a},axis:{w:.14*i,h:a},group:{w:.65*i,h:a}};return bio.iteration.loop(t,function(t){var i=t.name.removeWhiteSpace(),n="group"===r[o]?"":o;e["landscape_"+n+"_group_"+i]={width:r[o].w.toFixed(1),height:r[o].h.toFixed(1)}}),e}var a={chart:{},ids:[]};return a.setMargin=function(t){if(t.length||"string"!=typeof t){if("Object"===bio.objects.getType(t))return t;var e=t.length;return{top:t[0],left:e>1?t[1]:t[0],bottom:e>2?t[2]:t[0],right:1===e?t[0]:e>3?t[3]:t[1]}}return{top:t,left:t,bottom:t,right:t}},a.chart.landscape=function(t,r,l,s){var c={landscape_temp_sample:{width:.1*r,height:.15*l},landscape_axis_sample:{width:.14*r,height:.15*l},landscape_patient_sample:{width:.01*r,height:.15*l},landscape_sample:{width:.65*r,height:.15*l},landscape_scale_option:{width:.1*r,height:.15*l},landscape_temp_group:{width:.1*r,height:.16*l},landscape_axis_group:{width:.14*r,height:.15*l},landscape_patient_group:{width:.01*r,height:.16*l},landscape_group:{width:.65*r,height:.16*l},landscape_option:{width:.1*r,height:.16*l},landscape_legend:{width:.1*r,height:.64*l},landscape_gene:{width:.14*r,height:.64*l},landscape_patient_heatmap:{width:.01*r,height:.64*l},landscape_heatmap:{width:.65*r,height:.64*l},landscape_pq:{width:.1*r,height:.64*l}},u=n("landscape",t,r,l,.05),d=o(s,{},r,l,"axis"),p=o(s,{},r,l,"group"),f=o(s,{},r,l,"patient");return e.call(i(u.contents,r,.95*l),c),e.call(bio.dom().get("#landscape_group"),p),e.call(bio.dom().get("#landscape_axis_group"),d),e.call(bio.dom().get("#landscape_patient_group"),f),a.ids},a.chart.variants=function(t,o,r){var l={variants_needle:{width:.825*o,height:.825*r},variants_legend:{width:.175*o,height:.5*r},variants_patient_legend:{width:.175*o,height:.425*r},variants_navi:{width:.825*o,height:.1*r}},s=n("variants",t,o,r,.075);return e.call(i(s.contents,o,.925*r),l),a.ids},a.chart.expression=function(t,o,r){var l={expression_survival:{width:.4*o,height:.925*r},expression_bar_plot:{width:.4*o,height:.32*r},expression_function:{width:.2*o,height:.05*r},expression_color_mapping:{width:.2*o,height:.05*r},expression_bar_legend:{width:.2*o,height:.35*r},expression_division:{width:.4*o,height:.04*r},expression_scatter_plot:{width:.4*o,height:.3*r},expression_scatter_empty:{width:.2*o,height:.08*r},expression_scatter_legend:{width:.2*o,height:.2*r},expression_heatmap:{width:.4*o,height:.25*r},expression_signature:{width:.2*o,height:.05*r},expression_color_gradient:{width:.194*o,height:.075*r}},s=n("expression",t,o,r,.075);return e.call(i(s.contents,o,.925*r),l),a.ids},a.chart.exclusivity=function(t,o,r){var l={exclusivity_select_geneset:{width:.59*o,height:.12*r},exclusivity_survival:{width:.4*o,height:.925*r},exclusivity_network:{width:.25*o,height:.65*r},exclusivity_heatmap:{width:.35*o,height:.45*r},exclusivity_legend:{width:.35*o,height:.05*r},exclusivity_sample_legend:{width:.35*o,height:.05*r}},s=n("exclusivity",t,o,r,.075);return e.call(i(s.contents,o,.925*r),l),a.ids},a.chart.pathway=function(t,o,r){var l={},s=n("pathway",t,o,r,.075);return e.call(i(s.contents,o,.925*r),l),a.ids},a.chart.default=function(t,e){return t.id=e.element.attr("id"),t.margin=e.margin?bio.sizing.setMargin(e.margin):null,t.width=parseFloat(e.element.attr("width")),t.height=parseFloat(e.element.attr("height")),t.element="Object"===bio.objects.getType(e.element)||"Array"===bio.objects.getType(e.element)?e.element:/\W/.test(e.element[0])?d3.select(e.element):d3.select("#"+e.element),t},a}function commonConfig(){"use strict";var t={};return t.typeFormat=function(t){return t.replace(/(_ins|_del)$/gi,"_indel").pronoun()},function(){return t}}function exclusivityConfig(){"use strict";function t(t){return"B"===t?["A","M"]:"E"===t?["D","M"]:"M"===t?[".","M"]:[t]}function e(t,e){return"var"===t?"Mutation":e.toUpperCase().indexOf("AMP")>-1?"Amplipication":"Deletion"}function i(t){return"Amplification"===t?"A":"Homozygous_deletion"===t?"D":"M"}function n(t){return{Amplification:"A",Deletion:"D",Mutation:"M",None:"."}[t]}function o(t){return{A:"Amplification",D:"Deletion",M:"Mutation",".":"None"}[t]}function a(t){return{Amplification:0,Deletion:1,Mutation:2,None:3}[t]}function r(t,e,i){var n=null;return{legend:{attr:{x:function(t,i,o){var a=n||0,r=t.text.replace(" ","H");return n=n?n+bio.drawing().textSize.width(r,"10px"):bio.drawing().textSize.width(r,"10px")+5,e+a},y:function(t,e,i){return"**"===t.text?18:15}},style:{fill:function(t,e,i){return t.color},fontSize:function(t,e,i){return"**"===t.text?"12px":"10px"}},text:function(t,e,i){return t.text}},division:{attr:{x:function(t,n,o){var a=bio.drawing().textSize.width(t.text,"14px");return"#00AC52"===t.color?i.attr("width")-(10+a):e},y:function(t,e,n){return.05*i.attr("height")}},style:{fill:function(t,e,i){return t.color},fontSize:"14px"},text:function(t,e,i){if("**"===t.text)return t.text}}}[t]}function l(t){var e=".exclusivity_legend_svg.legend-shape-g-tag",i=".exclusivity_legend_svg.legend-text-g-tag";return{margin:[0,t,0,0],attr:{x:function(t,e,i){return"text"===this.tagName?e*(1.3*i.fontWidth.value)+5:e*(1.3*i.fontWidth.value)},y:function(t,e,i){return"text"===this.tagName?.8*i.height/2+.2*i.height:t.indexOf("Mutation")>-1?.2*i.height+.8*i.height/4.5:.2*i.height},width:2.5,height:function(t,e,i){return"Mutation"===t?.8*i.height/2:.8*i.height}},style:{fill:function(t,e,i){return"text"===this.tagName?"#333333":bio.boilerPlate.exclusivityInfo[t]},fontSize:"11px"},on:{mouseover:function(t,n,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(i,a),s=bio.rendering().opacity(bio.boilerPlate.exclusivityInfo[t],.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,n,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(i,a);d3.select(r).transition(10).style("fill",bio.boilerPlate.exclusivityInfo[t]),d3.select(l).style("font-weight","normal")}},text:function(t,e,i){return t}}}function s(){return{}}function c(t,e,i){var n=e.attr("height");return{shape:{margin:[.2*n,i,0,10],attr:{x:function(t,e,i){return i.scaleX(t.x)},y:function(t,e,i){return"Mutation"===t.value?i.scaleY(t.y)+bio.scales().band(i.scaleY)/3:i.scaleY(t.y)},width:function(t,e,i){return bio.scales().band(i.scaleX)},height:function(t,e,i){return"Mutation"===t.value?bio.scales().band(i.scaleY)/3:bio.scales().band(i.scaleY)}},style:{fill:function(t,e,i){return bio.boilerPlate.exclusivityInfo[t.value]}}},axis:{margin:[.2*n,i,0,10],range:[.2*n,n]}}[t]}function u(){return{attr:{x:function(t,e,i){return d3.select(".legend").node().getBoundingClientRect().width},y:function(t,e,i){return d3.select(".legend text").node().getBoundingClientRect().height/3}},style:{fill:function(t,e,i){var n=null;return bio.iteration.loop(i.data.sample.isAltered,function(e){e.text===t.text&&(n=t.color)}),n||"none"},fontSize:"25px"},text:function(t,e,i){return"**"}}}function d(t){return{margin:[20,t,0,9],attr:{x:function(t,e,i){return"text"===this.tagName?t.text.indexOf("Un")>-1?t.end-t.textWidth-i.margin.right:t.start+i.margin.right:"path"===this.tagName?t.path_x:t.start},y:function(t,e,i){return"text"===this.tagName?.05*i.height+i.margin.top:"path"===this.tagName?0===e?i.margin.top:t.path_y:i.margin.top},width:function(t,e,i){return t.end-t.start},height:function(t,e,i){return.1*i.height}},style:{fill:function(t,e,i){return"text"===this.tagName?"#FFFFFF":t.color},stroke:function(t,e,i){return"path"===this.tagName?"#333333":"none"},fontSize:"11px"},text:function(t,e,i){return t.text}}}return function(){return{name:o,symbol:n,byCase:e,legend:l,sample:r,network:s,heatmap:c,survival:u,separate:t,priority:a,division:d,abbreviation:i}}}function expressionConfig(){"use strict";function t(t){return{width:t?t.attr("width"):0,height:t?t.attr("height"):0}}function e(t){var e=".expression_bar_legend_svg.legend-shape-g-tag",i=".expression_bar_legend_svg.legend-text-g-tag",n=".expression_scatter_legend_svg.legend-shape-g-tag",o=".expression_scatter_legend_svg.legend-text-g-tag";return{color_mapping:{margin:[10,15,0,0],attr:{x:function(t,e,i){return"text"===this.tagName?i.margin.left:0},y:function(t,e,i){return"text"===this.tagName?e*i.fontHeight+i.fontHeight/2-1.5:e*i.fontHeight},width:8,height:8},style:{fill:function(t,e,i){return"text"===this.tagName?"#333333":"NA"===t?"#A4AAA7":c[e]},fontSize:"11px"},on:{mouseover:function(t,n,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(i,a),s=bio.rendering().opacity("NA"===t?"#A4AAA7":c[n],.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,n,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(i,a);d3.select(r).transition(10).style("fill","NA"===t?"#A4AAA7":c[n]),d3.select(l).style("font-weight","normal")}},text:function(t,e,i){return bio.drawing().textOverflow(t,"11px",.75*i.width)}},scatter:{margin:[15,15,20,15],attr:{cx:0,cy:function(t,e,i){return e*(i.fontHeight+3)},r:5,x:function(t,e,i){return i.margin.left},y:function(t,e,i){return e*(i.fontHeight+3)+1}},style:{fill:function(t,e,i){return"Alive"===t?"#5D5DD8":"#D86561"},fontSize:"11px"},on:{mouseover:function(t,e,i){var a=i.legendData.indexOf(t),r=bio.drawing().nthChild(n,a),l=bio.drawing().nthChild(o,a),s=bio.rendering().opacity("Alive"===t?"#5D5DD8":"#D86561",.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,e,i){var a=i.legendData.indexOf(t),r=bio.drawing().nthChild(n,a),l=bio.drawing().nthChild(o,a);d3.select(r).transition(10).style("fill","Alive"===t?"#5D5DD8":"#D86561"),d3.select(l).style("font-weight","normal")}},text:function(t,e,i){return t}}}[t]}function i(t,e){return{shape:{margin:[10,e,30,20],attr:{cx:function(t,e,i){return i.scaleX(t.x)},cy:function(t,e,i){return i.scaleY(t.y)},r:5},style:{fill:function(t,e,i){return void 0===t.value?"#333333":1===t.value?"#D86561":"#5D5DD8"},fillOpacity:.6},on:{mouseover:function(t,e,i){bio.tooltip({element:this,contents:"ID: <b>"+t.x+"</b></br>Months: <b>"+t.y+"</b></br>Status: <b>"+("0"===t.value?"Alive":"Dead")+"</b>"})},mouseout:function(t,e,i){bio.tooltip("hide")}}},axis:{top:0,left:e,margin:[0,0,0,0],exclude:"path, line"}}[t]}function n(t,e){return{shape:{margin:[0,e,0,20],attr:{x:function(t,e,i){return i.scaleX(t.x)},y:function(t,e,i){return i.scaleY(t.y)},width:function(t,e,i){return bio.scales().band(i.scaleX)},height:function(t,e,i){return bio.scales().band(i.scaleY)}},on:{mouseover:function(t,e,i){bio.tooltip({element:this,contents:"ID: <b>"+t.x+"</b></br>Gene: <b>"+t.y+"</b></br>TPM: <b>"+t.value+"</b></br>"})},mouseout:function(t,e,i){bio.tooltip("hide")}}},axis:{top:0,left:e,margin:[0,0,0,0],exclude:"path, line"}}[t]}function o(t){return{margin:[0,t,0,20],attr:{points:function(t,e,i){var n=i.id.indexOf("bar")>-1?t.y-t.value<0?i.scaleY(t.y)+8:i.scaleY(t.y)+3:i.height,o=i.id.indexOf("bar")>-1&&t.y-t.value<0?"top":"bottom";return bio.rendering().triangleStr(i.scaleX(t.x),n,10,o)}},style:{fill:"#333333"},on:{mouseover:function(t,e,i){bio.tooltip({element:this,contents:"<b>"+t.x+"</b></br>Value: <b>"+t.value+"</b></br>"})},mouseout:function(t,e,i){bio.tooltip("hide")}}}}function a(t,e){return{shape:{margin:[20,e+1,15,19],attr:{x:function(t,e,i){return i.scaleX(t.x)},y:function(t,e,i){return t.y-t.value<0?i.scaleY(t.value):i.scaleY(t.y)},width:function(t,e,i){return bio.scales().band(i.scaleX)},height:function(t,e,i){return t.y-t.value<0?i.scaleY(t.y)-i.scaleY(t.value):i.scaleY(t.value)-i.scaleY(t.y)}},style:{fill:function(t,e,i){return t.y-t.value==0?"#000000":"#62C2E0"},stroke:function(t,e,i){return t.y-t.value==0?"#000000":"#62C2E0"}},on:{mouseover:function(t,e,i){bio.tooltip({element:this,contents:"ID: <b>"+t.x+"</b></br>Average: <b>"+t.value+"</b>"})},mouseout:function(t,e,i){bio.tooltip("hide")}}},axis:{top:0,left:e,margin:[10,0,10,0]}}[t]}function r(e,i){return{axis:{top:20,left:0,margin:[0,5,0,10],exclude:"path, line",range:[5,t(i).width-10]},shape:{attr:{x:5,y:5,rx:3,ry:3,width:function(t,e,i){return d3.select(bio.drawing().getParentSVG(this)).attr("width")-10},height:15},style:{fill:function(t,e,i){return"url(#"+i.data.colorGradient.id+")"}}}}[e]}function l(t,e){function i(t,e,i){t.attr("points",function(t,n,o){return bio.rendering().triangleStr(i+e.additional,e.path_y,10,e.direction)})}function n(t,e){var i=t.attr("d"),n=i.substring(i.indexOf("M")+1,i.indexOf(","));t.attr("d",i.replace(new RegExp(n,"gi"),e))}var o=".division-path-0-g-tag path",a="#expression_division_svg_division_shape_rect";return{bar:{margin:[0,e,0,20]},division:{margin:[0,e,0,20],attr:{x:function(t,e,i){return i.position.init.low=i.position.init.low?i.position.init.low:t.path_x,i.position.init.high=i.position.init.high?i.position.init.high:t.path_x,i.position.now.low=i.position.init.low,i.position.now.high=i.position.init.high,"text"===this.tagName?t.text.indexOf("Low")>-1?t.start+5:t.end-t.textWidth-15:"path"===this.tagName?t.path_x:t.start},y:function(t,e,i){return"text"===this.tagName?i.height/2:"path"===this.tagName?t.text.indexOf("Low")>-1?0===e?t.path_y-5:t.path_y:0===e?t.path_y:t.path_y+5:0},points:function(t,e,i){return bio.rendering().triangleStr(t.path_x+t.additional,t.path_y,10,t.direction)},width:function(t,e,i){return t.end-t.start},height:function(t,e,i){return i.height},rx:3,ry:3},style:{fill:function(t,e,i){return"text"===this.tagName?"#FFFFFF":t.text.indexOf("Low")>-1?"#00AC52":"#FF6252"},stroke:function(t,e,i){return"text"===this.tagName?t.text.indexOf("Low")>-1?"#00AC52":"#FF6252":"none"},strokeWidth:"0.5px",fontSize:"12px",fontWeight:"bold",cursor:function(t,e,i){return"polygon"===this.tagName?"pointer":"normal"}},call:{drag:function(t,e,r){if(t.text.indexOf("Low")>-1){r.position.init.low=r.position.init.low?r.position.init.low:t.path_x,r.position.now.low=r.position.now.low?r.position.now.low+=d3.event.dx:t.path_x;l=r.position.now.low=Math.max(t.start,Math.min(r.position.now.high||t.path_x,r.position.now.low));i(d3.select(this),t,r.position.now.low),n(d3.select(o),l),d3.selectAll(a).attr("width",function(e,i,n){return e.text===t.text?l-e.start:e.end-r.position.now.high})}else{r.position.init.high=r.position.init.high?r.position.init.high:t.path_x,r.position.now.high=r.position.now.high?r.position.now.high+=d3.event.dx:t.path_x;var l=r.position.now.high=Math.max(r.position.now.low||t.path_x,Math.min(t.end,r.position.now.high)),s=d3.select(o).attr("d");s.substring(s.indexOf("M")+1,s.indexOf(","));i(d3.select(this),t,r.position.now.high),n(d3.select(".division-path-1-g-tag path"),l),d3.selectAll(a).attr("x",function(e,i,n){return e.text===t.text?l:e.start}).attr("width",function(e,i,n){return e.text===t.text?e.end-l:r.position.now.low-e.start})}}},text:function(t,e,i){return t.text}},scatter:{margin:[0,e,0,20]}}[t]}function s(t){return{legend:{attr:{x:function(t,e,i){var n=d3.select(".legend").node().getBoundingClientRect();return n.right-n.left},y:function(t,e,i){var n=d3.select(".legend text").node().getBoundingClientRect();bio.drawing().textSize.height("11px");return n.height/2.5}},style:{fill:function(t,e,i){return i.data.patient.data===t.text?t.color:"#FFFFFF"}},text:function(t,e,i){return i.data.patient.data===t.text?" **"===i.data.patient.data?"":" **":""}}}[t]}var c=["#B82647","#0A8D5E","#F9D537","#0B6DB7","#E3DDCB","#9F494C","#CBDD61","#ED9149","#89236A","#D8C8B2","#CA5E59","#006494","#2E674E","#9A6B31","#403F95","#616264","#E2A6B4","#5AC6D0","#733E7F","#45436C"];return function(){return{bar:a,legend:e,scatter:i,heatmap:n,patient:o,gradient:r,colorSet:c,division:l,survival:s}}}function landscapeConfig(){"use strict";function t(t){return bio.boilerPlate.variantInfo[bio.commonConfig().typeFormat(t)].order<2?"cnv":"var"}function e(t,e,i){if("common"===t)return{on:{mouseover:function(t,e){var i=this.parentNode.parentNode.className.baseVal;if(i.indexOf("gene")>-1&&i.indexOf("right")>-1||i.indexOf("group")>-1){var n=i.indexOf("gene")>-1?"Sort by <b>"+this.innerHTML+"</b>":"<b>"+this.innerHTML+"</b></br>Click to sort </br> Alt + Click add to key";bio.tooltip({element:this,contents:n}),d3.select(this).transition().style("font-size",12).style("font-weight","bold")}},mouseout:function(t,e){bio.tooltip("hide"),d3.select(this).transition().style("font-size",10).style("font-weight","normal")}}};var n=parseFloat(i.attr("width")),o=parseFloat(i.attr("height"));return{sampleY:{top:5,left:n-5,direction:"left",range:[5,o-25],margin:[5,0,25,0]},groupY:{top:5,left:30,range:[0,0],direction:"right",margin:[0,0,0,0],exclude:"path, line",on:{click:function(t,e,i){return bio.iteration.loop(i.data.axis.group.y,function(e,n){if(e[0]===t){var o=[].concat(i.data.group.group[n]);i.now.group=bio.landscapeSort().group.call(i,o,!!d3.event.altKey)}}),{sorted:{axis:"x",data:function(t){var e=[];return bio.iteration.loop(t,function(t){e=e.concat(t)}),e}(i.now.group.axis.data)},model:i}}}},geneY:{top:0,left:n-70,direction:"right",range:[10,o-45],exclude:"path, line",margin:[10,0,45,0],on:{click:function(t,e,i){var n=[];return bio.iteration.loop(i.data.heatmap,function(e){e.y===t&&n.push(e)}),{sorted:bio.landscapeSort().gene(i.data.axis.heatmap.x,n),model:i}}}},geneX:{left:15,top:o-45,range:[15,n-85],direction:"bottom",margin:[0,15,0,85]},pqX:{left:5,top:o-45,direction:"bottom",range:[10,n-20],margin:[0,10,20,20]}}[t+e]}function i(t){return{pq:{margin:[5,15,13,5],attr:{rx:3,ry:3,x:function(t,e,i){return"text"===this.tagName?i.margin.left:i.margin.left-i.margin.right},y:function(t,e,i){return"text"===this.tagName?i.height-i.margin.bottom:i.height-1.75*i.margin.bottom},width:function(t,e,i){return i.mostWidth.value+2*i.margin.right},height:function(t,e,i){return i.mostHeight+i.margin.top}}},gene:{margin:[5,5,13,125],attr:{rx:3,ry:3,x:function(t,e,i){return"text"===this.tagName?i.width-i.margin.right:i.width-i.margin.right-i.margin.left},y:function(t,e,i){return"text"===this.tagName?i.height-i.margin.bottom:i.height-1.75*i.margin.bottom},width:function(t,e,i){return i.mostWidth.value-2*i.margin.left},height:function(t,e,i){return i.mostHeight+i.margin.top}}},sample:{margin:[10,6.5,25,45],attr:{rx:3,ry:3,x:function(t,e,i){return"text"===this.tagName?-1*i.height+i.margin.bottom:-1*i.height+.65*i.margin.bottom},y:function(t,e,i){return"text"===this.tagName?i.width-i.margin.right:i.width-i.margin.right-i.margin.top},width:function(t,e,i){return i.mostWidth.value-i.margin.left},height:function(t,e,i){return i.mostHeight+i.margin.top/2}}},common:{titles:["#Mutations","-log10(p-value)"],style:{fontSize:"10px",fontWeight:"bold",filter:"url(#drop_shadow)",fill:function(t,e,i){return"text"===this.tagName?"#FFFFFF":"#595959"}},on:{click:function(t,e,i){return{sorted:bio.landscapeSort()[i.now.sort[i.sortName]](i.sortName,i.data),model:i}},mouseover:function(t,e,i){bio.tooltip({element:"text"===this.tagName?this.nextSibling?this.nextSibling:this.previousSibling:this,contents:"Sort by <b>"+t.text+"</b>"})},mouseout:function(t,e,i){bio.tooltip("hide")}},text:function(t,e,i){return t.text}}}[t]}function n(t){return{pq:{margin:[10,15,45.5,30],attr:{x:function(t,e,i){return bio.math.min(i.rangeX)},y:function(t,e,i){return i.scaleY(t.y)+.25},width:function(t,e,i){return i.scaleX(t.value)},height:function(t,e,i){return bio.scales().band(i.scaleY)-.5}},style:{fill:"#BFBFBF"},on:{mouseover:function(t,e,i){bio.tooltip({element:this,contents:"<b>"+t.y+"</b></br>Value: <b>"+t.value+"</b>"}),d3.select(this).transition(10).style("fill","#7A7A7A").style("filter","url(#drop_shadow)")},mouseout:function(t,e,i){bio.tooltip("hide"),d3.select(this).transition(10).style("fill","#BFBFBF").style("filter","none")}}},gene:{margin:[10,30,45.5,70],attr:{x:function(t,e,i){return i.scaleX(t.x+t.value)+.125},y:function(t,e,i){return i.scaleY(t.y)+.25},width:function(t,e,i){return i.scaleX(t.x)-i.scaleX(t.x+t.value)-.25},height:function(t,e,i){return bio.scales().band(i.scaleY)-.5}},style:{fill:function(t,e,i){return bio.boilerPlate.variantInfo[t.info].color}},on:{mouseover:function(t,e,i){var n=bio.rendering().opacity(bio.boilerPlate.variantInfo[t.info].color,.3);bio.tooltip({element:this,contents:"<b>"+t.y+"</b></br>Type: <b>"+t.info+"</b></br>Count: <b>"+t.value+"</b>"}),d3.select(this).transition(10).style("fill",n).style("filter","url(#drop_shadow)")},mouseout:function(t,e,i){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.variantInfo[t.info].color).style("filter","none")}}},sample:{margin:[10,5,20,0],attr:{x:function(t,e,i){return i.scaleX(t.x)+.25},y:function(t,e,i){return i.scaleY(t.y+t.value)+.25},width:function(t,e,i){return bio.scales().band(i.scaleX)-.5},height:function(t,e,i){return i.scaleY(t.y)-i.scaleY(t.y+t.value)-.5}},style:{fill:function(t,e,i){return bio.boilerPlate.variantInfo[t.info].color}},on:{mouseover:function(t,e,i){var n=bio.rendering().opacity(bio.boilerPlate.variantInfo[t.info].color,.3);bio.tooltip({element:this,contents:"<b>"+t.x+"</b></br>Type: <b>"+t.info+"</b></br>Count: <b>"+t.value+"</b>"}),d3.select(this).transition(10).style("fill",n).style("filter","url(#drop_shadow)")},mouseout:function(t,e,i){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.variantInfo[t.info].color).style("filter","none")}}}}[t]}function o(e){return{heatmap:{margin:[10,5,45.5,0],attr:{x:function(t,e,i){return i.scaleX(t.x)},y:function(e,i,n){return"cnv"!==t(e.value)?bio.scales().band(n.scaleY)/3+n.scaleY(e.y):n.scaleY(e.y)},width:function(t,e,i){return bio.scales().band(i.scaleX)},height:function(e,i,n){return"cnv"!==t(e.value)?bio.scales().band(n.scaleY)/3:bio.scales().band(n.scaleY)}},style:{fill:function(t,e,i){return bio.boilerPlate.variantInfo[t.value].color}},on:{mouseover:function(t,e,i){var n=bio.rendering().opacity(bio.boilerPlate.variantInfo[t.value].color,.3),o="";t.info.length>0&&bio.iteration.loop(t.info,function(t){o+="</br><b>"+t+"</b>"}),bio.tooltip({element:this,contents:"<b>Gene mutations</b></br>X: <b>"+t.x+"</b></br>Y: <b>"+t.y+"</b></br>Type: </br><b>"+t.value+"</b>"+o}),d3.select(this).transition(10).style("fill",n).style("filter","url(#drop_shadow)")},mouseout:function(t,e,i){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.variantInfo[t.value].color).style("filter","none")}}},group:{margin:[0,5,7,0],attr:{x:function(t,e,i){return i.scaleX(t.x)||i.margin.left},y:function(t,e,i){return i.scaleY(t.y)},width:function(t,e,i){return bio.scales().band(i.scaleX)},height:function(t,e,i){return bio.scales().band(i.scaleY)}},style:{fill:function(t,e,i){return bio.boilerPlate.clinicalInfo[t.value].color}},on:{mouseover:function(t,e,i){var n=bio.rendering().opacity(bio.boilerPlate.clinicalInfo[t.value].color,.3);bio.tooltip({element:this,contents:"<b>"+t.y+"</b></br>Sample: <b>"+t.x+"</b></br>Value: <b>"+t.value+"</b></br>"}),d3.select(this).transition(10).style("fill",n).style("filter","url(#drop_shadow)")},mouseout:function(t,e,i){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.clinicalInfo[t.value].color).style("filter","none")}}}}[e]}function a(){var e=".legend-shape-g-tag",i=".legend-text-g-tag";return{margin:[20,15,5,15],attr:{x:function(t,e,i){return"text"===this.tagName?i.margin.left:0},y:function(e,i,n){var o="text"===this.tagName?i*(n.fontHeight+n.padding):i*(n.fontHeight+n.padding)-n.fontHeight/2-1;return"rect"===this.tagName&&"var"===t(e)?o+n.fontHeight/4:o},width:function(t,e,i){return i.fontHeight/2},height:function(e,i,n){return"var"===t(e)?n.fontHeight/2:n.fontHeight}},style:{fill:function(t,e,i){return"text"===this.tagName?"#333333":bio.boilerPlate.variantInfo[t].color},fontSize:"11px"},on:{mouseover:function(t,n,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(i,a),s=bio.rendering().opacity(bio.boilerPlate.variantInfo[t].color,.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,n,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(i,a);d3.select(r).transition(10).style("fill",bio.boilerPlate.variantInfo[t].color),d3.select(l).style("font-weight","normal")}},text:function(t,e,i){return t}}}return function(){return{bar:n,axis:e,legend:a,byCase:t,title:i,heatmap:o}}}function pathwayConfig(){"use strict";function t(t){if(t){var e=bio.scales().get([0,50],[1,.5]),i=d3.hsl("Y"===t.active?"red":"blue");return i.l=e(t.frequency),i}return"#d0d0d0"}function e(t){var e=d3.select(t).node().parentNode.id;return e.substring(e.lastIndexOf("_")+1,e.length).toUpperCase()}function i(){return{style:{fill:function(e,i,n){return"rect"===this.tagName?t(e):e&&e.frequency>=30?"#F2F2F2":"#333333"}},on:{mouseover:function(t,i,n){var o="rect"===this.tagName?this:d3.select(this.parentNode).select("rect").node(),a=t?t.frequency:"NA",r=t?"Y"===t.active?"RED":"BLUE":"#E8E8E8",l=t?"Y"===t.active?"Activated":"Inactivated":"NA",s=e(this);bio.tooltip({element:o,contents:"<b>"+s+"</b></br>frequency : "+a+'</br><span style="color : '+r+'"><b>'+l+"</b></span>"})},mouseout:function(t,e,i){bio.tooltip("hide")}}}}function n(){function t(t){var e="mouseout"===d3.event.type?0:1,i=e?.02:0,n=e?-5:0;d3.select(this).transition().attr("transform",function(){return"matrix("+(t.scaleX+i)+", 0, 0, "+(t.scaleY+i)+", "+(t.translateX+n)+", "+(t.translateY+n)+")"}).style("cursor","pointer").selectAll("path").style("stroke",e?"#FBFD24":"#FFFFFF").style("stroke-width",e?20:0)}function e(t){return t.nci_id?"http://www.cancer.gov/about-cancer/treatment/drugs/"+t.nci_id:!t.nci_id&&t.dailymed_id?"http://www.dailymed.nlm.nih.gov/dailymed/drugInfo.cfm?setid="+t.dailymed_id:null}function i(t){var e=o.drug_color[t].color,i=document.querySelector("#legend_icon_"+e).cloneNode(!0),n=document.createElement("svg");return i.setAttribute("transform","matrix(0.04, 0, 0, 0.04, 10, 0)"),n.setAttribute("width",40),n.setAttribute("height",20),n.appendChild(i),n.outerHTML}return{on:{click:function(t,n,o){var a=this.id.split("_")[1],r=document.querySelector(".modal-title"),l=document.querySelector(".modal-body");$.ajax({type:"GET",url:"/models/drug/getPathwayDrugList?pathway_gene="+a+"&cancer_type="+t.cancer,success:function(t){r.innerHTML='<div id="modal_gene_title">Available drugs</div><div id="modal_gene_name">'+a.toUpperCase()+"</div>",bio.table({height:550,element:l,heads:["Type","Drug","Level of approval","Treated Cancer","Reference"],data:t,columns:function(t,n,o,a,r){if(0===t)return i(a.drug_type);if(1===t){var l=e(a);return l?a.agent+'<a class="drug-link" href='+l+" target='drug'><i class=\"fa fa-external-link\"></i></a>":a.agent}return 2===t?a.drug_class:3===t?a.cancer:4===t?a.source:void 0}})},error:function(t){console.log("Error: ",t)}}),$("#drug_modal").modal({keyboard:!1,backdrop:"static"})},mouseover:t,mouseout:t}}}var o={drug_color:{type1:{class:"agent-red",color:"red"},type2:{class:"agent-blue",color:"blue"},type3:{class:"agent-black",color:"black"}}};return function(){return{node:i,drug:n}}}function variantsConfig(){"use strict";function t(t){return 3*Math.sqrt(t)/1.25}function e(t,e,i){if("common"===t)return{};var n=parseFloat(i.attr("width")),o=parseFloat(i.attr("height"));return{needleX:{top:o-35,left:0,direction:"bottom",range:[40,n-40],margin:[10,40,35,40]},needleY:{top:0,left:40,direction:"left",range:[20,o-80],margin:[20,40,80,0]}}[t+e]}function i(t){var e=".legend-shape-g-tag",i=".legend-text-g-tag",n=".variants_patient_legend_svg"+e,o=".variants_patient_legend_svg"+i;return{needle:{margin:[15,10,5,15],attr:{cx:function(t,e,i){return i.margin.left},cy:function(t,e,i){return e*(i.fontHeight+5)},r:5,x:function(t,e,i){return"text"===this.tagName?2*i.margin.left:i.margin.left},y:function(t,e,i){return e*(i.fontHeight+5)+1}},style:{fill:function(t,e,i){return"text"===this.tagName?"#333333":bio.boilerPlate.variantInfo[t].color}},on:{mouseover:function(t,n,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(i,a),s=bio.rendering().opacity(bio.boilerPlate.variantInfo[t].color,.3);d3.select(r).transition(10).style("fill",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,n,o){var a=o.legendData.indexOf(t),r=bio.drawing().nthChild(e,a),l=bio.drawing().nthChild(i,a);d3.select(r).transition(10).style("fill",bio.boilerPlate.variantInfo[t].color),d3.select(l).style("font-weight","normal")}},text:function(t,e,i){return t}},patient:{margin:[15,10,5,15],attr:{x:function(t,e,i){return"text"===this.tagName?2*i.margin.left:i.margin.left},y:0,points:function(t,e,i){return bio.rendering().triangleStr(i.margin.left,-5,8,"top")}},style:{fill:function(t,e,i){return"text"===this.tagName?"#333":"#FFFFFF"},stroke:function(t,e,i){return"text"===this.tagName?"none":"#333333"},strokeWidth:"1px"},on:{mouseover:function(t,e,i){var a=i.legendData.indexOf(t),r=bio.drawing().nthChild(n,a),l=bio.drawing().nthChild(o,a),s=bio.rendering().opacity("#333333",.3);d3.select(r).transition(10).style("stroke",s),d3.select(l).style("font-weight","bold")},mouseout:function(t,e,i){var a=i.legendData.indexOf(t),r=bio.drawing().nthChild(n,a),l=bio.drawing().nthChild(o,a);d3.select(r).transition(10).style("stroke","#333333"),d3.select(l).style("font-weight","normal")}},text:function(t,e,i){return t}}}[t]}function n(){return{margin:[20,40,80,40],attr:{cx:function(t,e,i){var n=i.scaleX(t.x);return n>i.width-i.margin.right||n<i.margin.left?n*i.width:n},cy:function(t,e,i){return i.scaleY(t.y)},r:function(e,i,n){return t(e.value)},x:function(t,e,i){var n=i.scaleX(t.x);return n>i.width-i.margin.right||n<i.margin.left?n*i.width:n},y:function(t,e,i){return i.scaleY(t.y)}},style:{fill:function(t,e,i){return"path"===this.tagName?"#A8A8A8":i.id.indexOf("needle")>-1?bio.boilerPlate.variantInfo[t.info[0].type].color:bio.rendering().opacity(bio.boilerPlate.variantInfo[t.info[0].type].color,.3)},stroke:function(t,e,i){return"path"===this.tagName?"#A8A8A8":"none"}},on:{mouseover:function(t,e,i){var n=bio.rendering().opacity(bio.boilerPlate.variantInfo[t.info[0].type].color,.5);bio.tooltip({element:this,contents:"Type: <b>"+t.info[0].type+"</b></br>AAChange: <b>"+t.info[0].aachange+"</b></br>Counts: <b>"+t.y+"</b></br>Position: <b>"+t.x+"</b>"}),d3.select(this).transition(10).style("fill",n)},mouseout:function(t,e,i){bio.tooltip("hide"),d3.select(this).transition(10).style("fill",bio.boilerPlate.variantInfo[t.info[0].type].color)}}}}function o(){return{margin:[0,40,5,40],end:{init:0,now:0},start:{init:0,now:0},navi:{init:0,now:0,width:0,nowWidth:0},attr:{x:function(t,e,i){return"main"===t?i.start:"end"===t?i.end+i.margin.left-i.controls.width:i.start-i.controls.width},y:function(t,e,i){return"main"===t?0:.25*i.height},width:function(t,e,i){return"main"===t?i.end:2*i.controls.width},height:function(t,e,i){return"main"===t?i.height-i.margin.bottom:i.controls.height},rx:function(t,e,i){return"main"===t?3:5},ry:function(t,e,i){return"main"===t?3:5}},style:{fill:function(t,e,i){return"main"===t?"rgba(255, 255, 50, 0.1)":"#A8A8A8"},stroke:function(t,e,i){return"main"===t?"#FFDF6D":"#EAECED"},strokeWidth:function(t,e,i){return"main"===t?"1px":"2px"},cursor:function(t,e,i){return"main"===t?"move":"ew-resize"}},call:{drag:function(t,e,i){function n(t){return l[t].now+=d3.event.dx,l[t].now=Math.max(l.start["end"===t?"now":"init"],Math.min(l.end["end"===t?"init":"now"],l["end"===t?"end":"start"].now)),l[t].now}var o=d3.select("#variants_navi_svg_navi_main_rect"),a=d3.select("#variants_navi_svg_navi_start_rect"),r=d3.select("#variants_navi_svg_navi_end_rect"),l=i.opts.drag;if("start"===t)d3.select(this).attr("x",n(t)),l.navi.now=l.navi.init+(l.start.now-l.start.init),l.navi.nowWidth=l.navi.width-(l.end.init-l.end.now)-(l.start.now-l.start.init),o.attr("x",l.navi.now).attr("width",l.navi.nowWidth);else if("end"===t)d3.select(this).attr("x",n(t)),l.navi.nowWidth=l.navi.width-(l.start.now-l.start.init)-(l.end.init-l.end.now),o.attr("width",l.navi.nowWidth);else{l.navi.now+=d3.event.dx;var s=l.navi.now=Math.max(l.navi.init,Math.min(l.navi.width+i.margin.left-l.navi.nowWidth,l.navi.now));l.start.now=s-i.controls.width,l.end.now=s+l.navi.nowWidth-i.controls.width,o.attr("x",s),a.attr("x",l.start.now),r.attr("x",l.end.now)}}}}}function a(){return{margin:[20,40,80,40],attr:{x:function(t,e,i){var n=i.scaleX(t.x);return this.id.indexOf("base")>-1?i.margin.left:this.id.indexOf("text")>-1?n+5:n<i.margin.left?i.margin.left:n>i.width-i.margin.right?i.width-i.margin.right:n},y:function(t,e,i){var n=.4*(i.height-10-(i.height-i.margin.bottom));return"text"!==this.tagName?i.height-i.margin.bottom:i.height-i.margin.bottom+n/2},width:function(t,e,i){var n=i.scaleX(t.x),o=i.scaleX(t.x+t.width);if(n<i.margin.left){if((o-=i.margin.left-n)<0)return 0}else if(n+(o-n)>i.width-i.margin.right&&(o-=n+o-n-(i.width-i.margin.right))-n<0)return 0;return this.id.indexOf("base")>-1?i.width-i.margin.left-i.margin.right:o-n},height:function(t,e,i){return.4*(i.height-10-(i.height-i.margin.bottom))},rx:function(t,e,i){return this.id.indexOf("base")>-1?1:3},ry:function(t,e,i){return this.id.indexOf("base")>-1?1:3}},style:{fill:function(t,e,i){return this.id.indexOf("base")>-1?"#DADFE1":this.id.indexOf("text")>-1?"#FFFFFF":t.color}},on:{mouseover:function(t,e,i){var n=this.id.indexOf("base")>-1?null:"text"===this.tagName?this.previousSibling?this.previousSibling:this.nextSibling:this,o=bio.rendering().opacity(t.color,.5);n&&(bio.tooltip({element:n,contents:"<b>"+t.info.identifier+"</b></br>Desc: <b>"+t.info.description+"</b></br>Section: <b>"+t.x+" - "+(t.x+t.width)+"</b>"}),d3.select(n).transition(10).style("fill",o))},mouseout:function(t,e,i){var n=this.id.indexOf("base")>-1?null:"text"===this.tagName?this.previousSibling?this.previousSibling:this.nextSibling:this;n&&(bio.tooltip("hide"),d3.select(n).transition(10).style("fill",t.color))}},text:function(t,e,i){var n=i.scaleX(t.x),o=i.scaleX(t.x+t.width);return bio.drawing().textOverflow(t.info.identifier,"10px",o-n,5)}}}function r(){return{margin:[20,40,7.5,40],attr:{points:function(t,e,i){var n=i.scaleX(t.x);return(n<i.margin.left||n>i.width-i.margin.right)&&(n=i.width+i.margin.right),bio.rendering().triangleStr(n,i.scaleY(t.y)-i.margin.bottom,10,"top")}},style:{fill:function(t,e,i){return"path"===this.tagName?"#A8A8A8":bio.boilerPlate.variantInfo[t.info[0].type].color},stroke:function(t,e,i){return"path"===this.tagName?"#A8A8A8":"none"}}}}return function(){return{axis:e,navi:o,graph:a,legend:i,needle:n,radius:t,patient:r}}}function axises(){"use strict";function t(t,e){var i=[e.top||0,e.left||0];return{group:bio.rendering().addGroup(e.element,i[0],i[1],t+"-axis"),position:i,margin:bio.sizing.setMargin(e.margin),scale:bio.scales().get(e.domain,e.range)}}function e(t,e){if("string"!=typeof e)throw new Error("2nd Parameter type is not a string");return e?(t.selectAll(e).remove(),t):t}function i(t,i,o){var a=n.byD3v(t.scale,o,i);return i.tickValues,i.exclude?e(t.group.call(a),i.exclude):t.group.call(a)}var n={axises:{}};return n.byD3v=function(t,e,i){var n=(bio.dependencies.version.d3v4()?d3["axis"+e.pronoun()](t):d3.svg.axis().scale(t).orient(e)).ticks(5);return i&&i.tickValues?n.tickValues(i.tickValues):i&&i.ticks&&n.ticks(i.ticks),n},n.top=function(e){return i(t("top",e),e,"top")},n.left=function(e){return i(t("left",e),e,"left")},n.bottom=function(e){return i(t("bottom",e),e,"bottom")},n.right=function(e){return i(t("right",e),e,"right")},function(){return n}}function bar(){"use strict";function t(t,e,i,n){return"left"===n||"top"===n?[e,t-i]:[t-i,e]}var e={};return function(i,n){e=bio.objects.clone(n||{}),(e=bio.sizing.chart.default(e,i)).copyX=[].concat(i.xaxis),e.copyY=[].concat(i.yaxis),e.startTo=i.startTo||["top","left"],e.rangeX=t(e.width,e.margin.left,e.margin.right,e.startTo[1]),e.rangeY=t(e.height,e.margin.top,e.margin.bottom,e.startTo[0]),e.scaleX=bio.scales().get(e.copyX,e.rangeX),e.scaleY=bio.scales().get(e.copyY,e.rangeY),e.group=bio.rendering().addGroup(i.element,0,0,"bar"),e.opts=bio.objects.clone(i),e.opts.id=e.id+"_bar_rect",e.opts.element=e.group.selectAll("#"+e.id+"_bar_rect"),bio.rectangle(e.opts,e)}}function circle(){"use strict";return function(t,e){e=e||{},bio.rendering().circle({element:t.element,data:t.data||null,attr:t.attr?{id:function(i,n){return(t.id||e.id||t.element.attr("id"))+"_circle"},cx:function(i,n){return t.attr.cx?"function"!=typeof t.attr.cx?t.attr.cx:t.attr.cx.call(this,i,n,e):0},cy:function(i,n){return t.attr.cy?"function"!=typeof t.attr.cy?t.attr.cy:t.attr.cy.call(this,i,n,e):0},r:function(i,n){return t.attr.r?"function"!=typeof t.attr.r?t.attr.r:t.attr.r.call(this,i,n,e):0}}:null,style:t.style?{fill:function(i,n){return t.style.fill?"function"!=typeof t.style.fill?t.style.fill:t.style.fill.call(this,i,n,e):"#000000"},"fill-opacity":function(i,n){return t.style.fillOpacity?"function"!=typeof t.style.fillOpacity?t.style.fillOpacity:t.style.fillOpacity.call(this,i,n,e):1},stroke:function(i,n){return t.style.stroke?"function"!=typeof t.style.stroke?t.style.stroke:t.style.stroke.call(this,i,n,e):"none"},"stroke-width":function(i,n){return t.style.strokeWidth?"function"!=typeof t.style.strokeWidth?t.style.strokeWidth:t.style.strokeWidth.call(this,i,n,e):"0px"},filter:function(i,n){return!!t.style.filter&&("function"!=typeof t.style.filter?t.style.filter:t.style.filter.call(this,i,n,e))},cursor:function(i,n){return!!t.style.cursor&&("function"!=typeof t.style.cursor?t.style.cursor:t.style.cursor.call(this,i,n,e))}}:null,on:t.on?{click:function(i,n){!!t.on.click&&t.on.click.call(this,i,n,e)},mouseover:function(i,n){!!t.on.mouseover&&t.on.mouseover.call(this,i,n,e)},mouseout:function(i,n){!!t.on.mouseout&&t.on.mouseout.call(this,i,n,e)}}:null})}}function divisionLine(){"use strict";var t={};return function(e,i){t=bio.objects.clone(i||{}),(t=bio.sizing.chart.default(t,e)).position={now:{},init:{}},t.isMarker=void 0===e.isMarker||e.isMarker,e.pathElement="Array"!==bio.objects.getType(e.pathElement)?[e.pathElement]:e.pathElement,t.division_data=e.data,t.division_info=e.info||[{additional:0,color:"#000000",direction:null,text:"Low",textWidth:10},{additional:0,color:"#FFFFFF",direction:null,text:"High",textWidth:10}],bio.iteration.loop(t.division_info,function(t){t.textWidth=bio.drawing().textSize.width(t.text.replace(" ","a"),e.style.fontSize||"10px")}),t.axis=[].concat(e.axis),t.range=[t.margin.left,t.width-t.margin.right],t.scale=bio.scales().get(t.axis,t.range),t.invert=bio.scales().invert(t.scale),i.data.bar?bio.iteration.loop(i.data.bar,function(i){i.value===e.idxes[0]?t.division_info[0].start=t.scale(i.x):i.value===e.idxes[1]?(t.division_info[0].end=t.scale(i.x),t.division_info[1].start=t.scale(i.x)):i.value===e.idxes[2]&&(t.division_info[1].end=t.scale(i.x))}):t.now.geneset&&(t.division_info[0].start=t.scale(t.axis[0]),t.division_info[0].end=t.scale(e.idxes),t.division_info[1].start=t.scale(e.idxes),t.division_info[1].end=t.scale(t.axis.length-1)),t.shapeGroup=bio.rendering().addGroup(e.element,0,0,"division-shape"),t.textGroup=bio.rendering().addGroup(e.element,0,0,"division-text"),t.opts={text:bio.objects.clone(e),shape:bio.objects.clone(e)},t.opts.text.id=t.id+"_division_text",t.opts.text.data=t.division_info,t.opts.text.element=t.textGroup.selectAll("#"+t.id+"_division_text"),t.opts.shape.id=t.id+"_division_shape",t.opts.shape.data=t.division_info,t.opts.shape.element=t.shapeGroup.selectAll("#"+t.id+"_division_shape"),bio.text(t.opts.text,t),bio.rectangle(t.opts.shape,t),bio.iteration.loop(e.pathElement,function(i,n){var o="shape_"+n,a="path_"+n,r=bio.objects.clone(t.division_info[n]),l=bio.objects.clone(t.division_info[n]),s=[r,l];r.path_x=t.division_info[0].end,l.path_x=t.division_info[0].end,r.path_y=0===n?10:0,l.path_y=0===n?i.attr("height"):i.attr("height")-18,t.opts[a]=bio.objects.clone(e),t.opts[a].id=t.id+"_division_path_"+n,t.opts[a].data=s,t.opts[a].element=bio.rendering().addGroup(i,0,0,"division-path-"+n),t.opts[o]=bio.objects.clone(e),t.opts[o].id=t.id+"_division_shape_"+n,t.opts[o].data=[s[n]],t.opts[o].element=bio.rendering().addGroup(i,0,0,"division-shape-"+n).selectAll("#"+t.id+"_division_shape_"+n),t.isMarker&&bio.triangle({element:t.opts[o].element,data:t.opts[o].data,attr:t.opts[o].attr,style:t.opts[o].style,call:t.opts[o].call},t),bio.path({element:t.opts[a].element,data:t.opts[a].data,attr:t.opts[a].attr,style:{stroke:"#333333",strokeWidth:"0.5px"}},t)})}}function drawing(){"use strict";function t(t,e,i){var n=document.createElement("span"),o=document.createElement("div"),a=document.createElement("div");"width"===t?i=i.split(" "):e=e.split(" "),a.id="get_text_"+t,n.style.fontSize="width"===t?i[0]:e[0],n.style.fontWeight="width"===t?i[1]:e[1],n.innerHTML="width"===t?e:"Hg",o.style.display="inline-block",o.style.width="1px",o.style.height="0px",a.appendChild(n),a.appendChild(o),document.body.appendChild(a);try{var r=n.getBoundingClientRect()[t].toFixed()}finally{document.body.removeChild(document.getElementById("get_text_"+t))}return parseFloat(r)}var e={textSize:{}};return e.textSize.width=function(e,i){return t("width",e,i)},e.mostWidth=function(t,i){var n=[];return bio.iteration.loop(t,function(t){n.push({text:t,value:e.textSize.width(t,i)})}),n.sort(function(t,e){return t.value<e.value?1:-1})[0]},e.textSize.height=function(e){return t("height",e)},e.fitText=function(t,i,n,o){for(var a=10,r=a+"px "+(o||"normal");e.textSize.height(r)<n&&e.textSize.width(t,r)<i;)r=(a+=1)+"px "+o;return a-1+"px"},e.textOverflow=function(t,i,n,o){var a="";return o=o||5,e.textSize.width(t,i)<n-o?t:(bio.iteration.loop(t.split(""),function(t){e.textSize.width(a+=t,i)>n-o&&(a=a.substring(0,a.length-2))}),a)},e.getParentSVG=function(t){return"svg"===t.parentElement.tagName?t.parentElement:e.getParentSVG(t.parentElement)},e.nthChild=function(t,e){return d3.select(t).node().children[e]},e.findDom=function(t,e){if(t.children<1)throw new Error("There are no any child elements");var i=Array.prototype.slice.call(t.children),n=null;return bio.iteration.loop(i,function(t){t.tagName!==e.toUpperCase()&&"."+t.className!==e&&"#"+t.id!==e||(n=t)}),n},e.slideDown=function(t){var e=t.style.height?parseFloat(t.style.height):t.getBoundingClientRect().height,i=0;t.style.height="0px";var n=setInterval(function(){i+=1,t.style.height=i+"px",i===e&&clearInterval(n)},5)},e.slideUp=function(t){var e=t.style.height?parseFloat(t.style.height):t.getBoundingClientRect().height,i=parseFloat(t.style.height),n=setInterval(function(){i-=1,t.style.height=i+"px",0===i&&(clearInterval(n),t.style.height=e+"px",t.style.display="none")},5)},e.importSVG=function(t,e){var i=null;return d3.xml(t).mimeType("image/svg+xml").get(function(t,n){if(t)throw t;return e?e(n):i=n}),i},e.nodes=function(t){var e=[];return t.each(function(t){e.push(this)}),e},function(){return e}}function heat(){"use strict";function t(t){return bio.iteration.loop(t,function(t,e){bio.iteration.loop(i.mutationType,function(t){e[t][0]&&i.duplicate.push({x:e.x,y:e.y,value:e[t][0],info:e[t].splice(1)})})}),i.duplicate}function e(e){return bio.iteration.loop(e,function(t){var e=t.x+t.y,n=bio.landscapeConfig().byCase(t.value);i.value[e]?bio.boilerPlate.variantInfo[i.value[e][n][0]]>bio.boilerPlate.variantInfo[t.value]?i.value[e][n].unshift(t.value):i.value[e][n].push(t.value):(i.value[e]={cnv:[],var:[],x:t.x,y:t.y},i.value[e][n].push(t.value))}),t(i.value)}var i={};return function(t,n){i=bio.objects.clone(n||{}),(i=bio.sizing.chart.default(i,t)).copyX=[].concat(t.xaxis),i.copyY=[].concat(t.yaxis),i.rangeX=[i.margin.left,i.width-i.margin.right],i.rangeY=[i.margin.top,i.height-i.margin.bottom],i.scaleX=bio.scales().get(i.copyX,i.rangeX),i.scaleY=bio.scales().get(i.copyY,i.rangeY),i.group=bio.rendering().addGroup(t.element,0,0,"heatmap"),i.opts=bio.objects.clone(t),i.opts.data=i.duplicate?e(i.opts.data):i.opts.data,i.opts.id=i.id+"_heatmap_rect",i.opts.element=i.group.selectAll("#"+i.id+"_heatmap_rect"),bio.rectangle(i.opts,i)}}function legend(){"use strict";var t={};return function(e,i){t=bio.objects.clone(i||{}),(t=bio.sizing.chart.default(t,e)).legendData=e.data,t.padding=e.padding||5,t.fontSize=e.style.font||"10px",t.fontWidth=bio.drawing().mostWidth(t.legendData,t.fontSize),t.fontHeight=bio.drawing().textSize.height(t.fontSize),t.shapeWidth=t.width-(t.margin.left+t.margin.right+t.fontWidth.value),t.shapeGroup=bio.rendering().addGroup(e.element,t.margin.top,t.margin.left,"legend-shape"),t.textGroup=bio.rendering().addGroup(e.element,t.margin.top,t.margin.left,"legend-text"),t.opts={text:bio.objects.clone(e),shape:bio.objects.clone(e)},t.opts.text.id=t.id+"_legend_text",t.opts.text.element=t.textGroup.selectAll("#"+t.id+"_legend_text"),t.opts.shape.id=t.id+"_legend_shape",t.opts.shape.element=t.shapeGroup.selectAll("#"+t.id+"_legend_shape"),e.attr&&e.attr.width?bio.rectangle(t.opts.shape,t):e.attr&&e.attr.r?bio.circle(t.opts.shape,t):e.attr&&e.attr.points&&bio.triangle(t.opts.shape,t),bio.text(t.opts.text,t);var n=e.element.node().parentNode,o=t.textGroup.node().getBoundingClientRect();n.style.height=o.height+t.margin.top+t.padding+"px",n.style.width=t.width-5+"px"}}function needle(){"use strict";var t={};return function(e,i){t=bio.objects.clone(i||{}),(t=bio.sizing.chart.default(t,e)).copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.height-t.margin.bottom,t.margin.top],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.lineGroup=bio.rendering().addGroup(e.element,0,0,"needle-line"),t.shapeGroup=bio.rendering().addGroup(e.element,0,0,"needle-shape"),t.opts={line:bio.objects.clone(e),shape:bio.objects.clone(e)},t.opts.line.element=t.lineGroup,t.opts.shape.data=e.shapeData,t.opts.shape.element=t.shapeGroup.selectAll("#"+t.id+"_needle_shape"),bio.iteration.loop(e.lineData,function(e){t.opts.line.data=e.value,bio.path(t.opts.line,t)}),bio.circle(t.opts.shape,t)}}function network(){"use strict";function t(t,e){return d3.layout.force().nodes(t).links(e).charge(d3.forceManyBody()).linkDistance(150)}function e(t,e){return d3.forceSimulation(t).force("charge",d3.forceManyBody().strength(function(t,e){return t.group,-300-t.radius/100*600})).force("link",d3.forceLink(e).id(function(t){return t.text}).distance(function(t){return t.source.group&&t.target.group?90-t.source.radius/100*90:1===t.isOne?10+t.source.radius/100*1050:190-t.source.radius/100*190})).force("x",d3.forceX(function(t){return t.group?o.width/2.1:o.width-o.width*(t.index/10)})).force("y",d3.forceY(function(t){return t.group?o.height/2.5:.95*o.height}))}function i(t,e,i,n,a){var r=bio.rendering().addGroup(o.element,0,0,t);bio.rectangle({id:t,element:r,attr:{rx:2,ry:2,y:e,x:i,width:n,height:a},style:{strokeWidth:2,fill:"#FFFFFF",stroke:"#333333",filter:'url("#drop_shadow")',fillOpacity:function(e){return"compound"===t?1:.3}}},o)}function n(t,e,i){var n=bio.rendering().addGroup(o.element,0,0,"network-info");bio.text({element:n,text:t,id:"network_info",attr:{x:i,y:e},style:{fontSize:"16px",fontWeight:"bold"}})}var o={};return function(a,r){o=bio.objects.clone(r||{}),(o=bio.sizing.chart.default(o,a)).bcr=o.element.node().getBoundingClientRect(),o.network_data=a.data,o.arrow_width=5;var l=null,s=[],c=[];bio.iteration.loop(o.network_data,function(t){"compound"===t.type?l=t:"node"===t.type?s.push(t):c.push(t)}),bio.iteration.loop(s,function(t){l.members.indexOf(t.text)>-1&&(t.group=1),t.radius=(bio.drawing().textSize.width(t.text,"12px")+10)/2});var u={};bio.iteration.loop(c,function(t){u[t.target]=!0}),bio.iteration.loop(c,function(t){t.isOne=Object.keys(u).length}),bio.rendering().dropShadow(o.element.append("svg:defs"),1,-.1,1),bio.rendering().marker({id:"id",data:c,color:"linecolor",width:o.arrow_width,height:o.arrow_width,svg:o.element.append("svg:defs")}),i("infomation",.05*o.height,10,o.width-20,.1*o.height),i("compound",.15*o.height,10,o.width-20,.54*o.height),n(l.text,.105*o.height,o.width/2-bio.drawing().textSize.width(l.text,"16px")/2);for(var d=bio.dependencies.version.d3v4()?e(s,c):t(s,c),p=0,f=Math.ceil(Math.log(d.alphaMin())/Math.log(1-d.alphaDecay()));p<f;++p)d.tick();var g=bio.rendering().addGroup(o.element,0,0,"link-layer"),h=bio.rendering().addGroup(o.element,0,0,"node-layer"),m=g.selectAll(".link").data(c).enter().append("svg:path").attr("class","link").attr("marker-end",function(t){return'url("#marker_'+t.id+'")'}).style("fill","#FFFFFF").style("fill-opacity",.1).style("stroke",function(t){return t.linecolor}).style("stroke-width",1.5).style("stroke-dasharray",function(t){return"Dashed"===t.style?"3, 3":"none"}),v=h.selectAll(".node").data(s).enter().append("g").attr("class"," node");v.append("circle").attr("r",function(t){return(bio.drawing().textSize.width(t.text,"12px")+10)/2}).attr("fill",function(t){return t.bgcolor}).attr("stroke","#333333").attr("stroke-width",1),v.append("text").attr("dx",0).attr("dy",5).attr("text-anchor","middle").style("font-size","12px").style("font-weight","bold").text(function(t){return t.text});d.on("tick",function(){v.attr("transform",function(t,e){t.x=t.group?t.x:o.width/2.5,t.y=t.group?t.y:.78*o.height}),m.attr("d",function(t){var e=t.target.x-t.source.x,i=t.target.y-t.source.y,n=Math.sqrt(e*e+i*i),a=e*(t.target.radius+o.arrow_width)/n,r=i*(t.target.radius+o.arrow_width)/n;return"M"+t.source.x+","+t.source.y+"A"+n+","+n+" 0 0,1 "+(t.target.x-a)+","+(t.target.y-r)}),v.attr("transform",function(t){return"translate("+t.x+","+t.y+")"})})}}function path(){"use strict";function t(t,e){var i=this;return(bio.dependencies.version.d3v4()?d3.line():d3.svg.line()).x(function(n,o){return t.attr.x?"function"!=typeof t.attr.x?t.attr.x:t.attr.x.call(i,n,o,e):0}).y(function(n,o){return t.attr.y?"function"!=typeof t.attr.y?t.attr.y:t.attr.y.call(i,n,o,e):0})}return function(e,i){i=i||{},bio.rendering().line({element:e.element,attr:e.attr?{id:function(t){return(e.id||i.id||e.element.attr("id"))+"_path"},d:function(n,o){return t.call(this,e,i)(e.data)}}:null,style:e.style?{fill:function(t,n){return e.style.fill?"function"!=typeof e.style.fill?e.style.fill:e.style.fill.call(this,t,n,i):"#A8A8A8"},stroke:function(t,n){return e.style.stroke?"function"!=typeof e.style.stroke?e.style.stroke:e.style.stroke.call(this,t,n,i):"#A8A8A8"},"stroke-width":function(t,n){return e.style.strokeWidth?"function"!=typeof e.style.strokeWidth?e.style.strokeWidth:e.style.strokeWidth.call(this,t,n,i):"1px"}}:null})}}function rectangle(){"use strict";return function(t,e){return e=e||{},bio.rendering().rect({element:t.element,data:t.data||null,attr:t.attr?{id:function(i){return(t.id||e.id||t.element.attr("id"))+"_rect"},x:function(i,n){return t.attr.x?"function"!=typeof t.attr.x?t.attr.x:t.attr.x.call(this,i,n,e):0},y:function(i,n){return t.attr.y?"function"!=typeof t.attr.y?t.attr.y:t.attr.y.call(this,i,n,e):0},rx:function(i,n){return t.attr.rx?"function"!=typeof t.attr.rx?t.attr.rx:t.attr.rx.call(this,i,n,e):0},ry:function(i,n){return t.attr.ry?"function"!=typeof t.attr.ry?t.attr.ry:t.attr.ry.call(this,i,n,e):0},width:function(i,n){return t.attr.width?"function"!=typeof t.attr.width?t.attr.width:t.attr.width.call(this,i,n,e):1},height:function(i,n){return t.attr.height?"function"!=typeof t.attr.height?t.attr.height:t.attr.height.call(this,i,n,e):1}}:null,style:t.style?{fill:function(i,n){return t.style.fill?"function"!=typeof t.style.fill?t.style.fill:t.style.fill.call(this,i,n,e):"#000000"},"fill-opacity":function(i,n){return t.style.fillOpacity?"function"!=typeof t.style.fillOpacity?t.style.fillOpacity:t.style.fillOpacity.call(this,i,n,e):"none"},stroke:function(i,n){return t.style.stroke?"function"!=typeof t.style.stroke?t.style.stroke:t.style.stroke.call(this,i,n,e):"none"},"stroke-width":function(i,n){return t.style.strokeWidth?"function"!=typeof t.style.strokeWidth?t.style.strokeWidth:t.style.strokeWidth.call(this,i,n,e):"0px"},filter:function(i,n){return!!t.style.filter&&("function"!=typeof t.style.filter?t.style.filter:t.style.filter.call(this,i,n,e))},cursor:function(i,n){return!!t.style.cursor&&("function"!=typeof t.style.cursor?t.style.cursor:t.style.cursor.call(this,i,n,e))}}:null,on:t.on?{click:function(i,n){!!t.on.click&&t.on.click.call(this,i,n,e)},mouseover:function(i,n){!!t.on.mouseover&&t.on.mouseover.call(this,i,n,e)},mouseout:function(i,n){!!t.on.mouseout&&t.on.mouseout.call(this,i,n,e)}}:null,call:t.call?{start:function(i,n){!!t.call.start&&t.call.start.call(this,i,n,e)},drag:function(i,n){!!t.call.drag&&t.call.drag.call(this,i,n,e)},end:function(i,n){!!t.call.end&&t.call.end.call(this,i,n,e)}}:null})}}function rendering(){"use strict";function t(t,e){if(!e)return!1;bio.iteration.loop(e,function(e,i){t.attr(e,i)})}function e(t,e){if(!e)return!1;bio.iteration.loop(e,function(e,i){t.style(e,i)})}function i(t,e){if(!e)return!1;bio.iteration.loop(e,function(e,i){t.on(e,i)})}function n(t,e){if(!e)return!1;var i=bio.dependencies.version.d3v4()?d3.drag():d3.behavior.drag().origin(Object);bio.iteration.loop(e,function(t,e){t=bio.dependencies.version.d3v4()?t:"drag"!==t?"drag"+t:t,i.on(t,e)}),t.call(i)}function o(t,e){t.text(e)}function a(a){if(!this.element)throw new Error("Not defined SVG Element");var r=this.data?this.element.data(this.data).enter().append(a):this.element.append(a);return!!this.text&&o(r,this.text),t(r,this.attr),e(r,this.style),i(r,this.on),n(r,this.call),r}var r={};return r.createSVG=function(t,e,i){var n=bio.dom().get(t),o=n.id?"#"+n.id:"."+n.className,a=e||parseFloat(n.style.width),r=i||parseFloat(n.style.height);return d3.select(o).append("svg").attr("id",n.id+"_svg").attr("width",a).attr("height",r)},r.addGroup=function(t,e,i,n){t=bio.dependencies.version.d3v4()?t:t[0][0],t="Array"===bio.objects.getType(t)||"Object"===bio.objects.getType(t)?t:d3.select(t),n=n||"";var o=t.attr("id"),a=d3.selectAll("."+o+"."+n+"-g-tag");return(a.node()?a:t).append("g").attr("class",o+" "+n+"-g-tag").attr("transform","translate("+i+", "+e+")")},r.rect=function(t){return a.call(t,"rect")},r.circle=function(t){return a.call(t,"circle")},r.triangle=function(t){return a.call(t,"polygon")},r.triangleStr=function(t,e,i,n){var o,a,r,l,s="left"===n||"bottom"===n?-1:1;return"left"===n||"right"===n?(a=i/2*-1,r=o=i*s,l=i/2):(o=i/2*-1,r=i/2,l=a=i*s),t+","+e+" "+(t+o)+","+(e+a)+" "+(t+r)+","+(e+l)+" "+t+","+e},r.text=function(t){return a.call(t,"text")},r.line=function(i){var n=i.element.append("path");return t(n,i.attr),e(n,i.style),n},r.dropShadow=function(t,e,i,n){var o=t.append("defs").append("filter").attr("id","drop_shadow");o.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",e||3).attr("result","blur"),o.append("feOffset").attr("in","blur").attr("dx",i||2).attr("dy",n||2).attr("result","offsetBlur");var a=o.append("feMerge");a.append("feMergeNode").attr("in","offsetBlur"),a.append("feMergeNode").attr("in","SourceGraphic")},r.marker=function(t){t.svg.selectAll("marker").data(t.data||[""]).enter().append("svg:marker").attr("id",function(e){return t.id?"marker_"+e[t.id]:"marker"}).attr("viewBox","0 -5 10 10").attr("refX",5).attr("refY",0).attr("markerWidth",t.width||5).attr("markerHeight",t.height||5).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5").attr("fill",function(e){return t.color?e[t.color]:"#333333"})},r.opacity=function(t,e){var i=d3.rgb(t);return i.opacity=e||.3,i},r.translation=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","g");e.setAttributeNS(null,"transform",t);var i=e.transform.baseVal.consolidate().matrix;return{scale:[i.a,i.d],translate:[i.e,i.f],rotate:i.b,skew:i.c}},function(){return r}}function scales(){"use strict";function t(t){return"Number"===bio.objects.getType(t[0])?"linear":"ordinal"}var e={};return e.ordinal=function(t,e){return bio.dependencies.version.d3v4()?d3.scaleBand().domain(t).range(e):d3.scale.ordinal().domain(t).rangeBands(e)},e.linear=function(t,e){return bio.dependencies.version.d3v4()?d3.scaleLinear().domain(t).range(e):d3.scale.linear().domain(t).range(e)},e.get=function(i,n){return e[t(i)](i,n)},e.invert=function(e){var i=e.domain(),n=e.range();return("linear"===t(i)?bio.dependencies.version.d3v4()?d3.scaleLinear():d3.scale.linear():bio.dependencies.version.d3v4()?d3.scaleQuantize():d3.scale.quantize()).domain(n).range(i)},e.band=function(t){return bio.dependencies.version.d3v4()?t.bandwidth():t.rangeBand()},function(){return e}}function scatter(){"use strict";var t={};return function(e,i){t=bio.objects.clone(i||{}),(t=bio.sizing.chart.default(t,e)).scatter_data=e.data,t.copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.margin.top,t.height-t.margin.bottom],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.group=bio.rendering().addGroup(e.element,0,0,"scatter"),t.opts=bio.objects.clone(e),t.opts.data=t.scatter_data,t.opts.id=t.id+"_scatter_shape",t.opts.element=t.group.selectAll("#"+t.id+"_scatter_shape"),bio.circle(t.opts,t)}}function survival(){"use strict";function t(t){function e(t,e,i,n){var o={};o[t]={case_id:t,months:e,status:i},n.push(o)}var i={os:[],dfs:[]},n={os:[],dfs:[]},o={os:[],dfs:[]};return bio.iteration.loop(t,function(t){if(t){var a=t.os_days/30,r=t.dfs_days/30;i.os.push(a),i.dfs.push(r),null!=a&&null!=t.os_status&&e(t.participant_id,a,t.os_status,n.os),null!=r&&null!=t.dfs_status&&e(t.participant_id,r,t.dfs_status,n.dfs),e(t.participant_id,a,t.os_status,o.os),e(t.participant_id,r,t.dfs_status,o.dfs)}}),{month:i,pure:n,all:o}}function e(t,e){var i=document.createElement("input");return i.id=t+"_survival",i.name="tabs",i.type="radio",i.checked=0===e,i}function i(t,e){var i=document.createElement("label");return i.htmlFor=t+"_survival",i.innerHTML=e,i}function n(t,e){var i=document.createElement("div");return i.id=t,i}function o(t,o){document.querySelector(t).innerHTML="";for(var a=document.querySelector(t),r=0,l=o.length;r<l;r++){var s=o[r],c=o[r].toLowerCase();a.appendChild(e(c,r)),a.appendChild(i(c,s))}for(var r=0,l=o.length;r<l;r++){var u=n(o[r].toLowerCase());u.appendChild(n(o[r].toLowerCase()+"_survival_curve")),u.appendChild(n(o[r].toLowerCase()+"_stat_table")),a.appendChild(u)}}var a={};return function(e){return a.survival_data=t(e.data),o(e.element,["OS","DFS"]),SurvivalTab.init(e.division,a.survival_data.pure),a}}function text(){"use strict";return function(t,e){e=e||{},bio.rendering().text({element:t.element,data:t.data||null,attr:t.attr?{id:function(i){return(t.id||e.id||t.element.attr("id"))+"_text"},x:function(i,n){return t.attr.x?"function"!=typeof t.attr.x?t.attr.x:t.attr.x.call(this,i,n,e):0},y:function(i,n){return t.attr.y?"function"!=typeof t.attr.y?t.attr.y:t.attr.y.call(this,i,n,e):0}}:null,style:t.style?{fill:function(i,n){return t.style.fill?"function"!=typeof t.style.fill?t.style.fill:t.style.fill.call(this,i,n,e):"#000000"},"font-size":function(i,n){return t.style.fontSize?"function"!=typeof t.style.fontSize?t.style.fontSize:t.style.fontSize.call(this,i,n,e):"10px"},"font-family":function(i,n){return t.style.fontFamily?"function"!=typeof t.style.fontFamily?t.style.fontFamily:t.style.fontFamily.call(this,i,n,e):"Arial"},"font-weight":function(i,n){return t.style.fontWeight?"function"!=typeof t.style.fontWeight?t.style.fontWeight:t.style.fontWeight.call(this,i,n,e):"normal"},"alignment-baseline":function(i,n){return t.style.alignmentBaseline?"function"!=typeof t.style.alignmentBaseline?t.style.alignmentBaseline:t.style.alignmentBaseline.call(this,i,n,e):"middle"},cursor:function(i,n){return!!t.style.cursor&&("function"!=typeof t.style.cursor?t.style.cursor:t.style.cursor.call(this,i,n,e))},stroke:function(i,n){return!!t.style.stroke&&("function"!=typeof t.style.stroke?t.style.stroke:t.style.stroke.call(this,i,n,e))},"stroke-width":function(i,n){return!!t.style.strokeWidth&&("function"!=typeof t.style.strokeWidth?t.style.strokeWidth:t.style.strokeWidth.call(this,i,n,e))}}:null,on:t.on?{click:function(i,n){!!t.on.click&&t.on.click.call(this,i,n,e)},mouseover:function(i,n){!!t.on.mouseover&&t.on.mouseover.call(this,i,n,e)},mouseout:function(i,n){!!t.on.mouseout&&t.on.mouseout.call(this,i,n,e)}}:null,text:function(i,n){return t.text?"function"!=typeof t.text?t.text:t.text.call(this,i,n,e):""}})}}function triangle(){"use strict";return function(t,e){e=e||{},bio.rendering().triangle({element:t.element,data:t.data||null,attr:t.attr?{id:function(i){return(t.id||e.id||t.element.attr("id"))+"_triangle"},points:function(i,n){return t.attr.points?"function"!=typeof t.attr.points?t.attr.points:t.attr.points.call(this,i,n,e):0}}:null,style:t.style?{fill:function(i,n){return t.style.fill?"function"!=typeof t.style.fill?t.style.fill:t.style.fill.call(this,i,n,e):"#000000"},stroke:function(i,n){return t.style.stroke?"function"!=typeof t.style.stroke?t.style.stroke:t.style.stroke.call(this,i,n,e):"none"},"stroke-width":function(i,n){return t.style.strokeWidth?"function"!=typeof t.style.strokeWidth?t.style.strokeWidth:t.style.strokeWidth.call(this,i,n,e):"0px"},filter:function(i,n){return!!t.style.filter&&("function"!=typeof t.style.filter?t.style.filter:t.style.filter.call(this,i,n,e))},cursor:function(i,n){return!!t.style.cursor&&("function"!=typeof t.style.cursor?t.style.cursor:t.style.cursor.call(this,i,n,e))}}:null,on:t.on?{click:function(i,n){!!t.on.click&&t.on.click.call(this,i,n,e)},mouseover:function(i,n){!!t.on.mouseover&&t.on.mouseover.call(this,i,n,e)},mouseout:function(i,n){!!t.on.mouseout&&t.on.mouseout.call(this,i,n,e)}}:null,call:t.call?{start:function(i,n){!!t.call.start&&t.call.start.call(this,i,n,e)},drag:function(i,n){!!t.call.drag&&t.call.drag.call(this,i,n,e)},end:function(i,n){!!t.call.end&&t.call.end.call(this,i,n,e)}}:null})}}function handler(){"use strict";function t(t,e){bio.dom().get(t).addEventListener("scroll",e,!1)}function e(t,e){var i=!1;document.body.addEventListener(e,function(t){if(i)return t.preventDefault&&t.preventDefault(),!1}),t.addEventListener("mouseenter",function(t){i=!0}),t.addEventListener("mouseleave",function(t){i=!1})}function i(t,i){if(!t)throw new Error("No given element");e(t,"mousewheel"),t.addEventListener("mousewheel",function(e){t.scrollTop+=t.wheelDelta,i&&i.call(t,e)})}return function(){return{scroll:t,scrollOnHidden:i}}}function colorGradient(){"use strict";function t(t,e){i.offsets.show.push({offset:t,color:e}),i.offsets.data.push({offset:t,color:e})}function e(e,n){var o=[].concat(e).splice(1,e.length-2);t("0%",n[0]),bio.iteration.loop(o,function(t,o){var a=Math.round((bio.math.max(e)-bio.math.min(e))/t*10);i.offsets.show.push({offset:a-i.adjustValue+"%",color:n[o+1]}),i.offsets.data.push({offset:a+"%",color:n[o+1]})}),t("100%",n[e.length-1])}var i={};return function(t,n){return i=bio.objects.clone(n||{}),i=bio.sizing.chart.default(i,t),i.offsets=bio.initialize("colorGradient"),i.adjustValue=t.adjustValue||0,i.id=t.id||"linear_gradient",i.colors=t.colors||["#000000","#FFFFFF"],i.offset=t.offset||[0,100],i.defs=i.element.append("defs"),i.lineGradient=i.defs.append("linearGradient").attr("id",i.id),e(i.offset,i.colors),i.lineGradient.selectAll("stop").data(i.offsets.show).enter().append("stop").attr("offset",function(t,e){return t.offset}).attr("stop-color",function(t,e){return t.color}),i}}function expression(){"use strict";function t(){bio.selectBox({items:["Average"],viewName:"function",margin:[3,3,0,0],defaultText:"Average",id:"#expression_function",className:"expression-function",clickItem:function(t){_.now.function=t}})}function e(t,e,i){if(!_.now.colorSet)return"#62C2E0";var n=t.info?t.info[_.now.color_mapping]:"NA";return"NA"===n?"#A4AAA7":bio.expressionConfig().colorSet[_.now.colorSet.indexOf(n)]}function i(t){bio.selectBox({margin:[3,3,0,0],viewName:"color_mapping",defaultText:"Color Mapping",id:"#expression_color_mapping",className:"expression-color-mapping",items:t.map(function(t){return t.key}),clickItem:function(i){var n=document.querySelector("#expression_bar_legend");_.now.color_mapping=i,t.some(function(t){return _.now.colorSet=t.value,_.now.color_mapping===t.key}),bio.layout().removeGroupTag(["expression_bar_legend_svg"]),n.className.indexOf("active")<0&&(n.className+="active"),d3.selectAll("#expression_bar_plot_svg_bar_rect_rect").style("fill",e).style("stroke",e),o("color_mapping",_.now.colorSet),n.style.marginBottom=parseFloat(_.init.bar_legend_height)-parseFloat(n.style.height)-5+"px"}})}function n(t){bio.selectBox({margin:[3,3,0,0],viewName:"signature",id:"#expression_signature",className:"expression-signature",defaultText:_.now.signature,items:t.map(function(t){return t.signature}),clickItem:function(t){_.now.signature&&_.now.signature!==t&&(_.now.signature=t,_.requestData.signature=_.now.signature,$.ajax({type:"post",url:"/files",data:{name:"expression"},beforeSend:function(){bio.loading().start(_.setting.targetedElement,_.setting.targetedElementSize.width,_.setting.targetedElementSize.height)},success:function(t){var e="";bio.dom().remove(_.setting.targetedElement,[document.querySelector("#expression_title"),document.querySelector("#expression_contents")]),bio.layout().removeGroupTag(),_.now.signature.indexOf("50")>-1?e=t.data.data_pam50.data:_.now.signature.indexOf("1")>-1?e=t.data.data_sig1.data:_.now.signature.indexOf("2")>-1?e=t.data.data_sig2.data:_.now.signature.indexOf("3")>-1&&(e=t.data.data_sig3.data),bio.expression({element:_.setting.targetedElement.id,width:_.setting.targetedElementSize.width,height:_.setting.targetedElementSize.height,requestData:{source:_.requestData.source,cancer_type:_.requestData.cancer_type,sample_id:_.requestData.sample_id,signature:_.now.signature,filter:_.requestData.filter},data:e}),bio.loading().end()}}))}})}function o(t,e){var i="scatter"===t?"scatter_leg":"bar_leg";bio.layout().get(_.setting.svgs,[i],function(i,n){var o=bio.expressionConfig().legend(t);e&&bio.legend({data:e,element:n,on:o.on,attr:o.attr,text:o.text,style:o.style,margin:o.margin})})}function a(t){bio.layout().get(_.setting.svgs,["gradient"],function(e,i){var n=bio.expressionConfig().gradient("shape"),o=bio.expressionConfig().gradient("axis",i);_.data.colorGradient=bio.colorGradient({element:i,offset:t,adjustValue:6,colors:["#FF0000","#000000","#00FF00"]}),bio.rectangle({element:bio.rendering().addGroup(i,0,0,"gradient-shape"),attr:n.attr,style:n.style},_),bio.axises().bottom({element:i,top:o.top,left:o.left,range:o.range,margin:o.margin,exclude:o.exclude,tickValues:t,domain:[t[0],t[2]]}).selectAll("text").style("fill","#999999")})}function r(t,e,i){bio.layout().get(_.setting.svgs,["heatmap"],function(n,o){var a=bio.scales().get(i,["#FF0000","#000000","#00FF00"]),r=bio.expressionConfig(),l=r.heatmap("shape",t.axisMargin),s=r.heatmap("axis",t.axisMargin);o.attr("height",10*e.y.length),bio.heat({element:o,xaxis:e.x,yaxis:e.y,on:l.on,data:t.heatmap,attr:l.attr,margin:l.margin,style:{fill:function(t,e,i){return a(t.value)}}}),bio.axises().left({element:o,domain:e.y,top:s.top,left:s.left,margin:s.margin,exclude:s.exclude,range:[0,10*e.y.length]})})}function l(t,e){bio.layout().get(_.setting.svgs,["bar_plot"],function(i,n){var o=bio.expressionConfig(),a=o.bar("shape",t.axisMargin),r=o.bar("axis",t.axisMargin);bio.bar({element:n,xaxis:e.x,data:t.bar,on:a.on,attr:a.attr,style:a.style,margin:a.margin,yaxis:[e.y[2],e.y[0]]}),bio.axises().left({element:n,top:r.top,left:r.left,tickValues:e.y,margin:r.margin,domain:[e.y[2],e.y[0]],range:[20,n.attr("height")-15]}).selectAll("path, line").style("stroke","#999999")})}function s(t,e){_.data.survival.divide={},bio.iteration.loop(t,function(t){t.value<=e?_.data.survival.divide[t.x]="unaltered":_.data.survival.divide[t.x]="altered"})}function c(t,e){_.now.osdfs!==t&&(bio.layout().removeGroupTag(["scatter-g-tag","left-axis-g-tag"]),_.now.osdfs=t,f(e,e.axis.scatter,_.now.osdfs),(_.divide.low_arr||_.divide.high_arr)&&x(d3.selectAll("#expression_scatter_plot_svg_scatter_shape_circle"),_.divide.low_arr,_.divide.high_arr))}function u(t){var e=document.querySelector("#expression_survival").querySelectorAll("input");e[0].onclick=function(e){c("os",t)},e[1].onclick=function(e){c("dfs",t)}}function d(t){var e=document.querySelector("#expression_survival"),i=parseFloat(e.style.width),n=parseFloat(e.style.height)/1.4;SurvivalCurveBroilerPlate.settings={canvas_width:.92*i,canvas_height:.9*n,chart_width:.9*i,chart_height:.9*n,chart_left:50,chart_top:15,include_info_table:!1,include_legend:!0,include_pvalue:!0,pval_x:i/1.95,pval_y:40},SurvivalCurveBroilerPlate.style={censored_sign_size:5,axis_stroke_width:1,axisX_title_pos_x:i/2,axisX_title_pos_y:n/1.125,axisY_title_pos_x:-i/2,axisY_title_pos_y:10,axis_color:"black",pval_font_size:10,pval_font_style:"normal"},SurvivalCurveBroilerPlate.subGroupSettings.legend={low:"Low score group",high:"High score group"};s(t.bar,t.axis.bar.y[1]);var o=bio.survival({element:"#expression_survival",margin:[20,20,20,20],data:_.divide.patient_list||_.setting.defaultData.patient_list,division:_.divide.divide||t.survival.divide});_.data.survival.data=o.survival_data,_.data.scatter=Object.keys(_.data.scatter).length<1?_.data.survival.data.all:_.data.scatter,u(t)}function p(t,e){var i=[];return bio.iteration.loop(t,function(t){bio.iteration.loop(t,function(t,n){e.indexOf(t)>-1&&i.push({x:t,y:n.months,value:n.status})})}),i}function f(t,e,i){bio.layout().get(_.setting.svgs,["scatter_p"],function(n,o){var a=bio.expressionConfig(),r=a.scatter("shape",t.axisMargin),l=a.scatter("axis",t.axisMargin),s=[].concat(e.y[i]).reverse();bio.scatter({element:o,yaxis:s,xaxis:e.x,on:r.on,attr:r.attr,style:r.style,margin:r.margin,data:p(t.scatter[i],e.x)}),bio.axises().left({ticks:15,element:o,domain:s,top:l.top,left:l.left,margin:l.margin,range:[10,o.attr("height")-30]}).selectAll("path, line").style("stroke","#999999")})}function g(t,e){for(var i=0,n=t.length;i<n;i++){var o=t[i],a=e[i];_.data.patient.data===o.innerHTML&&(o.innerHTML+=" **",a.innerHTML+=" **")}}function h(t){var e=bio.expressionConfig().survival("legend");bio.text({element:t,attr:{x:function(t,i){return e.attr.x(t,i,_)},y:function(t,i){return e.attr.y(t,i,_)}},style:{fill:function(t,i){return e.style.fill(t,i,_)}},text:function(t,i){return e.text(t,i,_)}})}function m(){var t={},e=setInterval(function(){t.os_tb=document.querySelectorAll("#os_stat_table td b"),t.dfs_tb=document.querySelectorAll("#dfs_stat_table td b"),t.legend=d3.selectAll(".legend"),t.os_tb.length>0&&t.dfs_tb.length>0&&t.legend.node()&&(g(t.os_tb,t.dfs_tb),h(t.legend),clearInterval(e))},10)}function v(t){bio.layout().get(_.setting.svgs,["bar_p","scatter_p"],function(e,i){var n={},o=e.indexOf("bar")>-1?"bar":"scatter",a=bio.expressionConfig().patient(t.axisMargin);n.group=bio.rendering().addGroup(i,0,0,o+"-patient"),n.id=e+"_"+o+"_patient",n.margin=bio.sizing.setMargin(a.margin),n.width=parseFloat(i.attr("width")),n.height=parseFloat(i.attr("height")),n.scaleX=bio.scales().get(t.axis.heatmap.x,[n.margin.left,n.width-n.margin.right]),n.scaleY=bio.scales().get([t.axis.bar.y[2],t.axis.bar.y[0]],[n.margin.top,n.height-n.margin.bottom]),bio.triangle({element:n.group.selectAll("#"+n.id+"_"+o+"_patient"),data:t.bar.filter(function(e){if(e.x===t.patient.name)return e}),attr:{id:function(t,e,i){return n.id+"_"+o+"_patient"},points:a.attr.points},style:a.style,on:a.on},n)}),m()}function x(t,e,i){t.style("fill-opacity",function(n,o,a){return e.indexOf(n.x)<0&&i.indexOf(n.x)<0?.08:t.attr("id").indexOf("shape")>-1?.6:1}).style("stroke-opacity",function(t,n,o){return e.indexOf(t.x)<0&&i.indexOf(t.x)<0?.08:1})}function y(t){function e(t){bio.iteration.loop(t,function(t){t!==_.data.patient.name&&(bio.iteration.loop(_.setting.defaultData.patient_list,function(e){e.participant_id===t&&_.divide.patient_list.push(e)}),_.divide.divide[t]=_.data.survival.divide[t])})}function i(i,n){_.divide.divide={},_.divide.patient_list=[],_.divide.scatter={os:[],dfs:[]},e(i),e(n),d(t),v(t),x(d3.selectAll("#expression_bar_plot_svg_bar_rect_rect"),i,n),x(d3.selectAll("#expression_scatter_plot_svg_scatter_shape_circle"),i,n)}var n=bio.expressionConfig().division;bio.layout().get(_.setting.svgs,["division"],function(e,o){var a=n("division",t.axisMargin);bio.divisionLine({element:o,pathElement:[d3.select("#expression_bar_plot_svg"),d3.select("#expression_scatter_plot_svg")],info:[{additional:-10,color:"#00AC52",direction:"right",text:"Low score group"},{additional:10,color:"#FF6252",direction:"left",text:"High score group"}],data:t.bar,text:a.text,attr:a.attr,call:{drag:a.call.drag,end:function(t,e,n){var o=[].concat(n.axis);_.divide.low_sample=n.invert(n.position.now.low),_.divide.high_sample=n.invert(n.position.now.high),_.divide.high_arr=o.splice(n.axis.indexOf(_.divide.high_sample),o.length-1),_.divide.low_arr=o.splice(0,n.axis.indexOf(_.divide.low_sample)),i(_.divide.low_arr,_.divide.high_arr)}},style:a.style,margin:a.margin,axis:t.axis.bar.x,idxes:t.axis.bar.y},_)})}function b(e,s){t(),i(e.subtype),n(s.signature_list),o("color_mapping",_.now.colorSet||null),o("scatter",["Alive","Dead"]),a(e.axis.gradient.x),r(e,e.axis.heatmap,e.axis.gradient.x),l(e,e.axis.bar),d(e),f(e,e.axis.scatter,_.now.osdfs),v(e),y(e)}var _={};return function(t){_={},(_=bio.initialize("expression")).setting=bio.setting("expression",t),_.data=_.setting.preprocessData,_.requestData=t.requestData||{},_.requestURL=t.requestURL||"/rest/expressions",_.init.signature=t.data.signature_list[0].signature,_.now.signature=_.requestData.signature,_.init.bar_legend_height=document.querySelector("#expression_bar_legend").style.height,bio.title("#expression_title","Expressions"),b(_.data,_.setting.defaultData),console.log(">>> Expression reponse data: ",t),console.log(">>> Expression setting data: ",_.setting),console.log(">>> Expression model data: ",_)}}function exclusivity(){"use strict";function t(t,e){var i="SMCLUAD1690060028",n=h.now.geneset.split(" "),o=".";return t.length<1?[{text:"**",color:"#00AC52"},{text:i+" Belongs to",color:"#333333"},{text:"Unaltered group",color:"#00AC52"}]:(bio.iteration.loop(t,function(t){var i=e[n.indexOf(t.gene)];i.indexOf(t.value)>-1&&(o="."!==o?o:i[i.indexOf(t.value)])}),"."===o?[{text:"**",color:"#00AC52"},{text:i+" Belongs to",color:"#333333"},{text:"Unaltered group",color:"#00AC52"}]:[{text:"**",color:"#FF6252"},{text:i+" Belongs to",color:"#333333"},{text:"Altered group",color:"#FF6252"}])}function e(e){h.data.sample={data:[],isAltered:!1};var i=bio.exclusivityConfig(),n=bio.landscapeConfig();bio.iteration.loop(e,function(t){h.now.geneset.indexOf(t.gene)>-1&&h.data.sample.data.push({gene:t.gene,value:i.symbol(i.byCase(n.byCase(t.class),t.class))})}),h.data.sample.isAltered=t(h.data.sample.data,h.data.survival.heat[h.now.geneset])}function i(t){bio.layout().get(h.setting.svgs,["ty_legend"],function(e,i){var n=bio.exclusivityConfig(),o=n.legend(t.mostGeneWidth.value);bio.legend({element:i,on:o.on,attr:o.attr,text:o.text,style:o.style,margin:o.margin,data:t.type[h.now.geneset].sort(function(t,e){return n.priority(t)>n.priority(e)?1:-1})}),document.querySelector("#exclusivity_legend").style.height=i.attr("height")+"px"})}function n(t){bio.layout().get(h.setting.svgs,["sample_legend"],function(e,i){var n=bio.rendering().addGroup(i,0,0,"sample-legend"),o=bio.exclusivityConfig().sample("legend",t.mostGeneWidth.value);bio.text({text:o.text,attr:o.attr,style:o.style,id:e+"_sample_legend",data:t.sample.isAltered,element:n.selectAll("#"+e+"_sample_legend")},h)})}function o(t){bio.layout().get(h.setting.svgs,["heatmap"],function(e,i){var n=bio.rendering().addGroup(i,0,0,"sample-division"),o=bio.exclusivityConfig().sample("division",t.mostGeneWidth.value,i);bio.text({text:o.text,attr:o.attr,style:o.style,id:e+"_sample_division",data:t.sample.isAltered,element:n.selectAll("#"+e+"_sample_division")},h)})}function a(t,e){for(var i=0,n=t.length;i<n;i++){var o=t[i],a=e[i];bio.iteration.loop(h.data.sample.isAltered,function(t){t.text===o.innerHTML&&(o.innerHTML+=" **",a.innerHTML+=" **")})}}function r(t){var e=bio.exclusivityConfig().survival();bio.text({element:t,text:e.text,attr:{x:function(t,i){return e.attr.x(t,i,h)},y:function(t,i){return e.attr.y(t,i,h)}},style:{fill:function(t,i){return e.style.fill(t,i,h)}},text:function(t,i){return e.text(t,i,h)}})}function l(t){var e={},i=setInterval(function(){e.os_tb=document.querySelectorAll("#os_stat_table td b"),e.dfs_tb=document.querySelectorAll("#dfs_stat_table td b"),e.legend=d3.selectAll(".legend"),e.os_tb.length>0&&e.dfs_tb.length>0&&e.legend.node()&&(a(e.os_tb,e.dfs_tb),r(e.legend),clearInterval(i))},10)}function s(t){n(t),o(t),l(t)}function c(t){bio.layout().get(h.setting.svgs,["network"],function(e,i){bio.exclusivityConfig().network();bio.network({element:i,data:t.network[h.now.geneset.replaceAll(" ","")]})})}function u(t,e){bio.layout().get(h.setting.svgs,["heatmap"],function(i,n){var o=t.mostGeneWidth.value,a=bio.exclusivityConfig().heatmap("shape",n,o),r=bio.exclusivityConfig().heatmap("axis",n,o);n.attr("height");bio.heat({element:n,attr:a.attr,style:a.style,margin:a.margin,xaxis:e.x[h.now.geneset],yaxis:e.y[h.now.geneset],data:t.heatmap[h.now.geneset]}),bio.axises().left({top:0,left:o,element:n,direction:"left",range:r.range,exclude:"path, line",margin:r.margin,domain:e.y[h.now.geneset]})})}function d(t,e){var i={};return bio.iteration.loop(e.survival.data[t],function(n,o){n&&(i[n.participant_id]=o<=e.divisionIdx[t].idx?"altered":"unaltered")}),i}function p(t){var e=document.querySelector("#exclusivity_survival"),i=parseFloat(e.style.width),n=parseFloat(e.style.height);SurvivalCurveBroilerPlate.settings={canvas_width:.9*i,canvas_height:.59*n,chart_width:.9*i,chart_height:.59*n,chart_left:50,chart_top:15,include_info_table:!1,include_legend:!0,include_pvalue:!0,pval_x:i/1.95,pval_y:40},SurvivalCurveBroilerPlate.style={censored_sign_size:5,axis_stroke_width:1,axisX_title_pos_x:i/2,axisX_title_pos_y:n/1.725,axisY_title_pos_x:-i/2,axisY_title_pos_y:10,axis_color:"black",pval_font_size:10,pval_font_style:"normal"},SurvivalCurveBroilerPlate.subGroupSettings.legend={low:"Unaltered group",high:"Altered group"},bio.survival({element:"#exclusivity_survival",margin:[20,20,20,20],data:t.survival.data[h.now.geneset],division:d(h.now.geneset,t)})}function f(t){bio.layout().get(h.setting.svgs,["heatmap"],function(e,i){var n=bio.exclusivityConfig().division(t.mostGeneWidth.value);bio.divisionLine({element:i,isMarker:!1,pathElement:[i],info:[{text:"Altered group",color:"#FF6252"},{text:"Unaltered group",color:"#00AC52"}],text:n.text,attr:n.attr,style:n.style,margin:n.margin,axis:t.axis.heatmap.x[h.now.geneset],idxes:t.divisionIdx[h.now.geneset].idx+1},h)})}function g(t){e(h.setting.defaultData.sample),i(t),c(t),u(t,t.axis.heatmap),p(t),f(t),s(t)}var h={};return function(t){(h=bio.initialize("exclusivity")).setting=bio.setting("exclusivity",t),h.data=h.setting.preprocessData,bio.title("#exclusivity_title","Mutual Exclusivity"),h.now.geneset=h.data.geneset[0].join(" "),bio.selectBox({viewName:"geneset",margin:[0,0,0,0],fontSize:"14px",defaultText:h.now.geneset,className:"exclusivity-geneset",id:"#exclusivity_select_geneset",items:h.data.geneset.map(function(t){return t.join(" ")}),clickItem:function(t){h.now.geneset=t.toUpperCase(),bio.layout().removeGroupTag(),g(h.data)}}),g(h.data),console.log(">>> Exclusivity reponse data: ",t),console.log(">>> Exclusivity setting data: ",h.setting),console.log(">>> Exclusivity model data: ",h)}}function landscape(){"use strict";function t(t){var e=bio.dom().get("#landscape_heatmap");t.width=2*parseFloat(e.style.width),t.height=parseFloat(e.style.height)}function e(t){bio.scaleSet({element:"#landscape_option",defaultValue:m.init.width,change:function(t,e){return bio.layout().removeGroupTag(),"refresh"===e.type?(a({axis:"x",data:m.init.axis.x}),a({axis:"y",data:m.init.axis.y}),h(m.data,(m.now.width=m.init.width,m.now.width))):h(m.data,(m.now.width=e.value,m.now.width))}})}function i(){d3.selectAll("#landscape_group_svg, #landscape_axis_group_svg, #landscape_patient_group_svg").remove()}function n(t){t=t.sort(function(t,e){return bio.boilerPlate.variantInfo[t].order>bio.boilerPlate.variantInfo[e].order?1:-1})}function o(t){t.patient.heatmap={x:t.patient.x,y:t.gene.y},t.patient.group={x:["NA"],y:t.group.y},t.patient.sample={x:t.patient.x,y:t.sample.y}}function a(t){var e="x"===t.axis?"group":"pq",i="x"===t.axis?"sample":"gene";m.data.axis[e][t.axis]=t.data,m.data.axis[i][t.axis]=t.data,m.data.axis.heatmap[t.axis]=t.data}function r(t){bio.layout().get(m.setting.svgs,["e_gr","e_s","e_h"],function(e,i){i.attr("width",t||m.now.width||m.init.width)})}function l(t){if(!t)return!1;m=t.model,bio.layout().removeGroupTag(),a(t.sorted),h(m.data,m.now.width)}function s(t,e){var i={sample:"s_s",gene:"gene",pq:"pq",group:"s_g"}[t];bio.layout().get(m.setting.svgs,[i],function(i,n){var o=bio.landscapeConfig().axis(t,e,n),a=bio.landscapeConfig().axis("common"),r=m.data.axis[t][e.toLowerCase()];"group"===t&&bio.iteration.loop(r,function(t){i.indexOf(t[0].removeWhiteSpace())>-1&&(r=t)}),bio.axises()[o.direction]({element:n,domain:r,top:o.top,left:o.left,range:o.range,margin:o.margin,exclude:o.exclude}).selectAll("text").on("mouseout",!!a.on&&a.on.mouseout).on("mouseover",!!a.on&&a.on.mouseover).on("click",function(t,e){var i=!!o.on&&o.on.click.call(this,t,e,m);console.log(i.model),l(i)})})}function c(t,e){return t.indexOf("pq")<0?t.indexOf("gene")>-1?[{name:"gene",text:e.titles[0]}]:[{name:"sample",text:e.titles[0]}]:[{name:"pq",text:e.titles[1]}]}function u(t){bio.layout().get(m.setting.svgs,[t],function(t,e){var i=bio.landscapeConfig().title("common"),n=c(e.attr("id"),i),o=bio.landscapeConfig().title(n[0].name);bio.sortTitle({data:n,element:e,attr:o.attr,text:i.text,style:i.style,margin:o.margin,titles:i.titles,on:{mouseover:i.on.mouseover,mouseout:i.on.mouseout,click:function(t,e,o){m.sortName=n[0].name,m.now.sort[t.name]&&"asc"===m.now.sort[t.name]?m.now.sort[t.name]="desc":m.now.sort[t.name]="asc",l(i.on.click.call(this,t,e,m))}}},m)})}function d(t,e,i,n){var o={sample:{id:"e_s",config:"sample"},samplePatient:{id:"t_s",config:"sample"},gene:{id:t,config:t},pq:{id:t,config:t}}[t];bio.layout().get(m.setting.svgs,[o.id],function(a,r){var l=bio.landscapeConfig().bar(o.config);t.indexOf("Patient")>-1&&(l.margin[3]=5),bio.bar({data:e,element:r,on:l.on,xaxis:i.x,yaxis:i.y,startTo:n,attr:l.attr,style:l.style,margin:l.margin})})}function p(t,e){return t.indexOf("group")>-1||t.indexOf("patientGroup")>-1?e.y[0].removeWhiteSpace():""}function f(t,e,i){var n=p(t,i),o={group:{id:"p_group_",config:"group"},patientGroup:{id:"t_group_",config:"group"},heatmap:{id:"e_h",config:"heatmap"},patientHeatmap:{id:"t_h",config:"heatmap"}};bio.layout().get(m.setting.svgs,[o[t].id+n],function(n,a){var r=bio.landscapeConfig().heatmap(o[t].config),l=t.indexOf("map")>-1?bio.initialize("landscapeHeatmap"):null;(t.indexOf("patientHeatmap")>-1||t.indexOf("patientGroup")>-1)&&(r.margin[3]=5),bio.heat({data:e,element:a,xaxis:i.x,yaxis:i.y,on:r.on,attr:r.attr,style:r.style,margin:r.margin},l)})}function g(t){bio.layout().get(m.setting.svgs,["legend"],function(e,i){var n=bio.landscapeConfig().legend();bio.legend({data:t,element:i,on:n.on,attr:n.attr,text:n.text,style:n.style,margin:n.margin})})}function h(t,e){var i=m.data;r(e),s("pq","X"),s("gene","X"),s("gene","Y"),s("group","Y"),s("sample","Y"),u("pq"),u("s_s"),u("gene"),d("pq",i.pq,i.axis.pq,["top","left"]),d("gene",i.stack.gene,i.axis.gene,["top","left"]),d("sample",i.stack.sample,i.axis.sample,["top","left"]),d("samplePatient",i.stack.patient,i.axis.patient.sample,["top","left"]),f("heatmap",i.heatmap,i.axis.heatmap),f("patientHeatmap",i.patient,i.axis.patient.heatmap),bio.iteration.loop(i.axis.group.y,function(t,e){var n=i.axis.group.y[e],o={x:i.axis.group.x,y:n},a={x:i.axis.patient.group.x,y:n};f("group",i.group.group[e],o),f("patientGroup",[i.group.patient[e]],a)}),g(i.type)}var m={};return function(r){(m=bio.initialize("landscape")).setting=bio.setting("landscape",r),m.data=m.setting.preprocessData,i(),bio.title("#landscape_title",m.setting.defaultData.title),t(m.init),e(m.setting),m.exclusive.init=bio.landscapeSort().exclusive(m.data.heatmap,m.data.gene),m.init.axis.x=[].concat(m.exclusive.init.data),m.init.axis.y=[].concat(m.data.axis.gene.y),n(m.data.type),o(m.data.axis),a(m.exclusive.init),h(m.data,m.init.width),bio.handler().scroll("#landscape_heatmap",function(t){var e=bio.dom().get("#landscape_sample"),i=bio.dom().get("#landscape_group");e.scrollLeft=this.scrollLeft,i.scrollLeft=this.scrollLeft}),console.log(">>> Landscape reponse data: ",r),console.log(">>> Landscape setting data: ",m.setting),console.log(">>> Landscape model data: ",m)}}function landscapeSort(){"use strict";function t(t,e){var i={};return bio.iteration.loop(t,function(t,n){i[t[e]]=i[t[e]]?i[t[e]]+=t.value:i[t[e]]=t.value}),i}function e(t){var e=[];return bio.iteration.loop(t,function(t,i){e.push({key:t,value:i})}),e}function i(t,e){var i="asc"===t?1:-1;return e.sort(function(t,e){return t.value>e.value?1*i:-1*i})}function n(n,o){return{axis:"y",data:i(n,e(t(o,"y"))).map(function(t){return t.key})}}function o(n,o){return{axis:"x",data:i(n,e(t(o,"x"))).map(function(t){return t.key})}}function a(t,e){return{axis:"y",data:i(t,e).map(function(t){return t.y})}}function r(t,e,i){switch(t){case"gene":return n(e,i);case"sample":return o(e,i);case"pq":return a(e,i);default:throw new Error("Not matching function")}}function l(t,e){switch(t){case"gene":return e.stack.gene;case"sample":return e.stack.sample;case"pq":return e.pq;case"init":return e.init;default:throw new Error("No matching any data")}}function s(t,e){return r(t,"asc",l(t,e))}function c(t,e){return r(t,"desc",l(t,e))}function u(t,e){var i=bio.landscapeSort().exclusive(e,e[0].y);return bio.iteration.loop(t,function(t){i.data.indexOf(t)<0&&i.data.push(t)}),i}function d(t){var e=[];return bio.iteration.loop(Object.keys(t).sort(function(t,e){return bio.boilerPlate.clinicalInfo[t].order>bio.boilerPlate.clinicalInfo[e].order?1:-1}),function(i,n){e.push(t[i])}),e}function p(t){var e=[];return bio.iteration.loop.call(this,t,function(t){var i=[];bio.iteration.loop(t,function(t){i=i.concat(t.info)}),e.push(bio.landscapeSort().exclusive(i,this.data.gene))}),e}function f(t){var e=d(y(t)),i=p.call(this,e),n={};return bio.iteration.loop(i,function(t){n.axis=t.axis,n.data?n.data.push(t.data):n.data=[t.data]}),{group:e,axis:n}}function g(t,e){var i=[];return bio.iteration.loop(t,function(t){bio.iteration.loop(e,function(e){t.x===e.x&&i.push(t)})}),i}function h(t,e){if(e){if(this.now.group.length<1)throw new Error("There are empty group data");var i=[],n={group:[],axis:{axis:"x",data:[]}};return bio.iteration.loop.call(this,this.now.group.group,function(e){i.push(f.call(this,g(t,e)))}),bio.iteration.loop(i,function(t){n.group=n.group.concat(t.group),n.axis.data=n.axis.data.concat(t.axis.data)}),n}return f.call(this,t)}function m(t,e,i){var n=2*e.indexOf(i.y),o="cnv"===bio.landscapeConfig().byCase(i.value)?0:1;t.value=t.value.replaceAt(n,"00".replaceAt(o,"1"))}function v(t){return{axis:"x",data:t.sort(function(t,e){return t.value<e.value?1:-1}).map(function(t){return t.key})}}function x(t,e){var i={},n=[],o=0;return bio.iteration.loop(t,function(t){i[t.x]?i[t.x]=i[t.x]:(i[t.x]=!0,n.push({key:t.x,value:[].fill(e.length,"00").join("")}),o+=1),m(n[o-1],e,t)}),b.exclusive=n,v(n)}function y(t){var e={};return bio.iteration.loop(t,function(t){e[t.value]?e[t.value].push(t):e[t.value]=[t]}),e}var b={};return function(){return b=bio.initialize("landscapeSort"),{asc:s,desc:c,gene:u,group:h,exclusive:x}}}function scaleSet(){"use strict";function t(){var t=document.createElement("div");return t.id="scale_set_div",t}function e(t){var e=document.createElement("input");return e.id="scale_set_input",e.value=t||"100%",e}function i(t){return t.indexOf("caret")>-1?t.indexOf("up")>-1?"up":"down":"refresh"}function n(t){if(a.change){var e=i(this.className),n=parseInt(.1*a.defaultValue),o={up:1,down:-1}[e];a.scaleValue="refresh"!==e?a.scaleValue+o*n:a.defaultValue,a.scaleRate="refresh"!==e?"up"===e?(a.scaleRate+=a.termRate,a.scaleRate):(a.scaleRate-=a.termRate,a.scaleRate):a.defaultRate,a.scaleRate=a.defaultValue/2>a.scaleValue?(a.scaleRate+=a.termRate,a.scaleRate):2*a.defaultValue<a.scaleValue?2*a.defaultRate:a.scaleRate,a.scaleValue=a.defaultValue/2>a.scaleValue?a.defaultValue/2:2*a.defaultValue<a.scaleValue?2*a.defaultValue:a.scaleValue,a.input.value=a.scaleRate+"%",a.change.call(this,t,{type:e,value:a.scaleValue})}}function o(){var t=document.createElement("div"),e=["caret-up","caret-down","refresh"];return t.id="scale_options",bio.iteration.loop(e,function(e){var i=document.createElement("i"),o=document.createElement("div"),a=document.createElement("button");a.className="scale-"+e,i.className="fa fa-"+e+" fa-lg",a.addEventListener("click",n),a.appendChild(i),o.appendChild(a),t.appendChild(o)}),t}var a={};return function(i){if(!i.element)throw new Error("Please, pass the element");var n=bio.dom().get(i.element);(a={unit:i.unit||"%",change:i.change||null,termRate:i.termRate||10,scaleRate:i.defaultRate||100,defaultRate:i.defaultRate||100,scaleValue:i.defaultValue||100,defaultValue:i.defaultValue||100}).div=t(),a.input=e(),a.buttons=o(),a.div.appendChild(a.input),a.div.appendChild(a.buttons),n.appendChild(a.div)}}function sortTitle(){"use strict";var t={};return function(e,i){t=bio.objects.clone(i||{}),t=bio.sizing.chart.default(t,e),bio.rendering().dropShadow(e.element,1,-.1,1),t.font=e.style.fontSize+" "+e.style.fontWeight,t.mostWidth=bio.drawing().mostWidth(e.titles,t.font),t.mostHeight=bio.drawing().textSize.height(t.font),t.group=bio.rendering().addGroup(e.element,0,0,"sort-title"),t.id.indexOf("sample")>-1&&t.group.attr("transform","translate(0, 0) rotate(270)"),t.opts={text:bio.objects.clone(e),shape:bio.objects.clone(e)},t.opts.text.id=t.id+"_sorttitle_text",t.opts.text.element=t.group.selectAll("#"+t.id+"_text"),t.opts.shape.id=t.id+"_sorttitle_shape",t.opts.shape.element=t.group.selectAll("#"+t.id+"_shape"),bio.rectangle(t.opts.shape,t),bio.text(t.opts.text,t)}}function initialize(){"use strict";var t={layout:{svg:{variants:{},landscape:{},expression:{},exclusivity:{}}},sizing:{ids:[],chart:{}},setting:{idx:[],dom:null,size:{width:0,height:0}},preprocess:{pathway:null,variants:{needle:{line:[],shape:[]},patient:{line:[],shape:[]},type:[],graph:[],axis:{needle:{x:[],y:[]},now:{x:[],y:[]}}},landscape:{type:{},group:{group:[],patient:[]},heatmap:[],patient:[],stack:{gene:{},sample:{},patient:{}},axis:{pq:{x:[],y:[]},gene:{x:[],y:[]},group:{x:[],y:[]},sample:{x:[],y:[]},heatmap:{x:[],y:[]},patient:{x:[],y:[]}}},expression:{func:{default:"average",now:null,avg:[]},tpms:[],heatmap:[],scatter:{},subtype:[],survival:{},bar:[],axis:{gradient:{x:{},y:{}},heatmap:{x:{},y:{}},scatter:{x:{},y:{}},bar:{x:{},y:{}}}},exclusivity:{heatmap:{},network:{},type:{},survival:{merge:{},heat:{},data:{}},geneset:[],geneset_all:[],axis:{heatmap:{x:{},y:{}},division:{x:{},y:[]}},divisionIdx:{}}},loading:{},expression:{init:{function:"Average",signature:null,color_mapping:null},now:{function:null,signature:null,color_mapping:null,osdfs:"os"},divide:{}},exclusivity:{now:{geneset:null}},colorGradient:{show:[],data:[]},variants:{div:{}},variantsNavi:{start:0,end:0},landscape:{div:{},init:{axis:{x:[],y:[]},width:0,height:0},now:{sort:{gene:null,sample:null,pq:null},group:[],axis:{x:[],y:[]},width:0,height:0},exclusive:{init:null}},landscapeSort:{exclusive:[]},landscapeHeatmap:{mutationType:["cnv","var"],value:{},duplicate:[]}};return function(e){return bio.objects.clone(t[e]?t[e]:{})}}function preprocExclusivity(){"use strict";function t(t){var e={};return bio.iteration.loop(t,function(t){e[t.gene]=["."]}),e}function e(t,e){var i={};return bio.iteration.loop(t,function(t){var n=bio.boilerPlate.variantInfo[t.type],o=bio.exclusivityConfig().abbreviation(n),a=bio.objects.clone(e);i[t.participant_id]?"."===i[t.participant_id][t.gene][0]?i[t.participant_id][t.gene]=[o]:i[t.participant_id][t.gene].push(o):(a[t.gene]=[o],i[t.participant_id]=a)}),i}function i(i,n){var o=t(n),a=e(n,o);bio.iteration.loop(i,function(t){t.gene=a[t.participant_id]?a[t.participant_id]:o}),d.survival.merge=i}function n(t){return"rgb("+t.split(" ").join(",")+")"}function o(t){return d.type[t.join(" ")]=[]}function a(t){var e=t.matchAll(d.regex.geneset),i=t.matchAll(d.regex.heatmap),n=bio.exclusivityConfig(),a=0;bio.iteration.loop(e,function(t){var e=t.replace(/\[|\]/g,"").split(" "),r=e.length+a,l=e.join(" "),s=o(e),c=[];d.heatmap[l]=[],d.axis.heatmap.x[l]=[],d.axis.heatmap.y[l]=e,d.axis.division.x[l]=[],d.divisionIdx[l]={idx:0};for(var u=0,p=i[0].length;u<p;u++)d.axis.heatmap.x[l].push(""+u),d.axis.division.x[l].push(""+u);for(;a<r;a++)bio.iteration.loop(i[a].split(""),function(t,i){bio.iteration.loop(n.separate(t),function(t){t=n.name(t),d.heatmap[l].push({x:i,y:e[a>=e.length?a-(r-e.length):a],value:t}),s.indexOf(t)<0?s.push(t):s=s}),d.divisionIdx[l].idx="."!==t?d.divisionIdx[l].idx>i?d.divisionIdx[l].idx:i:d.divisionIdx[l].idx}),c.push(i[a]);d.geneset.push(e),d.geneset_all=d.geneset_all.concat(e),d.survival.heat[l]=c});var r=d.geneset[4];d.geneset[4]=d.geneset[0],d.geneset[0]=r}function r(t){var e=[];return bio.iteration.loop(t,function(t){var i={};t=t.replace(new RegExp(/\t|\s{2,}|\s(?=\D)/,"ig"),"\t"),bio.iteration.loop(t.split("\t"),function(t){var e=t.split(":");i[e[0]]=e[0].indexOf("color")<0?e[1]:n(e[1])}),e.push(i)}),e}function l(t){var e=null;bio.iteration.loop(t,function(t,i){d.network[t]=r(i),bio.iteration.loop(d.network[t],function(t){"compound"===t.type?(e=t.id,t.bgcolor=t.bgcolor.replace('"',""),t.textcolor=t.textcolor.replace('"',"")):"edge"===t.type?(t.source=t.source.replace(e,""),t.target=t.target.replace(e,""),t.linecolor=t.linecolor.replace('"',"")):"node"===t.type&&(t.bgcolor=t.bgcolor.replace('"',""))})})}function s(t){var e={};t=(t=t.replace(/\\n{1}/g,"\n")).replace(/\\t{1}/g,"\t"),bio.iteration.loop(t.split("\n"),function(t){bio.iteration.loop(d.geneset,function(i){var n=i.join("");t.indexOf(n)>-1&&(e[n]?e[n].push(t):e[n]=[t])})}),l(e)}function c(t){return t.indexOf("A")>-1&&t.indexOf("M")>-1?"B":t.indexOf("D")>-1&&t.indexOf("M")>-1?"E":t[0]}function u(t){var e={};bio.iteration.loop(d.survival.heat,function(t,i){for(var n=d.axis.heatmap.x[t].length,o=t.split(" "),a=d.survival.data[t]?d.survival.data[t]:d.survival.data[t]=[],r=e[t]={},l=0;l<n;l++)d.survival.merge.some(function(t){for(var e=!0,n=0,s=o.length;n<s;n++)c(t.gene[o[n]])!==i[n][l]&&(e=!1);if(e&&void 0===r[t.participant_id])return r[t.participant_id]="",a[l]=t,void 0!==a[l]})})}var d={};return function(t){return d={},d=bio.initialize("preprocess").exclusivity,d.regex={geneset:new RegExp(/\[\w+(\s\w+)+\w+\]/,"g"),heatmap:new RegExp(/(A|B|D|E|M|\.){10,}/,"g")},i(t.survival.patient,t.survival.types),a(t.heatmap),s(t.network),u(t.survival),d.mostGeneWidth=bio.drawing().mostWidth(d.geneset_all,"12px"),console.log(">>> Preprocess exclusivity data: ",t),console.log(">>> Preprocess data: ",d),d}}function preprocExpression(){"use strict";function t(t){f.axis.scatter.y={os:[],dfs:[]},f.patient_subtype={},bio.iteration.loop(t,function(t){f.axis.scatter.y.os.push(t.os_days/30),f.axis.scatter.y.dfs.push(t.dfs_days/30),f.patient_subtype[t.participant_id]=t});var e=bio.math.min(f.axis.scatter.y.os),i=bio.math.max(f.axis.scatter.y.os),n=bio.math.min(f.axis.scatter.y.dfs),o=bio.math.max(f.axis.scatter.y.dfs);f.axis.scatter.y.os=[e,i],f.axis.scatter.y.dfs=[n,o]}function e(t){var e={};return bio.iteration.loop(t,function(t){e[t.subtype]?e[t.subtype].push(t.value):e[t.subtype]=[t.value]}),e}function i(t){var i=e(t);bio.iteration.loop(i,function(t,e){f.subtype.push({key:t,value:e})})}function n(t){return Math.log(t+1)/Math.LN2}function o(t){f.axis.heatmap.x[t.participant_id]?f.axis.heatmap.x[t.participant_id].push({key:t.hugo_symbol,value:t.tpm}):f.axis.heatmap.x[t.participant_id]=[{key:t.hugo_symbol,value:t.tpm}]}function a(t){f.axis.gradient.x=[bio.math.min(t),bio.math.median(t),bio.math.max(t)],f.axis.gradient.y=[""]}function r(t){bio.iteration.loop(t,function(t,e){var i=0,n=0;bio.iteration.loop(e,function(t){f.axis.heatmap.y[t.key]="",i+=t.value}),n=i/e.length,f.bar.push({x:t,value:n,info:f.patient_subtype[t]}),f.func.avg.push(n)}),f.func.avg.sorted=f.func.avg.sort(function(t,e){return t>e?1:-1}),f.axis.bar.y=[bio.math.min(f.func.avg),bio.math.median(f.func.avg),bio.math.max(f.func.avg)]}function l(t,e){return{average:r(e)}[t]}function s(t){var e=[].concat(f.func.avg),i=[];bio.iteration.loop(t,function(t){i[e.indexOf(t.value)]=t.x}),f.axis.heatmap.x=i}function c(t,e){return{average:s(e)}[t]}function u(t){var e=f.func.now||f.func.default;bio.iteration.loop(t,function(t){t.tpm=n(t.tpm+1),o(t),f.tpms.push(t.tpm),f.heatmap.push({x:t.participant_id,y:t.hugo_symbol,value:t.tpm})}),a(f.tpms),l(e,f.axis.heatmap.x),c(e,f.bar),f.axis.heatmap.y=Object.keys(f.axis.heatmap.y),f.axis.scatter.x=f.axis.heatmap.x,f.axis.bar.x=f.axis.heatmap.x}function d(t){return f.axis.bar.y[1]>=f.func.avg[f.axis.bar.x.indexOf(t)]?"Low score group":"High score group"}function p(t){var e=0;return bio.iteration.loop(t,function(t){var i=bio.drawing().textSize.width(t,"10px");e=e>i?e:i}),e}var f={};return function(e){return f={},f=bio.initialize("preprocess").expression,f.all_rna_list=[].concat(e.cohort_rna_list.concat(e.sample_rna_list)),f.genes=e.gene_list.map(function(t){return t.hugo_symbol}),t(e.patient_list),i(e.subtype_list),u(f.all_rna_list),f.patient={name:e.sample_rna_list[0].participant_id,data:d(e.sample_rna_list[0].participant_id)},bio.iteration.loop(f.bar,function(t){t.y=f.axis.bar.y[1]}),f.axisMargin=p(f.axis.heatmap.y),console.log(">>> Preprocess variants data: ",e),console.log(">>> Preprocess data: ",f),f}}function preprocLandscape(){"use strict";function t(t,e){t.indexOf(e)<0&&t.push(e)}function e(t,e){t.push({x:e.participant_id,y:e.gene,value:e.type})}function i(t,e,i){t[e]=t[e]?t[e]:{},t[e][i]=t[e][i]?t[e][i]+1:1}function n(t,e){bio.iteration.loop(t,function(t,i){t.type=bio.commonConfig().typeFormat(t.type),p.type[t.type]=null,e(t,i)}),p.isIterateCommonOk=!0}function o(o){n(o,function(n){i(p.stack.gene,n.gene,n.type),i(p.stack.sample,n.participant_id,n.type),e(p.heatmap,n),t(p.axis.sample.x,n.participant_id)})}function a(o){n(o,function(n){i(p.stack.patient,n.participant_id,n.type),e(p.patient,n),t(p.axis.patient.x,n.participant_id)})}function r(t){bio.iteration.loop(t,function(t){var e=[];bio.iteration.loop(t.data,function(i){var n=[];bio.iteration.loop(p.heatmap,function(t){i.participant_id===t.x&&n.push(t)}),e.push({x:i.participant_id,y:t.name,value:i.value,info:n})}),p.group.group.push(e),p.axis.group.y.push([t.name]),p.group.patient.push({x:p.axis.patient.x[0],y:t.name,value:"NA"})})}function l(t,e){return t.map(function(t){var i=Math.log(t[e])/Math.log(12)*-1;return{x:0,y:t.gene,value:i}})}function s(t,e,i,n,o){return"gene"===t?{x:e,y:i,value:n,info:o}:{x:i,y:e,value:n,info:o}}function c(t,e){var i=[],n="gene"===t?"x":"y";return bio.iteration.loop(e,function(e,o){var a=0,r=0;bio.iteration.loop(o,function(n,o){i.push(s(t,a,e,o,n)),a+=o,r+=o}),p.axis[t][n].push(r)}),i}function u(){p.axis.gene.x=[bio.math.max(p.axis.gene.x),0],p.axis.sample.y=[bio.math.max(p.axis.sample.y),0],p.axis.pq.x=[0,bio.math.max(p.pq.map(function(t){return Math.ceil(t.value)}))]}function d(){p.axis.pq.y=p.axis.gene.y=p.axis.heatmap.y=p.gene,p.axis.heatmap.x=p.axis.group.x=p.axis.sample.x}var p={};return function(t){return p=bio.initialize("preprocess").landscape,t=t.gene_list?t:t.data,p.gene=t.gene_list.map(function(t){return t.gene}),o(t.mutation_list),a(t.patient_list),r(t.group_list),p.type=Object.keys(p.type),p.pq=l(t.gene_list,t.pq||"p"),p.stack.gene=c("gene",p.stack.gene),p.stack.sample=c("sample",p.stack.sample),p.stack.patient=c("patient",p.stack.patient),u(),d(),console.log(">>> Preprocess landscape data: ",t),console.log(">>> Preprocess data: ",p),p}}function preprocPathway(){"use strict";var t={};return function(e){return console.log(">>> Preprocess pathway data: ",e),console.log(">>> Preprocess data: ",t),t}}function preprocVariants(){"use strict";function t(t,e){bio.iteration.loop(t,function(t,i){var n=0,o={key:t,value:[{x:parseFloat(t),y:n,value:0}]};a.axis.needle.y.push(n),bio.iteration.loop(i,function(e,i){o.value.push({x:parseFloat(t),y:n+=i.length,value:i.length,info:i})}),a.axis.needle.y.push(n),e.push(o)})}function e(e,i){var n={};bio.iteration.loop(e,function(t){t.type=bio.commonConfig().typeFormat(t.type);var e=t.position+" "+t.type+" "+t.aachange;n[t.position]?n[t.position][e]?n[t.position][e].push(t):n[t.position][e]=[t]:(n[t.position]={},n[t.position][e]=[t]),a.type.indexOf(t.type)<0&&a.type.push(t.type)}),t(n,i)}function i(t){bio.iteration.loop(t,function(t,e){a.graph.push({x:t.start,y:0,width:t.end-t.start,height:15,color:t.colour,info:t})})}function n(t){a.axis.needle.x=[0,t[0].length],a.axis.needle.y=a.axis.needle.y.length<1?[0,1]:[bio.math.min(a.axis.needle.y),bio.math.max(a.axis.needle.y)]}function o(t,e){bio.iteration.loop(t,function(t){bio.iteration.loop(t.value,function(i,n){i.info&&(i.value=i.y-t.value[n-1].y,e.push(i))})})}var a={};return function(t){return a=bio.initialize("preprocess").variants,e(t.variants.public_list,a.needle.line),e(t.variants.patient_list,a.patient.line),i(t.variants.graph),n(t.variants.graph),o(a.needle.line,a.needle.shape),o(a.patient.line,a.patient.shape),console.log(">>> Preprocess variants data: ",t),console.log(">>> Preprocess data: ",a),a}}function preprocess(){"use strict";return function(t){return{pathway:bio.preprocPathway,variants:bio.preprocVariants,landscape:bio.preprocLandscape,expression:bio.preprocExpression,exclusivity:bio.preprocExclusivity}[t]}}function pathway(){"use strict";function t(t,e){bio.drawing().importSVG("/data/pathway/"+t+".svg",e)}function e(t,e){var i=null;return bio.iteration.loop(e,function(e){e.gene_id===t&&(i={is:!0,data:e})}),i||{is:!1,data:null}}function i(t,e){if(e>-1){var i=!1;setInterval(function(){i=!i,t.style("stroke",i?"#ff0000":"#333").style("stroke-width",i?3:1)},500)}}function n(t,e,n,o){var a=bio.pathwayConfig().node();o&&i(t,o),t.attr("cursor","pointer").style("fill",function(t){return a.style.fill.call(this,e)}).on("mouseover",function(t,i){a.on.mouseover.call(this,e,i,n)}).on("mouseout",function(t,i){a.on.mouseout.call(this,e,i,n)})}function o(t){bio.iteration.loop(t.childNodes,function(t,e){/gene_/i.test(e.id)&&d3.select(e).data({index:t})})}function a(t,i){var a=bio.dependencies.version.d3v4()?d3.selectAll("text").nodes():bio.drawing().nodes(d3.selectAll("text"));bio.iteration.loop(a,function(o){var a=e(o.textContent,t);if(a.is||/gene_/i.test(o.parentNode.id)){var r=d3.select(o.parentNode).select("rect"),l=i.indexOf(o.textContent),s={x:parseInt(r.attr("x")),y:parseInt(r.attr("y")),width:parseInt(r.attr("width")),height:parseInt(r.attr("height"))};n(r,a.data,s,l),n(d3.select(o),a.data,s)}}),o(a[0].parentNode.parentNode),d3.selectAll("text, rect").attr("class","")}function r(t){var e=bio.pathwayConfig().drug();d3.selectAll('g[id*="drug_"]').datum(function(e){var i=d3.select(this).attr("transform"),n=bio.dependencies.version.d3v4()?bio.rendering().translation(i):d3.transform(i);return{cancer:t,scaleX:n.scale[0],scaleY:n.scale[1],translateX:n.translate[0],translateY:n.translate[1]}}).on("click",e.on.click).on("mouseover",e.on.mouseover).on("mouseout",e.on.mouseout)}var l={};return function(e){t(e.cancer_type,function(t){bio.modal({id:"drug_modal",element:document.querySelector(e.element)}),(l=bio.initialize("pathway")).setting=bio.setting("pathway",e),l.data=l.setting.preprocessData,l.modalID="drug_modal",bio.title("#pathway_title",e.cancer_type.toUpperCase()+" - Pathway");var i=document.getElementById("pathway_contents"),n=document.querySelector(".modal-body");d3.select(t.documentElement).attr("width",parseFloat(i.style.width)).attr("height",parseFloat(i.style.height)),i.appendChild(t.documentElement),n.style.height=.8*parseFloat(i.style.height)+"px",a(l.setting.defaultData.pathway,l.setting.defaultData.patient),r(e.cancer_type)}),console.log(">>> Pathway reponse data: ",e),console.log(">>> Pathway setting data: ",l.setting),console.log(">>> Pathway model data: ",l)}}function loading(){"use strict";function t(t){var e=[];return bio.iteration.loop(t,function(t){var i=document.createElement("div");i.className="loading-circle-"+t,e.push(i)}),e}function e(e,i,n){var o=document.createElement("div"),a=document.createElement("div"),r=t([1,2,3,4]),l=document.createElement("span");o.className="loading",o.style.width=i+"px",o.style.height=n+"px",l.className="loading-text",l.innerHTML="Loading";for(var s=0,c=r.length;s<c;s++)a.appendChild(r[s]);return o.appendChild(a),o.appendChild(l),e.appendChild(o),o}function i(t,i,n){if(!i||!n)throw new Error("Please define the width and height");o.loadingElement=document.querySelector(".loading")?document.querySelector(".loading"):e(t,i,n),"none"===o.loadingElement.style.display&&(o.loadingElement.style.display="block")}function n(t,e){$(o.loadingElement).fadeOut("slow")}var o={};return function(t,e,o){return{start:i,end:n}}}function modal(){"use strict";function t(){var t=document.createElement("button");return t.id="modal_close",t.className="btn btn-default",t.innerHTML="Close",t.setAttribute("type","button"),t.setAttribute("data-dismiss","modal"),t}function e(e){i.modal=document.createElement("div"),i.modal.setAttribute("tabindex","-1"),i.modal.setAttribute("role","dialog"),i.modal.setAttribute("aria-labelledby",e),i.dialog=document.createElement("div"),i.dialog.setAttribute("role","document"),i.content=document.createElement("div"),i.header=document.createElement("div"),i.footer=document.createElement("div"),i.title=document.createElement("div"),i.body=document.createElement("div"),i.modal.id=e,i.body.className="modal-body",i.modal.className="modal fade",i.title.className="modal-title",i.dialog.className="modal-dialog",i.footer.className="modal-footer",i.header.className="modal-header",i.content.className="modal-content",i.body.style.height="0px",i.modal.style.display="none",i.header.appendChild(i.title),i.content.appendChild(i.header),i.content.appendChild(i.body),i.footer.appendChild(t()),i.content.appendChild(i.footer),i.dialog.appendChild(i.content),i.modal.appendChild(i.dialog)}var i={};return function(t){e(t.id||"modal"),i.element=t.element,i.element.appendChild(i.modal)}}function selectBox(){"use strict";function t(t){var e=document.createElement("div"),i=a.width-2*a.margin.left,n=a.height-2*a.margin.top<40?a.height-2*a.margin.top:40;return e.className=t+" drop-menu",e.style.width=i+"px",e.style.height=n+"px",e.style.marginLeft=a.margin.left+"px",e.style.marginTop=a.margin.top+"px",e.style.fontSize=a.fontSize,e}function e(t,e){var i=document.createElement("div"),n=document.createElement("span"),o=document.createElement("i");return i.className=t+" select",i.style.paddingTop=10-a.margin.top+1+"px",i.style.paddingBottom=10-a.margin.top+1+"px",i.style.paddingLeft=10-a.margin.left+1+"px",i.style.paddingRight=10-a.margin.left+1+"px",n.title=e,n.innerHTML=e,o.className="fa fa-chevron-down",i.appendChild(n),i.appendChild(o),i}function i(t){var e=document.createElement("input");return e.type="hidden",e.name=t,e}function n(t){var e=document.createElement("ul");return e.className="dropeddown",bio.iteration.loop(t,function(t){var i=document.createElement("li");i.id=t,i.title=t,i.innerHTML=bio.drawing().textOverflow(t,a.fontSize,.4*a.width),e.appendChild(i)}),e}function o(t,e){t="."+t,$(t).click(function(t){$(this).attr("tabindex",1).focus(),$(this).toggleClass("active"),$(this).find(".dropeddown").slideToggle(300)}),$(t).focusout(function(){$(this).removeClass("active"),$(this).find(".dropeddown").slideUp(300)}),$(t+" .dropeddown li").click(function(t){return $(this).parents(".drop-menu").find("span").text($(this).text()),$(this).parents(".drop-menu").find("span").attr("title",$(this).attr("id")),$(this).parents(".drop-menu").find("input").attr("value",$(this).attr("id")),!!e&&e($(this).attr("id").toLowerCase())})}var a={};return function(r){(a={}).element=document.querySelector(r.id),a.className=r.className||"",a.margin=bio.sizing.setMargin(r.margin||[0,0,0,0]),a.width=r.width||parseFloat(a.element.style.width),a.height=r.height||parseFloat(a.element.style.height),a.defaultText=r.defaultText||"Select",a.viewName=r.viewName||"viewName",a.fontSize=r.fontSize||"10px",a.items=r.items||[""],a.clickItem=r.clickItem||null,a.frame=t(a.className),a.defaultText=e(a.className,a.defaultText),a.viewer=i(a.viewName),a.addItems=n(a.items),a.element.children.length<1&&(a.frame.appendChild(a.defaultText),a.frame.appendChild(a.viewer),a.frame.appendChild(a.addItems),a.element.appendChild(a.frame),o(a.className,a.clickItem),document.querySelector(".drop-menu .select").style.lineHeight=a.fontSize)}}function table(){"use strict";function t(t,e){var i=document.createElement("div");return i.className="table-frame",i.style.width=t+"px",i.style.height=e+"px",i}function e(t){var e=document.createElement("div");return e.innerHTML=t||"",e.className="table-caption",e.style.display="table-caption",e}function i(t){var e=document.createElement("div");return e.id=t||"",e.className="table-row",e.style.display="table-row",e}function n(t,e,i){var n=document.createElement("div");return n.className="table-cell "+t.removeWhiteSpace(),n.style.padding="5px",n.style.width=e+"px",n.style.height=(i||35)+"px",n.style.lineHeight=(i||25)+"px",n.style.display="table-cell",n.innerHTML=t,n}function o(t){var e=document.createElement("div"),i=t.indexOf("<")>-1?t.substring(0,t.indexOf("<")):t,n=0;return e.id="temp_width",e.style.fontSize="16px",e.style.fontWeight="bold",e.style.overflow="hidden",e.style.border="1px solid",e.style.whiteSpace="nowrap",e.style.display="table-cell",e.style.textOverflow="ellipse",e.innerHTML=i,document.body.appendChild(e),n=e.getBoundingClientRect().width,document.body.removeChild(document.querySelector("#temp_width")),n+12}function a(t,e,i){s.cellWidth.fill(t.length,0),bio.iteration.loop(t,function(t,e){s.cellWidth[e]=o(t)}),bio.iteration.loop(e,function(e,n){var a=[];bio.iteration.loop(t,function(t,r){var l=i(r,n,t,e);s.cellWidth[r]=s.cellWidth[r]>o(l)?s.cellWidth[r]:o(l),a.push(l)}),s.cellData.push(a)});var n=0;bio.iteration.loop(s.cellWidth,function(t){n+=t}),s.frame.style.width=n+20+"px"}function r(t,e){var o=document.createElement("div"),a=i();return o.className="table-header",bio.iteration.loop(e,function(t,e){a.appendChild(n(t,s.cellWidth[e]))}),o.appendChild(a),t.appendChild(o),a}function l(t,e,o){var a=document.createElement("div");a.className="table-contents",a.style.height=o.height+"px",bio.iteration.loop(e,function(t){var e=i();bio.iteration.loop(t,function(t,i){e.appendChild(n(t,s.cellWidth[i]))}),a.appendChild(e)}),t.appendChild(a)}var s={cellData:[],cellWidth:[]};return function(i){if(document.querySelector(".table-frame")&&i.element.removeChild(document.querySelector(".table-frame")),!i.columns)throw new Error("Not found Columns");s.element=i.element,s.width=i.width||0,s.height=i.height||0,s.frame=t(s.width,s.height),a(i.heads,i.data,i.columns),s.frame.appendChild(e(i.title)),r(s.frame,i.heads),l(s.frame,s.cellData,i),s.element.appendChild(s.frame)}}function title(){"use strict";return function(t,e){var i=bio.dom().get(t),n=parseFloat(i.style.width),o=parseFloat(i.style.height);i.innerHTML=e,i.style.fontSize=bio.drawing().fitText(e,n,o,"bold"),i.style.lineHeight=i.style.height}}function tooltip(){"use strict";function t(t,e,i){return t.left-i.width/2<e.left?"right":t.top-i.height<e.top?"bottom":t.right+i.width>e.right?"left":(t.bottom,i.height,e.bottom,"top")}function e(e,i,n){if(!e)throw new Error("Do not find a Tooltip element");var o=e.getBoundingClientRect(),a=i.getBoundingClientRect(),r=t(a,n.getBoundingClientRect(),o);e.className=r,e.style.visibility="visible",e.style.top=function(t,e,i){if("left"!==t&&"top"!==t&&"bottom"!==t&&"right"!==t)throw new Error("Wrong direction");return{top:e.top-i-10+window.scrollY+"px",left:e.top-i/2+window.scrollY+"px",bottom:e.bottom+10+window.scrollY+"px",right:e.top-i/2+window.scrollY+"px"}[t]}(r,a,o.height),e.style.left=function(t,e,i){if("left"!==t&&"top"!==t&&"bottom"!==t&&"right"!==t)throw new Error("Wrong direction");return{top:e.left-i/2+window.scrollX+"px",left:e.left-i-10+"px",bottom:e.left-i/2+window.scrollX+"px",right:e.right+10+"px"}[t]}(r,a,o.width)}function i(t){if(!t)throw new Error("Do not find a Tooltip element");t.innerHTML="",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden"}return function(t){if("String"===bio.objects.getType(t)){if(!document.getElementById("biochart_tooltip"))throw new Error('Not found "#biochart_tooltip"');return i(document.getElementById("biochart_tooltip"))}var n=t.element||null,o=t.contents||"",a=bio.drawing().getParentSVG(n),r=document.getElementById("biochart_tooltip");return r.innerHTML=o,e(r,n,a)}}function dependencies(){"use strict";var t={version:{}};return t.version.d3v4=function(){if(!d3)throw new Error("D3JS is not found");return 0!==d3.version.indexOf("3")},t}function dom(){"use strict";var t={};return t.get=function(t){if("object"==typeof t)return t;var e=["#","."],i=t.removeSymbol(),n=null;return bio.iteration.loop(e,function(t){var e=t+i,o=document.querySelector(e);o&&(n=o)}),n},t.remove=function(t,e){if(bio.objects.getType(t).indexOf("HTML")<0)throw new Error("Not a dom element");bio.iteration.loop(e,function(e){t.removeChild(e)})},t.removeAll=function(t){if(bio.objects.getType(t).indexOf("HTML")<0)throw new Error("Not a dom element");for(;t.firstChild;)t.removeChild(t.firstChild)},function(){return t}}function iteration(){"use strict";var t={};return t.loop=function(t,e){if("object"!=typeof t)throw new Error("This is not Object or Array");if("Array"===bio.objects.getType(t))for(var i=0,n=t.length;i<n;i++)e.call(this,t[i],i);else for(var o in t)e.call(this,o,t[o])},Array.prototype.fill=function(t,e){for(var i=0;i<t;i++)this.push(e);return this},t}function math(){"use strict";var t={};return t.medianIndex=function(t){var e=t.length;return e%2==1?(e+1)/2:e/2},t.median=function(e){var i=bio.objects.clone(e);return i.sort(function(t,e){return t>e?1:-1})[t.medianIndex(i)]},t.min=function(t,e){return arguments.length<2?Math.min.apply(null,t):Math.min.call(null,t,e)},t.max=function(t,e){return arguments.length<2?Math.max.apply(null,t):Math.max.call(null,t,e)},t.random=function(t,e){return t=t||0,e=e||1,Math.floor(Math.random()*e)+t},t}function objects(){"use strict";var t={};return t.getType=function(t){var e=Object.prototype.toString.call(t);return e.substring(e.indexOf(" ")+1,e.indexOf("]"))},t.clone=function(e){if("object"!=typeof e)return e;if("Array"===t.getType(e))return(new Array).concat(e);var i={};return bio.iteration.loop(e,function(n,o){e.hasOwnProperty(n)&&(i[n]=t.clone(e[n]))}),i},t.getKey=function(t,e){return Object.keys(t)[Object.values(t).indexOf(e)]},t}function strings(){"use strict";String.prototype.matchAll=function(t){for(var e,i=[];e=t.exec(this);)i.push(e[0]);return i},String.prototype.pronoun=function(){return this[0].toUpperCase()+this.substring(1).toLowerCase()},String.prototype.removeWhiteSpace=function(){return this.replace(/\s/gi,"")},String.prototype.removeSymbol=function(){return this.replace(/\W/gi,"")},String.prototype.replaceAt=function(t,e){return this.substring(0,t)+e+this.substring(t+1)},String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"ig"),e)}}function variants(){"use strict";function t(t,e){var i=[].concat(l.data.axis.needle.y);bio.layout().get(l.setting.svgs,["needle"],function(n,o){var a=bio.variantsConfig().axis(t,e,o),r=(bio.variantsConfig().axis("common"),l.data.axis.needle[e.toLowerCase()]);bio.axises()[a.direction]({element:o,top:a.top,left:a.left,range:a.range,margin:a.margin,exclude:a.exclude,domain:"Y"===e?i.reverse():r})})}function e(t,e){var i={needle:"s_legend",patient:"t_legend"}[t];e=e.sort(function(t,e){return bio.boilerPlate.variantInfo[t].order>bio.boilerPlate.variantInfo[e].order?1:-1}),bio.layout().get(l.setting.svgs,[i],function(i,n){var o=bio.variantsConfig().legend(t);bio.legend({data:e,element:n,on:o.on,attr:o.attr,text:o.text,style:o.style,margin:o.margin})})}function i(t,e,i,n){bio.layout().get(l.setting.svgs,["needle"],function(o,a){var r=bio.variantsConfig().needle();bio.needle({element:a,yaxis:i.y,on:r.on,lineData:t,shapeData:e,attr:r.attr,style:r.style,margin:r.margin,xaxis:n||i.x})})}function n(t,e){bio.layout().get(l.setting.svgs,["navi"],function(n,r){var s=bio.variantsConfig().navi();bio.variantsNavi({data:t,element:r,xaxis:e.x,yaxis:e.y,on:s.on,attr:s.attr,style:s.style,margin:s.margin,call:{drag:s.call.drag,end:function(t,e,n){var r=n.opts.drag,s=bio.scales().invert(n.scaleX),c=[s(r.start.now+n.controls.width),s(r.end.now+n.controls.width)],u=[n.margin.left,n.width-n.margin.right];d3.selectAll(".bottom-axis-g-tag").call(bio.axises().byD3v(bio.scales().get(c,u),"bottom")),bio.layout().removeGroupTag([".variants_needle_svg.needle-line-g-tag",".variants_needle_svg.needle-shape-g-tag",".variants_needle_svg.needle-graph-g-tag",".variants_needle_svg.needle-patient-shape-g-tag"]),i(l.data.needle.line,l.data.needle.shape,l.data.axis.needle,c),o(l.data.graph,l.data.axis.needle,c),a(l.data.patient.shape,l.data.axis.needle,c)}}})})}function o(t,e,i){bio.layout().get(l.setting.svgs,["needle"],function(n,o){var a=bio.variantsConfig().graph();bio.variantsGraph({data:t,element:o,on:a.on,yaxis:e.y,text:a.text,attr:a.attr,style:a.style,margin:a.margin,xaxis:i||e.x})})}function a(t,e,i){bio.layout().get(l.setting.svgs,["needle"],function(n,o){var a=bio.variantsConfig().patient(),r=bio.variantsConfig().needle();bio.variantsPatient({data:t,element:o,yaxis:e.y,attr:a.attr,style:a.style,on:r.on,margin:a.margin,xaxis:i||e.x})})}function r(r){bio.layout().removeGroupTag(),t("needle","X"),t("needle","Y"),e("needle",r.type),e("patient",[r.patient.shape[0].info[0].id]),i(r.needle.line,r.needle.shape,r.axis.needle),n(r,r.axis.needle),o(r.graph,r.axis.needle),a(r.patient.shape,r.axis.needle)}var l={};return function(t){(l=bio.initialize("variants")).setting=bio.setting("variants",t),l.data=l.setting.preprocessData,bio.title("#variants_title",l.setting.defaultData.variants.title),r(l.data),console.log(">>> Variants reponse data: ",t),console.log(">>> Variants setting data: ",l.setting),console.log(">>> Variants model data: ",l)}}function variantsGraph(){"use strict";var t={};return function(e,i){t=bio.objects.clone(i||{}),(t=bio.sizing.chart.default(t,e)).graphData=e.data,t.copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.margin.top,t.height-t.margin.bottom],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.group=bio.rendering().addGroup(e.element,0,0,"needle-graph"),t.opts={base:bio.objects.clone(e),graph:bio.objects.clone(e)},t.opts.base.data=[""],t.opts.base.id=t.id+"_graph_base",t.opts.base.element=t.group.selectAll("#"+t.id+"_graph_base"),bio.rectangle(t.opts.base,t),t.opts.graph.id=t.id+"_graph_group",t.opts.graph.data=null,t.opts.graph.element=t.group.selectAll("#"+t.id+"_graph_group").data(t.graphData).enter().append("g").attr("id",t.id+"_graph_group").attr("transform","translate(0, 0)"),bio.rectangle(t.opts.graph,t),bio.text(t.opts.graph,t)}}function variantsNavi(){"use strict";var t={};return function(e,i){var n=bio.variantsConfig().navi();t=bio.initialize("variantsNavi"),t=bio.objects.clone(i||{}),(t=bio.sizing.chart.default(t,e)).naviData=e.data,t.copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.height-t.margin.bottom,t.margin.top],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.controls={width:5,height:.4*t.height},t.start=t.scaleX(bio.math.min(t.copyX)),t.end=t.width-t.margin.left-t.margin.right,n.start.init=t.start-t.controls.width,n.end.init=t.end-t.controls.width+t.margin.left,n.start.now=n.start.init,n.end.now=n.end.init,n.navi.init=t.start,n.navi.now=t.start,n.navi.width=t.end,n.navi.nowWidth=t.end-t.start,t.group=bio.rendering().addGroup(e.element,0,0,"heatmap");var o=bio.variantsConfig().needle();bio.variantsConfig().navi();bio.needle({xaxis:t.copyX,yaxis:t.copyY,element:e.element,attr:o.attr,style:o.style,margin:[10,40,10,40],lineData:t.naviData.needle.line,shapeData:t.naviData.needle.shape}),t.opts={end:bio.objects.clone(e),main:bio.objects.clone(e),start:bio.objects.clone(e),drag:n},t.opts.main.data=["main"],t.opts.main.id=t.id+"_navi_main",t.opts.main.element=t.group.selectAll("#"+t.id+"_navi_main"),t.opts.start.data=["start"],t.opts.start.id=t.id+"_navi_start",t.opts.start.element=t.group.selectAll("#"+t.id+"_navi_start"),t.opts.end.data=["end"],t.opts.end.id=t.id+"_navi_end",t.opts.end.element=t.group.selectAll("#"+t.id+"_navi_end"),bio.rectangle(t.opts.main,t),bio.rectangle(t.opts.start,t),bio.rectangle(t.opts.end,t),d3.selectAll("#"+t.id+" path").remove()}}function variantsPatient(){"use strict";var t={};return function(e,i){t=bio.objects.clone(i||{}),(t=bio.sizing.chart.default(t,e)).patientData=e.data,t.copyX=[].concat(e.xaxis),t.copyY=[].concat(e.yaxis),t.rangeX=[t.margin.left,t.width-t.margin.right],t.rangeY=[t.height-t.margin.bottom,t.margin.top],t.scaleX=bio.scales().get(t.copyX,t.rangeX),t.scaleY=bio.scales().get(t.copyY,t.rangeY),t.shapeGroup=bio.rendering().addGroup(e.element,0,0,"needle-patient-shape"),t.opts=bio.objects.clone(e),t.opts.data=t.patientData,t.opts.element=t.shapeGroup.selectAll("#"+t.id+"_needle_patient_shape"),bio.triangle(t.opts,t)}}!function(t){"use strict";var e={initialize:initialize(),sizing:sizing(),layout:layout(),setting:setting(),boilerPlate:boilerPlate(),commonConfig:commonConfig(),pathwayConfig:pathwayConfig(),variantsConfig:variantsConfig(),landscapeConfig:landscapeConfig(),expressionConfig:expressionConfig(),exclusivityConfig:exclusivityConfig(),preprocess:preprocess(),preprocPathway:preprocPathway(),preprocVariants:preprocVariants(),preprocLandscape:preprocLandscape(),preprocExpression:preprocExpression(),preprocExclusivity:preprocExclusivity(),modal:modal(),title:title(),table:table(),loading:loading(),tooltip:tooltip(),selectBox:selectBox(),bar:bar(),text:text(),path:path(),heat:heat(),axises:axises(),circle:circle(),scales:scales(),needle:needle(),legend:legend(),drawing:drawing(),scatter:scatter(),network:network(),triangle:triangle(),survival:survival(),rectangle:rectangle(),rendering:rendering(),divisionLine:divisionLine(),dom:dom(),math:math(),handler:handler(),strings:strings(),objects:objects(),iteration:iteration(),dependencies:dependencies(),expression:expression(),colorGradient:colorGradient(),exclusivity:exclusivity(),scaleSet:scaleSet(),sortTitle:sortTitle(),landscape:landscape(),landscapeSort:landscapeSort(),variants:variants(),variantsNavi:variantsNavi(),variantsGraph:variantsGraph(),variantsPatient:variantsPatient(),pathway:pathway()};t.bio=e}(window||{});var SurvivalCurveBroilerPlate={elem:{svg:"",xScale:"",yScale:"",xAxis:"",yAxis:"",line:"",curve:"",dots:[],censoredDots:""},settings:{canvas_width:400,canvas_height:400,chart_width:370,chart_height:370,chart_left:50,chart_top:25,include_info_table:!1,include_legend:!0,include_pvalue:!0,pval_x:220,pval_y:57},divs:{curveDivId:"",headerDivId:"",infoTableDivId:""},subGroupSettings:{line_color:"red",mouseover_color:"#F5BCA9",legend:"",curveId:""},text:{xTitle:"",yTitle:"",qTips:{estimation:"",censoredEvent:"",failureEvent:""},infoTableTitles:{total_cases:"#total cases",num_of_events_cases:"",median:""},pValTitle:"Logrank Test P-Value: "},style:{censored_sign_size:5,axis_stroke_width:1,axisX_title_pos_x:260,axisX_title_pos_y:30,axisY_title_pos_x:10,axisY_title_pos_y:10,axis_color:"black",pval_font_size:10,pval_font_style:"normal"},vals:{pVal:0}};if(void 0===cbio)var cbio={};cbio.util=function(){function t(t,e){e=e||512;for(var i=atob(t),n=[],o=0;o<i.length;o+=e){for(var a=i.slice(o,o+e),r=new Array(a.length),l=0;l<a.length;l++)r[l]=a.charCodeAt(l);var s=new Uint8Array(r);n.push(s)}return n}function e(t,e){$(t).mouseenter(function(t){e.fadeIn({complete:function(){$(this).css({visibility:"visible"}),$(this).css({display:"inline"})}})}),$(t).mouseleave(function(t){e.fadeOut({complete:function(){$(this).css({visibility:"hidden"}),$(this).css({display:"inline"})}})})}function i(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function n(t){var e=document.getElementById(t),i=e;return e.contentWindow&&(i=e.contentWindow),i}function o(t){var e=document.getElementById(t),i=e.contentDocument;return!i&&e.contentWindow&&(i=e.contentWindow.document),i}function a(t,e){return"case.do?cancer_study_id="+t+"&case_id="+e}function r(t,e){return"case.do?cancer_study_id="+t+"&sample_id="+e}function l(t,e){t?(t[0]&&t[0].ownerSVGElement?t=t[0]:t[0]&&t[0][0]&&t[0][0].ownerSVGElement&&(t=t[0][0]),$(t).off("mouseenter",s),$(t).one("mouseenter",{qTipOpts:e},s)):console.error("qTip target is not defined.")}function s(t){var e={show:{ready:!0},hide:{fixed:!0,delay:100},style:{classes:"qtip-light qtip-rounded qtip-shadow",tip:!0},position:{my:"top left",at:"bottom right",viewport:$(window)}},i=t.data.qTipOpts;jQuery.extend(!0,e,i),$(this).qtip(e)}function c(){return{proxy:{pdbProxy:{options:{servletName:"get3dPdb.json",listJoiner:" ",subService:!1}},variantAnnotationProxy:{options:{initMode:"full",data:{}}}}}}function u(t){var e;if(null==t)return t;e=(e=d(e=t.replace(/\s+$/,""),"_"," ")).toLowerCase();var i=new Array;i.push(e.charAt(0).toUpperCase());for(var n=1;n<e.length;n++)" "==e.charAt(n-1)?i.push(e.charAt(n).toUpperCase()):i.push(e.charAt(n));return i.join("")}function d(t,e,i){for(var n=t,o=n.indexOf(e);-1!=o;)o=(n=n.replace(e,i)).indexOf(e);return n}function p(){return'<b>Recurrent Hotspot</b><br/>This mutated amino acid was identified as a recurrent hotspot (statistically significant) in a population-scale cohort of tumor samples of various cancer types using methodology based in part on <a href="http://www.ncbi.nlm.nih.gov/pubmed/26619011" target="_blank">Chang et al., Nat Biotechnol, 2016</a>.<br/><br/>Explore all mutations at <a href="http://cancerhotspots.org/" target="_blank">http://cancerhotspots.org/</a>.'}function f(t,e){var i=[],n=!1;_.each(t,function(t){$.isNumeric(t)&&i.push(Number(t))}),i.sort(function(t,e){return t-e});var o=i[Math.floor(i.length/4)],a=i[Math.ceil(.75*i.length)>i.length-1?i.length-1:Math.ceil(.75*i.length)],r=a-o;i[Math.ceil(.5*i.length)]<.001&&(n=!0);var l,s;if(a<1?(l=Number((a+1.5*r).toFixed(2)),s=Number((o-1.5*r).toFixed(2))):(l=Math.ceil(a+1.5*r),s=Math.floor(o-1.5*r)),s<i[0]&&(s=i[0]),l>i[i.length-1]&&(l=i[i.length-1]),e){var c=0;if(-1===i.indexOf(s)){for(;s>i[c]&&s>i[c+1];)c++;s=i[c+1]}if(c=i.length-1,-1===i.indexOf(l)){for(;l<i[c]&&l<i[c-1];)c--;l=i[c-1]}}return[s,l,n]}var g=function(t){return null===t||void 0===t},h=function(){var t=window.location.origin;return t||(t=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),t},m=function(t,e){function i(t,i){return t[e]<i[e]?-1:t[e]>i[e]?1:0}return t.sort(i),t},v=function(t){return t.replace(/[^a-zA-Z0-9-]/g,"_")};return{toPrecision:function(t,e,i){return 1e-6<=t&&t<i?t.toExponential(e):t.toPrecision(e)},getObjectLength:function(t){var e=0;for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e++;return e},checkNullOrUndefined:g,uniqueElementsOfArray:function(t){for(var e=[],i={},n=0,o=t.length;n<o;n++)t[n]in i||(e.push(t[n]),i[t[n]]=1);return e},arrayToAssociatedArrayIndices:function(t,e){g(e)&&(e=0);for(var i={},n=0,o=t.length;n<o;n++)i[t[n]]=n+e;return i},alterAxesAttrForPDFConverter:function(t,e,i,n,o){o&&(e*=-1,n*=-1);var a=t.selectAll(".tick").selectAll("text"),r=i.selectAll(".tick").selectAll("text"),l=parseInt(a.attr("y")),s=parseInt(r.attr("y"));a.attr("y",l+e),r.attr("y",s+n)},lcss:function(t,e){for(var i=0;i<t.length&&i<e.length&&t[i]===e[i];)i++;return t.substring(0,i)},b64ToByteArrays:t,browser:function(){var t={},e=navigator.userAgent.toLowerCase();if(t.firefox=/mozilla/.test(e)&&/firefox/.test(e),t.mozilla=t.firefox,t.chrome=/webkit/.test(e)&&/chrome/.test(e),t.safari=/applewebkit/.test(e)&&/safari/.test(e)&&!/chrome/.test(e),t.opera=/opera/.test(e),t.msie=/msie/.test(e),t.version="",t.msie||t.firefox||t.chrome||t.safari||t.opera||/trident/.test(e)&&(t.msie=!0,t.version=11),""===t.version)for(var i in t)if(t[i]){t.version=e.match(new RegExp("("+i+")( |/)([0-9]+)"))[3];break}return t}(),getWindowOrigin:h,sortByAttribute:m,safeProperty:v,autoHideOnMouseLeave:e,swapElement:i,getTargetWindow:n,getTargetDocument:o,getLinkToPatientView:a,getLinkToSampleView:r,addTargetedQTip:l,baseMutationMapperOpts:c,toTitleCase:u,getHotSpotDesc:p,replaceAll:d,findExtremes:f}}(),Array.prototype.forEach||(Array.prototype.forEach=function(t){var e=this.length>>>0;if("function"!=typeof t)throw new TypeError;for(var i=arguments[1],n=0;n<e;n++)n in this&&t.call(i,this[n],n,this)});var KmEstimator=function(){return{calc:function(t){var e=1;for(var i in t){var n=t[i];"1"==n.status?(n.survival_rate=e*((n.num_at_risk-1)/n.num_at_risk),e=n.survival_rate):"0"==n.status&&(n.survival_rate=e)}}}},LogRankTest=function(){function t(t,i,n){for(var r=0,l=0;r<t.length&&l<i.length;){if(t[r].time<i[l].time){if((s=jQuery.extend(!0,{},o)).time=t[r].time,"1"!=t[r].status){r+=1;continue}s.num_of_failure_1=1,s.num_at_risk_1=t[r].num_at_risk,s.num_at_risk_2=i[l].num_at_risk,r+=1}else if(t[r].time>i[l].time){if((s=jQuery.extend(!0,{},o)).time=i[l].time,"1"!=i[l].status){l+=1;continue}s.num_of_failure_2=1,s.num_at_risk_1=t[r].num_at_risk,s.num_at_risk_2=i[l].num_at_risk,l+=1}else{var s=jQuery.extend(!0,{},o);if(s.time=t[r].time,"1"!=t[r].status&&"1"!=i[l].status){r+=1,l+=1;continue}"1"==t[r].status&&(s.num_of_failure_1=1),"1"==i[l].status&&(s.num_of_failure_2=1),s.num_at_risk_1=t[r].num_at_risk,s.num_at_risk_2=i[l].num_at_risk,r+=1,l+=1}a.push(s)}e(n)}function e(t){$.each(a,function(t,e){e.expectation=e.num_at_risk_1/(e.num_at_risk_1+e.num_at_risk_2)*(e.num_of_failure_1+e.num_of_failure_2)}),i(t)}function i(t){$.each(a,function(t,e){var i=e.num_of_failure_1+e.num_of_failure_2,n=e.num_at_risk_1+e.num_at_risk_2;e.variance=i*(n-i)*e.num_at_risk_1*e.num_at_risk_2/(n*n*(n-1))}),n(t)}function n(t){var e=0,i=0,n=0;$.each(a,function(t,o){e+=o.num_of_failure_1,i+=o.expectation,n+=o.variance});var o=(e-i)*(e-i)/n;$.post("http://www.cbioportal.org/calcPval.do",{chi_square_score:o}).done(function(e){(r=t)(e)})}var o={time:"",num_of_failure_1:0,num_of_failure_2:0,num_at_risk_1:0,num_at_risk_2:0,expectation:0,variance:0},a=[],r="";return{calc:function(e,i,n){a.length=0,t(e,i,n)}}},SurvivalCurve=function(){function t(){$("#"+A.curveDivId).empty(),b.svg=d3.select("#"+A.curveDivId).append("svg").attr("width",w.canvas_width).attr("height",w.canvas_height),b.curve=b.svg.append("g"),b.censoredDots=b.svg.append("g").attr("id","crossDots")}function e(t){var e=[],i=d3.format(".0%");$.each(t,function(t,i){var n=i.data;$.each(n.getData(),function(t,i){e.push(i.time)})}),b.xScale=d3.scaleLinear().domain([0,d3.max(e)+.1*d3.max(e)]).range([w.chart_left,w.chart_width]),b.yScale=d3.scaleLinear().domain([-.03,1.05]).range([w.chart_height-40,w.chart_left]),b.xAxis=d3.axisBottom(b.xScale).tickSize(6,0,0),b.yAxis=d3.axisLeft(b.yScale).tickFormat(i).tickSize(6,0,0)}function i(){b.line=d3.line().x(function(t){return b.xScale(t.time)}).y(function(t){return b.yScale(t.survival_rate)})}function n(t){var e={case_id:"",time:"",status:"",num_at_risk:-1,survival_rate:0},i=jQuery.extend(!0,{},e);return i.case_id="NA",i.time=0,i.status="NA",i.num_at_risk=t,i.survival_rate=1,i}function o(t,e,i){null!==t&&t.length>0&&(0!==t[0].time&&t.unshift(n(t[0].num_at_risk)),b.curve=b.svg.append("path").attr("id",i+"-line").attr("d",b.line(t)).style("fill","none").style("stroke",e.line_color))}function a(t,e,i){b.dots[t].selectAll("path").data(e).enter().append("svg:path").attr("d",d3.symbol().size(400).type(d3.symbolCircle)).attr("transform",function(t){return"translate("+b.xScale(t.time)+", "+b.yScale(t.survival_rate)+")"}).attr("fill",i).style("opacity",0)}function r(t){var e=function(t){if(d3.select(this).transition().duration(400).style("opacity",.9),!$(this).data("qtip")){var e=window.QuerySession?window.QuerySession.getCancerStudyIds()[0]:window.cancerStudyId||window.cancer_study_id||window.cancer_study_id_selected,i="<font size='2'>";i+=C.qTips.id+": <strong><a href='"+E(e,t.case_id)+"' target='_blank'>"+t.case_id+"</a></strong><br>",i+=C.qTips.estimation+": <strong>"+(100*t.survival_rate).toFixed(2)+"%</strong><br>","0"===t.status?i+=C.qTips.censoredEvent+": <strong>"+t.time.toFixed(2)+" </strong>months (censored)<br>":i+=C.qTips.failureEvent+": <strong>"+t.time.toFixed(2)+" </strong>months<br>",i+="</font>",$(this).qtip({content:{text:i},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow qtip-wide"},show:{event:"mouseover",ready:!0},hide:{fixed:!0,delay:100,event:"mouseout"},position:{my:"left bottom",at:"top right"}})}},i=function(){d3.select(this).transition().duration(400).style("opacity",0)};b.dots[t].selectAll("path").on("mouseover",e),b.dots[t].selectAll("path").on("mouseout",i)}function l(t,e){b.svg.append("g").style("stroke-width",k.axis_stroke_width).style("fill","none").style("stroke",k.axis_color).attr("class","survival-curve-x-axis-class").style("shape-rendering","crispEdges").attr("transform","translate(0, "+(w.chart_height-40)+")").call(t),b.svg.append("g").style("stroke-width",k.axis_stroke_width).style("fill","none").style("stroke",k.axis_color).style("shape-rendering","crispEdges").attr("transform","translate(0, "+w.chart_left+")").call(t.ticks(0)),b.svg.append("g").style("stroke-width",k.axis_stroke_width).style("fill","none").style("stroke",k.axis_color).attr("class","survival-curve-y-axis-class").style("shape-rendering","crispEdges").attr("transform","translate("+w.chart_left+", 0)").call(e),b.svg.append("g").style("stroke-width",k.axis_stroke_width).style("fill","none").style("stroke",k.axis_color).style("shape-rendering","crispEdges").attr("transform","translate("+(w.chart_width-1)+", 0)").call(e.ticks(0)),b.svg.selectAll("text").style("font-family","sans-serif").style("font-size","11px").style("stroke-width",.5).style("stroke","black").style("fill","black")}function s(t,e,i){b.censoredDots.append("g").attr("id",i+"-crossdots").selectAll("path").data(t).enter().append("path").filter(function(t){return"0"==t.status}).attr("transform",function(t){return"translate("+b.xScale(t.time)+","+b.yScale(t.survival_rate)+")"}).attr("d",d3.symbol().type(d3.symbolCross).size(function(t){return 25})).attr("fill",e.line_color)}function c(t){var e=[];$.each(t,function(t,i){var n={};n.text=i.settings.legend,n.color=i.settings.line_color,e.push(n)});var i=b.svg.selectAll(".legend").data(e).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate("+w.chart_left+", "+(20+15*e)+")"});i.append("path").attr("width",18).attr("height",18).attr("d",d3.symbol().size(60).type(function(t){return d3.symbolSquare})).attr("fill",function(t){return t.color}).attr("stroke","black").attr("stroke-width",.9),i.append("text").attr("x",10).attr("y",5).style("text-anchor","front").style("font-size","11px").text(function(t){return t.text})}function u(t,e){b.svg.append("text").attr("class","label").attr("x",k.axisX_title_pos_x).attr("y",k.axisX_title_pos_y).style("text-anchor","middle").style("font-size","11px").style("font-weight","bold").text(t),b.svg.append("text").attr("class","label").attr("transform","rotate(-90)").attr("x",k.axisY_title_pos_x).attr("y",k.axisY_title_pos_y).style("text-anchor","middle").style("font-size","11px").style("font-weight","bold").text(e)}function d(t){b.svg.append("text").attr("class","pval").attr("x",w.pval_x).attr("y",w.pval_y).attr("font-size",k.pval_font_size).attr("font-style",k.pval_font_style).style("text-anchor","front").text(C.pValTitle+cbio.util.toPrecision(Number(t),3,.001))}function p(t){b.svg.select(".pval").text(C.pValTitle+cbio.util.toPrecision(Number(t),3,1e-4))}function f(t){$("#"+A.infoTableDivId).empty(),$.each(t,function(t,e){var i="High score group"===e.groupName||"Altered group"===e.groupName?"#FF6252":"#00AC52",n=$("#exclusivity_survival div").width();$("#"+A.infoTableDivId).append('<tr><td style="width: '+n+'px; text-align:right;"></td><td style="width: '+n+'px; text-align:center;"><b style="color : '+i+';">'+e.groupName+'</b></td></tr><tr><td style="width: '+n+'px; text-align:right;">'+C.infoTableTitles.total_cases+'</td><td style="width: '+n+'px; text-align:center;"><b>'+e.num_cases+'</b></td></tr><tr><td style="width: '+n+'px; text-align:right;">'+C.infoTableTitles.num_of_events_cases+'</td><td style="width: '+n+'px; text-align:center;"><b>'+e.num_of_events_cases+'</b></td></tr><tr><td style="width: '+n+'px; text-align:right;">'+C.infoTableTitles.median+'</td><td style="width: '+n+'px; text-align:center;"><b>'+e.median+"</b></td></tr>")})}function g(t){$("#"+A.headerDivId).append("<button id='"+A.curveDivId+"_svg_download' style='font-size:12px;'>SVG</button>"),$("#"+A.headerDivId).append("<button id='"+A.curveDivId+"_pdf_download' style='font-size:12px;'>PDF</button>"),$("#"+A.headerDivId).append("<button id='"+A.curveDivId+"_data_download' style='font-size:12px;'>Data</button>"),$("#"+A.curveDivId+"_svg_download").click(function(){var t=new XMLSerializer,e=cbio.download.addSvgHeader(t.serializeToString($("#"+A.curveDivId+" svg")[0]));cbio.download.clientSideDownload([e],"survival_study.svg","application/svg+xml")}),$("#"+A.curveDivId+"_pdf_download").click(function(){var t={filename:"survival_study.pdf",contentType:"application/pdf",servletName:"svgtopdf.do"};cbio.download.initDownload($("#"+A.curveDivId+" svg")[0],t)}),$("#"+A.curveDivId+"_data_download").click(function(){var e="",i="",n=this.id;-1!==n.indexOf("os")?(e+="Overall Survival Kaplan-Meier Estimate\n",i="os_survival_data.txt"):-1!==n.indexOf("dfs")&&(e+="Disease Free Survival Kaplan-Meier Estimate\n",i="dfs_survival_data.txt"),_.each(t,function(t){var i="\n"+t.settings.legend+"\n";i+="Case ID\tNumber at Risk\tStatus\tSurvival Rate\tTime (months)\n",_.each(t.data.getData(),function(t){var e="";-1!==n.indexOf("os")?"0"==t.status?e="censored":"1"===t.status&&(e="deceased"):-1!==n.indexOf("dfs")&&("0"==t.status?e="censored":"1"==t.status&&(e="relapsed")),i+=t.case_id+"\t"+t.num_at_risk+"\t"+e+"\t"+t.survival_rate+"\t"+t.time+"\n"}),e+=i}),cbio.download.clientSideDownload([e],i)})}function h(t,e){var n=e.data,l=e.settings,u={};u.id=l.curveId,u.color=l.line_color,D[u.id]=u,b.dots[u.id]=b.svg.append("g").attr("id",u.id+"-dots"),i(),o(n.getData(),l,u.id),n.getData().shift(),s(n.getData(),l,u.id),a(u.id,n.getData(),l.mouseover_color),r(u.id),w.include_legend&&c(t)}function m(t){d3.selectAll("#"+t+"-dots").remove(),d3.selectAll("#"+t+"-line").remove(),d3.selectAll("#"+t+"-crossdots").remove(),delete D[t]}function v(t){if(t)for(var e in t)w[e]=t[e]}function x(t){w.include_pvalue&&!isNaN(t)?b.svg.select(".pval").empty()?d(t):p(t):b.svg.select(".pval").empty()||b.svg.select(".pval").remove()}function y(t){t.settings.curveId in D?console.log("%c Error: Curve ID exists","color:red"):h([t],t)}var b="",w="",C="",k="",A="",S="",D={},E={};return{init:function(i,n){b=n.elem,w=n.settings,C=n.text,k=n.style,A=n.divs,S=n.vals,E=n.qtipFunc;var o=!1;if($.each(i,function(t,e){if(0===e.data.getData().length)return o=!0,!1}),o)$("#"+A.infoTableDivId).empty(),$("#"+A.infoTableDivId).append("<span style='margin: 20px; color: grey;'>Survival data not available</span>");else{if(t(),e(i),l(b.xAxis,b.yAxis),u(C.xTitle,C.yTitle),$.each(i,function(t,e){h(i,e)}),g(i),n.settings.include_info_table){var a=[];$.each(i,function(t,e){var i=jQuery.extend(!0,{},e.data.getStats());i.groupName=e.settings.legend,a.push(i)}),f(a)}n.settings.include_pvalue&&d(S.pVal)}},updateView:function(t,e){e&&v(e.settings),t&&x(t.pval)},addCurve:y,removeCurve:m}},SurvivalCurveProxy=function(){function t(t){var e={};t.forEach(function(t){var i=Object.keys(t)[0];e[i]=t[i]}),t=e;var i=0;for(var n in t)if(t.hasOwnProperty(n)&&""!==t[n]&&-1!==u.indexOf(n)){var r=jQuery.extend(!0,{},o);r.case_id=t[n].case_id,r.time=t[n].months,r.status=t[n].status,"NA"!==r.time&&"NA"!==r.status&&void 0!==r.status&&void 0!==r.status&&(a.push(r),i+=1)}cbio.util.sortByAttribute(a,"time");for(var l in a)a[l].num_at_risk=i,i+=-1}function e(){s.calc(a);var t=jQuery.extend(!0,{},r);0!==a.length?t.num_cases=a.length:t.num_cases="NA",t.num_of_events_cases=i(a),t.median=n(a),l=t}function i(t){if(0!==t.length){var e=0;for(var i in t)"1"==t[i].status&&(e+=1);return e}return"NA"}function n(t){var e=0;if(0!==t.length){var i=0;for(var n in t)if(t[n].survival_rate<=.5){i=n,e=parseFloat(t[i].time);break}return 0==e?"NA":e}return"NA"}var o={case_id:"",time:"",status:"",num_at_risk:-1,survival_rate:0},a=[],r={pVal:0,num_cases:0,num_of_events_cases:0,median:0},l={},s="",c="",u=[];return{init:function(i,n,o,r){u=n,s=o,c=r,t(i),0===a.length||0!==a.length&&e()},getData:function(){return a},getStats:function(){return l}}},SurvivalCurveView=function(t){var e=t,i="",n="",o="",a=[],r=[],l=[],s=function(t){e.vals.pVal=t,(i=new SurvivalCurve).init(l,e)};return{getResultInit:function(t,e){n=new KmEstimator,o=new LogRankTest;for(var i in t)"altered"===t[i]?a.push(i):"unaltered"===t[i]&&r.push(i);var c=new SurvivalCurveProxy,u=new SurvivalCurveProxy;c.init(e,a,n,o),u.init(e,r,n,o);var d=jQuery.extend(!0,{},SurvivalCurveBroilerPlate.subGroupSettings);d.line_color="#00AC52",d.mouseover_color="#00AC52",d.legend=SurvivalCurveBroilerPlate.subGroupSettings.legend.low;var p=jQuery.extend(!0,{},SurvivalCurveBroilerPlate.subGroupSettings);p.line_color="#FF6252",p.mouseover_color="#FF6252",p.legend=SurvivalCurveBroilerPlate.subGroupSettings.legend.high;var f={},g={};f.data=c,f.settings=p,g.data=u,g.settings=d,l=[f,g],o.calc(l[0].data.getData(),l[1].data.getData(),s)},pValCallBackFunc:s}},SurvivalTab=function(){return{init:function(t,e){var i=jQuery.extend(!0,{},SurvivalCurveBroilerPlate),n=jQuery.extend(!0,{},SurvivalCurveBroilerPlate);i.text.xTitle="Months Survival",i.text.yTitle="Surviving",i.text.qTips.estimation="Survival estimate",i.text.qTips.censoredEvent="Time of last observation",i.text.qTips.failureEvent="Time of death",i.text.qTips.id="Patient ID",i.settings.include_info_table=!0,i.divs.curveDivId="os_survival_curve",i.divs.headerDivId="os_header",i.divs.infoTableDivId="os_stat_table",i.text.infoTableTitles.total_cases="#total cases",i.text.infoTableTitles.num_of_events_cases="#cases deceased",i.text.infoTableTitles.median="median months survival",i.qtipFunc=cbio.util.getLinkToPatientView,n.text.xTitle="Months Disease Free",n.text.yTitle="Disease Free",n.text.qTips.estimation="Disease free estimate",n.text.qTips.censoredEvent="Time of last observation",n.text.qTips.failureEvent="Time of relapse",n.text.qTips.id="Patient ID",n.settings.include_info_table=!0,n.divs.curveDivId="dfs_survival_curve",n.divs.headerDivId="dfs_header",n.divs.infoTableDivId="dfs_stat_table",n.text.infoTableTitles.total_cases="#total cases",n.text.infoTableTitles.num_of_events_cases="#cases relapsed",n.text.infoTableTitles.median="median months disease free",n.qtipFunc=cbio.util.getLinkToPatientView,new SurvivalCurveView(i).getResultInit(t,e.os),new SurvivalCurveView(n).getResultInit(t,e.dfs)}}}();