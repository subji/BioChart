"use strict";var axis=function(t){function e(){render.context(c.ctx).line({left:this.position[0],top:this.position[1],edge:["vertical"===this.direction?this.position[0]:this.position[0]+this.position[2],"vertical"===this.direction?this.position[1]+this.position[2]:this.position[1]]})}function n(t){for(var e=0;e<this.len;e++)t.call(this,this.toDomain[e])}function i(){var t=render.context(c.ctx),e="bottom"===this.location||"right"===this.location?1:-1;this.tickSize=this.tickSize*e,n.call(this,function(e){t.line({top:"vertical"===this.direction?this.scale(e):this.position[1],left:"vertical"===this.direction?this.position[0]:this.scale(e),edge:["vertical"===this.direction?this.position[0]+this.tickSize:this.scale(e),"vertical"===this.direction?this.scale(e):this.position[1]+this.tickSize]})})}function o(t){var e={top:0,left:0},n=scale.getDistance(this.scale,this.toDomain),i=draw.getTextWidth(this.font||"5px",t);switch(this.location){case"top":e.top=this.position[1]-(this.tickSize+2),e.left=this.scale(t)-i/2;break;case"left":e.top=this.scale(t)+n/2,e.left=this.position[0]-(i+this.tickSize+2);break;case"bottom":e.top=this.position[1]+(this.tickSize+2),e.left=this.scale(t)-i/2;break;case"right":e.top=this.scale(t)+n/2,e.left=this.position[0]+(this.tickSize+2)}return e}function a(){console.log(this,this.toDomain);for(var t=render.context(c.ctx),e=0,n=this.toDomain.length;e<n;e++){var i=this.toDomain[e],a=o.call(this,i);a.text=i,a.textBaseline="middle",t.text(a)}}function r(t){t.base&&e.call(t,null),t.ticks&&i.call(t,null),t.text&&a.call(t,null)}var c={};return t.context=function(e){return c.ctx=e,arguments.length?t:c.ctx},t.horizontal=function(e){return e.direction="horizontal",e.toDomain=scale.getDomain(),e.len=scale.getDomainLength(),e.base=void 0===e.base||e.base,e.ticks=void 0===e.ticks||e.ticks,e.tickSize=void 0===e.tickSize?10:e.tickSize,r(e),t},t.vertical=function(e){return e.direction="vertical",e.toDomain=scale.getDomain(),e.len=scale.getDomainLength(),e.base=void 0===e.base||e.base,e.ticks=void 0===e.ticks||e.ticks,e.tickSize=void 0===e.tickSize?5:e.tickSize,r(e),t},t}(axis||{}),config={};config.mutualExName=function(t){return{A:"Amplification",B:"Amplification & Mutation",D:"Deletion",E:"Deletion & Mutation",M:"Mutation",".":"None"}[t]},config.mutualExPriority=function(t){return{A:1,B:0,D:3,E:2,M:4,".":5}[t]},config.mutualExColor=function(t){return{A:{bg:"#D3D3D3",ins:"#FFBDE0"},B:{bg:"#FFBDE0",ins:"#5CB755"},D:{bg:"#D3D3D3",ins:"#BDE0FF"},E:{bg:"#BDE0FF",ins:"#5CB755"},M:{bg:"#D3D3D3",ins:"#5CB755"},".":{bg:"#D3D3D3",ins:"#D3D3D3"}}[t]},config.mutualExShapes=function(t){var e=scale.compatibleBand(t.scaleX),n=scale.compatibleBand(t.scaleY),i="M"===t.value||"B"===t.value||"E"===t.value?n/3:0,o="M"===t.value||"B"===t.value||"E"===t.value?i:n;t.isLegend;return render.rect({top:t.scaleY(t.y)+1,left:t.scaleX(t.x)+.25,width:t.isLegend?t.isLegend:e+.5,height:n-2,fillStyle:config.mutualExColor(t.value).bg}).rect({top:t.scaleY(t.y)+i+1,left:t.scaleX(t.x)+.25,width:t.isLegend?t.isLegend:e+.5,height:o-2,fillStyle:config.mutualExColor(t.value).ins})},config.variantColor=function(){},config.groupColor=function(){};var draw=function(t){return t.ctx=null,t.getTextWidth=function(t,e){var n=document.createElement("canvas"),i=n.getContext("2d"),o=0;return n.id="get-text-width",i.font=t,document.body.appendChild(n),o=i.measureText(e).width,document.body.removeChild(document.getElementById("get-text-width")),o},t.randomDraw=function(t,e){return Math.floor(Math.random()*t)+(e||0)},t.getDegree=function(t,e,n,i){var o=n-t,a=i-e,r=Math.atan2(o,a);return{radian:r,degree:Math.floor(180*r/Math.PI)}},t.noOverlap=function(e,n,i){for(var o=n.filter(function(t){return"node"===t.type}),a=n.filter(function(t){return"edge"===t.type}),r=0,c=o.length;r<c;r++){var l=o[r];l.textWidth=t.getTextWidth(e,"14px Calibri",l.text),l.width=l.width||1.2*l.textWidth,l.height=l.height||24,l.radius=5,i&&(l.top=i.members.indexOf(l.text)>-1?t.randomDraw(i.top+l.height/2,.7*i.height-l.height/2):(i.top-0)/2-l.height/2,l.left=t.randomDraw(i.left+i.width-i.left-l.width,i.left)),a.forEach(function(t){t.source=t.source.substring(0,l.text.length)===l.text?l.text:t.source,t.target=t.target.substring(0,l.text.length)===l.text?l.text:t.target,t.id=t.id.substring(0,t.source.length+t.target.length)})}return n},t}(draw||{}),eventHandler=function(t){function e(t){function e(e){t({x:e.pageX-n.ctx.canvas.offsetLeft,y:e.pageY-n.ctx.canvas.offsetTop})}if(!n.ctx)throw new Error("Not found context of canvas.");n.ctx.canvas.removeEventListener("mousemove",e),n.ctx.canvas.addEventListener("mousemove",e)}var n={};return t.context=function(e){return n.ctx=e,arguments.length?t:n.ctx},t.data=function(e){return n.data=e,arguments.length?t:n.data},t.hover=function(t){e(function(t){})},t}(eventHandler||{}),exclusive=function(){function t(t,e){for(var n in e){var i=document.createElement("div");i.id=n,i.style.width=e[n].w+"px",i.style.height=e[n].h+"px",t.appendChild(i)}}function e(t,e){function n(t){return"rgb("+t.split(" ").join(",")+")"}var i=/id:\w+/gi,o=[];return e.split("\n").splice(1).filter(function(e,a){var r={};"id:"===e.match(i)[0].replace(t,"")&&(e.split("\t").filter(function(t){r[t.split(":")[0]]=t.split(":")[0].indexOf("color")>-1?n(t.split(":")[1]):t.split(":")[1]}),o.push(r))}),o}function n(t,e){var n=t.replace(/\s/g,""),i=t.split(" "),o=[];e.split("\n\n").filter(function(t,e){if(""!==t){var i=/[\[][\w(\s|,)]+[\]]/g.exec(t.split("\n"))[0].replace(/\[|\]|\s/g,"");if(n.indexOf(i)>-1)return t}})[0].split("\n").filter(function(t,e){if(e>0){var n=0,a=0,r="";i.forEach(function(e){t.indexOf(e)>-1&&(n=t.indexOf(e),a=e.length)}),r=t.substring(n,n+a),t.substring(0,n-2).split("").forEach(function(t,e){o.push({x:e,y:r,value:t})})}});return o}function i(t){for(var e={},n=0,i=t.length;n<i;n++)e[t[n].y]=1;return{x:[0,t.length/Object.keys(e).length],y:Object.keys(e)}}return function(o){var a=o.element||null,r=document.querySelector(a),c=parseFloat(o.width||r.style.width||800),l=parseFloat(o.height||r.style.height||400);t(r,size.chart.mutualExt(r,c,l));var s="MAPK1 BRAF KRAS NF1 EGFR HGF",h=new RegExp(s.replace(/\s/g,"|"),"ig"),d=n(s,o.heatmap.data);network({data:e(h,o.network.data),element:"#network"}),heatmap({data:d,margin:size.setMargin(o.heatmap.margin),element:"#heatmap",axis:{x:{location:"bottom",scale:"ordinal",data:i(d).x,ticks:!1,base:!1,text:!1},y:{location:"left",scale:"ordinal",data:i(d).y,ticks:!1,base:!1}},rect:function(t){return config.mutualExShapes(t)}}),survival({element:"#survival"});var u=[];d.map(function(t){u.indexOf(t.value)<0&&u.push(t.value)}),legend({element:"#legend",margin:[20,20,20,20],data:u,direction:"horizontal",font:"11px Calibri",shapes:config.mutualExShapes,colors:config.mutualExColor})}}(),force=function(t){return t.setConstant=function(e){return t.constant=e||50,model},t.getConstant=function(){return t.constant||50},t.getKvalue=function(e,n){var i=t.getConstant();return Math.sqrt(e*n)/i},t.aForce=function(t,e){return e*e/t},t.rForce=function(t,e){return t*t/e},t}(force||{}),heatmap=function(t){function e(t,e,n,i){switch(t){case"top":return[i.left,i.top,e-i.right];case"left":return[i.left,i.top,n-i.bottom];case"bottom":return[i.left,n-i.bottom,e-i.right];case"right":return[e-i.right,i.top,n-i.bottom];default:throw new Error("Not defined location information.")}}return function(t){console.log(t);var n=document.querySelector(t.element),i=parseFloat(t.width||n.style.width||588),o=parseFloat(t.height||n.style.height||300),a=t.margin||{top:0,left:0,bottom:0,right:0},r=render.createCanvas(n.id,i,o),c=r.getContext("2d"),l=(render.context(c),t.axis.x),s=t.axis.y,h=l.location||"bottom",d=s.location||"left",u=l.range||"normal",f=s.range||"normal",g=scale[l.scale](l.data,"riverse"===u?[i-a.right,a.left]:[a.left,i-a.right]),p=scale[s.scale](s.data,"riverse"===f?[o-a.bottom,a.top]:[a.top,o-a.bottom]);n.appendChild(r),axis.context(c).horizontal({scale:g,location:h,position:e(h,i,o,a),ticks:void 0===l.ticks||l.ticks,base:void 0===l.base||l.base,text:void 0===l.text||l.text}).vertical({scale:p,location:d,position:e(h,i,o,a),ticks:void 0===s.ticks||s.ticks,base:void 0===s.base||s.base,text:void 0===s.text||s.text});for(var x=0,m=t.data.length;x<m;x++)t.data[x].scaleX=g,t.data[x].scaleY=p,t.rect(t.data[x])}}(),legend=function(t){return function(t){var e=document.querySelector(t.element),n=parseFloat(t.width||e.style.width||588),i=parseFloat(t.height||e.style.height||60),o=size.setMargin(t.margin),a=render.createCanvas(e.id,n,i),r=a.getContext("2d"),c=render.context(r),l=[];t.data.map(function(t){return l[config.mutualExPriority(t)]=t}),l=l.filter(function(t){return t});for(var s=scale.ordinal(l,"horizontal"===t.direction?[o.left,n-o.right]:[o.top,i-o.bottom]),h=scale.ordinal(["legendY"],"horizontal"===t.direction?[o.top,i-o.bottom]:[o.left,n-o.right]),d=0,u=l.length;d<u;d++){var f=l[d],g={};g.value=f,g.x=f,g.y="legendY",g.scaleX=s,g.scaleY=h,g.isLegend=10,t.shapes(g),c.text({top:h(g.y)+scale.compatibleBand(h)/2,left:s(g.x)+g.isLegend+5,text:config.mutualExName(f),textBaseline:"middle",font:t.font})}e.appendChild(a)}}();!function(t){t.bio={draw:draw,render:render,variants:variants,pathways:"",expression:"",landscape:"",exclusive:exclusive,chart:{legend:legend,needle:"",graph:"",procbar:"",title:"",network:network,heatmap:heatmap,survival:survival},size:size,scale:scale,eventHandler:eventHandler}}(window||{});var network=function(){return function(t){var e=[],n={},i="";t.data.map(function(t){if("compound"===t.type)i=t.members,e.push({group:"nodes",data:{id:"n0",bgcolor:t.bgcolor,bdcolor:t.bordercolor||"rgb(0, 0, 0)",width:100,height:100,isComp:!0,per:t.text},position:{}});else if("node"===t.type){var o={data:{id:i.indexOf(t.text)>-1?"n0:"+t.text:t.text,name:t.text,bgcolor:t.bgcolor,bdcolor:t.bordercolor||"rgb(0, 0, 0)",width:draw.getTextWidth("14px Calibri",t.text),height:15,isComp:!1},group:"nodes"};n[t.text]={parent:i.indexOf(t.text)>-1?"n0:":""},i.indexOf(t.text)>-1&&(o.data.parent="n0"),e.push(o)}else if("edge"===t.type){var a="",r="",c="";for(var l in n)t.source.substring(0,l.length)===l&&(a=n[l].parent+l,c=t.source.substring(l.length,t.source.length),r=n[t.target.substring(0,t.target.indexOf(c))].parent+t.target.substring(0,t.target.indexOf(c)));e.push({data:{id:a+r,source:a,target:r,color:t.linecolor},group:"edges"})}});cytoscape({container:document.querySelector(t.element),boxSelectionEnabled:!1,autoungrabify:!0,autounselectify:!0,fit:!0,padding:10,pixelRatio:"auto",elements:e,style:cytoscape.stylesheet().selector("node").css({shape:"rectangle",width:"data(width)",height:"data(height)","font-size":"10",content:"data(name)","text-valign":"center","background-color":"data(bgcolor)","border-color":"data(bdcolor)","border-width":"1"}).selector(":parent").css({"background-color":"rgba(255, 255, 255, 0.5)","border-color":"rgb(150, 0, 0)","border-width":"1",content:"data(per)","font-size":"12","text-valign":"top"}).selector("edge").css({"curve-style":"bezier","target-arrow-shape":"triangle","target-arrow-color":"data(color)","arrow-scale":"1","line-color":"data(color)"}),layout:{name:"cose-bilkent",animate:!1}})}}(),render=function(t){function e(t){t.fillStyle="#000000",t.strokeStyle="#000000",t.shadowColor="#000000",t.shadowBlur="0",t.shadowOffsetX="0",t.shadowOffsetY="0"}function n(t,n){e(t);for(var i in n)if(t[i])switch(t[i]=n[i],i){case"fillStyle":t.fill();break;case"strokeStyle":t.stroke();break;case"dashed":t.setLineDash([3,10])}}return t.ctx=null,t.text=function(e){return t.ctx.beginPath(),n(t.ctx,e),t.ctx.font=e.font||"10px",t.ctx.fillText(e.text,e.left,e.top),t.ctx.closePath(),t},t.line=function(e){return t.ctx.beginPath(),t.ctx.moveTo(e.left,e.top),2===e.edge.length&&"object"!=typeof e.edge[0]?function(){t.ctx.lineTo(e.edge[0],e.edge[1])}():function(){for(var n=0,i=e.edge.length;n<i;n++)t.ctx.lineTo(e.edge[n][0],e.edge[n][1])}(),n(t.ctx,e),t.ctx.stroke(),t.ctx.closePath(),t},t.rect=function(e){return t.ctx.beginPath(),t.ctx.rect(e.left,e.top,e.width,e.height),n(t.ctx,e),t.ctx.closePath(),t},t.rounded=function(e){return t.ctx.beginPath(),t.ctx.moveTo(e.left+e.radius,e.top),t.ctx.lineTo(e.left+e.width-e.radius,e.top),t.ctx.arcTo(e.left+e.width,e.top,e.left+e.width,e.top+e.radius,e.radius),t.ctx.lineTo(e.left+e.width,e.top+e.height-e.radius),t.ctx.arcTo(e.left+e.width,e.top+e.height,e.left+e.width-e.radius,e.top+e.height,e.radius),t.ctx.lineTo(e.left+e.radius,e.top+e.height),t.ctx.arcTo(e.left,e.top+e.height,e.left,e.top+e.height-e.radius,e.radius),t.ctx.lineTo(e.left,e.top+e.radius),t.ctx.arcTo(e.left,e.top,e.left+e.radius,e.top,e.radius),n(t.ctx,e),t.ctx.closePath(),t},t.arrow=function(e){var i=Math.atan2(e.height-e.top,e.width-e.left);return t.ctx.beginPath(),t.ctx.moveTo(e.left,e.top),t.ctx.lineTo(e.width,e.height),t.ctx.lineTo(e.width-e.headLen*Math.cos(i-Math.PI/6),e.height-e.headLen*Math.sin(i-Math.PI/6)),t.ctx.moveTo(e.width,e.height),t.ctx.lineTo(e.width-e.headLen*Math.cos(i+Math.PI/6),e.height-e.headLen*Math.sin(i+Math.PI/6)),n(t.ctx,e),t.ctx.closePath(),t},t.getRatio=function(){var t=document.createElement("canvas").getContext("2d");return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)},t.context=function(e){return t.ctx=e,t},t.createCanvas=function(e,n,i,o){o=o||t.getRatio();var a=document.createElement("canvas");return a.id=e,a.width=n*o,a.height=i*o,a.style.width=n+"px",a.style.height=i+"px",a.getContext("2d").setTransform(o,0,0,o,0,0),a},t}(render||{}),scale=function(t){function e(t,e){var i=[];if("number"==typeof e[0]&&"number"==typeof e[0]){for(var o=Math.max(e[0],e[1]),a=Math.min(e[0],e[1]),r=o-a,c=a;c<r;c++)i.push(c);return n.data.push(i),n.len.push(r),"ordinal"===t?i:[a,o]}return n.data.push(e),n.len.push(e.length),e}var n={data:[],len:[]};return t.ordinal=function(t,n){return d3.scaleBand?d3.scaleBand().domain(e("ordinal",t)).range(n):d3.scale.ordinal().domain(e("ordinal",t)).rangeBands(n)},t.linear=function(t,n){return d3.scaleLinear?d3.scaleLinear().domain(e("linear",t)).range(n):d3.scale.linear().domain(e("linear",t)).range(n)},t.compatibleBand=function(t){return t.bandwidth?t.bandwidth():t.rangeBand()},t.getDomain=function(){return n.data.shift()},t.getDomainLength=function(){return n.len.shift()},t.getDistance=function(t,e){return e.length<2?t(e[0]):t(e[1])-t(e[0])},t.date=function(){console.log("Date")},t}(scale||{}),size={};size.setMargin=function(t){if("number"==typeof t)return{top:t,left:t,bottom:t,right:t};switch(t.length){case 1:return{top:t[0],left:t[0],bottom:t[0],right:t[0]};case 2:return{top:t[0],left:t[1],bottom:t[0],right:t[1]};case 3:return{top:t[0],left:t[1],bottom:t[2],right:t[1]};case 4:default:return{top:t[0],left:t[1],bottom:t[2],right:t[3]}}},size.chart={},size.chart.mutualExt=function(t,e,n){return t.style.width=e+"px",t.style.height=n+"px",{survival:{w:.3*e,h:n},selectBox:{w:.7*e,h:.05*n},separateBar:{w:.7*e,h:.05*n},group:{w:.7*e,h:.3*n},network:{w:.7*e*.3,h:.6*n},heatmap:{w:.7*e*.7,h:.5*n},legend:{w:.7*e*.7,h:.1*n}}};var survival=function(t){return function(t){var e=t.element||null,n=document.querySelector(e),i=parseFloat(t.width||n.style.width||360),o=parseFloat(t.height||n.style.height||600),a=render.createCanvas(e.substring(1,e.length),i,o),r=a.getContext("2d");n.appendChild(a),eventHandler.context(r).hover(function(t){console.log(t)})}}(),variants=function(){return function(t){var e=t.element||null,n=document.querySelector(e),i=t.width||n.style.width||1200,o=t.height||n.style.height||600;console.log("Variants","\nElement: ",e,"\nWidth: ",i,"\nHeight: ",o)}}();