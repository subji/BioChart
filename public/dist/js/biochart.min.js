"use strict";var axis=function(t){function e(){render.context(c.ctx).line({left:this.position[0],top:this.position[1],edge:["vertical"===this.direction?this.position[0]:this.position[0]+this.position[2],"vertical"===this.direction?this.position[1]+this.position[2]:this.position[1]]})}function n(t){for(var e=0;e<this.len;e++)t.call(this,this.toDomain[e])}function i(){var t=render.context(c.ctx),e="bottom"===this.location||"right"===this.location?1:-1;this.tickSize=this.tickSize*e,n.call(this,function(e){t.line({top:"vertical"===this.direction?this.scale(e):this.position[1],left:"vertical"===this.direction?this.position[0]:this.scale(e),edge:["vertical"===this.direction?this.position[0]+this.tickSize:this.scale(e),"vertical"===this.direction?this.scale(e):this.position[1]+this.tickSize]})})}function o(t){var e={top:0,left:0},n=scale.getDistance(this.scale,this.toDomain),i=draw.getTextWidth(this.font||"5px",t);switch(this.location){case"top":e.top=this.position[1]-(this.tickSize+2),e.left=this.scale(t)-i/2;break;case"left":e.top=this.scale(t)+n/2,e.left=this.position[0]-(i+this.tickSize+2);break;case"bottom":e.top=this.position[1]+(this.tickSize+2),e.left=this.scale(t)-i/2;break;case"right":e.top=this.scale(t)+n/2,e.left=this.position[0]+(this.tickSize+2)}return e}function a(){for(var t=render.context(c.ctx),e=0,n=this.toDomain.length;e<n;e++){var i=this.toDomain[e],a=o.call(this,i);a.text=i,a.textBaseline="middle",t.text(a)}}function r(t){t.base&&e.call(t,null),t.ticks&&i.call(t,null),t.text&&a.call(t,null)}var c={};return t.context=function(e){return c.ctx=e,arguments.length?t:c.ctx},t.horizontal=function(e){return e.direction="horizontal",e.toDomain=scale.getDomain(),e.len=scale.getDomainLength(),e.base=void 0===e.base||e.base,e.ticks=void 0===e.ticks||e.ticks,e.tickSize=void 0===e.tickSize?10:e.tickSize,r(e),t},t.vertical=function(e){return e.direction="vertical",e.toDomain=scale.getDomain(),e.len=scale.getDomainLength(),e.base=void 0===e.base||e.base,e.ticks=void 0===e.ticks||e.ticks,e.tickSize=void 0===e.tickSize?5:e.tickSize,r(e),t},t}(axis||{}),config={};config.mutualExName=function(t){return{A:"Amplification",B:"Amplification & Mutation",D:"Deletion",E:"Deletion & Mutation",M:"Mutation",".":"None"}[t]},config.mutualExPriority=function(t){return{A:1,B:0,D:3,E:2,M:4,".":5}[t]},config.mutualExColor=function(t){return{A:{bg:"#D3D3D3",ins:"#FFBDE0"},B:{bg:"#FFBDE0",ins:"#5CB755"},D:{bg:"#D3D3D3",ins:"#BDE0FF"},E:{bg:"#BDE0FF",ins:"#5CB755"},M:{bg:"#D3D3D3",ins:"#5CB755"},".":{bg:"#D3D3D3",ins:"#D3D3D3"}}[t]},config.mutualExShapes=function(t){var e=scale.compatibleBand(t.scaleX),n=scale.compatibleBand(t.scaleY),i="M"===t.value||"B"===t.value||"E"===t.value?n/3:0,o="M"===t.value||"B"===t.value||"E"===t.value?i:n;t.isLegend;return render.rect({top:t.scaleY(t.y)+1,left:t.scaleX(t.x)+.25,width:t.isLegend?t.isLegend:e+.5,height:n-2,fillStyle:config.mutualExColor(t.value).bg}).rect({top:t.scaleY(t.y)+i+1,left:t.scaleX(t.x)+.25,width:t.isLegend?t.isLegend:e+.5,height:o-2,fillStyle:config.mutualExColor(t.value).ins})},config.variantColor=function(){},config.groupColor=function(){};var draw=function(t){return t.ctx=null,t.getTextWidth=function(t,e){var n=document.createElement("canvas"),i=n.getContext("2d"),o=0;return n.id="get-text-width",i.font=t,document.body.appendChild(n),o=i.measureText(e).width,document.body.removeChild(document.getElementById("get-text-width")),o},t.randomDraw=function(t,e){return Math.floor(Math.random()*t)+(e||0)},t.getDegree=function(t,e,n,i){var o=n-t,a=i-e,r=Math.atan2(o,a);return{radian:r,degree:Math.floor(180*r/Math.PI)}},t.noOverlap=function(e,n,i){for(var o=n.filter(function(t){return"node"===t.type}),a=n.filter(function(t){return"edge"===t.type}),r=0,c=o.length;r<c;r++){var l=o[r];l.textWidth=t.getTextWidth(e,"14px Calibri",l.text),l.width=l.width||1.2*l.textWidth,l.height=l.height||24,l.radius=5,i&&(l.top=i.members.indexOf(l.text)>-1?t.randomDraw(i.top+l.height/2,.7*i.height-l.height/2):(i.top-0)/2-l.height/2,l.left=t.randomDraw(i.left+i.width-i.left-l.width,i.left)),a.forEach(function(t){t.source=t.source.substring(0,l.text.length)===l.text?l.text:t.source,t.target=t.target.substring(0,l.text.length)===l.text?l.text:t.target,t.id=t.id.substring(0,t.source.length+t.target.length)})}return n},t}(draw||{}),eventHandler=function(t){function e(t){function e(e){t({x:e.pageX-n.ctx.canvas.offsetLeft,y:e.pageY-n.ctx.canvas.offsetTop})}if(!n.ctx)throw new Error("Not found context of canvas.");n.ctx.canvas.removeEventListener("mousemove",e),n.ctx.canvas.addEventListener("mousemove",e)}var n={};return t.context=function(e){return n.ctx=e,arguments.length?t:n.ctx},t.data=function(e){return n.data=e,arguments.length?t:n.data},t.hover=function(t){e(function(t){})},t}(eventHandler||{}),exclusive=function(){function t(t,e){for(var n in e){var i=document.createElement("div");i.id=n,i.style.width=e[n].w+"px",i.style.height=e[n].h+"px",t.appendChild(i)}}return function(e){var n=e.element||null,i=document.querySelector(n),o=parseFloat(e.width||i.style.width||800),a=parseFloat(e.height||i.style.height||400);t(i,size.chart.mutualExt(i,o,a)),network({data:e.network.data,element:"#network"}),heatmap({data:e.heatmap.data,margin:size.setMargin(e.heatmap.margin),element:"#heatmap",axis:{x:{location:"bottom",scale:"ordinal",data:e.heatmap.xaxis,ticks:!1,base:!1,text:!1},y:{location:"left",scale:"ordinal",data:e.heatmap.yaxis,ticks:!1,base:!1}},rect:function(t){return config.mutualExShapes(t)}}),survival({element:"#survival"}),legend({element:"#legend",margin:e.legend.margin,data:e.legend.data,direction:"horizontal",font:"11px Calibri",shapes:config.mutualExShapes,colors:config.mutualExColor}),selectBox.element("#selectBox").data(sample.split(" ")).make()}}(),force=function(t){return t.setConstant=function(e){return t.constant=e||50,model},t.getConstant=function(){return t.constant||50},t.getKvalue=function(e,n){var i=t.getConstant();return Math.sqrt(e*n)/i},t.aForce=function(t,e){return e*e/t},t.rForce=function(t,e){return t*t/e},t}(force||{}),heatmap=function(t){function e(t,e,n,i){switch(t){case"top":return[i.left,i.top,e-i.right];case"left":return[i.left,i.top,n-i.bottom];case"bottom":return[i.left,n-i.bottom,e-i.right];case"right":return[e-i.right,i.top,n-i.bottom];default:throw new Error("Not defined location information.")}}return function(t){console.log(t);var n=document.querySelector(t.element),i=parseFloat(t.width||n.style.width||588),o=parseFloat(t.height||n.style.height||300),a=t.margin||{top:0,left:0,bottom:0,right:0},r=render.createCanvas(n.id,i,o),c=r.canvas,l=r.ctx,s=(render.context(l),t.axis.x),d=t.axis.y,h=s.location||"bottom",u=d.location||"left",g=s.range||"normal",f=d.range||"normal",x=scale[s.scale](s.data,"riverse"===g?[i-a.right,a.left]:[a.left,i-a.right]),p=scale[d.scale](d.data,"riverse"===f?[o-a.bottom,a.top]:[a.top,o-a.bottom]);n.appendChild(c),axis.context(l).horizontal({scale:x,location:h,position:e(h,i,o,a),ticks:void 0===s.ticks||s.ticks,base:void 0===s.base||s.base,text:void 0===s.text||s.text}).vertical({scale:p,location:u,position:e(h,i,o,a),ticks:void 0===d.ticks||d.ticks,base:void 0===d.base||d.base,text:void 0===d.text||d.text});for(var m=0,v=t.data.length;m<v;m++)t.data[m].scaleX=x,t.data[m].scaleY=p,t.rect(t.data[m])}}(),legend=function(t){return function(t){var e=document.querySelector(t.element),n=parseFloat(t.width||e.style.width||588),i=parseFloat(t.height||e.style.height||60),o=size.setMargin(t.margin),a=render.createCanvas(e.id,n,i),r=a.canvas,c=a.ctx,l=render.context(c),s=[];t.data.map(function(t){return s[config.mutualExPriority(t)]=t}),s=s.filter(function(t){return t});for(var d=scale.ordinal(s,"horizontal"===t.direction?[o.left,n-o.right]:[o.top,i-o.bottom]),h=scale.ordinal(["legendY"],"horizontal"===t.direction?[o.top,i-o.bottom]:[o.left,n-o.right]),u=0,g=s.length;u<g;u++){var f=s[u],x={};x.value=f,x.x=f,x.y="legendY",x.scaleX=d,x.scaleY=h,x.isLegend=10,t.shapes(x),l.text({top:h(x.y)+scale.compatibleBand(h)/2,left:d(x.x)+x.isLegend+5,text:config.mutualExName(f),textBaseline:"middle",font:t.font})}e.appendChild(r)}}();!function(t){t.bio={draw:draw,render:render,variants:variants,pathways:"",expression:"",landscape:"",exclusive:exclusive,chart:{legend:legend,needle:"",graph:"",procbar:"",title:"",network:network,heatmap:heatmap,survival:survival},tools:{selectBox:selectBox},size:size,scale:scale,eventHandler:eventHandler}}(window||{});var network=function(){return function(t){var e=[],n={},i="";t.data.map(function(t){if("compound"===t.type)i=t.members,e.push({group:"nodes",data:{id:"n0",bgcolor:t.bgcolor,bdcolor:t.bordercolor||"rgb(0, 0, 0)",width:100,height:100,isComp:!0,per:t.text},position:{}});else if("node"===t.type){var o={data:{id:i.indexOf(t.text)>-1?"n0:"+t.text:t.text,name:t.text,bgcolor:t.bgcolor,bdcolor:t.bordercolor||"rgb(0, 0, 0)",width:draw.getTextWidth("14px Calibri",t.text),height:15,isComp:!1},group:"nodes"};n[t.text]={parent:i.indexOf(t.text)>-1?"n0:":""},i.indexOf(t.text)>-1&&(o.data.parent="n0"),e.push(o)}else if("edge"===t.type){var a="",r="",c="";for(var l in n)t.source.substring(0,l.length)===l&&(a=n[l].parent+l,c=t.source.substring(l.length,t.source.length),r=n[t.target.substring(0,t.target.indexOf(c))].parent+t.target.substring(0,t.target.indexOf(c)));e.push({data:{id:a+r,source:a,target:r,color:t.linecolor},group:"edges"})}});cytoscape({container:document.querySelector(t.element),boxSelectionEnabled:!1,autoungrabify:!0,autounselectify:!0,fit:!0,padding:10,pixelRatio:"auto",elements:e,style:cytoscape.stylesheet().selector("node").css({shape:"rectangle",width:"data(width)",height:"data(height)","font-size":"10",content:"data(name)","text-valign":"center","background-color":"data(bgcolor)","border-color":"data(bdcolor)","border-width":"1"}).selector(":parent").css({"background-color":"rgba(255, 255, 255, 0.5)","border-color":"rgb(150, 0, 0)","border-width":"1",content:"data(per)","font-size":"12","text-valign":"top"}).selector("edge").css({"curve-style":"bezier","target-arrow-shape":"triangle","target-arrow-color":"data(color)","arrow-scale":"1","line-color":"data(color)"}),layout:{name:"cose-bilkent",animate:!1}})}}(),render=function(t){function e(t){t.fillStyle="#000000",t.strokeStyle="#000000",t.shadowColor="#000000",t.shadowBlur="0",t.shadowOffsetX="0",t.shadowOffsetY="0"}function n(t,n){e(t);for(var i in n)if(t[i])switch(t[i]=n[i],i){case"fillStyle":t.fill();break;case"strokeStyle":t.stroke();break;case"dashed":t.setLineDash([3,10])}}return t.ctx=null,t.text=function(e){return t.ctx.beginPath(),n(t.ctx,e),t.ctx.font=e.font||"10px",t.ctx.fillText(e.text,e.left,e.top),t.ctx.closePath(),t},t.line=function(e){return t.ctx.beginPath(),t.ctx.moveTo(e.left,e.top),2===e.edge.length&&"object"!=typeof e.edge[0]?function(){t.ctx.lineTo(e.edge[0],e.edge[1])}():function(){for(var n=0,i=e.edge.length;n<i;n++)t.ctx.lineTo(e.edge[n][0],e.edge[n][1])}(),n(t.ctx,e),t.ctx.stroke(),t.ctx.closePath(),t},t.rect=function(e){return t.ctx.beginPath(),t.ctx.rect(e.left,e.top,e.width,e.height),n(t.ctx,e),t.ctx.closePath(),t},t.rounded=function(e){return t.ctx.beginPath(),t.ctx.moveTo(e.left+e.radius,e.top),t.ctx.lineTo(e.left+e.width-e.radius,e.top),t.ctx.arcTo(e.left+e.width,e.top,e.left+e.width,e.top+e.radius,e.radius),t.ctx.lineTo(e.left+e.width,e.top+e.height-e.radius),t.ctx.arcTo(e.left+e.width,e.top+e.height,e.left+e.width-e.radius,e.top+e.height,e.radius),t.ctx.lineTo(e.left+e.radius,e.top+e.height),t.ctx.arcTo(e.left,e.top+e.height,e.left,e.top+e.height-e.radius,e.radius),t.ctx.lineTo(e.left,e.top+e.radius),t.ctx.arcTo(e.left,e.top,e.left+e.radius,e.top,e.radius),n(t.ctx,e),t.ctx.closePath(),t},t.arrow=function(e){var i=Math.atan2(e.height-e.top,e.width-e.left);return t.ctx.beginPath(),t.ctx.moveTo(e.left,e.top),t.ctx.lineTo(e.width,e.height),t.ctx.lineTo(e.width-e.headLen*Math.cos(i-Math.PI/6),e.height-e.headLen*Math.sin(i-Math.PI/6)),t.ctx.moveTo(e.width,e.height),t.ctx.lineTo(e.width-e.headLen*Math.cos(i+Math.PI/6),e.height-e.headLen*Math.sin(i+Math.PI/6)),n(t.ctx,e),t.ctx.closePath(),t},t.getRatio=function(){var t=document.createElement("canvas").getContext("2d");return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)},t.context=function(e){return t.ctx=e,t},t.createCanvas=function(e,n,i,o){o=o||t.getRatio();var a=document.createElement("canvas");a.id=e,a.width=Math.floor(n*o),a.height=Math.floor(i*o),a.style.width=n+"px",a.style.height=i+"px",a.getContext("2d").setTransform(o,0,0,o,0,0);var r=a.getContext("2d");return r.imageSmoothingEnabled=!1,r.mozImageSmoothingEnabled=!1,r.webkitImageSmoothingEnabled=!1,{canvas:a,ctx:r}},t}(render||{}),scale=function(t){function e(t,e){var i=[];if("number"==typeof e[0]&&"number"==typeof e[0]){for(var o=Math.max(e[0],e[1]),a=Math.min(e[0],e[1]),r=o-a,c=a;c<r;c++)i.push(c);return n.data.push(i),n.len.push(r),"ordinal"===t?i:[a,o]}return n.data.push(e),n.len.push(e.length),e}var n={data:[],len:[]};return t.ordinal=function(t,n){return d3.scaleBand?d3.scaleBand().domain(e("ordinal",t)).range(n):d3.scale.ordinal().domain(e("ordinal",t)).rangeBands(n)},t.linear=function(t,n){return d3.scaleLinear?d3.scaleLinear().domain(e("linear",t)).range(n):d3.scale.linear().domain(e("linear",t)).range(n)},t.compatibleBand=function(t){return t.bandwidth?t.bandwidth():t.rangeBand()},t.getDomain=function(){return n.data.shift()},t.getDomainLength=function(){return n.len.shift()},t.getDistance=function(t,e){return e.length<2?t(e[0]):t(e[1])-t(e[0])},t.date=function(){console.log("Date")},t}(scale||{}),selectBox=function(t){var e={};return t.element=function(n){return e.element=n,arguments.length?t:e.element},t.data=function(n){return e.data=n,arguments.length?t:e.data},t.make=function(){var n=document.querySelector(e.element),i=document.createElement("select"),o=document.createElement("option");o.disabled=!0,o.selected=!0,o.hidden=!0,o.text="Choose a gene set",i.className=e.element.substring(1,e.element.length),i.options.add(o);for(var a=0,r=e.data.length;a<r;a++){var c=e.data[a],l=document.createElement("option");l.text=c,l.value=c,i.options.add(l)}return n.appendChild(i),t},t}(selectBox||{}),size={};size.setMargin=function(t){if("number"==typeof t)return{top:t,left:t,bottom:t,right:t};if("[object Object]"===Object.prototype.toString.call(t))return t;switch(t.length){case 1:return{top:t[0],left:t[0],bottom:t[0],right:t[0]};case 2:return{top:t[0],left:t[1],bottom:t[0],right:t[1]};case 3:return{top:t[0],left:t[1],bottom:t[2],right:t[1]};case 4:default:return{top:t[0],left:t[1],bottom:t[2],right:t[3]}}},size.chart={},size.chart.mutualExt=function(t,e,n){return t.style.width=e+"px",t.style.height=n+"px",{survival:{w:.3*e,h:n},selectBox:{w:.7*e,h:.05*n},separateBar:{w:.7*e,h:.1*n},group:{w:.7*e,h:.25*n},network:{w:.7*e*.3,h:.6*n},heatmap:{w:.7*e*.7,h:.5*n},legend:{w:.7*e*.7,h:.1*n}}};var survival=function(t){return function(t){var e=t.element||null,n=document.querySelector(e),i=parseFloat(t.width||n.style.width||360),o=parseFloat(t.height||n.style.height||600),a=render.createCanvas(e.substring(1,e.length),i,o),r=a.canvas,c=a.ctx;n.appendChild(r),eventHandler.context(c).hover(function(t){console.log(t)})}}(),variants=function(){return function(t){var e=t.element||null,n=document.querySelector(e),i=t.width||n.style.width||1200,o=t.height||n.style.height||600;console.log("Variants","\nElement: ",e,"\nWidth: ",i,"\nHeight: ",o)}}();